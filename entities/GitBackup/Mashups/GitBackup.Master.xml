<?xml version="1.0" encoding="UTF-8"?>
<Entities
 build="b103"
 majorVersion="8"
 minorVersion="5"
 modelPersistenceProviderPackage="PostgresPersistenceProviderPackage"
 revision="5"
 schemaVersion="1054"
 universal="password">
    <Mashups>
        <Mashup
         aspect.isEditableExtensionObject="true"
         aspect.isExtension="true"
         aspect.isResponsive="true"
         aspect.mashupType="target"
         columns="0.0"
         description=""
         documentationContent=""
         homeMashup=""
         lastModifiedDate="2020-06-24T19:58:40.778Z"
         name="GitBackup.Master"
         projectName="GitBackup"
         rows="0.0"
         tags="Applications:GitBackup">
            <avatar></avatar>
            <DesignTimePermissions>
                <Create></Create>
                <Read></Read>
                <Update></Update>
                <Delete></Delete>
                <Metadata></Metadata>
            </DesignTimePermissions>
            <RunTimePermissions></RunTimePermissions>
            <VisibilityPermissions>
                <Visibility></Visibility>
            </VisibilityPermissions>
            <ConfigurationTableDefinitions></ConfigurationTableDefinitions>
            <ConfigurationTables></ConfigurationTables>
            <ParameterDefinitions></ParameterDefinitions>
            <Things></Things>
            <ThingShapes></ThingShapes>
            <ThingTemplates></ThingTemplates>
            <mashupContent>
            <![CDATA[
            {
              "ConfigurationTables" : { },
              "CustomMashupCss" : "",
              "Data" : {
                "Session" : {
                  "DataName" : "Session",
                  "EntityName" : "",
                  "EntityType" : "Session",
                  "Id" : "session",
                  "Services" : [ {
                    "APIMethod" : "post",
                    "Characteristic" : "Services",
                    "Id" : "SessionInterface",
                    "Name" : "GetGlobalSessionValues",
                    "Parameters" : { },
                    "RefreshInterval" : 0,
                    "Target" : "GetGlobalSessionValues"
                  } ]
                },
                "UserExtensions" : {
                  "DataName" : "UserExtensions",
                  "EntityName" : "",
                  "EntityType" : "UserExtensions",
                  "Id" : "UserExtensions",
                  "Services" : [ {
                    "APIMethod" : "post",
                    "Characteristic" : "Services",
                    "Id" : "UserExtensionInterface",
                    "Name" : "GetCurrentUserExtensionProperties",
                    "Parameters" : { },
                    "RefreshInterval" : 0,
                    "Target" : "GetCurrentUserExtensionProperties"
                  } ]
                }
              },
              "DataBindings" : [ ],
              "DesignTimePermissions" : {
                "Create" : [ ],
                "Delete" : [ ],
                "Metadata" : [ ],
                "Read" : [ ],
                "Update" : [ ]
              },
              "Events" : [ {
                "EventHandlerArea" : "UI",
                "EventHandlerId" : "expression-11",
                "EventHandlerService" : "Evaluate",
                "EventTriggerArea" : "Mashup",
                "EventTriggerEvent" : "Loaded",
                "EventTriggerId" : "mashup-root",
                "EventTriggerSection" : "",
                "Id" : "9a96522e-6c25-46e4-90ae-8e3ed019add7"
              }, {
                "EventHandlerArea" : "UI",
                "EventHandlerId" : "expression-8",
                "EventHandlerService" : "Evaluate",
                "EventTriggerArea" : "UI",
                "EventTriggerEvent" : "Changed",
                "EventTriggerId" : "expression-11",
                "EventTriggerSection" : "",
                "Id" : "64a08de7-60b9-459b-a400-3e22d3dc8bfd"
              } ],
              "RunTimePermissions" : {
                "permissions" : [ ]
              },
              "UI" : {
                "Properties" : {
                  "Area" : "Mashup",
                  "BGImageRepeat" : "no-repeat",
                  "BGImageSize" : "auto",
                  "DisplayName" : "Mashup",
                  "DropShadow" : false,
                  "Font" : "Arial, Helvetica",
                  "Height" : 768,
                  "Id" : "mashup-root",
                  "Left" : 0,
                  "MaxWidth" : 0,
                  "MinHeight" : 0,
                  "MinWidth" : 0,
                  "ResponsiveLayout" : true,
                  "ShowDataLoading" : true,
                  "Style" : "DefaultContainerStyle",
                  "StyleTheme" : "Base Theme",
                  "Title" : "",
                  "Top" : 0,
                  "Type" : "targetmashup",
                  "UseThemeForHybrids" : false,
                  "Visible" : true,
                  "Width" : 1024,
                  "WindowStyle" : "DefaultMasterWindowStyle",
                  "Z-index" : 10,
                  "__TypeDisplayName" : "Master Mashup",
                  "id_index" : 11,
                  "supportsAutoResize" : true
                },
                "Widgets" : [ {
                  "Properties" : {
                    "Area" : "UI",
                    "Columns" : 0,
                    "DisplayName" : "Master Layout",
                    "Footer" : false,
                    "FooterHeight" : 0,
                    "Header" : true,
                    "HeaderHeight" : 50,
                    "Id" : "layout-1",
                    "IncludeSpacingInFixedAreas" : false,
                    "IsPrintLayout" : false,
                    "LeftSidebar" : false,
                    "LeftSidebarWidth" : 0,
                    "Orientation" : "vertical",
                    "PctColumn1" : 50,
                    "PctColumn2" : 50,
                    "PctColumn3" : 1,
                    "PctColumn4" : 1,
                    "PctColumn5" : 1,
                    "PctColumn6" : 1,
                    "PctColumn7" : 1,
                    "PctColumn8" : 1,
                    "PctRow1" : 100,
                    "PctRow2" : 50,
                    "PctRow3" : 0,
                    "PctRow4" : 0,
                    "PctRow5" : 0,
                    "PctRow6" : 0,
                    "PctRow7" : 0,
                    "PctRow8" : 0,
                    "PrintMarginLeftRight" : 0.5,
                    "PrintMarginTopBottom" : 0.5,
                    "PrintWidth" : 650,
                    "ResponsiveLayout" : true,
                    "RightSidebar" : false,
                    "RightSidebarWidth" : 0,
                    "Rows" : 1,
                    "ShowDataLoading" : true,
                    "Spacing" : 0,
                    "Type" : "layout",
                    "Visible" : true,
                    "Z-index" : 10,
                    "__TypeDisplayName" : "Layout"
                  },
                  "Widgets" : [ {
                    "Properties" : {
                      "AnimateExpandCollapse" : true,
                      "Area" : "UI",
                      "BGImageRepeat" : "no-repeat",
                      "BGImageSize" : "auto",
                      "DisplayName" : "Header",
                      "ExpandCollapseTabLocation" : "outside",
                      "Expanded" : true,
                      "Id" : "container-2",
                      "MinHeight" : 0,
                      "MinWidth" : 0,
                      "Overlay" : true,
                      "OverlayIsTransparent" : true,
                      "ResponsiveLayout" : true,
                      "ShowDataLoading" : true,
                      "ShowExpandCollapseTab" : false,
                      "Style" : "DefaultContainerStyle",
                      "TabCollapseStyle" : "DefaultTabCollapseStyle",
                      "TabExpandStyle" : "DefaultTabExpandStyle",
                      "TabHeight" : 36,
                      "TabLocation" : "center",
                      "TabOffset" : 0,
                      "TabWidth" : 36,
                      "Type" : "container",
                      "Visible" : true,
                      "Z-index" : 10,
                      "__TypeDisplayName" : "Container",
                      "userCannotRemove" : true
                    },
                    "Widgets" : [ {
                      "Properties" : {
                        "Area" : "UI",
                        "DisplayName" : "panel-7",
                        "Height" : 200,
                        "HideScrollbars" : false,
                        "HorizontalAnchor" : "left",
                        "Id" : "panel-7",
                        "Left" : 110,
                        "ResponsiveLayout" : true,
                        "ShowDataLoading" : true,
                        "Style" : "DefaultContainerStyle",
                        "Top" : 20,
                        "Type" : "panel",
                        "VerticalAnchor" : "top",
                        "Visible" : true,
                        "Width" : 300,
                        "Z-index" : 10,
                        "__TypeDisplayName" : "Panel"
                      },
                      "Widgets" : [ {
                        "Properties" : {
                          "Area" : "UI",
                          "AutoEvaluate" : false,
                          "DataChangeType" : "ALWAYS",
                          "DisplayName" : "expression-8",
                          "Expression" : "(function () {// ----BEGIN: extensions/BMCodeHost/ui/BMCodeHost/BMCodeHost.runtime.js\n/**\n * Returns the widget with the specified id by searching the target mashup.\n * {\n * \t@param withId <String, nullable> \t\t\t\t\tRequired if named is not specified. The ID of the widget to find\n * \t@param named <String, nullable>\t\t\t\t\t\tThe display name of the widget, if specified, the search will find the first widget \n *\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat has the specified id (if given) or the speficied display name.\n * \t@param inMashup <TWMashup>\t\t\t\t\t\t\tThe mashup object in which to search.\n * \t@param traverseContainedMashup <Boolean, nullable> \tDefaults to false. If set to true, the search will include other mashups contained within the source mashup.\n * }\n * @return <TWWidget, nullable> \t\t\t\t\t\tThe actual widget object if found, null otherwise\n */\nfunction BMFindWidget(args) {\n\tvar id = args.withId;\n\tvar mashup = args.inMashup;\n\tvar name = args.named;\n\t\n\tif (!mashup) mashup = TW.Runtime.Workspace.Mashups.Current;\n\t\n\treturn BMFindWidgetRecursive(id, name, mashup.rootWidget, args.traverseContainedMashup);\n}\n\nfunction BMFindWidgetRecursive(id, name, container, includeContainedMashup) {\n\t\n\tvar widgets = container.getWidgets();\n\tvar length = widgets.length;\n\t\n\tfor (var i = 0; i < length; i++) {\n\t\tvar widget = widgets[i];\n\t\t\n\t\tif (widget.idOfThisElement == id || widget.properties.Id == id) return widget;\n\t\tif (widget.properties.DisplayName == name) return widget;\n\t\t\n\t\tvar subWidgets = widget.getWidgets();\n\t\tif (widget.properties.__TypeDisplayName == \"Contained Mashup\" && !includeContainedMashup) continue;\n\t\tif (subWidgets.length > 0) {\n\t\t\twidget = BMFindWidgetRecursive(id, name, widget, includeContainedMashup);\n\t\t\t\n\t\t\tif (widget) return widget;\n\t\t}\n\t\t\n\t\t\n\t}\n\t\n\treturn null;\n\t\n}\n\nTW.Runtime.Widgets.BMCodeHost = function () {\n\n\tvar self = this;\n\n\t/**\n\t * Finds and returns the widget instance with the given DisplayName.\n\t * @param name <String>\t\t\t\tThe display name.\n\t * @return <TWWidget, nullable>\t\tThe widget, if it was found or null otherwise.\n\t */\n\tself.widgetNamed = function (name) {\n\t\treturn BMFindWidget({named: name, inMashup: self.mashup});\n\t};\n\t\n\t/**\n\t * May be invoked to publish a property update to a widget, as if it came from a binding.\n\t * @param widget <TWWidget>\t\t\tThe widget whose property should update.\n\t * {\n\t *\t@param forProperty <String>\t\tThe property to update.\n\t *\t@param value <AnyObject>\t\tThe property's new value.\n\t * }\n\t */\n\tself.dispatchPropertyUpdateToWidget = function (widget, args) {\n\t\tvar value = args.value;\n\t\twidget.updateProperty({TargetProperty: args.forProperty, SinglePropertyValue: args.value, RawSinglePropertyValue: args.value, \n\t\t\tActualDataRows: (value && value.rows && value.dataShape) ? value.rows : value\n\t\t});\n\t};\n\n\t/**\n\t * A shortcut to self.widgetNamed.\n\t */\n\tvar $w = self.widgetNamed;\n\tvar $j = function (name) {\n\t\tvar widget = $w(name);\n\t\tif (widget) {\n\t\t\treturn widget.jqElement;\n\t\t}\n\t\telse {\n\t\t\treturn;\n\t\t}\n\t};\n\n\tvar $b = function (name) {\n\t\tvar widget = $w(name);\n\t\tif (widget) {\n\t\t\treturn widget.boundingBox;\n\t\t}\n\t\telse {\n\t\t\treturn;\n\t\t}\n\t};\n\n    self.renderHtml = function () {\n\t\tvar properties = JSON.parse(this.getProperty(\"RuntimeProperties\"));\n\n\t\tfor (var i = 0; i < properties.length; i++) {\n\t\t\tif (properties[i].type != \"property\") continue;\n\n\t\t\t(function (name) {\n\t\t\t\t// Initialize the property values to the values set in the composer\n\t\t\t\tself[\"_CodeHost_property_\" + name] = self.getProperty(name);\n\t\t\t\tObject.defineProperty(self, name, {\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn self[\"_CodeHost_property_\" + name];\n\t\t\t\t\t},\n\t\t\t\t\tset: function(value) {\n\t\t\t\t\t\tself[\"_CodeHost_property_\" + name] = value;\n\t\t\t\t\t\tself.setProperty(name, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// Create observer functions\n\t\t\t\tself[name + 'ShouldUpdateToValue'] = function () {\n\t\t\t\t\treturn YES;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tself[name + 'DidUpdateToValue'] = function () {};\n\t\t\t\t\n\t\t\t})(properties[i].name);\n\t\t}\n\n        return '<div class=\"widget-content\"></div>';\n    };\n\n\tself.updateProperty = function (updatePropertyInfo) {\n\t\ttry {\n\t\t\tvar property = updatePropertyInfo.TargetProperty;\n\t\t\tvar value = updatePropertyInfo.RawSinglePropertyValue || updatePropertyInfo.SinglePropertyValue;\n\t\t\tvar previousValue = self[property];\n\t\t\tif (self[property + 'ShouldUpdateToValue'](value, {fromValue: previousValue})) {\n\t\t\t\tself[property] = value;\n\t\n\t\t\t\tself[property + 'DidUpdateToValue'](self[property], {fromValue: previousValue});\n\t\t\t\tself.propertyDidUpdateToValue(property, self[property]);\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t};\n\t\n\tself.propertyDidUpdateToValue = function (name, value) {\n\t\t\n\t};\n\n\t/**\n\t * Should be invoked to dispatch an event to the Thingworx runtime.\n\t * @param name <String>\t\tThe event to dispatch.\n\t */\n\tself.dispatchEvent = function (name) {\n\t\tself.jqElement.triggerHandler(name);\n\t};\n\n\tself.afterRender = function() {\n\t\t\n\t\tvar afterRender = self.afterRender;\n\t\t\n\t\ttry {\n\t\t\tif (this.getProperty(\"Scope\") == \"local\") {\n\t\t\t\teval(this.getProperty(\"Code\") + \"\\n//# sourceURL=\" + this.getProperty(\"Title\") + \".js\");\n\t\t\t\t\n\t\t\t\tif (typeof self.renderWithContainer == 'function') {\n\t\t\t\t\tself.renderWithContainer(self.jqElement);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tself.boundingBox.css({display: 'none'});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Fire afterRender if it was redefined\n\t\t\t\tif (self.afterRender != afterRender) self.afterRender();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t(0, eval)(this.getProperty(\"Code\") + \"\\n//# sourceURL=\" + this.getProperty(\"Title\") + \".js\");\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t}\n\n\tself.serviceInvoked = function (serviceName) {\n\t\t// Ensure that the service has been implemented by the script\n\t\tif (typeof self[serviceName] == 'function') {\n\t\t\ttry {\n\t\t\t\tself[serviceName]();\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tconsole.log(\"Unable to invoke service \" + serviceName + \"; no handler has been defined for it.\");\n\t\t}\n\t};\n\n\n};\n\nTW.Runtime.Widgets.BMTypescriptHost = function () {\n\tTW.Runtime.Widgets.BMCodeHost.call(this);\n\n\tvar self = this;\n\t\n\n\t/**\n\t * A shortcut to self.widgetNamed.\n\t */\n\tvar $w = self.widgetNamed;\n\tvar $j = function (name) {\n\t\tvar widget = $w(name);\n\t\tif (widget) {\n\t\t\treturn widget.jqElement;\n\t\t}\n\t\telse {\n\t\t\treturn;\n\t\t}\n\t};\n\n\tvar $b = function (name) {\n\t\tvar widget = $w(name);\n\t\tif (widget) {\n\t\t\treturn widget.boundingBox;\n\t\t}\n\t\telse {\n\t\t\treturn;\n\t\t}\n\t};\n\n\tself.afterRender = function() {\n\t\t\n\t\tvar afterRender = self.afterRender;\n\t\t\n\t\ttry {\n\t\t\tif (this.getProperty(\"Scope\") == \"local\") {\n\t\t\t\teval(this.getProperty(\"TranspiledCode\") + \"\\n//# sourceURL=\" + this.getProperty(\"Title\") + \".ts\");\n\t\t\t\t\n\t\t\t\tif (typeof self.renderWithContainer == 'function') {\n\t\t\t\t\tself.renderWithContainer(self.jqElement);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tself.boundingBox.css({display: 'none'});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Fire afterRender if it was redefined\n\t\t\t\tif (self.afterRender != afterRender) self.afterRender();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t(0, eval)(this.getProperty(\"TranspiledCode\") + \"\\n//# sourceURL=\" + this.getProperty(\"Title\") + \".ts\");\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\t}\n}\n\nvar BMCSSHostWidgetRegex = /\\$([^=\\s\\.#\\[\\]@>\\*\\:\\~\\\"\\(\\)]+)/g;\n\nTW.Runtime.Widgets.BMCSSHost = function () {\n\n\tvar self = this;\n\n    this.renderHtml = function () {\n        return '<div class=\"widget-content\"></div>';\n    };\n\n\tthis.afterRender = function() {\n\t\tthis.boundingBox.css({display: 'none'});\n\t\t\n\t\tvar style = this.getProperty('Code');\n\t\tvar self = this;\n\n\t\tthis.style = $(\"<style>\").text(style);\n\n\t\t$(\"head\").append(this.style);\n\n\t\tif (self.getProperty('DirectLink')) {\n\t\t\tself.resolveThing();\n\t\t}\n\t}\n\n\tthis.resolveThing = function () {\n\t\tvar resolver = new XMLHttpRequest();\n\t\tresolver.open('POST', '/Thingworx/Things/Debugger.Websocket/Services/GetConfigurationTable?x-thingworx-session=true');\n\t\tresolver.setRequestHeader('x-thingworx-session', true);\n\t\tresolver.setRequestHeader('Content-Type', 'application/json');\n\t\tresolver.setRequestHeader('Accept', 'application/json');\n\t\t\n\t\tresolver.onload = function (event) {\n\t\t\tif (resolver.status == 200) {\n\t\t\t\tself.host = (location.protocol.indexOf('https') == -1 ? 'ws://' : 'wss://') + location.host + '/Thingworx' + JSON.parse(resolver.responseText).rows[0].endpoint;\n\t\t\t\tself.connect();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsnackBarWithAction(\"test\", '[CSS] DirectLink was unable to connect', 'RETRY', function () {\n\t\t\t\t\tself.resolveThing();\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\t\n\t\tresolver.onerror = function (event) {\n\t\t\tsnackBarWithAction(\"test\", '[CSS] DirectLink was unable to connect', 'RETRY', function () {\n\t\t\t\tself.resolveThing();\n\t\t\t});\n\t\t};\n\t\t\n\t\tresolver.send(JSON.stringify({\n\t\t\ttableName: 'PortInfo'\n\t\t}));\n\t}\n\t\n\tthis.connect = function () {\n\t\ttry{\n\n\t\t\tvar socket;\n\t\t\tvar host = this.host;\n\t\t\tvar requiredNamespace = this.getProperty(\"DirectLinkUUID\");\n\t\t\tvar requiredNamespaceComponents = requiredNamespace.split(\".\");\n\t\t\tthis.socket = new WebSocket(host);\n\t\t\tvar socket = this.socket;\n\n\t\t\tsocket.onopen = function(){\n\t\t\t}\n\n\t\t\tsocket.onmessage = function(msg) {\n\t\t\t\t\n\t\t\t\t// message format is \"[namespace]message\"\n\t\t\t\tvar incomingMessage = msg.data;\n\t\t\t\tvar compatibleNamespace = false;\n\t\t\t\t\n\t\t\t\tvar incomingNamespace = incomingMessage.substring(0, incomingMessage.indexOf(\"]\")).substring(1);\n\t\t\t\tvar incomingMessage = incomingMessage.substring(incomingMessage.indexOf(\"]\") + 1);\n\t\t\t\t\n\t\t\t\tif (requiredNamespace == \"\") {\n\t\t\t\t\tcompatibleNamespace = true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcompatibleNamespace = true;\n\n\t\t\t\t\tvar namespaceComponents = incomingNamespace.split(\".\");\n\t\t\t\t\t\n\t\t\t\t\tfor (var i = 0; i < requiredNamespaceComponents; i++) {\n\t\t\t\t\t\tif (namespaceComponents[i] != requiredNamespaceComponents[i]) {\n\t\t\t\t\t\t\tcompatibleNamespace = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (compatibleNamespace) {\n\t\t\t\t\tself.style.remove();\n\n\t\t\t\t\tself.style = $(\"<style>\").text(incomingMessage);\n\t\t\n\t\t\t\t\t$(\"head\").append(self.style);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsocket.onclose = function(){\n\t\t\t\tsnackBarWithAction(self.jqElement.attr('id') + \"-snackbar\", \"[CSS] DirectLink was disconnected\", \"RECONNECT\", function () {\n\t\t\t\t\tself.connect();\n\t\t\t\t});\n\t\t\t}\t\t\t\n\n\t\t} catch(exception){\n\t\t\tsnackBarWithAction(self.jqElement.attr('id') + \"-snackbar\", \"[CSS] DirectLink was unable to connect\", \"RECONNECT\", function () {\n\t\t\t\tself.connect();\n\t\t\t});\n\t\t}\n\t\t\n\t}\n\n\tthis.beforeDestroy = function () {\n\t\tif (this.style) this.style.remove();\n\t}\n\n};\n\n// ----END: extensions/BMCodeHost/ui/BMCodeHost/BMCodeHost.runtime.js\n// ----BEGIN: extensions/BMCoreUI/ui/BMCoreUI/BMCoreUI.min.js\n/*\n:\n|-----------------------------------------------------------------------------\n| \n| Copyright (c) 2014, Nucleic Development Team.\n|\n| Distributed under the terms of the Modified BSD License.\n|\n| The full license is in the file COPYING.txt, distributed with this software.\n|---------------------------------------------------------------------------- VelocityJS.org (1.3.0). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License  VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License.  iScroll v5.2.0 ~ (c) 2008-2016 Matteo Spinelli ~ @license: http://cubiq.org/license */\n'use strict';var BMCoreUI=\"2.1.0\",YES=!0,NO=!1;\"remove\"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});var BMIsTouchDevice=!!(\"ontouchstart\"in window||navigator.maxTouchPoints),_BMScrollBarSize;\nfunction BMScrollBarGetSize(){if(void 0!==_BMScrollBarSize)return _BMScrollBarSize;var a=document.createElement(\"div\");a.style=\"width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;\";document.body.appendChild(a);_BMScrollBarSize=a.offsetWidth-a.clientWidth;a.remove?a.remove():a.removeNode(YES);return _BMScrollBarSize}\nfunction BMCSSRuleWithSelector(a,b){let c=b.properties,d=a+\" {\\n\";Object.keys(c).forEach((a)=>{d+=a+\": \"+c[a]+(b.important?\" !important\":\"\")+\";\\n\"});return d+=\"\\n}\\n\"}\nfunction BMAddSmoothMousewheelInteractionToNode(a,b){function c(){var b=Math.sign(f);let d=Math.sign(h);f&&(f-=b*g);h&&(h-=d*g);f&&(f+=b*k);h&&(h+=d*l);k&&(k-=.5);l&&(l-=.5);Math.sign(f)!=b&&(f=0);Math.sign(h)!=d&&(h=0);(h||f)&&requestAnimationFrame(c);if(f||h)b=new WheelEvent(\"wheel\",{deltaX:f,deltaY:h,deltaZ:0,deltaMode:0,clientX:m.clientX,cientY:m.clientY,offsetX:m.offsetX,offsetY:m.offsetY,layerX:m.layerX,layerY:m.layerY,target:m.target}),b._BMIsCustomScrollEvent=YES,a.dispatchEvent(b)}let d=\nNO,e;b=b||{};let f=0,h=0,g=b.withDeceleration||3,k=0,l=0,m,q=b.baseAcceleration||6,n=b.speedIncrement||20;a.addEventListener(\"mousedown\",function(){h=f=0});a.addEventListener(\"wheel\",function(a){e&&window.clearTimeout(e);e=window.setTimeout((a)=>{e=void 0;d=NO},200);a._BMIsCustomScrollEvent||d||(0==a.deltaMode&&50>Math.abs(a.deltaX)&&50>Math.abs(a.deltaY)&&0==Math.floor(a.deltaY)-a.deltaY?d=YES:(m=a,a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),0==f&&0==h&&requestAnimationFrame(c),\nMath.sign(a.deltaX)!=Math.sign(f)||0==f?(f=q*Math.sign(a.deltaX),k=q):f+=a.deltaX?Math.sign(a.deltaX)*n:0,Math.sign(a.deltaY)!=Math.sign(h)||0==h?(h=q*Math.sign(a.deltaY),l=q):h+=a.deltaY?Math.sign(a.deltaY)*n:0))})}function BMHook(a,b){for(var c in b)(window.Velocity||$.Velocity).hook(a,c,b[c])}\nfunction BMExtend(a){void 0===a&&(a={});var b=arguments.length;if(\"function\"==typeof Object.getOwnPropertyDescriptors)for(var c=1;c<b;c++){var d=Object.getOwnPropertyDescriptors(arguments[c]);Object.defineProperties(a,d)}else for(c=1;c<b;c++){d=Object.getOwnPropertyNames(arguments[c]);for(var e=0;e<d.length;e++){var f=Object.getOwnPropertyDescriptor(arguments[c],d[e]);f&&Object.defineProperty(a,d[e],f)}}return a}\nfunction BMCopyProperties(a){var b=arguments.length,c=arguments;void 0===a&&(a={});for(var d=1;d<b;d++)Object.getOwnPropertyNames(arguments[d]).forEach(function(b){a[b]=c[d][b]});return a}function BMShadowForElevation(a,b){b=b||{};var c=void 0===b.opacity?.1:b.opacity;return\"0px \"+4*a+\"px \"+6*a+\"px rgba(0, 0, 0, \"+c+\"), \"+(\"0px \"+8*a+\"px \"+12*a+\"px\")+\" rgba(0, 0, 0, \"+c+\")\"+(b.drawOutline||NO?\", 0px 0px 1px 1px rgba(0, 0, 0, \"+c+\")\":\"\")}\nfunction BMRippleMakeWithElement(a,b){var c=b.forTarget;a[0].classList.add(\"BMRipple\");var d=BMIsTouchDevice?\"touchend.ripple\":\"mouseup.ripple\";c.on(BMIsTouchDevice?\"touchstart.ripple\":\"mousedown.ripple\",function(b){var e=c.outerWidth(),h=c.outerHeight(),g=Math.sqrt(Math.pow(e,2)+Math.pow(h,2)),k=c[0].getBoundingClientRect(),l=k.left;k=k.top;b.pageX=BMIsTouchDevice?b.originalEvent.touches[0].screenX:b.originalEvent.clientX;b.pageY=BMIsTouchDevice?b.originalEvent.touches[0].screenY:b.originalEvent.clientY;\na.velocity(\"stop\",!0).css({width:\"0px\",height:\"0px\",opacity:0});BMHook(a,{translateX:b.pageX-l+\"px\",translateY:b.pageY-k+\"px\"});a.velocity({translateX:(e-g)/2+\"px\",translateY:(h-g)/2+\"px\",width:g+\"px\",height:g+\"px\",opacity:1},{duration:400,easing:\"ease-out\",display:\"block\",queue:NO});let m=BMUUIDMake();$(window).on(d+m,function(b){$(window).off(d+m);a.velocity({opacity:0},{duration:300,easing:\"ease-in-out\",display:\"none\",queue:NO})})})}\nfunction BMRippleMakeForTarget(a,b){b=b&&b.withColor||\"rgba(0, 0, 0, .1)\";b=b.RGBAString||b;var c=$('<div style=\"position: absolute; display: block; top: 0px; left: 0px; border-radius: 50%;\"></div>');c.css({backgroundColor:b});BMRippleMakeWithElement(c,{forTarget:a});return c}function BMNumberByInterpolatingNumbersWithFraction(a,b,c){return(b-a)*c+a}function BMNumberByConstrainingNumberToBounds(a,b,c){return Math.max(b,Math.min(a,c))}\nfunction BMKeysForValue(a,b){var c=[];Object.getOwnPropertyNames(b.inObject).forEach(function(d){b.inObject[d]==a&&c.push(d)});return c}function BMUUIDMake(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return(\"x\"==a?b:b&3|8).toString(16)})}var BMHTMLEntity=Object.freeze({Command:\"&#8984;\",Option:\"&#8997;\",Shift:\"&#8679;\",CapsLock:\"&#8682;\",Delete:\"&#9003;\",Return:\"&#9166;\"});\nfunction BMInset(a,b,c,d){this.left=a||0;this.top=b||0;this.right=c||0;this.bottom=d||0}BMInset.prototype={left:0,top:0,right:0,bottom:0,copy:function(){return new BMInset(this.left,this.top,this.right,this.bottom)}};function BMInsetMakeWithEqualInsets(a){a=a||0;return BMInsetMake(a,a,a,a)}BMInset.insetWithEqualInsets=BMInsetMakeWithEqualInsets;function BMInsetMake(a,b,c,d){return new BMInset(a,b,c,d)}\nfunction BMInsetMakeWithLeft(a,b){b=b||{};return new BMInset(a||0,b.top||0,b.right||0,b.bottom||0)}BMInset.insetWithLeft=BMInsetMakeWithLeft;var BMPoint=function(a,b){this.x=a||0;this.y=b||0};\nBMExtend(BMPoint.prototype,{x:0,y:0,get stringValue(){return this.x+\",\"+this.y},get integerStringValue(){return(this.x|0)+\",\"+(this.y|0)},get integerPointValue(){return BMPointMake(this.x|0,this.y|0)},isEqualToPoint:function(a){return this.x==a.x&&this.y==a.y},copy:function(){return BMPointMake(this.x,this.y)},distanceToPoint:function(a){return BMDistanceBetweenPoints(this,a)},slopeAngleToPoint:function(a){return BMSlopeAngleBetweenPoints(this,a)},interpolatedValueWithFraction(a,b){b=b.toValue;return BMPointMake(BMNumberByInterpolatingNumbersWithFraction(this.x,\nb.x,a),BMNumberByInterpolatingNumbersWithFraction(this.y,b.y,a))}});var BMPointMake=function(a,b){return new BMPoint(a,b)},BMPointMakeWithX=function(a,b){return new BMPoint(a||0,b&&b.y||0)},BMDistanceBetweenPoints=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},BMSlopeAngleBetweenPoints=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},BMSize=function(a,b){this.width=a||0;this.height=b||0};\nBMSize.prototype={newRectWithSize:function(){return new BMRect(new BMPoint,this)},copy:function(){return new BMSize(this.width,this.height)},isEqualToSize:function(a){return a.width===this.width&&a.height===this.height},interpolatedValueWithFraction(a,b){b=b.toValue;return BMSizeMake(BMNumberByInterpolatingNumbersWithFraction(this.width,b.width,a),BMNumberByInterpolatingNumbersWithFraction(this.height,b.height,a))}};function BMSizeMake(a,b){return new BMSize(a,b)}\nvar BMRect=function(a,b){a=a||new BMPoint;b=b||new BMSize;this.origin=a;this.size=b};\nBMRect.prototype={origin:void 0,size:void 0,get right(){return this.origin.x+this.size.width},get bottom(){return this.origin.y+this.size.height},get left(){return this.origin.x},get top(){return this.origin.y},get width(){return this.size.width},get height(){return this.size.height},get center(){return new BMPoint(this.origin.x+this.size.width/2,this.origin.y+this.size.height/2)},set center(a){var b=this.center;this.offset(a.x-b.x,a.y-b.y)},isEqualToRect:function(a){return a.origin.x==this.origin.x&&\na.origin.y==this.origin.y&&this.size.width==a.size.width&&this.size.height==a.size.height},intersectsRect:function(a){return this.isEqualToRect(a)?YES:!(a.left>this.right||a.right<this.left||a.top>this.bottom||a.bottom<this.top)},intersectsContentOfRect:function(a){return this.isEqualToRect(a)?YES:!(a.left>=this.right||a.right<=this.left||a.top>=this.bottom||a.bottom<=this.top)},rectByIntersectingWithRect:function(a){var b=new BMPoint(Math.max(this.left,a.left),Math.max(this.top,a.top));a=new BMSize(Math.min(this.right,\na.right)-b.x,Math.min(this.bottom,a.bottom)-b.y);if(!(0>=a.width||0>=a.height))return new BMRect(b,a)},rectsByExclusiveOrWithRect:function(a){},rectsWithDifferenceFromRect:function(a){if(!this.isEqualToRect(a)){var b=this.rectByIntersectingWithRect(a);if(!b)return[this];if(!b.isEqualToRect(this)){if(b.size.height==this.size.height)return[BMRectMake(b.origin.x==this.origin.x?b.right:this.origin.x,this.origin.y,this.size.width-b.size.width,this.size.height)];if(b.size.width==this.size.width)return[BMRectMake(this.origin.x,\nb.origin.y==this.origin.y?b.bottom:this.origin.y,this.size.width,this.size.height-b.size.height)];a=BMRectMake(b.origin.x==this.origin.x?b.right:this.origin.x,this.origin.y,this.size.width-b.size.width,this.size.height);b=BMRectMake(a.origin.x==this.origin.x?a.right:this.origin.x,b.origin.y==this.origin.y?b.bottom:this.origin.y,this.size.width-a.size.width,this.size.height-b.size.height);return[a,b]}}},containsRect:function(a){return a.left>=this.left&&a.top>=this.top&&a.right<=this.right&&a.bottom<=\nthis.bottom},containsPoint:function(a){return a.x>this.left&&a.x<this.right&&a.y>this.top&&a.y<this.bottom},intersectsPoint:function(a){return a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom},offset:function(a,b){this.origin.x+=a;this.origin.y+=b},offsetWithX:function(a,b){this.origin.x+=a||0;this.origin.y+=b&&b.y||0},inset:function(a,b){void 0===b?(this.origin.x+=a.left,this.origin.y+=a.top,this.size.width-=a.left+a.right,this.size.height-=a.top+a.bottom):(this.origin.x+=a,this.origin.y+=\nb,this.size.width-=2*a,this.size.height-=2*b)},insetWithWidth:function(a,b){b=b.height;this.origin.x+=a;this.origin.y+=b;this.size.width-=2*a;this.size.height-=2*b},insetWithInset:function(a){this.origin.x+=a.left;this.origin.y+=a.top;this.size.width-=a.left+a.right;this.size.height-=a.top+a.bottom},rectWithInset:function(a){var b=this.copy();b.insetWithInset(a);return b},rectWithTransformToRect:function(a){var b=BMRectMake();b.size.width=a.size.width/this.size.width;b.size.height=a.size.height/this.size.height;\nvar c=a.center.y-this.center.y;b.origin.x=a.center.x-this.center.x;b.origin.y=c;return b},copy:function(){var a=new BMRect;a.origin.x=this.origin.x;a.origin.y=this.origin.y;a.size.width=this.size.width;a.size.height=this.size.height;return a},interpolatedValueWithFraction(a,b){return BMRectByInterpolatingRect(this,{toRect:b.toValue,withFraction:a})},toString(){return`(${this.origin.x}:${this.origin.y})=>[${this.size.width}:${this.size.height}]`}};\nfunction BMRectByInterpolatingRect(a,b){var c=b.toRect;b=b.withFraction;return BMRectMake(BMNumberByInterpolatingNumbersWithFraction(a.origin.x,c.origin.x,b),BMNumberByInterpolatingNumbersWithFraction(a.origin.y,c.origin.y,b),BMNumberByInterpolatingNumbersWithFraction(a.size.width,c.size.width,b),BMNumberByInterpolatingNumbersWithFraction(a.size.height,c.size.height,b))}function BMRectMake(a,b,c,d){return new BMRect(new BMPoint(a,b),new BMSize(c,d))}\nfunction BMRectMakeWithX(a,b){return new BMRect(new BMPoint(a,b&&b.y),new BMSize(b&&b.width,b&&b.height))}function BMRectMakeWithOrigin(a,b){return new BMRect(a||new BMPoint,b&&b.size||new BMSize)}function BMRectMakeWithNodeFrame(a){a=a.getBoundingClientRect();return new BMRect(new BMPoint(a.left,a.top),new BMSize(a.width,a.height))}\nfunction BMAnimatable(a,b,c){if(!c.set)throw Error(\"[BMCoreUI] Incorrectly applied BMAnimatable to property \"+b+\" that doesn't have a setter\");if(c.get)d=c.set,c.set=function(a){BMAnimationContextGetCurrent()?BMAnimationContextGetCurrent().controllerForObject(this,{node:this.node}).registerAnimatableProperty(b,{targetValue:a.copy(),startingValue:this[b].copy()}):d.call(this,a)};else{c.get=function(){return this[\"_\"+b]};var d=c.set;c.set=function(a){BMAnimationContextGetCurrent()?BMAnimationContextGetCurrent().controllerForObject(this,\n{node:this.node}).registerAnimatableProperty(b,{targetValue:a.copy(),startingValue:this[b].copy()}):d.call(this,a);this[\"_\"+b]=a.copy()}}}\nfunction BMAnimatableNumber(a,b,c){if(!c.set)throw Error(\"[BMCoreUI] Incorrectly applied BMAnimatable to property \"+b+\" that doesn't have a setter\");if(c.get)d=c.set,c.set=function(a){BMAnimationContextGetCurrent()?BMAnimationContextGetCurrent().controllerForObject(this,{node:this.node}).registerOwnProperty(b,{targetValue:a,startingValue:this[b]}):d.call(this,a)};else{c.get=function(){return this[\"_\"+b]};var d=c.set;c.set=function(a){BMAnimationContextGetCurrent()?BMAnimationContextGetCurrent().controllerForObject(this,\n{node:this.node}).registerOwnProperty(b,{targetValue:a,startingValue:this[b]}):d.call(this,a);this[\"_\"+b]=a}}}function BMAnimationController(){}\nBMAnimationController.prototype={_animation:void 0,_owner:void 0,_node:void 0,_properties:void 0,initWithAnimation(a,b){this._animation=a;this._owner=b.owner;this._node=b.node;this._properties={};return this},registerBuiltInProperty(a,b){this._properties[a]=b.withValue},registerCustomProperty(a,b){this._properties.tween||(this._properties.tween={});this._properties.tween[a]={handler:b.withHandler,startingValue:b.startingValue,targetValue:b.targetValue,BMAnimatable:NO}},registerOwnProperty(a,b){this._properties.tween||\n(this._properties.tween={});var c=this;this._properties.tween[a]={handler:(b,e)=>{c._owner[a]=e},startingValue:b.startingValue,targetValue:b.targetValue,name:a,BMAnimatable:NO}},registerAnimatableProperty(a,b){this._properties.tween||(this._properties.tween={});var c=this;this._properties.tween[a]={handler:(b,e)=>{c._owner[a]=e},startingValue:b.startingValue,targetValue:b.targetValue,name:a,BMAnimatable:YES}},apply(a){if(\"tween\"in this._properties){this._options={};var b=this._properties.tween;this._properties.tween=\n[1,0];var c=this,d=BMFunctionCollectionMake();Object.getOwnPropertyNames(b).forEach((a)=>{var e=b[a];if(e.name)if(e.BMAnimatable){var h=e.startingValue;h||(h=c._owner[e.name].copy());d.push((a,b,c,d,f)=>{e.handler(f,h.interpolatedValueWithFraction(f,{toValue:e.targetValue}))})}else h=e.startingValue,void 0===h&&(h=c._owner[e.name].copy()),d.push((a,b,c,d,f)=>{e.handler(f,BMNumberByInterpolatingNumbersWithFraction(h,e.targetValue,f))});else\"number\"==typeof e.startingValue&&\"number\"==typeof e.targetValue?\nd.push((a,b,c,d,f)=>{e.handler(f,BMNumberByInterpolatingNumbersWithFraction(e.startingValue,e.targetValue,f))}):d.push((a,b,c,d,f)=>{e.handler(f)})});this._options.progress=d}a.targets.push({element:this._node,properties:this._properties,options:this._options})}};function BMAnimationContext(){throw Error(\"Animation contexts may not be created manually. To create an animation context, invoke the BMAnimationBeginWithDuration() function.\");}\nBMAnimationContext.prototype={options:{},subscribers:void 0,controllerForObject(a,b){let c=this.subscribers.get(a);c||(c=Object.create(BMAnimationController.prototype).initWithAnimation(this,{owner:a,node:b.node}),this.subscribers.set(a,c));return c},targets:void 0,registerAnimationForTarget:function(a,b){this.targets.push({element:a,properties:b.properties,options:b.options})},registerSubscriber:function(a,b){}};var _BMAnimationStack=[];\nfunction BMAnimationContextGetCurrent(){return _BMAnimationStack[_BMAnimationStack.length-1]}function BMAnimationBeginWithDuration(a,b){b=b||{};b.duration=a;a=Object.create(BMAnimationContext.prototype);a.options=b;a.targets=[];a.subscribers=new Map;_BMAnimationStack.push(a);return a}function BMAnimationApply(){return BMAnimationApplyBlocking(NO)}\nfunction BMAnimationApplyBlocking(a){void 0===a&&(a=YES);var b=_BMAnimationStack.pop(),c=b.targets;b.subscribers.forEach(function(a,c,d){a.apply(b)});var d=NO;if(b.options.complete){var e=b.options.complete;var f=function(a){d||(d=YES,setTimeout(function(){e(a);for(var b=0;b<l;b++)c[b].complete&&c[b].complete(a)},0))}}else f=function(a){d||(d=YES,setTimeout(function(){for(var b=0;b<l;b++)c[b].complete&&c[b].complete(a)},0))};b.options.complete=f;f=b.options.stride;for(var h=b.options.delay||0,g=window.Velocity||\n$.Velocity,k=[],l=b.targets.length,m=0;m<l;m++){var q=c[m].element;a&&g(q,\"stop\",!0);var n=c[m].options?BMCopyProperties({},b.options,c[m].options):b.options;f&&(n=BMCopyProperties({},n),m<l-1&&delete n.complete,n.delay=h,h+=f);k.push(g.animate(q,c[m].properties,n));n.queue&&q.dequeue(n.queue)}if(window.Promise)return Promise.all(k)}function BMAnimateWithBlock(a,b){BMAnimationBeginWithDuration(b.duration,b);a();return b.blocking?BMAnimationApplyBlocking(YES):BMAnimationApply()}\nfunction BMIndexPath(){}\nBMIndexPath.prototype={object:void 0,indexes:[],get row(){return this.indexes[1]},set row(a){this.indexes[1]=a},get section(){return this.indexes[0]},set section(a){this.indexes[0]=a},copy:function(){var a=new BMIndexPath;a.object=this.object;a.indexes=this.indexes.slice();return a},isEqualToIndexPath:function(a,b){if(!a||a.indexes.length!=this.indexes.length)return NO;for(var c=0;c<this.indexes.length;c++)if(this.indexes[c]!=a.indexes[c])return NO;return b.usingComparator(this.object,a.object)},\nisLooselyEqualToIndexPath:function(a,b){if(!a)return NO;if(void 0===a.object&&void 0===this.object){if(a.indexes.length!=this.indexes.length)return NO;for(b=0;b<this.indexes.length;b++)if(this.indexes[b]!=a.indexes[b])return NO;return YES}return b.usingComparator(this.object,a.object)}};var BMIndexPathNone=BMIndexPathMakeWithRow(NaN,{section:NaN,forObject:NaN});BMIndexPathNone.section=NaN;BMIndexPathNone.isEqualToIndexPath=function(){return NO};BMIndexPathNone.isLooselyEqualToIndexPath=function(){return NO};\nfunction BMIndexPathMakeWithRow(a,b){var c=new BMIndexPath;c.indexes=[b&&b.section||0,a];c.object=b&&b.forObject;return c}function BMIndexPathMakeWithIndexes(a,b){var c=new BMIndexPath;c.indexes=a;c.object=b?b.forObject:void 0;return c}function BMKeyPath(){}\nBMKeyPath.prototype={_components:void 0,get components(){return this._components.slice()},initWithString:function(a){this._components=a.split(\".\")},initWithComponents:function(a){this._components=a.slice()},valueForObject:function(a,b){b=Math.min(this._components.length,b&&b.withLimit||this._components.length);for(var c=0;c<b;c++)if(a=a[this._components[c]],\"undefined\"===typeof a)return;return a}};function BMKeyPathMakeWithString(a){return(new BMKeyPath).initWithString(a)}\nfunction BMKeyPathMakeWithComponents(a){return(new BMKeyPath).initWithComponents(a)}var BMScrollingDirectionVertical=Object.freeze({Stationary:0,Top:1,Bottom:-1}),BMScrollingDirectionHorizontal=Object.freeze({Stationary:0,Left:1,Right:-1});\nfunction BMFunctionCollectionMake(){var a=[],b=function(){var b=this,d;a.forEach((a)=>d=a.apply(b,arguments));return d};Object.getOwnPropertyNames(Array.prototype).forEach(function(c){b[c]=function(){return a[c].apply(a,arguments)}});BMExtend(b,{get length(){return a.length},set length(b){a.length=b},functionAtIndex(b){return a[b]},setfunction(b,d){return a[d.atIndex]=b}});return b}function BMColor(){}\nBMColor.prototype={_storage:void 0,get red(){return this._storage.red},set red(a){this._storage.red=a},get green(){return this._storage.green},set green(a){this._storage.green=a},get blue(){return this._storage.blue},set blue(a){this._storage.blue=a},get alpha(){return this._storage.alpha},set alpha(a){this._storage.alpha=a},get hue(){return this._storage.hue},set hue(a){this._storage.hue=a},get saturation(){return this._storage.saturation},set saturation(a){this._storage.saturation=a},get luminosity(){return this._storage.luminosity},\nset luminosity(a){this._storage.luminosity=a},get RGBAString(){return this._storage.RGBAString},get RGBString(){return this._storage.RGBString},get hexString(){return this._storage.hexString},get HSLAString(){return this._storage.HSLAString},get HSLString(){return this._storage.HSLString},copy:function(){var a=new BMColor;a._storage=this._storage.copy();return a},interpolatedValueWithFraction(a,b){return BMColorByInterpolatingRGBAColor(this,{toColor:b.toValue,withFraction:a})}};\nfunction BMColorMake(){return BMColorMakeWithRed(0,{green:0,blue:0,alpha:0})}\nfunction BMColorMakeWithString(a){if(!a)return BMColorMakeWithRed(0,{green:0,blue:0,alpha:0});if(_BMColorKeywords[a])return BMColorMakeWithHexString(_BMColorKeywords[a]);if(0==a.indexOf(\"#\"))return BMColorMakeWithHexString(a);if(0==a.indexOf(\"rgba\"))return BMColorMakeWithRGBAString(a);if(0==a.indexOf(\"rgb\"))return BMColorMakeWithRGBString(a);if(0==a.indexOf(\"hsla\"))return BMColorMakeWithHSLAString(a);if(0==a.indexOf(\"hsl\"))return BMColorMakeWithHSLString(a)}\nfunction BMColorMakeWithRed(a,b){var c=new BMColor;c._storage=new _BMRGBAColor;c._storage._color=c;c._storage._red=BMNumberByConstrainingNumberToBounds(a|0,0,255);c._storage._green=BMNumberByConstrainingNumberToBounds(b.green|0,0,255);c._storage._blue=BMNumberByConstrainingNumberToBounds(b.blue|0,0,255);c._storage._alpha=BMNumberByConstrainingNumberToBounds(\"alpha\"in b?b.alpha:1,0,1);return c}\nfunction BMColorMakeWithHue(a,b){var c=new BMColor;c._storage=new _BMHSLAColor;c._storage._color=c;c._storage._hue=BMNumberByConstrainingNumberToBounds(a|0,0,360);c._storage._saturation=BMNumberByConstrainingNumberToBounds(b.saturation|0,0,100);c._storage._lightness=BMNumberByConstrainingNumberToBounds(b.lightness|0,0,100);c._storage._alpha=BMNumberByConstrainingNumberToBounds(\"alpha\"in b?b.alpha:1,0,1);return c}\nfunction BMColorMakeWithHexString(a){var b=new BMColor;b._storage=new _BMRGBAColor;b._storage._color=b;\"#\"==a.charAt(0)?(b._storage._red=parseInt(a.substring(1,3),16),b._storage._green=parseInt(a.substring(3,5),16),b._storage._blue=parseInt(a.substring(5,7),16)):(b._storage._red=parseInt(a.substring(0,2),16),b._storage._green=parseInt(a.substring(2,4),16),b._storage._blue=parseInt(a.substring(4,6),16));return b}\nfunction BMColorMakeWithRGBAString(a){var b=new BMColor;b._storage=new _BMRGBAColor;b._storage._color=b;a=a.split(\",\");b._storage.red=parseInt(a[0].substring(5),10);b._storage.green=parseInt(a[1],10);b._storage.blue=parseInt(a[2],10);b._storage.alpha=parseFloat(a[3],10);return b}\nfunction BMColorMakeWithRGBString(a){var b=new BMColor;b._storage=new _BMRGBAColor;b._storage._color=b;a=a.split(\",\");b._storage.red=parseInt(a[0].substring(4),10);b._storage.green=parseInt(a[1],10);b._storage.blue=parseInt(a[2],10);return b}\nfunction BMColorMakeWithHSLAString(a){var b=new BMColor;b._storage=new _BMHSLAColor;b._storage._color=b;a=a.split(\",\");b._storage.hue=parseInt(a[0].substring(5),10);b._storage.saturation=parseInt(a[1],10);b._storage.luminosity=parseInt(a[2],10);b._storage.alpha=parseFloat(a[3],10);return b}\nfunction BMColorMakeWithHSLString(a){var b=new BMColor;b._storage=new _BMHSLAColor;b._storage._color=b;a=a.split(\",\");b._storage.hue=parseInt(a[0].substring(4),10);b._storage.saturation=parseInt(a[1],10);b._storage.luminosity=parseInt(a[2],10);return b}\nfunction BMColorByInterpolatingRGBAColor(a,b){var c=b.toColor;b=b.withFraction;return BMColorMakeWithRed(BMNumberByInterpolatingNumbersWithFraction(a.red,c.red,b),{green:BMNumberByInterpolatingNumbersWithFraction(a.green,c.green,b),blue:BMNumberByInterpolatingNumbersWithFraction(a.blue,c.blue,b),alpha:BMNumberByInterpolatingNumbersWithFraction(a.alpha,c.alpha,b)})}\nfunction BMColorByInterpolatingHSLAColor(a,b){var c=b.toColor;b=b.withFraction;return BMColorMakeWithHue(BMNumberByInterpolatingNumbersWithFraction(a.hue,c.hue,b),{saturation:BMNumberByInterpolatingNumbersWithFraction(a.saturation,c.saturation,b),luminosity:BMNumberByInterpolatingNumbersWithFraction(a.luminosity,c.luminosity,b),alpha:BMNumberByInterpolatingNumbersWithFraction(a.alpha,c.alpha,b)})}\nfunction BMHexStringWithNumber(a,b){a=a.toString(16);for(b=b&&b.minDigits||0;a.length<b;)a=\"0\"+a;return a}function _BMRGBAColor(){}\n_BMRGBAColor.prototype={_color:void 0,_red:0,get red(){return this._red},set red(a){this._red=BMNumberByConstrainingNumberToBounds(a|0,0,255)},_green:0,get green(){return this._green},set green(a){this._green=BMNumberByConstrainingNumberToBounds(a|0,0,255)},_blue:0,get blue(){return this._blue},set blue(a){this._blue=BMNumberByConstrainingNumberToBounds(a|0,0,255)},_alpha:1,get alpha(){return this._alpha},set alpha(a){this._alpha=BMNumberByConstrainingNumberToBounds(a,0,1)},get hue(){return this.BMHSLAColor.hue},\nset hue(a){var b=this.BMHSLAColor;this._color._storage=b;b.hue=a},get saturation(){return this.BMHSLAColor.saturation},set saturation(a){var b=this.BMHSLAColor;this._color._storage=b;b.saturation=a},get luminosity(){return this.BMHSLAColor.luminosity},set luminosity(a){var b=this.BMHSLAColor;this._color._storage=b;b.luminosity=a},get BMHSLAColor(){var a=new _BMHSLAColor,b=this._red/255,c=this._green/255,d=this._blue/255,e=Math.max(b,c,d),f=Math.min(b,c,d),h=(e+f)/2;a._luminosity=100*h|0;if(e==f)a._saturation=\n0,a._hue=0;else{var g=e-f;switch(e){case b:var k=(c-d)/g+(c<d?6:0);break;case c:k=(d-b)/g+2;break;case d:k=(b-c)/g+4}a._saturation=100*(.5<h?g/(2-e-f):g/(e+f))|0;a._hue=k/6*360|0}a._alpha=this._alpha;return a},get RGBAString(){return\"rgba(\"+this._red+\",\"+this._green+\",\"+this._blue+\",\"+this._alpha+\")\"},get RGBString(){return\"rgb(\"+this._red+\",\"+this._green+\",\"+this._blue+\")\"},get hexString(){return\"#\"+BMHexStringWithNumber(this._red,{minDigits:2})+BMHexStringWithNumber(this._green,{minDigits:2})+BMHexStringWithNumber(this._blue,\n{minDigits:2})},get HSLAString(){return this.BMHSLAColor.HSLAString},get HSLString(){return this.BMHSLAColor.HSLString},copy:function(){var a=new _BMRGBAColor;a._red=this._red;a._green=this._green;a._blue=this._blue;a._alpha=this._alpha;return a}};function _BMHSLAColor(){}\n_BMHSLAColor.prototype={_color:void 0,get red(){return this.BMRGBAColor.red},set red(a){var b=this.BMRGBAColor;this._color._storage=b;b.red=a},get green(){return this.BMRGBAColor.green},set green(a){var b=this.BMRGBAColor;this._color._storage=b;b.green=a},get blue(){return this.BMRGBAColor.blue},set blue(a){var b=this.BMRGBAColor;this._color._storage=b;b.blue=a},_alpha:1,get alpha(){return this._alpha},set alpha(a){this._alpha=BMNumberByConstrainingNumberToBounds(a,0,1)},_hue:0,get hue(){return this._hue},\nset hue(a){this._hue=BMNumberByConstrainingNumberToBounds(a|0,0,360)},_saturation:0,get saturation(){return this._saturation},set saturation(a){this._saturation=BMNumberByConstrainingNumberToBounds(a|0,0,100)},_luminosity:0,get luminosity(){return this._luminosity},set luminosity(a){this._luminosity=BMNumberByConstrainingNumberToBounds(a|0,0,100)},get BMRGBAColor(){var a=new _BMRGBAColor;if(0==this._saturation)a._red=a._green=a._blue=this._luminosity/100*255|0;else{var b=this._hue/360,c=this._luminosity/\n100,d=this._saturation/100;d=.5>c?c*(1+d):c+d-c*d;c=2*c-d;a._red=255*_BMHueToRGB(c,d,b+1/3)|0;a._green=255*_BMHueToRGB(c,d,b)|0;a._blue=255*_BMHueToRGB(c,d,b-1/3)|0}a._alpha=this._alpha;return a},get RGBAString(){return this.BMRGBAColor.RGBAString},get RGBString(){return this.BMRGBAColor.RGBString},get hexString(){return this.BMRGBAColor.hexString},get HSLAString(){return\"hsl(\"+this._hue+\",\"+this._saturation+\"%,\"+this._luminosity+\"%,\"+this._alpha+\")\"},get HSLString(){return\"hsl(\"+this._hue+\",\"+this._saturation+\n\"%,\"+this._luminosity+\"%)\"},copy:function(){var a=new _BMRGBAColor;a._hue=this._hue;a._saturation=this._saturation;a._luminosity=this._luminosity;a._alpha=this._alpha;return a}};function _BMHueToRGB(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}\nvar _BMColorKeywords={aliceblue:\"#f0f8ff\",antiquewhite:\"#faebd7\",aqua:\"#00ffff\",aquamarine:\"#7fffd4\",azure:\"#f0ffff\",beige:\"#f5f5dc\",bisque:\"#ffe4c4\",black:\"#000000\",blanchedalmond:\"#ffebcd\",blue:\"#0000ff\",blueviolet:\"#8a2be2\",brown:\"#a52a2a\",burlywood:\"#deb887\",cadetblue:\"#5f9ea0\",chartreuse:\"#7fff00\",chocolate:\"#d2691e\",coral:\"#ff7f50\",cornflowerblue:\"#6495ed\",cornsilk:\"#fff8dc\",crimson:\"#dc143c\",cyan:\"#00ffff\",darkblue:\"#00008b\",darkcyan:\"#008b8b\",darkgoldenrod:\"#b8860b\",darkgray:\"#a9a9a9\",darkgreen:\"#006400\",\ndarkgrey:\"#a9a9a9\",darkkhaki:\"#bdb76b\",darkmagenta:\"#8b008b\",darkolivegreen:\"#556b2f\",darkorange:\"#ff8c00\",darkorchid:\"#9932cc\",darkred:\"#8b0000\",darksalmon:\"#e9967a\",darkseagreen:\"#8fbc8f\",darkslateblue:\"#483d8b\",darkslategray:\"#2f4f4f\",darkslategrey:\"#2f4f4f\",darkturquoise:\"#00ced1\",darkviolet:\"#9400d3\",deeppink:\"#ff1493\",deepskyblue:\"#00bfff\",dimgray:\"#696969\",dimgrey:\"#696969\",dodgerblue:\"#1e90ff\",firebrick:\"#b22222\",floralwhite:\"#fffaf0\",forestgreen:\"#228b22\",fuchsia:\"#ff00ff\",gainsboro:\"#dcdcdc\",\nghostwhite:\"#f8f8ff\",gold:\"#ffd700\",goldenrod:\"#daa520\",gray:\"#808080\",green:\"#008000\",greenyellow:\"#adff2f\",grey:\"#808080\",honeydew:\"#f0fff0\",hotpink:\"#ff69b4\",indianred:\"#cd5c5c\",indigo:\"#4b0082\",ivory:\"#fffff0\",khaki:\"#f0e68c\",lavender:\"#e6e6fa\",lavenderblush:\"#fff0f5\",lawngreen:\"#7cfc00\",lemonchiffon:\"#fffacd\",lightblue:\"#add8e6\",lightcoral:\"#f08080\",lightcyan:\"#e0ffff\",lightgoldenrodyellow:\"#fafad2\",lightgray:\"#d3d3d3\",lightgreen:\"#90ee90\",lightgrey:\"#d3d3d3\",lightpink:\"#ffb6c1\",lightsalmon:\"#ffa07a\",\nlightseagreen:\"#20b2aa\",lightskyblue:\"#87cefa\",lightslategray:\"#778899\",lightslategrey:\"#778899\",lightsteelblue:\"#b0c4de\",lightyellow:\"#ffffe0\",lime:\"#00ff00\",limegreen:\"#32cd32\",linen:\"#faf0e6\",magenta:\"#ff00ff\",maroon:\"#800000\",mediumaquamarine:\"#66cdaa\",mediumblue:\"#0000cd\",mediumorchid:\"#ba55d3\",mediumpurple:\"#9370db\",mediumseagreen:\"#3cb371\",mediumslateblue:\"#7b68ee\",mediumspringgreen:\"#00fa9a\",mediumturquoise:\"#48d1cc\",mediumvioletred:\"#c71585\",midnightblue:\"#191970\",mintcream:\"#f5fffa\",mistyrose:\"#ffe4e1\",\nmoccasin:\"#ffe4b5\",navajowhite:\"#ffdead\",navy:\"#000080\",oldlace:\"#fdf5e6\",olive:\"#808000\",olivedrab:\"#6b8e23\",orange:\"#ffa500\",orangered:\"#ff4500\",orchid:\"#da70d6\",palegoldenrod:\"#eee8aa\",palegreen:\"#98fb98\",paleturquoise:\"#afeeee\",palevioletred:\"#db7093\",papayawhip:\"#ffefd5\",peachpuff:\"#ffdab9\",peru:\"#cd853f\",pink:\"#ffc0cb\",plum:\"#dda0dd\",powderblue:\"#b0e0e6\",purple:\"#800080\",rebeccapurple:\"#663399\",red:\"#ff0000\",rosybrown:\"#bc8f8f\",royalblue:\"#4169e1\",saddlebrown:\"#8b4513\",salmon:\"#fa8072\",sandybrown:\"#f4a460\",\nseagreen:\"#2e8b57\",seashell:\"#fff5ee\",sienna:\"#a0522d\",silver:\"#c0c0c0\",skyblue:\"#87ceeb\",slateblue:\"#6a5acd\",slategray:\"#708090\",slategrey:\"#708090\",snow:\"#fffafa\",springgreen:\"#00ff7f\",steelblue:\"#4682b4\",tan:\"#d2b48c\",teal:\"#008080\",thistle:\"#d8bfd8\",tomato:\"#ff6347\",turquoise:\"#40e0d0\",violet:\"#ee82ee\",wheat:\"#f5deb3\",white:\"#ffffff\",whitesmoke:\"#f5f5f5\",yellow:\"#ffff00\",yellowgreen:\"#9acd32\"},BMCollectionViewLayoutAttributesType=Object.freeze({Cell:{},SupplementaryView:{},DecorationView:{}}),\nBMCellAttributesType=BMCollectionViewLayoutAttributesType,BMCollectionViewLayoutAttributesStyleDefaults=Object.freeze({opacity:1,scaleX:1,scaleY:1,rotate:0,rotateX:0,rotateY:0,rotateZ:0,skewX:0,skewY:0,skewZ:0,transformOriginX:\"50%\",transformOriginY:\"50%\",translateZ:0,blur:\"0px\"}),BMCellAttributesStyleDefaults=BMCollectionViewLayoutAttributesStyleDefaults,BMCollectionViewLayoutAttributes=function(){},BMCellAttributes=BMCollectionViewLayoutAttributes;\nBMCollectionViewLayoutAttributes.prototype={_cell:void 0,get cell(){return this._cell},set cell(a){(this._cell=a)&&a.element&&(this._hookFrame(),this.hook(this._style))},_itemType:BMCollectionViewLayoutAttributesType.Cell,get itemType(){return this._itemType},identifier:void 0,_frame:void 0,get frame(){return this._frame},set frame(a){this._frame=a.copy();this._hookFrame()},_hookFrame:function(){var a=this.frame;if(this._cell&&this._cell.element){var b={translateX:a.origin.x+\"px\",translateY:a.origin.y+\n\"px\"};this._cell.width!=a.size.width&&(b.width=a.size.width+\"px\");this._cell.height!=a.size.height&&(b.height=a.size.height+\"px\");(b.width||b.height)&&this._cell.collectionView.delegate&&this._cell.collectionView.delegate.collectionViewWillResizeCell&&this._cell.collectionView.delegate.collectionViewWillResizeCell(this._cell.collectionView,this._cell,{toSize:a.size.copy()});this.hook(b)}},_flatten:function(){this._cell&&(this.style={},this._cell.element[0].style.transform=\"\",BMCopyProperties(this._cell.element[0].style,\n{left:this._frame.origin.x+\"px\",top:this._frame.origin.y+\"px\"}))},_style:void 0,get style(){this._style||(this._style={});return this._style},set style(a){a=a||{};delete a.width;delete a.height;delete a.left;delete a.right;delete a.translateX;delete a.translateY;var b=this._style;this._style={};for(c in a)this._style[c]=a[c];if(b)for(var c in b)void 0===a[c]&&(a[c]=BMCollectionViewLayoutAttributesStyleDefaults[c]);this.hook(a)},addStyle:function(a){delete a.width;delete a.height;delete a.left;delete a.right;\ndelete a.translateX;delete a.translateY;for(var b in a)this._style[b]=a[b];this.hook(a)},_isHidden:NO,get isHidden(){return this._isHidden},set isHidden(a){this._isHidden=a},hook:function(a){if(this._cell&&this._cell.element){var b=this;if(_BMAnimationStack.length){var c=_BMAnimationStack[_BMAnimationStack.length-1],d=c.subscribers.get(this);this._cell._isHidden==this._isHidden||this._isHidden||(this._cell.isHidden=NO);d||(d={apply:function(c){for(var d={},e=0;e<this.properties.length;e++){var g=\nthis.properties[e],k;for(k in g)d[k]=g[k]}var l=b._cell;if(a.width||a.height)e=BMRectMakeWithOrigin(BMPointMake(),{size:b.frame.size.copy()}),b._cell.boundsWillChangeToBounds(e);var m=NO,q=b.frame.size.width,n=b.frame.size.height;c.targets.push({element:b._cell.element,properties:d,complete:function(){if(!m&&(m=YES,d.width&&(l.width=q),d.height&&(l.height=n),l._isHidden!=b._isHidden&&b._isHidden&&(l.isHidden=YES),a.width||a.height)){var c=BMRectMakeWithOrigin(BMPointMake(),{size:b.frame.size.copy()}),\ne=b._cell._bounds;b._cell._bounds=c;b._cell.boundsDidChangeFromBounds(e);b._cell.collectionView.delegate&&b._cell.collectionView.delegate.collectionViewDidResizeCell&&b._cell.collectionView.delegate.collectionViewDidResizeCell(b._cell.collectionView,b._cell,{toSize:b.frame.size.copy()})}}})},properties:[]},c.subscribers.set(this,d));d.properties.push(a)}else{BMHook(this._cell.element,a);a.width&&(this._cell.width=this.frame.size.width);a.height&&(this._cell.height=this.frame.size.height);if(a.width||\na.height)c=BMRectMakeWithOrigin(BMPointMake(),{size:this.frame.size.copy()}),this._cell.boundsWillChangeToBounds(c),d=this._cell._bounds,this._cell._bounds=c,this._cell.boundsDidChangeFromBounds(d),this._cell.collectionView.delegate&&this._cell.collectionView.delegate.collectionViewDidResizeCell&&this._cell.collectionView.delegate.collectionViewDidResizeCell(this._cell.collectionView,this._cell,{toSize:this.frame.size.copy()});this._isHidden!=this._cell._isHidden&&(this._cell.isHidden=this._isHidden)}}},\nindexPath:void 0,copy:function(){var a=new BMCollectionViewLayoutAttributes;a._frame=this._frame.copy();a.indexPath=this.indexPath.copy();a._style=$.extend({},this._style);a._itemType=this._itemType;a.identifier=this.identifier;return a}};function BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a){var b=new BMCollectionViewLayoutAttributes;b.indexPath=a;b._itemType=BMCollectionViewLayoutAttributesType.Cell;b._style={};return b}var BMCellAttributesMakeForCellAtIndexPath=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath;\nfunction BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(a,b){var c=new BMCollectionViewLayoutAttributes;c.indexPath=b.atIndexPath;c._itemType=BMCollectionViewLayoutAttributesType.SupplementaryView;c.identifier=a;c._style={};return c}var BMCellAttributesMakeForSupplementaryViewWithIdentifier=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier,BMCollectionViewCell=function(){},BMCell=BMCollectionViewCell;\nBMCollectionViewCell.prototype={get retainCount(){return this._retainCount+this._manageCount},get isManaged(){return 0<this._manageCount},get isRetained(){return 0<this.retainCount},collectionView:void 0,_element:void 0,get element(){return this._element||(this._element=$(this.node))},node:void 0,itemType:BMCollectionViewLayoutAttributesType.Cell,reuseIdentifier:void 0,_bounds:BMRectMake(),get bounds(){return this._bounds},boundsWillChangeToBounds(a){},boundsDidChangeFromBounds(a){},_attributes:void 0,\nget attributes(){return this._attributes},set attributes(a){var b=this._attributes;this._attributes&&(this._attributes.cell=void 0);if(this._attributes=a){a.cell=void 0;if(b&&b.style){a.style=a.style||{};for(var c in b.style)void 0===a.style[c]&&(a.style[c]=BMCollectionViewLayoutAttributesStyleDefaults[c])}a&&(a.cell=this)}},get indexPath(){return this._attributes?this._attributes.indexPath:void 0},_manage:function(){if(this._manageCount)return this;this._manageCount++;this.collectionView.cellWasManaged(this);\n1===this.retainCount&&(this.prepareForDisplay(),this.collectionView.cellShouldRender(this));return this},_unmanage:function(){this._manageCount&&(this._manageCount--,this.collectionView.cellWasUnmanaged(this),0===this.retainCount&&(this.prepareForReuse(),this.collectionView.cellWasReleased(this)))},retain:function(){this._retainCount++;1==this.retainCount&&(this.prepareForDisplay(),this.collectionView.cellShouldRender(this));return this},release:function(){this._retainCount--;0==this.retainCount&&\n(this.prepareForReuse(),this.collectionView.cellWasReleased(this))},recycle:function(){this._unmanage();0<this.retainCount&&(this.collectionView.cellWasInvalidated(this),this.destroy(),this.releaseRecycledCell=this.recycle=this.release=this.retain=this._unmanage=this._manage=function(){})},releaseRecycledCell:function(){this.release();0<this.retainCount&&(this.collectionView.cellWasInvalidated(this),this.destroy(),this.releaseRecycledCell=this.recycle=this.release=this.retain=this._unmanage=this._manage=\nfunction(){})},_isHidden:NO,get isHidden(){return this._isHidden},set isHidden(a){this._isHidden!=a&&(a?this._hide():this._show())},_hide:function(){this._isHidden=YES;this.element[0].classList.add(\"BMCollectionViewCellHidden\")},_show:function(){this._isHidden=NO;this.element[0].classList.remove(\"BMCollectionViewCellHidden\")},prepareForReuse(){},prepareForDisplay(){},destroy(){},get initializesAtomically(){return YES},initWithCollectionView(a,b){this._manageCount=this._retainCount=0;this.collectionView=\na;this.reuseIdentifier=b.reuseIdentifier;this.node=b.node;return this},initNonatomic:async function(){}};function BMCollectionViewCellMakeForCollectionView(a,b){return(new BMCollectionViewCell).initWithCollectionView(a,b)}\nvar BMCellMakeForCollectionView=BMCollectionViewCellMakeForCollectionView,_BMCollectionViewTransitionLayoutAttributesUnitRegex=/\\-?\\+?\\d*\\.?\\d*(\\D*)/,_BMCollectionViewTransitionCellAttributesUnitRegex=_BMCollectionViewTransitionLayoutAttributesUnitRegex,_BMCollectionViewTransitionLayoutAttributes=function(){};\n_BMCollectionViewTransitionLayoutAttributes.prototype=BMExtend({},BMCollectionViewLayoutAttributes.prototype,{_sourceAttributes:void 0,get sourceAttributes(){return this._sourceAttributes},_targetAttributes:void 0,get targetAttributes(){return this._targetAttributes},_fraction:0,get fraction(){return this._fraction},set fraction(a){var b=this._sourceAttributes.isHidden;this._targetAttributes!=b&&(b=0!=a&&1!=a?NO:0==a?this._sourceAttributes.isHidden:this._targetAttributes.isHidden);this.isHidden=b;\nthis._fraction=a;this._frame=BMRectByInterpolatingRect(this._sourceAttributes._frame,{toRect:this._targetAttributes._frame,withFraction:a});this._hookFrame();b=this._sourceAttributes.style;var c=this._targetAttributes.style;this._style||(this._style={});if(!this._intermediateTransitionStyle){this._intermediateTransitionStyle={};for(var d in b){this._intermediateTransitionStyle[d]={source:parseFloat(b[d])};var e=parseFloat(c[d]);isNaN(e)&&(e=parseFloat(BMCollectionViewLayoutAttributesStyleDefaults[d]));\nthis._intermediateTransitionStyle[d].target=e;e=_BMCollectionViewTransitionLayoutAttributesUnitRegex.exec(b[d])[1]||\"\";this._intermediateTransitionStyle[d].unit=e}for(d in c)this._intermediateTransitionStyle[d]||(this._intermediateTransitionStyle[d]={target:parseFloat(c[d])},e=parseFloat(b[d]),isNaN(e)&&(e=parseFloat(BMCollectionViewLayoutAttributesStyleDefaults[d])),this._intermediateTransitionStyle[d].source=e,e=_BMCollectionViewTransitionCellAttributesUnitRegex.exec(c[d])[1]||\"\",this._intermediateTransitionStyle[d].unit=\ne)}b=this._intermediateTransitionStyle;for(d in b)c=b[d],this._style[d]=BMNumberByInterpolatingNumbersWithFraction(c.source,c.target,a)+c.unit;this.hook(this._style)},_applyFinalAttributes:function(){this._cell&&(this._cell.attributes=this._targetAttributes)}});\nfunction _BMCollectionViewTransitionLayoutAttributesMakeWithSourceAttributes(a,b){var c=new _BMCollectionViewTransitionLayoutAttributes;c.indexPath=a.indexPath.copy();c._itemType=a._itemType;c.identifier=a.identifier;c._sourceAttributes=a;c._targetAttributes=b.targetAttributes;c._fraction=0;return c}var _BMCollectionViewTransitionCellAttributesMakeWithSourceAttributes=_BMCollectionViewTransitionLayoutAttributesMakeWithSourceAttributes;function BMCollectionViewLayout(){}\nBMCollectionViewLayout.prototype={_collectionView:void 0,get collectionView(){return this._collectionView},set collectionView(a){this._collectionView=a},attributesForCellAtIndexPath:function(a){throw Error(\"attributesForCellAtIndexPath() must be implemented by layout objects.\");},attributesForElementsInRect:function(a){throw Error(\"attributesForCellsInRect() must be implemented by layout objects.\");},contentSize:function(){throw Error(\"contentSize() must be implemented by layout objects.\");},attributesForSupplementaryViewWithIdentifier:function(a,\nb){throw Error(\"attributesForSupplementaryViewWithIdentifier(_, {atIndexPath}) must be implemented by layout objects that define supplementary views.\");},prepareLayout:function(){},get invalidationContextType(){return BMCollectionViewLayoutInvalidationContext},collectionViewWillStartUpdates:function(a){},collectionViewDidStartUpdates:function(){},preferredScrollOffsetWithOffset:function(a){return a},preferredScrollOffsetForTransitionFromLayout:function(a,b){return this.preferredScrollOffsetWithOffset(b.withOffset)},\ninitialAttributesForMovingCellFromIndexPath:function(a,b){a=b.withTargetAttributes.copy();a.style={opacity:0};return a},initialAttributesForMovingSupplementaryViewWithIdentifier:function(a,b){a=b.withTargetAttributes.copy();a.style={opacity:0};return a},initialAttributesForAppearingCellAtIndexPath:function(a,b){a=b.withTargetAttributes.copy();a.style={scaleX:0,scaleY:0,opacity:0};return a},initialAttributesForAppearingSupplementaryViewWithIdentifier:function(a,b){a=b.withTargetAttributes.copy();a.style=\n{scaleX:0,scaleY:0,opacity:0};return a},initialAttributesForRevealingCellAtIndexPath:function(a,b){return this.initialAttributesForAppearingCellAtIndexPath(a,b)},initialAttributesForRevealingSupplementaryViewWithIdentifier:function(a,b){return this.initialAttributesForAppearingSupplementaryViewWithIdentifier(a,b)},initialAttributesForPresentedCellAtIndexPath:function(a,b){a=b.withTargetAttributes.copy();a.style={scaleX:0,scaleY:0,opacity:0};return a},initialAttributesForPresentedSupplementaryViewWithIdentifier:function(a,\nb){a=b.withTargetAttributes.copy();a.style={scaleX:0,scaleY:0,opacity:0};return a},supplementaryViewsToInsert:function(){return[]},finalAttributesForDisappearingCellAtIndexPath:function(a,b){a=b.withTargetAttributes.copy();a.style={scaleX:0,scaleY:0,opacity:0};return a},finalAttributesForDisappearingSupplementaryViewWithIdentifier:function(a,b){a=b.withTargetAttributes.copy();a.style={scaleX:0,scaleY:0,opacity:0};return a},finalAttributesForHidingCellAtIndexPath:function(a,b){return this.finalAttributesForDisappearingCellAtIndexPath(a,\nb)},finalAttributesForHidingSupplementaryViewWithIdentifier:function(a,b){return this.finalAttributesForDisappearingSupplementaryViewWithIdentifier(a,b)},supplementaryViewsToDelete:function(){return[]},invalidateLayout:function(){this._collectionView&&this._collectionView.invalidateLayout()},invalidateLayoutWithContext:function(a,b){this._collectionView&&this._collectionView.invalidateLayoutWithContext(a,b)},shouldInvalidateLayoutForFrameChange:function(a){return YES},shouldInvalidateLayoutForBoundsChange:function(a){return NO},\ndidInvalidateLayoutForBoundsChange:function(){},rectWithScrollingPositionOfCellAtIndexPath:function(a){return(a=this.attributesForCellAtIndexPath(a))?a.frame:BMRectMake()},rectWithScrollingPositionOfSupplementaryViewWithIdentifier:function(a,b){return(a=this.attributesForSupplementaryViewWithIdentifier(a,b))?a.frame:BMRectMake()},get snapsScrollPosition(){return NO},snappingScrollOffsetForScrollOffset:function(a,b){return a},prepareForDragOperation(){},dragOperationWillRollback(){},dragOperationDidFinish(){},\ncopy:function(){throw Error(\"Layout objects that support copying should implement the copy() method.\");}};function BMCollectionViewLayoutInvalidationContext(){}BMCollectionViewLayoutInvalidationContext.prototype={invalidateEverything:NO,invalidateDataSetCounts:NO,contentSizeAdjustment:void 0,invalidatedCellIndexPaths:void 0,invalidatedSupplementaryViewIndexPaths:void 0};\nvar _BMCollectionViewTransitionLayout=function(a,b,c,d){this.transitionAttributes=a;this.initialSize=b;this.targetSize=c;this.targetLayout=d};\n_BMCollectionViewTransitionLayout.prototype=BMExtend({},BMCollectionViewLayout.prototype,{_fraction:0,get fraction(){return this._fraction},set fraction(a){if(this.collectionView){this._fraction=a;for(var b=this.transitionAttributes.length,c=0;c<b;c++)this.transitionAttributes[c].fraction=a}},attributesForElementsInRect:function(a){return this.transitionAttributes},contentSize:function(){return BMSizeMake(BMNumberByInterpolatingNumbersWithFraction(this.initialSize.width,this.targetSize.width,this._fraction),\nBMNumberByInterpolatingNumbersWithFraction(this.initialSize.height,this.targetSize.height,this._fraction))},attributesForCellAtIndexPath:function(a,b){return this.targetLayout.attributesForCellAtIndexPath(a,b)},attributesForSupplementaryViewWithIdentifier:function(a,b){return this.targetLayout.attributesForSupplementaryViewWithIdentifier(a,b)},_applyFinalAttributes:function(){for(var a=this.transitionAttributes.length,b=0;b<a;b++)this.transitionAttributes[b]._applyFinalAttributes()}});\nvar BMCollectionViewTableLayoutSupplementaryView=Object.freeze({Footer:\"Footer\",Header:\"Header\",Empty:\"Empty\"}),BMCollectionViewTableLayout=function(){},BMCollectionViewTableLayoutRowHeightVariable=-1;\nBMExtend(BMCollectionViewTableLayout.prototype,BMCollectionViewLayout.prototype,{_rowHeight:44,get rowHeight(){return this._rowHeight},set rowHeight(a){this._rowHeight=a;this.invalidateLayout()},_minimumWidth:0,get minimumWidth(){return this._minimumWidth},set minimumWidth(a){this._minimumWidth=a;this.invalidateLayout()},_showsHeaders:NO,get showsHeaders(){return this._showsHeaders},set showsHeaders(a){this._showsHeaders=a;this.invalidateLayout()},_headerHeight:22,get headerHeight(){return this._showsHeaders?\nthis._headerHeight:0},set headerHeight(a){this._headerHeight=a;this._showsHeader&&this.invalidateLayout()},_showsFooters:NO,get showsFooters(){return this._showsFooters},set showsFooters(a){this._showsFooters=a;this.invalidateLayout()},_footerHeight:22,get footerHeight(){return this._showsFooters?this._footerHeight:0},set footerHeight(a){this._footerHeight=a;this._showsFooters&&this.invalidateLayout()},_sectionInsets:BMInsetMake(),get sectionInsets(){return this._sectionInsets},set sectionInsets(a){this._sectionInsets=\na||BMInsetMake();this.invalidateLayout()},_pinsHeadersToContentEdge:NO,get pinsHeadersToContentEdge(){return this._pinsHeadersToContentEdge},set pinsHeadersToContentEdge(a){this._pinsHeadersToContentEdge=a;this.invalidateLayout()},_pinsFootersToContentEdge:NO,get pinsFootersToContentEdge(){return this._pinsFootersToContentEdge},set pinsFootersToContentEdge(a){this._pinsFootersToContentEdge=a;this.invalidateLayout()},_cachedContentSize:void 0,contentSize:function(){var a=this._sectionInsets.top,b=\nthis._sectionInsets.bottom,c=this.headerHeight,d=this.footerHeight,e=0,f=this.collectionView.numberOfSections();e+=f*(c+d+a+b);if(0<=this._rowHeight)for(a=0;a<f;a++)e+=this._rowHeight*this.collectionView.numberOfObjectsInSectionAtIndex(a);else for(a=0;a<f;a++)for(b=this.collectionView.numberOfObjectsInSectionAtIndex(a),c=0;c<b;c++)e+=this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,this.collectionView.indexPathForObjectAtRow(c,{inSectionAtIndex:a}));return this._cachedContentSize=\nBMSizeMake(Math.max(this.collectionView.frame.size.width,this.minimumWidth+this.collectionView.scrollBarSize),Math.max(this.collectionView.frame.size.height,e))},shouldInvalidateLayoutForBoundsChange:function(a){return this._pinsHeadersToContentEdge||this._pinsFootersToContentEdge},attributesForCellAtIndexPath:function(a){var b=a.row,c=a.section,d=(c+1)*(this._sectionInsets.top+this.headerHeight)+c*(this._sectionInsets.bottom+this.footerHeight),e=this._cachedContentSize.height>this.collectionView.frame.size.height;\nif(0<=this._rowHeight)for(var f=0;f<=c;f++){var h=f==c?b:this.collectionView.numberOfObjectsInSectionAtIndex(f);d+=this._rowHeight*h}else for(f=0;f<=c;f++){h=f==c?b:this.collectionView.numberOfObjectsInSectionAtIndex(f);for(var g=0;g<h;g++)d+=this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,this.collectionView.indexPathForObjectAtRow(g,{inSectionAtIndex:f}))}b=BMRectMake(this._sectionInsets.left,d,Math.max(this.collectionView.frame.size.width,this.minimumWidth+\nthis.collectionView.scrollBarSize)-this._sectionInsets.left-this._sectionInsets.right-(e?this.collectionView.scrollBarSize:0),0<=this._rowHeight?this._rowHeight:this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,a));a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a);a.frame=b;return a},attributesForSupplementaryViewWithIdentifier:function(a,b){var c=this._cachedContentSize.height>this.collectionView.frame.size.height;if(a===BMCollectionViewTableLayoutSupplementaryView.Empty){var d=\nBMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])});d.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height);return d}var e=b.atIndexPath.section;if(!(e>=this.collectionView.numberOfSections())){d=this.sectionInsets.top;var f=0>this._rowHeight,h=this.sectionInsets.top+this.sectionInsets.bottom,g=this.sectionInsets.left;c=Math.max(this.collectionView.frame.size.width,\nthis.minimumWidth+this.collectionView.scrollBarSize)-this.sectionInsets.left-this.sectionInsets.right-(c?this.collectionView.scrollBarSize:0);for(var k,l=this.collectionView.scrollOffset,m=this.collectionView.frame,q=0;q<e;q++){k=d+h;d+=this.headerHeight+this.footerHeight+h;var n=this.collectionView.numberOfObjectsInSectionAtIndex(q);if(f)for(var u=0;u<n;u++)d+=this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,this.collectionView.indexPathForObjectAtRow(u,\n{inSectionAtIndex:q}));else d+=n*this._rowHeight}e=k<l.y&&d>l.y?YES:NO;k=k>l.y&&d>l.y+m.size.height?YES:NO;if(a===BMCollectionViewTableLayoutSupplementaryView.Header)return a=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,{atIndexPath:b.atIndexPath}),a.frame=BMRectMake(g,d,c,this.headerHeight),this._pinsHeadersToContentEdge&&e&&(a.frame.origin.y=Math.max(a.frame.origin.y,l.y),a.style.zIndex=1),a;if(a===BMCollectionViewTableLayoutSupplementaryView.Footer){n=\nthis.collectionView.numberOfObjectsInSectionAtIndex(q);if(f)for(u=0;u<n;u++)d+=this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,this.collectionView.indexPathForObjectAtRow(u,{inSectionAtIndex:q}));else d+=n*this._rowHeight;d+=this.headerHeight;a=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,{atIndexPath:b.atIndexPath});a.frame=BMRectMake(g,d,c,this.footerHeight);this._pinsHeadersToContentEdge&&\nk&&(a.frame.origin.y=Math.min(a.frame.origin.y,l.y+this.collectionView.frame.size.height-a.frame.size.height),a.style.zIndex=1);return a}}},indexPathAtPoint:function(a,b){b=b||{};b=b.directionNext;a=a.y;var c=this._sectionInsets.top+this.headerHeight,d=this._sectionInsets.bottom+this.footerHeight;if(a<=c)return this.collectionView.indexPathForObjectAtRow(0,{inSectionAtIndex:0});var e=c;var f=this.collectionView.numberOfSections();if(0<=this._rowHeight)for(var h=0;h<f;h++){var g=this.collectionView.numberOfObjectsInSectionAtIndex(h);\nif(a<=e+g*this._rowHeight)return this.collectionView.indexPathForObjectAtRow(Math.floor((a-e)/this._rowHeight)|0,{inSectionAtIndex:h});e+=g*this._rowHeight;if(a<=e+d+c)return b?h<f-1?this.collectionView.indexPathForObjectAtRow(0,{inSectionAtIndex:h+1}):this.collectionView.indexPathForObjectAtRow(g-1,{inSectionAtIndex:h}):this.collectionView.indexPathForObjectAtRow(g-1,{inSectionAtIndex:h});e+=d+c}else for(h=0;h<f;h++){g=this.collectionView.numberOfObjectsInSectionAtIndex(h);for(var k=0;k<g;k++){var l=\nthis.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,this.collectionView.indexPathForObjectAtRow(k,{inSectionAtIndex:h}));if(a<=e+l)return this.collectionView.indexPathForObjectAtRow(k,{inSectionAtIndex:h});e+=l}if(a<=e+d+c)return b?h<f-1?this.collectionView.indexPathForObjectAtRow(0,{inSectionAtIndex:h+1}):this.collectionView.indexPathForObjectAtRow(g-1,{inSectionAtIndex:h}):this.collectionView.indexPathForObjectAtRow(g-1,{inSectionAtIndex:h});e+=d+c}return this.collectionView.indexPathForObjectAtRow(this.collectionView.numberOfObjectsInSectionAtIndex(f-\n1),{inSectionAtIndex:f-1})},attributesForElementsInRect:function(a){var b=this._cachedContentSize.height>this.collectionView.frame.size.height;if(0==this.collectionView.numberOfSections()){var c=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])});c.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height);return[c]}var d=this._sectionInsets.top,\ne=0>this._rowHeight,f=this.sectionInsets.left;b=Math.max(this.collectionView.frame.size.width,this.minimumWidth+this.collectionView.scrollBarSize)-this.sectionInsets.left-this.sectionInsets.right-(b?this.collectionView.scrollBarSize:0);var h=a.origin.y;a=a.bottom;for(var g=0,k=-1;!(d+this.headerHeight>h);){d+=this.headerHeight;if(e){k=this.collectionView.numberOfObjectsInSectionAtIndex(g);for(c=0;c<k;c++){var l=this.collectionView.indexPathForObjectAtRow(c,{inSectionAtIndex:g});l=this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,\nl);if(d+l>h)break;d+=l}k=c}else{l=this.collectionView.numberOfObjectsInSectionAtIndex(g)*this._rowHeight;if(d+l>h){k=l=Math.floor((h-d)/this._rowHeight);d+=l*this._rowHeight;break}k=this.collectionView.numberOfObjectsInSectionAtIndex(g);d+=l}if(d+this.footerHeight>h)break;d+=this.footerHeight+this.sectionInsets.top+this.sectionInsets.bottom;g++;k=-1;if(g>=this.collectionView.numberOfSections())return[]}h=[];var m=g;this._pinsHeadersToContentEdge&&-1<k&&(c=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,\n{atIndexPath:BMIndexPathMakeWithIndexes([g])}),c.frame=BMRectMake(f,this.collectionView.scrollOffset.y,b,this.headerHeight),c.style.zIndex=1,h.push(c));for(var q=g,n,u;d<a&&!(g>=this.collectionView.numberOfSections());)if(q=g,-1==k)this.showsHeaders&&(c=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([g])}),c.frame=BMRectMake(f,d,b,this.headerHeight),this._pinsHeadersToContentEdge&&g===\nm&&(c.frame.origin.y>this.collectionView.scrollOffset.y&&-1<g-1&&(k=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([g-1])}),k.frame=BMRectMake(f,Math.min(this.collectionView.scrollOffset.y,c.frame.origin.y-this.headerHeight),b,this.headerHeight),k.style.zIndex=1,h.push(k)),c.frame.origin.y=Math.max(this.collectionView.scrollOffset.y,c.frame.origin.y),c.style.zIndex=1),h.push(c),d+=this.headerHeight),\nk=0;else if(k==this.collectionView.numberOfObjectsInSectionAtIndex(g))this.showsFooters?(c=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([g])}),c.frame=BMRectMake(f,d,b,this.footerHeight),h.push(c),n=c,u=g,d+=this.footerHeight+this.sectionInsets.top+this.sectionInsets.bottom,k=-1,g++):(k=-1,g++,d+=this.footerHeight+this.sectionInsets.top+this.sectionInsets.bottom);else{if(g>=this.collectionView.numberOfSections())return h;\nl=this.collectionView.indexPathForObjectAtRow(k,{inSectionAtIndex:g});c=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(l);c.frame=BMRectMake(f,d,b,e?this.collectionView.delegate.collectionViewRowHeightForCellAtIndexPath(this.collectionView,l):this._rowHeight);h.push(c);d+=c.frame.size.height;k++}this._pinsFootersToContentEdge&&(q===u?(n.frame.origin.y<this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-this.footerHeight&&u+1<this.collectionView.numberOfSections()&&(d=\nBMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([u+1])}),d.frame=BMRectMake(f,Math.max(this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-this.footerHeight,n.frame.bottom),b,this.footerHeight),h.push(d)),n.frame.origin.y=Math.min(n.frame.origin.y,this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-n.frame.size.height),n.style.zIndex=1):(c=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([q])}),c.frame=BMRectMake(f,this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-this.footerHeight,b,this.footerHeight),c.style.zIndex=1,h.push(c)));return h},initialAttributesForPresentedCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath(this.collectionView,\na,{withTargetAttributes:b});b.frame.origin.x+=b.frame.size.width/2;b.style={opacity:0,translateZ:0};return b},initialAttributesForPresentedSupplementaryViewWithIdentifier:function(a,b){var c=this.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForPresentedSupplementaryViewWithIdentifier)return this.collectionView.delegate.collectionViewInitialAttributesForPresentedSupplementaryViewWithIdentifier(this.collectionView,\na,{atIndexPath:b.atIndexPath,withTargetAttributes:c});c.frame.origin.x+=c.frame.size.width/2;c.style={opacity:0,translateZ:0};return c},initialAttributesForAppearingCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath(this.collectionView,a,{withTargetAttributes:b});\nb.frame.origin.x+=b.frame.size.width/2;b.style={opacity:0,translateZ:0};return b},initialAttributesForAppearingSupplementaryViewWithIdentifier:function(a,b){var c=this.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForAppearingSupplementaryViewWithIdentifier)return this.collectionView.delegate.collectionViewInitialAttributesForAppearingSupplementaryViewWithIdentifier(this.collectionView,\na,{atIndexPath:b.atIndexPath,withTargetAttributes:c});c.frame.origin.x+=c.frame.size.width/2;c.style={opacity:0,translateZ:0};return c},initialAttributesForMovingCellFromIndexPath:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=d.attributesForCellAtIndexPath(a)});return c},initialAttributesForMovingSupplementaryViewWithIdentifier:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=d.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath})});\nreturn c},supplementaryViewsToInsert:function(){var a=this.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=c.collectionView.numberOfSections()});for(var d=[],e=b;e<a;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0<b&&0==a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},supplementaryViewsToDelete:function(){var a=this.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=c.collectionView.numberOfSections()});for(var d=[],e=a;e<b;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Header,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0==b&&0<a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},finalAttributesForDisappearingCellAtIndexPath:function(a){var b,\nc=this;this.collectionView.usingOldDataSet(function(){b=c.attributesForCellAtIndexPath(a).copy();c.collectionView.delegate&&c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath?b=c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath(c.collectionView,a,{withTargetAttributes:b}):(b.frame.origin.x-=b.frame.size.width/2,b.style={opacity:0,translateZ:0})});return b},finalAttributesForDisappearingSupplementaryViewWithIdentifier:function(a,\nb){var c,d=this;this.collectionView.usingOldDataSet(function(){c=d.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}).copy();d.collectionView.delegate&&d.collectionView.delegate.collectionViewFinalAttributesForDisappearingSupplementaryViewWithIdentifier?c=d.collectionView.delegate.collectionViewFinalAttributesForDisappearingSupplementaryViewWithIdentifier(d.collectionView,a,{atIndexPath:b.atIndexPath,withTargetAttributes:c}):(c.frame.origin.x-=c.frame.size.width/2,c.style=\n{opacity:0,translateZ:0})});return c},copy:function(){var a=new BMCollectionViewTableLayout;a.rowHeight=this.rowHeight;a.showsHeaders=this.showsHeaders;a.headerHeight=this.headerHeight;a.showsFooters=this.showsFooters;a.footerHeight=this.footerHeight;a.sectionInsets=this.sectionInsets;a.pinsHeadersToContentEdge=this.pinsHeadersToContentEdge;a.pinsFootersToContentEdge=this.pinsFootersToContentEdge;return a}});function BMCollectionViewTreeLayout(){}\nBMExtend(BMCollectionViewTreeLayout.prototype,BMCollectionViewLayout.prototype,{_rowHeight:44,get rowHeight(){return this._rowHeight},set rowHeight(a){this._rowHeight=a;this.invalidateLayout()},_showsHeaders:NO,get showsHeaders(){return this._showsHeaders},set showsHeaders(a){this._showsHeaders=a;this.invalidateLayout()},_headerHeight:22,get headerHeight(){return this._showsHeaders?this._headerHeight:0},set headerHeight(a){this._headerHeight=a;this._showsHeader&&this.invalidateLayout()},_showsFooters:NO,\nget showsFooters(){return this._showsFooters},set showsFooters(a){this._showsFooters=a;this.invalidateLayout()},_footerHeight:22,get footerHeight(){return this._showsFooters?this._footerHeight:0},set footerHeight(a){this._footerHeight=a;this._showsFooters&&this.invalidateLayout()},_indentWidth:22,get indentWidth(){return this._indentWidth},set indentWidth(a){this._indentWidth=a;this.invalidateLayout()},_sectionInsets:BMInsetMake(),get sectionInsets(){return this._sectionInsets},set sectionInsets(a){this._sectionInsets=\na||BMInsetMake();this.invalidateLayout()},_pinsHeadersToContentEdge:NO,get pinsHeadersToContentEdge(){return this._pinsHeadersToContentEdge},set pinsHeadersToContentEdge(a){this._pinsHeadersToContentEdge=a;this.invalidateLayout()},_pinsFootersToContentEdge:NO,get pinsFootersToContentEdge(){return this._pinsFootersToContentEdge},set pinsFootersToContentEdge(a){this._pinsFootersToContentEdge=a;this.invalidateLayout()},prepareLayout:function(){if(!this.collectionView.invalidationContext)return this.rebuildLayout()},\ncontentSize:function(){},shouldInvalidateLayoutForBoundsChange:function(a){return this._pinsHeadersToContentEdge||this._pinsFootersToContentEdge}});var BMCollectionViewFlowLayoutGravity=Object.freeze({Center:{},Edge:{},Spaced:{},Expand:{}}),BMCollectionViewFlowLayoutAlignment=Object.freeze({Top:{},Center:{},Bottom:{},Expand:{}}),BMCollectionViewFlowLayoutSupplementaryView=BMCollectionViewTableLayoutSupplementaryView,BMCollectionViewFlowLayout=function(){};\nBMCollectionViewFlowLayout.prototype=BMExtend({},BMCollectionViewLayout.prototype,{_cellSize:void 0,get cellSize(){return this._cellSize},set cellSize(a){this._cellSize=a;this.invalidateLayout()},_rowSpacing:44,get rowSpacing(){return this._rowSpacing},set rowSpacing(a){this._rowSpacing=a;this.invalidateLayout()},_showsHeaders:NO,get showsHeaders(){return this._showsHeaders},set showsHeaders(a){this._showsHeaders=a;this.invalidateLayout()},_headerHeight:22,get headerHeight(){return this._showsHeaders?\nthis._headerHeight:0},set headerHeight(a){this._headerHeight=a;this._showsHeader&&this.invalidateLayout()},_showsFooters:NO,get showsFooters(){return this._showsFooters},set showsFooters(a){this._showsFooters=a;this.invalidateLayout()},_footerHeight:22,get footerHeight(){return this._showsFooters?this._footerHeight:0},set footerHeight(a){this._footerHeight=a;this._showsFooters&&this.invalidateLayout()},_sectionInsets:BMInsetMake(),get sectionInsets(){return this._sectionInsets},set sectionInsets(a){this._sectionInsets=\na||BMInsetMake();this.invalidateLayout()},_gravity:BMCollectionViewFlowLayoutGravity.Spaced,get gravity(){return this._gravity},set gravity(a){this._gravity=a;this.invalidateLayout()},_minimumSpacing:0,get minimumSpacing(){return this._minimumSpacing},set minimumSpacing(a){this._minimumSpacing=a;this.invalidateLayout()},_leftAlignFinalRow:NO,get leftAlignFinalRow(){return this._leftAlignFinalRow},set leftAlignFinalRow(a){this._leftAlignFinalRow=a;this.invalidateLayout()},_alignment:BMCollectionViewFlowLayoutAlignment.Center,\nget alignment(){return this._alignment},set alignment(a){this._alignment=a;this.invalidateLayout()},_topPadding:0,get topPadding(){return this._topPadding},set topPadding(a){this._topPadding=a;this.invalidateLayout()},_bottomPadding:0,get bottomPadding(){return this._bottomPadding},set bottomPadding(a){this._bottomPadding=a;this.invalidateLayout()},_contentGravity:BMCollectionViewFlowLayoutAlignment.Center,get contentGravity(){return this._contentGravity},set contentGravity(a){this._contentGravity=\na;this.invalidateLayout()},_pinsHeadersToContentEdge:NO,get pinsHeadersToContentEdge(){return this._pinsHeadersToContentEdge},set pinsHeadersToContentEdge(a){this._pinsHeadersToContentEdge=a;this.invalidateLayout()},_pinsFootersToContentEdge:NO,get pinsFootersToContentEdge(){return this._pinsFootersToContentEdge},set pinsFootersToContentEdge(a){this._pinsFootersToContentEdge=a;this.invalidateLayout()},cachedLayout:void 0,collectionViewWillStartUpdates:function(a){this.prepareLayout()},collectionViewDidStartUpdates:function(){this.previousLayout=\nvoid 0},prepareLayout:function(){return this._prepareLayoutWithScrollbarOffset(NO)},_prepareLayoutWithScrollbarOffset:function(a){if(!this.isChangingBounds){this.previousLayout=a?this.previousLayout:this.cachedLayout;var b=this.collectionView.frame.size.height;if(this._cellSize){m=this.cachedLayout={sections:[],prototypeRows:[]};m.sectionInsets=this.sectionInsets;m.rowSpacing=this.rowSpacing;m.showsHeaders=this.showsHeaders;m.showsFooters=this.showsFooters;m.headerHeight=this.headerHeight;m.footerHeight=\nthis.footerHeight;m.minimumSpacing=this.minimumSpacing;m.pinsHeadersToContentEdge=this._pinsHeadersToContentEdge;m.pinsFootersToContentEdge=this._pinsFootersToContentEdge;var c=this.cellSize.width;v=this.cellSize.height;m.cellWidth=c;m.rowHeight=v;t=this.rowSpacing;p=this.minimumSpacing;q=this.collectionView.frame.size.width-this.sectionInsets.left-this.sectionInsets.right-(a?this.collectionView.scrollBarSize:0);var d;if(m.minimumSpacing){var e=d=0;this._gravity===BMCollectionViewFlowLayoutGravity.Spaced&&\n(e=2*p);do{if(e&&e+c+p>q)break;d&&(e+=p);e+=c;d++}while(e<q&&c)}else d=q/c|0||1;m.numberOfColumns=d;for(e=0;e<d;e++){var f={attributes:[]},h=this.leftAlignFinalRow?d-1:e,g=c*(h+1)+p*h;for(B=0;B<=h;B++)f.attributes.push({frame:BMRectMake(0,0,c,v)});this.reflowRow(f,{forWidth:q,height:v,withOccupiedWidth:g,spacing:p});m.prototypeRows.push(f)}q=this.collectionView.numberOfSections();B=this._sectionInsets.top;h=this._sectionInsets.bottom;g=this.headerHeight;var k=this.footerHeight;c=B+this._topPadding;\nfor(e=0;e<q;e++){p=this.collectionView.numberOfObjectsInSectionAtIndex(e);f=Math.ceil(p/d)|0;var l=(f-1)*t;g&&(l+=t);k&&(l+=t);f={top:c,bottom:c+k+g+v*f+l,numberOfObjects:p};m.sections.push(f);c=f.bottom+B+h;if(c>b&&this.collectionView.scrollBarSize&&!a)return this._prepareLayoutWithScrollbarOffset(YES)}c+=this._bottomPadding;if(c>b&&this.collectionView.scrollBarSize&&!a)return this._prepareLayoutWithScrollbarOffset(YES);if(c<this.collectionView.frame.size.height&&(a=0,this._contentGravity===BMCollectionViewFlowLayoutAlignment.Center?\na=(this.collectionView.frame.size.height-c)/2:this._contentGravity===BMCollectionViewFlowLayoutAlignment.Bottom&&(a=this.collectionView.frame.size.height-c),0!=a))for(b=m.sections.length,e=0;e<b;e++)f=m.sections[e],f.top+=a,f.bottom+=a}else{var m=this.cachedLayout={sections:[]};m.pinsHeadersToContentEdge=this._pinsHeadersToContentEdge;m.pinsFootersToContentEdge=this._pinsFootersToContentEdge;B=this._sectionInsets.top;h=this._sectionInsets.bottom;l=this._bottomPadding;c=this._topPadding;var q=this.collectionView.frame.size.width-\nthis._sectionInsets.left-this._sectionInsets.right-(a?this.collectionView.scrollBarSize:0),n=this._sectionInsets.left,u=this.showsHeaders,w=this.showsFooters;g=this.headerHeight;k=this.footerHeight;var x=this.collectionView.numberOfSections(),t=this._rowSpacing,p=this._minimumSpacing;for(e=0;e<x;e++){f={rows:[]};c+=B;f.top=c;u&&(v=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])}),\nv.frame=BMRectMake(n,c,q,g),f.headerAttributes=v,c+=g+t);for(var D=this.collectionView.numberOfObjectsInSectionAtIndex(e),r=0;r<D;){d={top:c,attributes:[],startIndex:r};var A=0,v=0;for(this._gravity===BMCollectionViewFlowLayoutGravity.Spaced&&(A=2*p);A<q||0>=q;){var z=this.collectionView.indexPathForObjectAtRow(r,{inSectionAtIndex:e}),E=this.collectionView.delegate.collectionViewSizeForCellAtIndexPath(this.collectionView,z);if(E.width+A+p>q&&d.attributes.length)break;z=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(z);\nz.frame=BMRectMake(A,c,E.width,E.height);v<E.height&&(v=E.height);d.attributes.push(z);A+=E.width;1<d.attributes.length&&(A+=p);r++;if(d.top+v>b&&this.collectionView.scrollBarSize&&!a)return this._prepareLayoutWithScrollbarOffset(YES);if(r>=D||0==q)break}d.attributes.length&&(this.reflowRow(d,{forWidth:q,height:v,withOccupiedWidth:A,spacing:p}),c+=v,d.bottom=c,d.endIndex=r-1,f.rows.push(d),c+=t)}if(w&&(c+=t,v=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}),v.frame=BMRectMake(n,c,q,k),f.footerAttributes=v,c+=k,c>b&&this.collectionView.scrollBarSize&&!a))return this._prepareLayoutWithScrollbarOffset(YES);f.bottom=c;m.sections.push(f);c+=h;if(c>b&&this.collectionView.scrollBarSize&&!a)return this._prepareLayoutWithScrollbarOffset(YES)}c+=l;if(c>b&&this.collectionView.scrollBarSize&&!a)return this._prepareLayoutWithScrollbarOffset(YES);if(c<this.collectionView.frame.size.height&&(a=0,this._contentGravity===\nBMCollectionViewFlowLayoutAlignment.Center?a=(this.collectionView.frame.size.height-c)/2:this._contentGravity===BMCollectionViewFlowLayoutAlignment.Bottom&&(a=this.collectionView.frame.size.height-c),0!=a))for(b=m.sections.length,e=0;e<b;e++){f=m.sections[e];f.top+=a;f.bottom+=a;t=f.rows.length;for(var B=0;B<t;B++)for(d=f.rows[B],d.top+=a,d.bottom+=a,v=0;v<d.attributes.length;v++)d.attributes[v].frame.origin.y+=a;f.headerAttributes&&(f.headerAttributes.frame.origin.y+=a);f.footerAttributes&&(f.footerAttributes.frame.origin.y+=\na)}m.size=BMSizeMake(this.collectionView.frame.size.width,Math.max(c,this.collectionView.frame.size.height))}}},reflowRow:function(a,b){var c=b.forWidth,d=b.withOccupiedWidth,e=b.height;b=b.spacing;var f=b*(a.attributes.length-1),h=d-f,g=this._gravity,k=this._alignment,l=a.attributes.length,m=g==BMCollectionViewFlowLayoutGravity.Expand?(c-f)/h:1,q=0;if(g==BMCollectionViewFlowLayoutGravity.Expand){for(var n=q=0;n<l;n++)q+=a.attributes[n].frame.size.width*m|0;q=(c-f|0)%(q|0)}f=0;var u=this._sectionInsets.left;\ng===BMCollectionViewFlowLayoutGravity.Center?u=u+(c-d)/2|0:g===BMCollectionViewFlowLayoutGravity.Edge?(b=(c-h)/(l-1)|0,f=c-(b*(l-1)+h)):g===BMCollectionViewFlowLayoutGravity.Spaced&&(b=(c-h)/(l+1)|0,f=c-(b*(l+1)+h),u+=b);for(n=0;n<l;n++)c=a.attributes[n],c.frame.origin.x=u,c.frame.size.width*=m,c.frame.size.width|=0,q&&(c.frame.size.width+=1,q--),u+=b+c.frame.size.width,f&&(u+=1,f--),k===BMCollectionViewFlowLayoutAlignment.Center?c.frame.origin.y+=(e-c.frame.size.height)/2|0:k===BMCollectionViewFlowLayoutAlignment.Bottom?\nc.frame.origin.y+=e-c.frame.size.height:k===BMCollectionViewFlowLayoutAlignment.Expand&&(c.frame.size.height=e)},contentSize:function(){return this._cellSize?this.cachedLayout.sections.length?BMSizeMake(this.collectionView.frame.size.width,Math.max(this.cachedLayout.sections[this.cachedLayout.sections.length-1].bottom+this._bottomPadding+this.sectionInsets.bottom,this.collectionView.frame.size.height)):this.collectionView.frame.size.copy():this.cachedLayout.size},shouldInvalidateLayoutForBoundsChange:function(a){if(a=\nthis._pinsHeadersToContentEdge||this._pinsFootersToContentEdge)this.isChangingBounds=YES;return a},didInvalidateLayoutForBoundsChange:function(){this.isChangingBounds=NO},attributesForCellAtIndexPath:function(a){return this._cellSize?this.computedAttributesForCellAtIndexPath(a):this.cachedAttributesForCellAtIndexPath(a)},cachedAttributesForCellAtIndexPath:function(a,b){b=(b&&b.usingCache||this.cachedLayout).sections[a.section].rows;a=a.row;for(var c=b.length,d=0;d<c;d++){var e=b[d];if(a>=e.startIndex&&\na<=e.endIndex)return e.attributes[a-e.startIndex]}throw\"Unable to find the cached attributes for the cell at the given index path\";},computedAttributesForCellAtIndexPath:function(a,b){b=b&&b.usingCache||this.cachedLayout;var c=b.sections[a.section],d=b.numberOfColumns,e=c.numberOfObjects,f=a.row,h=f/d|0;f%=d;d=h==(e/d|0)?b.prototypeRows[(e%d||d)-1]:b.prototypeRows[d-1];c=c.top;b.showsHeaders&&(c+=b.headerHeight+b.rowSpacing);c+=h*(b.rowHeight+b.rowSpacing);a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a);\na.frame=d.attributes[f].frame.copy();a.frame.origin.y=c;return a},attributesForSupplementaryViewWithIdentifier:function(a,b){return a===BMCollectionViewTableLayoutSupplementaryView.Empty?(a=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}),a.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height),a):this._cellSize?this.computedAttributesForSupplementaryViewWithIdentifier(a,\nb):this.cachedAttributesForSupplementaryViewWithIdentifier(a,b)},cachedAttributesForSupplementaryViewWithIdentifier:function(a,b){var c=b&&b.usingCache||this.cachedLayout;b=b.atIndexPath.section;if(!(b>=c.sections.length)){if(a===BMCollectionViewFlowLayoutSupplementaryView.Header)return c.sections[b].headerAttributes;if(a===BMCollectionViewFlowLayoutSupplementaryView.Footer)return c.sections[b].footerAttributes}},computedAttributesForSupplementaryViewWithIdentifier:function(a,b){var c=b&&b.usingCache||\nthis.cachedLayout,d=b.atIndexPath.section;if(!(d>=c.sections.length)){d=c.sections[d];b=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath});if(a===BMCollectionViewFlowLayoutSupplementaryView.Header)return b.frame=BMRectMake(c.sectionInsets.left,d.top,this.collectionView.frame.size.width-c.sectionInsets.left-c.sectionInsets.right,c.headerHeight),b;if(a===BMCollectionViewFlowLayoutSupplementaryView.Footer)return b.frame=BMRectMake(c.sectionInsets.left,\nd.bottom-c.footerHeight,this.collectionView.frame.size.width-c.sectionInsets.left-c.sectionInsets.right,c.footerHeight),b}},attributesForElementsInRect:function(a){return 0==this.collectionView.numberOfSections()?(a=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}),a.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height),[a]):this._cellSize?\nthis.computedAttributesForElementsInRect(a):this.cachedAttributesForElementsInRect(a)},cachedAttributesForElementsInRect:function(a,b){b=b&&b.usingCache||this.cachedLayout;var c=[],d=a.origin.y;a=a.bottom;for(var e=0,f=b.sections.length,h;e<f&&!(h=b.sections[e],h.bottom>d);e++);if(e==f)return c;var g=-1;if(!h.headerAttributes||h.headerAttributes.frame.bottom<d){for(var k=h.rows,l=k.length,m=0;m<l&&!(k[m].bottom>d);m++);g=m}var q=d=h;if(b.pinsHeadersToContentEdge&&-1!=g){var n=h.headerAttributes.copy();\nn.frame.origin.y=this.collectionView.scrollOffset.y;c.push(n)}try{for(;e<f;e++){h=b.sections[e];k=h.rows;for(l=k.length;g<=l;g++)if(-1==g){if(h.headerAttributes){n=h.headerAttributes;b.pinsHeadersToContentEdge&&h===d&&(n=n.copy(),n.frame.origin.y=Math.max(this.collectionView.scrollOffset.y,n.frame.origin.y));var u=n.frame.origin.y;if(u>a)return c;c.push(n)}q=h}else if(g==l){if(h.footerAttributes){u=h.footerAttributes.frame.origin.y;if(u>a)return c;var w=h.footerAttributes;if(this.collectionView._pinsFootersToContentEdge){var x=\nw=w.copy();var t=h}c.push(w)}}else{var p=k[g];u=p.top;if(u>a)return c;for(m=0;m<p.attributes.length;m++)c.push(p.attributes[m])}g=-1}}finally{b.pinsFootersToContentEdge&&this._showsFooters&&(t===q?w=x:(w=q.footerAttributes.copy(),c.push(w)),w.frame.origin.y=Math.min(w.frame.origin.y,this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-w.frame.size.height))}return c},computedAttributesForElementsInRect:function(a,b){b=b&&b.usingCache||this.cachedLayout;var c=[],d=a.origin.y;a=a.bottom;\nfor(var e=0,f=b.sections.length,h;e<f&&!(h=b.sections[e],h.bottom>d);e++);if(e==f)return c;var g=-1,k=h.top,l=h,m=h;if(!b.showsHeaders||h.top+b.headerHeight<d){g=0;var q=Math.ceil(h.numberOfObjects/b.numberOfColumns)|0;k=b.showsHeaders?h.top+b.headerHeight+b.rowSpacing:h.top;for(var n=NO,u=0;u<q;u++)if(g=u,k+b.rowHeight>d){n=YES;break}else k+=b.rowHeight+b.rowSpacing;n||(g=u)}if(b.pinsHeadersToContentEdge&&-1<g&&b.showsHeaders){var w=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])});w.frame=BMRectMake(b.sectionInsets.left,this.collectionView.scrollOffset.y,this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.headerHeight);w.style.zIndex=1;c.push(w)}d=b.numberOfColumns;try{for(;e<f;e++){h=b.sections[e];for(q=Math.ceil(h.numberOfObjects/d)|0;g<=q;g++)if(-1==g){if(b.showsHeaders){if(k>a)return c;w=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])});w.frame=BMRectMake(b.sectionInsets.left,k,this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.headerHeight);if(h===l&&b.pinsHeadersToContentEdge){if(w.frame.origin.y>this.collectionView.scrollOffset.y&&b.sections[e-1]){var x=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e-1])});x.frame=BMRectMake(b.sectionInsets.left,\nMath.min(this.collectionView.scrollOffset.y,w.frame.origin.y-b.headerHeight),this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.headerHeight);c.push(x)}w.frame.origin.y=Math.max(w.frame.origin.y,this.collectionView.scrollOffset.y);w.style.zIndex=1}k+=b.headerHeight+b.rowSpacing;c.push(w)}m=h}else if(g==q)if(b.showsFooters){if(k>a)return c;var t=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([e])});\nt.frame=BMRectMake(b.sectionInsets.left,k,this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.footerHeight);var p=t;var D=h;k+=b.footerHeight+b.sectionInsets.top+b.sectionInsets.bottom;c.push(t)}else{if(k+=b.sectionInsets.top+b.sectionInsets.bottom,k>a)return c}else{if(k>a)return c;n=g*d;var r=d;if(g==q-1){r=h.numberOfObjects%d||d;var A=b.prototypeRows[r-1]}else A=b.prototypeRows[d-1];for(u=0;u<r;u++){var v=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(this.collectionView.indexPathForObjectAtRow(n+\nu,{inSectionAtIndex:e}));v.frame=A.attributes[u].frame.copy();v.frame.origin.y=k;c.push(v)}k+=b.rowHeight;if(b.showsFooters||g<q-1)k+=b.rowSpacing}g=-1}}finally{b.pinsFootersToContentEdge&&b.showsFooters&&(D===m?(t=p,t.frame.origin.y<this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-b.footerHeight&&b.sections[t.indexPath.section+1]&&(h=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([t.indexPath.section+\n1])}),h.frame=BMRectMake(b.sectionInsets.left,Math.max(this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-b.footerHeight,t.frame.bottom),this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.footerHeight),c.push(h)),t.frame.origin.y=Math.min(t.frame.origin.y,this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-t.frame.size.height),t.style.zIndex=1):(t=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}),t.frame=BMRectMake(b.sectionInsets.left,this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-b.footerHeight,this.collectionView.frame.size.width-b.sectionInsets.left-b.sectionInsets.right,b.footerHeight),t.style.zIndex=1,c.push(t)))}return c},initialAttributesForPresentedCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath(this.collectionView,\na,{withTargetAttributes:b});b.frame.origin.y+=this.collectionView.frame.size.height/2;b.style={rotateZ:\"15deg\",opacity:0,translateZ:0};return b},initialAttributesForPresentedSupplementaryViewWithIdentifier:function(a,b){var c=this.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForPresentedSupplementaryViewWithIdentifier)return this.collectionView.delegate.collectionViewInitialAttributesForPresentedSupplementaryViewWithIdentifier(this.collectionView,\na,{atIndexPath:b.atIndexPath,withTargetAttributes:c});c.frame.origin.x+=c.frame.size.width/2;c.style={opacity:0,translateZ:0};return c},initialAttributesForAppearingCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath(this.collectionView,a,{withTargetAttributes:b});\nb.style={opacity:0,translateZ:0,scaleX:.5,scaleY:.5};return b},initialAttributesForAppearingSupplementaryViewWithIdentifier:function(a,b){var c=this.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}).copy();if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForAppearingSupplementaryViewWithIdentifier)return this.collectionView.delegate.collectionViewInitialAttributesForAppearingSupplementaryViewWithIdentifier(this.collectionView,a,\n{atIndexPath:b.atIndexPath,withTargetAttributes:c});c.style={opacity:0,translateZ:0,scaleX:.5,scaleY:.5};return c},initialAttributesForMovingCellFromIndexPath:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=d._cellSize?d.computedAttributesForCellAtIndexPath(a,{usingCache:d.previousLayout}):d.cachedAttributesForCellAtIndexPath(a,{usingCache:d.previousLayout})});return c},initialAttributesForMovingSupplementaryViewWithIdentifier:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=\na===BMCollectionViewTableLayoutSupplementaryView.Empty?d.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}):d._cellSize?d.computedAttributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath,usingCache:d.previousLayout}):d.cachedAttributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath,usingCache:d.previousLayout})});return c},supplementaryViewsToInsert:function(){var a=this.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=\nc.collectionView.numberOfSections()});for(var d=[],e=b;e<a;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0<b&&0==a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,\n{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},supplementaryViewsToDelete:function(){var a=this.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=c.collectionView.numberOfSections()});for(var d=[],e=a;e<b;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0==b&&0<a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},finalAttributesForDisappearingCellAtIndexPath:function(a){var b,c=this;this.collectionView.usingOldDataSet(function(){b=c._cellSize?c.computedAttributesForCellAtIndexPath(a,{usingCache:c.previousLayout}):c.cachedAttributesForCellAtIndexPath(a,{usingCache:c.previousLayout}).copy();\nc.collectionView.delegate&&c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath?b=c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath(c.collectionView,a,{withTargetAttributes:b}):b.style={opacity:0,translateZ:0,scaleX:.5,scaleY:.5}});return b},finalAttributesForDisappearingSupplementaryViewWithIdentifier:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=a===BMCollectionViewTableLayoutSupplementaryView.Empty?\nd.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}):d._cellSize?d.computedAttributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath,usingCache:d.previousLayout}):d.cachedAttributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath,usingCache:d.previousLayout});d.collectionView.delegate&&d.collectionView.delegate.collectionViewFinalAttributesForDisappearingSupplementaryViewWithIdentifier?c=d.collectionView.delegate.collectionViewFinalAttributesForDisappearingSupplementaryViewWithIdentifier(d.collectionView,\na,{atIndexPath:b.atIndexPath,withTargetAttributes:c}):c.style={opacity:0,translateZ:0,scaleX:.5,scaleY:.5}});return c},copy:function(){var a=new BMCollectionViewFlowLayout;a.cellSize=this.cellSize&&this.cellSize.copy();a.rowSpacing=this.rowSpacing;a.showsHeaders=this.showsHeaders;a.headerHeight=this.headerHeight;a.showsFooters=this.showsFooters;a.footerHeight=this.footerHeight;a.sectionInsets=this.sectionInsets;a.gravity=this.gravity;a.leftAlignFinalRow=this.leftAlignFinalRow;a.alignment=this.alignment;\na.topPadding=this.topPadding;a.bottomPadding=this.bottomPadding;a.contentGravity=this.contentGravity;a.pinsHeadersToContentEdge=this.pinsHeadersToContentEdge;a.pinsFootersToContentEdge=this.pinsFootersToContentEdge;return a}});var BMCollectionViewMasonryLayout=function(){};\nBMCollectionViewMasonryLayout.prototype=BMExtend({},BMCollectionViewLayout.prototype,{_minimumColumnWidth:128,get minimumColumnWidth(){return this._minimumColumnWidth},set minimumColumnWidth(a){this._minimumColumnWidth=a;this.invalidateLayout()},_numberOfColumns:void 0,get numberOfColumns(){return this._numberOfColumns},set numberOfColumns(a){this._numberOfColumns=a;this.invalidateLayout()},_columnSpacing:22,get columnSpacing(){return this._columnSpacing},set columnSpacing(a){this._columnSpacing=\na;this.invalidateLayout()},_cellSpacing:22,get cellSpacing(){return this._cellSpacing},set cellSpacing(a){this._cellSpacing=a;this.invalidateLayout()},_columnSpeeds:[],get columnSpeeds(){return this._columnSpeeds},set columnSpeeds(a){this._columnSpeeds=a;this.invalidateLayout()},_topPadding:22,get topPadding(){return this._topPadding},set topPadding(a){this._topPadding=a;this.invalidateLayout()},_bottomPadding:22,get bottomPadding(){return this._bottomPadding},set bottomPadding(a){this._bottomPadding=\na;this.invalidateLayout()},cachedLayout:void 0,prepareLayout:function(){if(!this.isChangingBounds){this.previousLayout=this.cachedLayout;var a=this.cachedLayout={},b=this.collectionView.frame.size.width,c=this.columnSpacing,d=this.cellSpacing,e=this.numberOfColumns,f=this.columnSpeeds;if(!e){var h=this.minimumColumnWidth;e=b/h|0;e*h+(e+1)*c>b&&--e}h=(b-(e+1)*c)/e|0;a.columns=[];for(b=0;b<e;b++)a.columns.push({height:this._topPadding,speedHeight:this._topPadding/(f[b]||1),speed:f[b]||1,attributes:[],\nx:c+b*(c+h)});c=this.collectionView.numberOfSections();for(b=0;b<c;b++){f=this.collectionView.numberOfObjectsInSectionAtIndex(b);for(var g=0;g<f;g++){for(var k=this.collectionView.indexPathForObjectAtRow(g,{inSectionAtIndex:b}),l=this.collectionView.delegate.collectionViewHeightForCellAtIndexPath(this.collectionView,k,{forColumnWidth:h}),m=a.columns[0].speedHeight,q=0,n=1;n<e;n++){var u=a.columns[n];u.speedHeight<m&&(m=u.speedHeight,q=n)}u=a.columns[q];k=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(k);\nk.frame=BMRectMake(u.x,u.height,h,l);k.style={translateZ:0};u.attributes.push(k);u.height+=l+d;u.speedHeight+=(l+d)/u.speed}}for(n=0;n<e;n++)u=a.columns[n],u.height+=this._bottomPadding,u.speedHeight+=this._bottomPadding/u.speed}},contentSize:function(){for(var a=0,b=0;b<this.cachedLayout.columns.length;b++)a<this.cachedLayout.columns[b].speedHeight&&(a=this.cachedLayout.columns[b].speedHeight);return BMSizeMake(this.collectionView.frame.size.width,Math.max(a,this.collectionView.frame.size.height))},\ncollectionViewWillStartUpdates:function(){this.prepareLayout()},collectionViewDidStartUpdates:function(){this.previousLayout=void 0},shouldInvalidateLayoutForBoundsChange:function(a){return this.isChangingBounds=YES},didInvalidateLayoutForBoundsChange:function(){this.isChangingBounds=NO},attributesForElementsInRect:function(a){return this.cachedAttributesForElementsInRect(a)},cachedAttributesForElementsInRect:function(a,b){var c=this.collectionView.scrollOffset,d=a.origin.y;a=a.bottom;var e=[];b=\n(b&&b.usingCache||this.cachedLayout).columns;for(var f=b.length,h=0;h<f;h++){var g=b[h],k=c.y-c.y*g.speed,l=g.attributes.length;g=g.attributes;for(var m=0;m<l;m++){var q=g[m];if(q.frame.bottom+k>d)break}for(;m!=l;){q=g[m];if(q.frame.top+k>a)break;q=q.copy();q.frame.origin.y=q.frame.origin.y+k|0;e.push(q);m++}}return e},attributesForCellAtIndexPath:function(a){return this.cachedAttributesForCellAtIndexPath(a)},cachedAttributesForCellAtIndexPath:function(a,b){var c=this.collectionView.scrollOffset;\nb=(b&&b.usingCache||this.cachedLayout).columns;for(var d=b.length,e=0;e<d;e++)for(var f=b[e],h=c.y-c.y*f.speed,g=f.attributes.length,k=f.attributes,l=0;l<g;l++){var m=k[l];if(m.indexPath.section==a.section&&m.indexPath.row==a.row)return m=m.copy(),m.frame.origin.y=m.frame.origin.y+h|0,m.speed=f.speed,m}},initialAttributesForPresentedCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a);if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForPresentedCellAtIndexPath(this.collectionView,\na,{withTargetAttributes:b,layout:this});b.frame.origin.y+=this.collectionView.frame.size.height/3*b.speed;b.style={opacity:0,translateZ:0,rotateZ:\"15deg\"};return b},initialAttributesForAppearingCellAtIndexPath:function(a){var b=this.attributesForCellAtIndexPath(a);if(this.collectionView.delegate&&this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath)return this.collectionView.delegate.collectionViewInitialAttributesForAppearingCellAtIndexPath(this.collectionView,\na,{withTargetAttributes:b,layout:this});b.frame.origin.y+=this.collectionView.frame.size.height/3*b.speed;b.style={opacity:0,translateZ:0,rotateZ:\"15deg\"};return b},initialAttributesForMovingCellFromIndexPath:function(a,b){var c,d=this;this.collectionView.usingOldDataSet(function(){c=d.cachedAttributesForCellAtIndexPath(a,{usingCache:d.previousLayout})});return c},finalAttributesForDisappearingCellAtIndexPath:function(a){var b,c=this;this.collectionView.usingOldDataSet(function(){b=c.cachedAttributesForCellAtIndexPath(a,\n{usingCache:c.previousLayout});c.collectionView.delegate&&c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath?b=c.collectionView.delegate.collectionViewFinalAttributesForDisappearingCellAtIndexPath(c.collectionView,a,{withTargetAttributes:b}):(b.frame.origin.y+=c.collectionView.frame.size.height/3*b.speed,b.style={opacity:0,translateZ:0,rotateZ:\"15deg\"})});return b},copy:function(){var a=new BMCollectionViewMasonryLayout;a.minimumColumnWidth=this.minimumColumnWidth;\na.numberOfColumns=this.numberOfColumns;a.columnSpacing=this.columnSpacing;a.cellSpacing=this.cellSpacing;a.columnSpeeds=this.columnSpeeds&&this.columnSpeeds.slice();a.topPadding=this.topPadding;a.bottom=this.bottomPadding;return a}});var BMCollectionViewStackLayout=function(){};\nBMCollectionViewStackLayout.prototype=BMExtend({},BMCollectionViewLayout.prototype,{_showsSingleCellFullScreen:NO,get showsSingleCellFullScreen(){return this._showsSingleCellFullScreen},set showsSingleCellFullScreen(a){this._showsSingleCellFullScreen=a;this.invalidateLayout()},_showsSingleCell:NO,get showsSingleCell(){return this._showsSingleCell},set showsSingleCell(a){this._showsSingleCell=a;this.invalidateLayout()},_insets:BMInsetMake(88,88,88,88),get insets(){return this._insets.copy()},set insets(a){this._insets=\na.copy();this.invalidateLayout()},_spread:22,get spread(){return this._spread},set spread(a){this._spread=a;this.invalidateLayout()},_numberOfBackgroundCells:3,get numberOfBackgroundCells(){return this._numberOfBackgroundCells},set numberOfBackgroundCells(a){this._numberOfBackgroundCells=a;this.invalidateLayout()},_minimumScale:.9,get minimumScale(){return this._minimumScale},set minimumScale(a){this._minimumScale=a;this.invalidateLayout()},_blursBackgroundCells:NO,get blursBackgroundCells(){return this._blursBackgroundCells},\nset blursBackgroundCells(a){this._blursBackgroundCells=a;this.invalidateLayout()},_maximumBlur:15,get maximumBlur(){return this._maximumBlur},set maximumBlur(a){this._maximumBlur=a;this.invalidateLayout()},_rotatesCells:NO,get rotatesCells(){return this._rotatesCells},set rotatesCells(a){this._rotatesCells=a;this.invalidateLayout()},_rotation:-90,get rotation(){return this._rotation},set rotation(a){this._rotation=a;this.invalidateLayout()},_numberOfObjects:0,shouldInvalidateLayoutForFrameChange:function(){return YES},\nshouldInvalidateLayoutForBoundsChange:function(){return YES},collectionViewWillStartUpdates:function(){this.prepareLayout()},prepareLayout:function(){for(var a=0,b=this.collectionView.numberOfSections(),c=0;c<b;c++)a+=this.collectionView.numberOfObjectsInSectionAtIndex(c);this._numberOfObjects=a},contentSize:function(){return this._showsSingleCell?this.collectionView.frame.size.copy():BMSizeMake(this.collectionView.frame.size.width,this.collectionView.frame.size.height*this._numberOfObjects)},previousIndexPathWithIndexPath:function(a){if(a.row)return this.collectionView.indexPathForObjectAtRow(a.row-\n1,{inSectionAtIndex:a.section});for(a=a.section-1;0<=a;){var b=this.collectionView.numberOfObjectsInSectionAtIndex(a);if(b)return this.collectionView.indexPathForObjectAtRow(b-1,{inSectionAtIndex:a});a--}},nextIndexPathWithIndexPath:function(a){var b=this.collectionView.numberOfObjectsInSectionAtIndex(a.section);if(a.row<b-1)return this.collectionView.indexPathForObjectAtRow(a.row+1,{inSectionAtIndex:a.section});var c=this.collectionView.numberOfSections();for(a=a.section+1;a<c;){if(b=this.collectionView.numberOfObjectsInSectionAtIndex(a))return this.collectionView.indexPathForObjectAtRow(0,\n{inSectionAtIndex:a});a++}},attributesForElementsInRect:function(a){if(this._showsSingleCell){a=[];if(this.collectionView.numberOfSections()&&this.collectionView.numberOfObjectsInSectionAtIndex(0)){var b=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(this.collectionView.indexPathForObjectAtRow(0,{inSectionAtIndex:0}));b.frame=this.collectionView.frame.copy();b.frame.origin=BMPointMake();a.push(b)}return a}a=this.collectionView.scrollOffset;var c=this.collectionView.frame.size.height;b=a.y;\nvar d=a.y+c,e=this.collectionView.frame.size.width-this.insets.left-this.insets.right,f=c-this.insets.top-this.insets.bottom;a=[];for(var h=0,g,k=this.collectionView.numberOfSections(),l=0;l<k;l++){for(var m=this.collectionView.numberOfObjectsInSectionAtIndex(l),q=0;q<m;q++)if(h+=c,h>=b&&h<=d){g=this.collectionView.indexPathForObjectAtRow(q,{inSectionAtIndex:l});break}if(g)break}if(!g)return a;c=(c-h+b)/c;d=this._spread*c|0;k=(1-this._minimumScale)/(this._numberOfBackgroundCells+1);m=1/(this._numberOfBackgroundCells+\n1);q=this._maximumBlur/(this._numberOfBackgroundCells+1);l=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(g);l.frame=BMRectMakeWithX(this.insets.left,{y:b+this.insets.top-d,width:e,height:f});l.style.zIndex=2*this._numberOfBackgroundCells+4;l.style.scaleX=1-k*c;l.style.scaleY=1-k*c;l.style.opacity=1-m*c;this._blursBackgroundCells&&(l.style.blur=c*q+\"px\");this._rotatesCells&&(l.style.rotateX=(this.numberOfBackgroundCells-1)/1E4+\"deg\",l.style.transformOriginX=\"50%\",l.style.transformOriginY=\n\"100%\",l.style.translateZ=2*this._numberOfBackgroundCells+4+\"px\");a.push(l);var n=this.nextIndexPathWithIndexPath(g);if(n){let b=h-this.insets.bottom+this.insets.top/3,d=h+this.insets.top;l=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(n);l.frame=BMRectMakeWithX(this.insets.left,{y:BMNumberByInterpolatingNumbersWithFraction(b,d,c),width:e,height:f});l.style.zIndex=2*this._numberOfBackgroundCells+6;this._rotatesCells&&(l.style.rotateX=BMNumberByInterpolatingNumbersWithFraction(this._rotation,\n0,c)+\"deg\",l.style.transformOriginX=\"50%\",l.style.transformOriginY=\"100%\",l.style.translateZ=2*this._numberOfBackgroundCells+6+\"px\");a.push(l);if(l=this.nextIndexPathWithIndexPath(n))h=h+this.collectionView.frame.size.height-this.insets.bottom+this.insets.top/3,l=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(l),l.frame=BMRectMakeWithX(this.insets.left,{y:h,width:e,height:f}),l.style.zIndex=2*this._numberOfBackgroundCells+8,this._rotatesCells&&(l.style.rotateX=this._rotation+\"deg\",l.style.transformOriginX=\n\"50%\",l.style.transformOriginY=\"100%\",l.style.translateZ=2*this._numberOfBackgroundCells+8+\"px\"),a.push(l)}for(l=0;l<this._numberOfBackgroundCells;l++){g=this.previousIndexPathWithIndexPath(g);if(!g)break;h=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(g);h.frame=BMRectMakeWithX(this.insets.left,{y:b+this.insets.top-d-(l+1)*this._spread,width:e,height:f});h.style.zIndex=2*(this._numberOfBackgroundCells+1-l);h.style.scaleX=1-k*c-k*(l+1);h.style.scaleY=1-k*c-k*(l+1);h.style.opacity=1-m*c-m*\n(l+1);this._blursBackgroundCells&&(h.style.blur=(c+l+1)*q+\"px\");this._rotatesCells&&(h.style.rotateX=(this.numberOfBackgroundCells+l)/1E4+\"deg\",h.style.transformOriginX=\"50%\",h.style.transformOriginY=\"100%\",h.style.translateZ=2*(this._numberOfBackgroundCells+1-l)+\"px\");a.push(h)}return a},attributesForCellAtIndexPath:function(a){if(this._showsSingleCell){var b=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a);b.frame=this.collectionView.frame.copy();b.frame.origin=BMPointMake();if(0!=a.row||\n0!=a.section)b.isHidden=YES,b.style.opacity=0;return b}b=this.collectionView.scrollOffset;var c=this.collectionView.frame.size.height,d=b.y,e=b.y+c;b=this.collectionView.frame.size.width-this.insets.left-this.insets.right;for(var f=c-this.insets.top-this.insets.bottom,h=0,g,k=this.collectionView.numberOfSections(),l=0;l<k;l++){for(var m=this.collectionView.numberOfObjectsInSectionAtIndex(l),q=0;q<m;q++)if(h+=c,h>=d&&h<=e){g=this.collectionView.indexPathForObjectAtRow(q,{inSectionAtIndex:l});break}if(g)break}m=\n(c-h+d)/c;e=this._spread*m|0;k=(1-this._minimumScale)/(this._numberOfBackgroundCells+1);q=1/(this._numberOfBackgroundCells+1);var n=this._maximumBlur/(this._numberOfBackgroundCells+1);if(a.isEqualToIndexPath(g,{usingComparator:this.collectionView.identityComparator}))return a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a),a.frame=BMRectMakeWithX(this.insets.left,{y:d+this.insets.top-e,width:b,height:f}),a.style.zIndex=this._numberOfBackgroundCells+2,a.style.scaleX=1-k*m,a.style.scaleY=\n1-k*m,a.style.opacity=1-q*m,this._blursBackgroundCells&&(a.style.blur=m*n+\"px\"),a;if((l=this.nextIndexPathWithIndexPath(g))&&a.isEqualToIndexPath(l,{usingComparator:this.collectionView.identityComparator}))return a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(l),a.frame=BMRectMakeWithX(this.insets.left,{y:h+this.insets.top,width:b,height:f}),a.style.zIndex=this._numberOfBackgroundCells+3,a;if(a.section>l.section||a.section==l.section&&a.row>l.row){for(l=d=0;l<a.section;l++)m=this.collectionView.numberOfObjectsInSectionAtIndex(l),\nd+=c*m;d+=c*a.row;a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a);a.frame=BMRectMakeWithX(this.insets.left,{y:d,width:b,height:f});a.isVisible=NO;return a}for(l=0;l<this._numberOfBackgroundCells;l++){c=this.previousIndexPathWithIndexPath(g);if(!c)break;if(a.isEqualToIndexPath(c,{usingComparator:this.collectionView.identityComparator}))return a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(c),a.frame=BMRectMakeWithX(this.insets.left,{y:d+this.insets.top-e-(l+1)*this._spread,width:b,\nheight:f}),a.style.zIndex=this._numberOfBackgroundCells+1-l,a.style.scaleX=1-k*m-k*(l+1),a.style.scaleY=1-k*m-k*(l+1),a.style.opacity=1-q*m-q*(l+1),this._blursBackgroundCells&&(a.style.blur=(m+l+1)*n+\"px\"),a;g=c}a=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(a);a.frame=BMRectMakeWithX(this.insets.left,{y:d+this.insets.top-(this._numberOfBackgroundCells+1)*this._spread,width:b,height:f});a.style.zIndex=0;a.style.scaleX=this._minimumScale;a.style.scaleY=this._minimumScale;a.style.opacity=\n0;this._blursBackgroundCells&&(a.style.blur=this._maximumBlur+\"px\");return a},rectWithScrollingPositionOfCellAtIndexPath:function(a){for(var b=this.collectionView.frame.size.height,c=0,d=0;d<a.section;d++){var e=this.collectionView.numberOfObjectsInSectionAtIndex(d);c+=b*e}c+=b*a.row;return BMRectMakeWithX(0,{y:c,width:this.collectionView.frame.size.width,height:this.collectionView.frame.size.height})},snapsScrollPosition(){return YES},snappingScrollOffsetForScrollOffset(a,b){a=a.copy();a.y=(a.y/\nthis.collectionView.frame.size.height|0)*this.collectionView.frame.size.height+(b.withVerticalDirection==BMScrollingDirectionVertical.Bottom?this.collectionView.frame.size.height:0);a.y=Math.max(0,Math.min(this.collectionView.size.height-this.collectionView.frame.size.height,a.y));return a},copy(){var a=new BMCollectionViewStackLayout;a._showsSingleCellFullScreen=this._showsSingleCellFullScreen;a._showsSingleCell=this._showsSingleCell;a._insets=this._insets.copy();a._spread=this._spread;a._numberOfBackgroundCells=\nthis._numberOfBackgroundCells;a._minimumScale=this._minimumScale;a._blursBackgroundCells=this._blursBackgroundCells;a._maximumBlur=this._maximumBlur;return a}});var BMCollectionViewTileLayoutOrientation=Object.freeze({Horizontal:{},Vertical:{}}),BMCollectionViewTileLayout=function(){};\nBMCollectionViewTileLayout.prototype=BMExtend({},BMCollectionViewLayout.prototype,{_gridSize:0,get gridSize(){return this._gridSize},set gridSize(a){this._gridSize=a||0;this.invalidateLayout()},_spacing:0,get spacing(){return this._spacing},set spacing(a){this._spacing=a||0;this.invalidateLayout()},_showsHeaders:NO,get showsHeaders(){return this._showsHeaders},set showsHeaders(a){this._showsHeaders=a;this.invalidateLayout()},_headerHeight:22,get headerHeight(){return this._showsHeaders?this._headerHeight:\n0},set headerHeight(a){this._headerHeight=a;this._showsHeader&&this.invalidateLayout()},_showsFooters:NO,get showsFooters(){return this._showsFooters},set showsFooters(a){this._showsFooters=a;this.invalidateLayout()},_footerHeight:22,get footerHeight(){return this._showsFooters?this._footerHeight:0},set footerHeight(a){this._footerHeight=a;this._showsFooters&&this.invalidateLayout()},_sectionInsets:BMInsetMake(),get sectionInsets(){return this._sectionInsets},set sectionInsets(a){this._sectionInsets=\na||BMInsetMake();this.invalidateLayout()},_topPadding:0,get topPadding(){return this._topPadding},set topPadding(a){this._topPadding=a;this.invalidateLayout()},_bottomPadding:0,get bottomPadding(){return this._bottomPadding},set bottomPadding(a){this._bottomPadding=a;this.invalidateLayout()},_pinsHeadersToContentEdge:NO,get pinsHeadersToContentEdge(){return this._pinsHeadersToContentEdge},set pinsHeadersToContentEdge(a){this._pinsHeadersToContentEdge=a;this.invalidateLayout()},_pinsFootersToContentEdge:NO,\nget pinsFootersToContentEdge(){return this._pinsFootersToContentEdge},set pinsFootersToContentEdge(a){this._pinsFootersToContentEdge=a;this.invalidateLayout()},_orientation:BMCollectionViewTileLayoutOrientation.Vertical,get orientation(){return this._orientation},set orientation(a){this._orientation=a;this.invalidateLayout()},_isChangingBounds:NO,constrainedSizeWithSize:function(a){return BMSizeMake(Math.min(this.constrainedValueWithValue(a.width),this.collectionView.frame.size.width-this._sectionInsets.left-\nthis._sectionInsets.right),this.constrainedValueWithValue(a.height))},constrainedValueWithValue:function(a){if(1<this._gridSize){var b=this._gridSize,c=this._spacing,d=a/(b+c)|0;0==d&&(d=1);d=d*b+(d-1)*c;return a-d>d+b+c-a?d+b+c:d}return a},collectionViewWillStartUpdates:function(a){this.previousLayoutCache=this.layoutCache;this.prepareLayout()},collectionViewDidStartUpdates:function(a){this.previousLayoutCache=void 0},prepareLayout:function(){return this._prepareLayoutWithScrollbarOffset(NO)},_prepareLayoutWithScrollbarOffset:function(a){if(!this._isChangingBounds){a=\nthis.collectionView.frame.size.width-this._sectionInsets.left-this._sectionInsets.right;var b={},c=this.collectionView.numberOfSections();this.layoutCache=b;b.sections=Array(c);b.size=BMSizeMake(this.collectionView.frame.size.width,0);for(var d=this._topPadding,e=0;e<c;e++){var f={attributes:[]};b.sections[e]=f;d+=this._sectionInsets.top;f.outerFrame=BMRectMake(this._sectionInsets.left,d,a,0);if(this._showsHeaders){f.outerFrame.size.height+=this._headerHeight+this._spacing;d+=this._headerHeight+this._spacing;\nvar h=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])});h.frame=f.outerFrame.copy();h.frame.size.height=this._headerHeight;f.headerAttributes=h}f.frame=BMRectMake(this._sectionInsets.left,d,a,0);this._prepareLayoutForSection(e,{intoCache:f});f.outerFrame.size.height+=f.frame.size.height;d=f.outerFrame.bottom;this._showsFooters&&(h=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}),h.frame=f.outerFrame.copy(),h.frame.size.height=this._footerHeight,h.frame.origin.y=d+this._spacing,f.footerAttributes=h,f.outerFrame.size.height+=this._footerHeight+this._spacing);f.outerFrame.size.height+=this._sectionInsets.bottom;d=f.outerFrame.bottom}b.size.height=d+this._bottomPadding}},_prepareLayoutForSection:function(a,b){var c=this.collectionView.numberOfObjectsInSectionAtIndex(a);b=b.intoCache;for(var d=b.frame.origin.y,e=b.frame.origin.x,\nf=[BMRectMakeWithX(b.frame.origin.x,{y:b.frame.origin.y,width:b.frame.size.width,height:Number.MAX_SAFE_INTEGER})],h=0;h<c;h++){if(this.DEBUG)debugger;var g=this.collectionView.indexPathForObjectAtRow(h,{inSectionAtIndex:a}),k=this.collectionView.delegate.collectionViewSizeForCellAtIndexPath(this.collectionView,g);k=this.constrainedSizeWithSize(k);for(var l=void 0,m=0;m<f.length;m++){var q=f[m];if(!(q.size.width<k.width||q.size.height<k.height||l)){l=q;break}}m=BMRectMakeWithOrigin(BMPointMakeWithX(l.origin.x,\n{y:l.origin.y}),{size:k});g=BMCollectionViewLayoutAttributesMakeForCellAtIndexPath(g);g.frame=m;b.attributes.push(g);this.DEBUG&&(g=document.createElement(\"div\"),BMCopyProperties(g.style,{position:\"absolute\",boxSizing:\"border-box\",top:m.origin.y+\"px\",left:m.origin.x+\"px\",width:m.size.width+\"px\",height:m.size.height+\"px\",boxShadow:\"0px 0px 1px 1px blue\"}),(this.collectionView._contentWrapper&&this.collectionView._contentWrapper[0]||this.collectionView._container[0]).appendChild(g));d<m.bottom&&(d=\nm.bottom);e<m.right&&(e=m.right);if(this.DEBUG)debugger;g=m.rectWithInset(BMInset.insetWithEqualInsets(-this._spacing));for(m=0;m<f.length;m++)if(q=f[m],q.isEqualToRect(g)||g.containsRect(q))f.splice(m,1),q.div&&q.div.remove(),m--;else if(g.intersectsContentOfRect(q)){k=this.rectsWithDifferenceOfExtent(q,{fromRect:g,spacing:this._spacing});f.splice(m,1);q.div&&q.div.remove();l=0;var n=k[0];if(n)for(q=m;q<f.length;q++){m=f[q];if(m.isEqualToRect(n)&&(l++,n.isInvalid=YES,n=k[l],!n))break;if(m.origin.y>\nn.origin.y&&(f.splice(q,0,n),q++,l++,n=k[l],!n))break;if(m.origin.y==n.origin.y&&m.origin.x>n.origin.x&&(f.splice(q,0,n),q++,l++,n=k[l],!n))break}if(n)for(;l<k.length;l++)f.push(k[l]);m=-1;if(this.DEBUG)for(q=0;q<k.length;q++)l=document.createElement(\"div\"),n=k[q],n.isInvalid||(BMCopyProperties(l.style,{position:\"absolute\",boxSizing:\"border-box\",top:n.origin.y+\"px\",left:n.origin.x+\"px\",width:n.size.width+\"px\",height:n.size.height+\"px\",boxShadow:\"0px 0px 1px 1px red\"}),n.div=l,(this.collectionView._contentWrapper&&\nthis.collectionView._contentWrapper[0]||this.collectionView._container[0]).appendChild(l))}}d+=this._spacing+this._sectionInsets.bottom;var u=(b.frame.right-e)/2|0;u&&(b.attributes=b.attributes.map(function(a){a.frame.origin.x+=u;return a}));b.frame.size.width=e-b.frame.origin.x;b.frame.size.height=d-b.frame.origin.y},attributesForElementsInRect:function(a){if(0==this.collectionView.numberOfSections())return a=BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,\n{atIndexPath:BMIndexPathMakeWithIndexes([0])}),a.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height),[a];for(var b=this.layoutCache.sections.length,c=[],d=NO,e,f,h,g,k=0;k<b;k++){var l=this.layoutCache.sections[k];if(a.intersectsRect(l.outerFrame)){e=l;var m;l.headerAttributes&&a.intersectsRect(l.headerAttributes.frame)&&(c.push(m=l.headerAttributes.copy()),h&&m.frame.intersectsRect(h.frame)&&(this.orientation==BMCollectionViewTileLayoutOrientation.Horizontal&&\n(h.frame.origin.x=m.frame.origin.x-h.frame.size.width),this.orientation==BMCollectionViewTileLayoutOrientation.Vertical&&(h.frame.origin.y=m.frame.origin.y-h.frame.size.height)));d||(d=YES,this.pinsHeadersToContentEdge&&l.headerAttributes&&(m||c.push(m=l.headerAttributes.copy()),h=m,h.style.zIndex=1,m.frame.origin.y=Math.max(this.collectionView.scrollOffset.y,m.frame.origin.y),m.frame.origin.x=Math.max(this.collectionView.scrollOffset.x,m.frame.origin.x)));f=l.attributes.length;for(var q=0;q<f;q++)a.intersectsRect(l.attributes[q].frame)&&\nc.push(l.attributes[q]);l.footerAttributes&&a.intersectsRect(l.footerAttributes.frame)?(c.push(f=l.footerAttributes.copy()),g=f):f=void 0}else if(d)break}e&&this.pinsFootersToContentEdge&&e.footerAttributes&&(f||c.push(f=e.footerAttributes.copy()),f.style.zIndex=1,f.frame.origin.y=Math.min(this.collectionView.scrollOffset.y+this.collectionView.frame.size.height-f.frame.size.height,f.frame.origin.y),f.frame.origin.x=Math.min(this.collectionView.scrollOffset.x+this.collectionView.frame.size.width-f.frame.size.width,\nf.frame.origin.x),g&&f.frame.intersectsRect(g.frame)&&(this.orientation==BMCollectionViewTileLayoutOrientation.Horizontal&&(f.frame.origin.x=g.frame.origin.x-f.frame.size.width),this.orientation==BMCollectionViewTileLayoutOrientation.Vertical&&(f.frame.origin.y=g.frame.origin.y-f.frame.size.height)));return c},shouldInvalidateLayoutForBoundsChange:function(){var a=this._pinsHeadersToContentEdge||this._pinsFootersToContentEdge;a&&(this._isChangingBounds=YES);return a},didInvalidateLayoutForBoundsChange:function(){this._isChangingBounds=\nNO},attributesForCellAtIndexPath:function(a){return this.cachedAttributesForCellAtIndexPath(a,{withCache:this.layoutCache})},cachedAttributesForCellAtIndexPath:function(a,b){return b.withCache.sections[a.section].attributes[a.row]},initialAttributesForMovingCellFromIndexPath:function(a){return this.cachedAttributesForCellAtIndexPath(a,{withCache:this.previousLayoutCache})},attributesForSupplementaryViewWithIdentifier:function(a,b){if(a===BMCollectionViewTableLayoutSupplementaryView.Empty)return a=\nBMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}),a.frame=BMRectMake(0,0,this.collectionView.frame.size.width,this.collectionView.frame.size.height),a;b=b.atIndexPath;if(a==BMCollectionViewFlowLayoutSupplementaryView.Footer)return this.layoutCache.sections[b.section].footerAttributes;if(a==BMCollectionViewFlowLayoutSupplementaryView.Header)return this.layoutCache.sections[b.section].headerAttributes},\ncontentSize:function(){let a=this.layoutCache.size;a.height=Math.max(a.height,this.collectionView.frame.size.height);return a},initialAttributesForPresentedCellAtIndexPath:function(a,b){a=b.withTargetAttributes.copy();b=a.frame;var c=this.collectionView.bounds.center.slopeAngleToPoint(b.center),d=this.collectionView.bounds.center.distanceToPoint(b.center);b.offset(4*d*Math.cos(c),4*d*Math.sin(c));a.style.scaleX=2;a.style.scaleY=2;a.style.opacity=0;return a},supplementaryViewsToInsert:function(){var a=\nthis.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=c.collectionView.numberOfSections()});for(var d=[],e=b;e<a;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0<b&&0==a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},supplementaryViewsToDelete:function(){var a=this.collectionView.numberOfSections(),b,c=this;this.collectionView.usingOldDataSet(function(){b=c.collectionView.numberOfSections()});for(var d=[],e=a;e<b;e++)this.showsHeaders&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Header,\n{atIndexPath:BMIndexPathMakeWithIndexes([e])})),this.showsFooters&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewFlowLayoutSupplementaryView.Footer,{atIndexPath:BMIndexPathMakeWithIndexes([e])}));0==b&&0<a&&d.push(BMCollectionViewLayoutAttributesMakeForSupplementaryViewWithIdentifier(BMCollectionViewTableLayoutSupplementaryView.Empty,{atIndexPath:BMIndexPathMakeWithIndexes([0])}));return d},rightExtentByTrimmingLeftSideOfExtent:function(a,b){b=b.withIntersectingRect;\nreturn BMRectMakeWithX(b.right,{y:a.origin.y,width:a.right-b.right,height:a.height})},leftExtentByTrimmingRightSideOfExtent:function(a,b){return BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:b.withIntersectingRect.origin.x-a.origin.x,height:a.height})},topExtentByTrimmingBottomSideOfExtent:function(a,b){return BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:a.size.width,height:b.withIntersectingRect.origin.y-a.origin.y})},bottomExtentByTrimmingTopSideOfExtent:function(a,b){b=b.withIntersectingRect;\nreturn BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.size.width,height:a.bottom-b.bottom})},rectsWithDifferenceOfExtent:function(a,b){var c=this._gridSize;b=b.fromRect;if(b.bottom>=a.origin.y&&b.top<=a.origin.y){var d=[],e=this.leftExtentByTrimmingRightSideOfExtent(a,{withIntersectingRect:b});e.width>=c&&d.push(e);var f=this.rightExtentByTrimmingLeftSideOfExtent(a,{withIntersectingRect:b});f.width>=c&&d.push(f);f=this.bottomExtentByTrimmingTopSideOfExtent(a,{withIntersectingRect:b});f.height>=c&&\nd.push(f);return d}if(b.right>=a.origin.x&&b.origin.x<=a.origin.x)return d=[],f=this.topExtentByTrimmingBottomSideOfExtent(a,{withIntersectingRect:b}),f.height>=c&&d.push(f),f=this.rightExtentByTrimmingLeftSideOfExtent(a,{withIntersectingRect:b}),f.width>=c&&d.push(f),f=this.bottomExtentByTrimmingTopSideOfExtent(a,{withIntersectingRect:b}),f.height>=c&&d.push(f),d;if(b.origin.x<=a.right&&b.right>=a.right)return d=[],f=this.topExtentByTrimmingBottomSideOfExtent(a,{withIntersectingRect:b}),f.height>=\nc&&d.push(f),e=this.leftExtentByTrimmingRightSideOfExtent(a,{withIntersectingRect:b}),e.width>=c&&d.push(e),f=this.bottomExtentByTrimmingTopSideOfExtent(a,{withIntersectingRect:b}),f.height>=c&&d.push(f),d;if(b.origin.y<=a.bottom&&b.bottom>=a.bottom)return d=[],e=this.leftExtentByTrimmingRightSideOfExtent(a,{withIntersectingRect:b}),e.width>=c&&d.push(e),this.topExtentByTrimmingBottomSideOfExtent(a,{withIntersectingRect:b}),f.height>=c&&d.push(f),f=this.rightExtentByTrimmingLeftSideOfExtent(a,{withIntersectingRect:b}),\nf.width>=c&&d.push(f),d;debugger;if(b.intersectsPoint(a.origin))return d=[],f=BMRectMakeWithX(b.right,{y:a.origin.y,width:a.right-b.right,height:a.height}),f.width>=c&&d.push(f),f=BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.width,height:a.bottom-b.bottom}),f.height>=c&&d.push(f),d;if(b.intersectsPoint({x:a.right,y:a.origin.y}))return d=[],e=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:b.origin.x-a.origin.x,height:a.height}),e.width>=c&&d.push(e),f=BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.width,\nheight:a.bottom-b.bottom}),f.height>=c&&d.push(f),d;if(b.intersectsPoint({x:a.left,y:a.bottom}))return d=[],f=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:a.size.width,height:b.origin.y-a.origin.y}),f.height>=c&&d.push(f),f=BMRectMakeWithX(b.right,{y:a.origin.y,width:a.right-b.right,height:a.height}),f.width>=c&&d.push(f),d;if(b.intersectsPoint({x:a.right,y:a.bottom}))return d=[],f=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:a.size.width,height:b.origin.y-a.origin.y}),f.height>=c&&d.push(f),\ne=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:b.origin.x-a.origin.x,height:a.height}),e.width>=c&&d.push(e),d;if(b.bottom>=a.origin.y&&b.top<=a.origin.y)return d=[],e=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:b.origin.x-a.origin.x,height:a.height}),e.width>=c&&d.push(e),f=BMRectMakeWithX(b.right,{y:a.origin.y,width:a.right-b.right,height:a.height}),f.width>=c&&d.push(f),f=BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.width,height:a.bottom-b.bottom}),f.height>=c&&d.push(f),d;if(b.right>=a.origin.x&&\nb.origin.x<=a.origin.x)return d=[],f=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:a.size.width,height:b.origin.y-a.origin.y}),f.height>=c&&d.push(f),f=BMRectMakeWithX(b.right,{y:a.origin.y,width:a.right-b.right,height:a.height}),f.width>=c&&d.push(f),f=BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.width,height:a.bottom-b.bottom}),f.height>=c&&d.push(f),d;if(b.origin.x<=a.right&&b.right>=a.right)return d=[],f=BMRectMakeWithX(a.origin.x,{y:a.origin.y,width:a.size.width,height:b.origin.y-a.origin.y}),\nf.height>=c&&d.push(f),e=BMRectMakeWithX(a.right,{y:a.origin.y,width:b.right-a.right,height:a.height}),e.width>=c&&d.push(e),f=BMRectMakeWithX(a.origin.x,{y:b.bottom,width:a.width,height:a.bottom-b.bottom}),f.height>=c&&d.push(f),d;debugger}});\nvar BMCollectionViewTransferPolicy=Object.freeze({Move:\"Move\",Copy:\"Copy\"}),BMCollectionViewAcceptPolicy=Object.freeze({Move:\"Move\",Copy:\"Copy\"}),_BMCoreUIIsDragging=NO,_BMCollectionViewAnimationDurationDefault=500,_BMCollectionViewAnimationEasingDefault=\"easeInOutQuart\",_BMCollectionViewAnimationStrideDefault=50,_BMCollectionViewDoubleClickDelay=250,_BMCollectionViewLongClickDelay=400,_BMCollectionViewClickSlopeThreshold=10,_BMCollectionViewSnappingScrollThreshold=200,_BMCollectionViewIdentityComparator=\nfunction(a,b){return a==b},BMCollectionViewScrollingDirection=Object.freeze({Vertical:{},Horizontal:{},Both:{}}),BMCollectionViewScrollingGravityHorizontal=Object.freeze({Left:{},Center:{},Right:{}}),BMCollectionViewScrollingGravityVertical=Object.freeze({Top:{},Center:{},Bottom:{}}),_BMCollectionViews=new Map;function BMCollectionView(){}\nBMCollectionView.prototype={delegate:void 0,_dataSet:void 0,get dataSet(){return this._dataSet},set dataSet(a){var b=this._dataSet;this._dataSet=a;this.dataSetDidChangeFromDataSet(b)},_container:void 0,get container(){return this._container},identityComparator:_BMCollectionViewIdentityComparator,indexPathForObjectAtRow:function(a,b){return this._dataSet?this._dataSet.indexPathForObjectAtRow(a,{inSectionAtIndex:b.inSectionAtIndex}):void 0},indexPathForObject:function(a){return this._dataSet?this._dataSet.indexPathForObject(a):\nvoid 0},numberOfSections:function(){return this._dataSet?this._dataSet.numberOfSections():0},numberOfObjectsInSectionAtIndex:function(a){return this._dataSet?this._dataSet.numberOfObjectsInSectionAtIndex(a):0},_layout:void 0,get layout(){return this._layout},set layout(a){if(this.isUpdatingData){var b=this;this.registerDataCompletionCallback(function(){b.layout=a})}else this._layout=a||new BMCollectionViewFlowLayout,this._layout.collectionView=this,this.initialized&&this.invalidateLayout()},_frame:void 0,\nget frame(){return this._frame},_size:void 0,get size(){return this._size},_contentWrapper:void 0,get contentWrapper(){return this._contentWrapper},_bounds:void 0,get bounds(){return this._bounds},_offscreenBufferSize:100,offscreenBufferFactor:.5,_scrollingDirection:BMCollectionViewScrollingDirection.Vertical,get scrollingDirection(){return this._scrollingDirection},cellCache:{},supplementaryViewCache:{},attributeCache:{},retainedCells:[],allCells:[],initialized:NO,_collectionEnabled:YES,get scrollOffset(){var a=\nthis._bounds.origin.copy();a.x+=this._offscreenBufferSize;a.y+=this._offscreenBufferSize;return a},set scrollOffset(a){this._scrollToOffset(a)},get scrollBarSize(){return this.iScroll?0:BMScrollBarGetSize()},_autoResizeToken:void 0,get autoResizes(){return void 0!==this._autoResizeToken},set autoResizes(a){if(this.autoResizes!=a)if(a){var b=this;this._autoResizeToken=function(a){b.resized()};window.addEventListener(\"resize\",this._autoResizeToken)}else window.removeEventListener(\"resize\",this._autoResizeToken),\nthis._autoResizeToken=void 0},_cellClass:BMCollectionViewCell,get cellClass(){return this._cellClass},set cellClass(a){this._cellClass=a||BMCollectionViewCell},_cellClasses:void 0,registerCellClass(a,b){this._cellClasses[b.forReuseIdentifier]=a},_supplementaryViewClasses:void 0,registerSupplementaryViewClass(a,b){this._supplementaryViewClasses[b.forReuseIdentifier]=a},_init:function(){var a=window.navigator.standalone&&void 0===this.customScrollRequired||this.customScrollRequired;a&&(this.iScroll=\nYES,this.offscreenBufferFactor=0);this._prepareFrame();this._createBounds();this._reloadLayout();if(a){this._container.css({\"overflow-x\":\"hidden\",\"overflow-y\":\"hidden\"});this.customScroll=YES;BMAddSmoothMousewheelInteractionToNode(this._container[0]);this.iScroll=new IScroll(this._container[0],{mouseWheel:YES,scrollbars:YES,probeType:3,click:NO,deceleration:.001,resizePolling:999999999999,scrollX:YES,freeScroll:YES,interactiveScrollbars:!BMIsTouchDevice,disableMouse:YES,disablePointer:YES,fadeScrollbars:BMIsTouchDevice,\nHWCompositing:YES,bindToWrapper:YES,stopPropagation:YES});var b=this;this.iScroll.on(\"scroll\",function(){b._handleNewScrollFromEvent({x:-this.x,y:-this.y})})}else this._boundContainerDidScrollWithEvent=this.containerDidScrollWithEvent.bind(this),this.container[0].addEventListener(\"scroll\",this._boundContainerDidScrollWithEvent,{capture:this._highFrequencyScrollingEnabled,passive:YES});let c=NO;this._container[0].addEventListener(\"wheel\",(a)=>{(this._size.width>this._frame.size.width||this._size.height>\nthis._frame.size.height)&&a.stopPropagation()});let d,e,f=NO;this._container[0].addEventListener(\"touchstart\",(a)=>{!d&&(c=this._size.width>this._frame.size.width||this._size.height>this._frame.size.height)&&(d=a.changedTouches[0].identifier,e=BMPointMake(a.changedTouches[0].clientX,a.changedTouches[0].clientY))});this._container[0].addEventListener(\"touchmove\",(a)=>{if(d){var b=a.changedTouches.length;for(let c=0;c<b;c++){let d=a.changedTouches[c];if(d.identifier==d){f?a.stopPropagation():(b=d,BMPointMake(b.clientX,\nb.clientY).distanceToPoint(e)>_BMCollectionViewClickSlopeThreshold&&(f=YES,a.stopPropagation()));break}}}});a=(a)=>{if(d){var b=a.changedTouches.length;for(let c=0;c<b;c++){let b=a.changedTouches[c];if(b.identifier==b){f&&a.stopPropagation();f=NO;e=void 0;break}}}};this._container[0].addEventListener(\"touchcancel\",a);this._container[0].addEventListener(\"touchend\",a);a=NO;this.delegate&&\"function\"==typeof this.delegate.collectionViewShouldRunIntroAnimation&&(a=this.delegate.collectionViewShouldRunIntroAnimation(this));\nif(a){a=this._bounds.rectWithInset(BMInset.insetWithEqualInsets(this._offscreenBufferSize));var h=this.retainedCells.slice();b=this;for(var g=0;g<h.length;g++){var k=h[g];a.intersectsRect(k.attributes.frame)||(h.splice(g,1),g--);var l;k.attributes.itemType==BMCollectionViewLayoutAttributesType.Cell?l=this.layout.initialAttributesForPresentedCellAtIndexPath(k.indexPath,{withTargetAttributes:k.attributes}):k.attributes.itemType==BMCollectionViewLayoutAttributesType.SupplementaryView&&(l=this.layout.initialAttributesForPresentedSupplementaryViewWithIdentifier(k.reuseIdentifier,\n{atIndexPath:k.indexPath,withTargetAttributes:k.attributes}));l.targetAttributes=k.attributes;k.attributes=l}l={};this.delegate&&this.delegate.collectionViewAnimationOptionsForIntroAnimation&&(l=this.delegate.collectionViewAnimationOptionsForIntroAnimation(this));BMAnimateWithBlock(function(){for(var a=0;a<h.length;a++){var b=h[a];b.attributes=b.attributes.targetAttributes}},BMExtend({duration:_BMCollectionViewAnimationDurationDefault,easing:_BMCollectionViewAnimationEasingDefault,stride:_BMCollectionViewAnimationStrideDefault,\ndelay:0},l))}this.initialized=YES},invalidateLayout:function(){if(this.initialized)if(this.isUpdatingData){var a=this;this.registerDataCompletionCallback(function(){a.invalidateLayout()})}else this.attributeCache={},this.retainedCells=[],this._reloadLayout()},invalidateLayoutWithContext:function(a,b){this.invalidateLayout()},resized:function(){if(this.initialized&&(this._frame.size.height!=this._container.height()||this._frame.size.width!=this._container.width()))if(this.isUpdatingData){var a=this;\nthis.registerDataCompletionCallback(function(){a.resized()})}else this._prepareFrame(),this._bounds.size.width=this._frame.size.width+2*this._offscreenBufferSize,this._bounds.size.height=this._frame.size.height+2*this._offscreenBufferSize,this._constrainBounds(),this._layout.shouldInvalidateLayoutForFrameChange(this._frame)&&this.invalidateLayout()},_prepareFrame:function(){var a=this._container.offset();this._frame=BMRectMake(a.left,a.top,this._container.width(),this._container.height());this._offscreenBufferSize=\nthis.customScroll?0:Math.max(this._frame.size.width*this.offscreenBufferFactor,this._frame.size.height*this.offscreenBufferFactor);this.scrollView&&(this.scrollView.frame=this._frame)},_createBounds:function(){this._bounds=this._frame.copy();this._bounds.size.width+=2*this._offscreenBufferSize;this._bounds.size.height+=2*this._offscreenBufferSize;this._bounds.origin.x=-this._offscreenBufferSize;this._bounds.origin.y=-this._offscreenBufferSize},_constrainBounds:function(){var a=this._bounds;a.right>\nthis._size.width+this._offscreenBufferSize&&(a.origin.x=this._size.width-this._frame.size.width-this._offscreenBufferSize,a.origin.x=Math.max(a.origin.x,-this._offscreenBufferSize));a.origin.x<-this._offscreenBufferSize&&(a.origin.x=-this._offscreenBufferSize);a.bottom>this._size.height+this._offscreenBufferSize&&(a.origin.y=this._size.height-this._frame.size.height-this._offscreenBufferSize,a.origin.y=Math.max(a.origin.y,-this._offscreenBufferSize));a.origin.y<-this._offscreenBufferSize&&(a.origin.y=\n-this._offscreenBufferSize)},invalidateLayoutForBoundsChange:function(){if(this.initialized){this.attributeCache={};this._layout.prepareLayout();var a=this._layout.contentSize();a.isEqualToSize(this._size)||(this._size=a,this._contentWrapper.css({width:this._size.width+\"px\",height:this._size.height+\"px\"}),this._constrainBounds(),this._applyOverflows());a=this._requestAttributesInRect(this._bounds.copy());this._renderCellsWithAttributes(a,{exclusive:YES})}},_reloadLayout:function(){this._layout.prepareLayout();\nthis._size=this._layout.contentSize();this.scrollView&&(this.scrollView.size=this._size);this._contentWrapper?this._contentWrapper.css({width:this._size.width+\"px\",height:this._size.height+\"px\"}):(this._contentWrapper=$('<div style=\"width: '+this._size.width+\"px; height: \"+this._size.height+'px; overflow: hidden; position: absolute; left: 0px; top: 0px;\"></div>'),this._container.append(this._contentWrapper));this._constrainBounds();this._applyOverflows();var a=this._requestAttributesInRect(this._bounds.copy());\nthis._renderCellsWithAttributes(a,{exclusive:YES})},_applyOverflows:function(){this.customScroll?this.iScroll?this.iScroll.refresh():(this.scrollView.canScrollHorizontally=this._size.width>this._frame.size.width,this.scrollView.canScrollVertically=this._size.height>this._frame.size.height,this.initialized||this._container.css({\"overflow-x\":\"hidden\",\"overflow-y\":\"hidden\"})):(this._size.width<=this._frame.size.width?this._container.css(\"overflow-x\",\"hidden\"):this._container.css(\"overflow-x\",\"scroll\"),\nthis._size.height<=this._frame.size.height?this._container.css(\"overflow-y\",\"hidden\"):this._container.css(\"overflow-y\",\"scroll\"))},_alignedRequestRectWithRect:function(a){return this._alignedRequestRectWithPoint(a.origin)},_alignedRequestOriginWithPoint:function(a){return BMPointMake(((a.x+this._offscreenBufferSize)/this._bounds.size.width|0)*this._bounds.size.width-this._offscreenBufferSize,((a.y+this._offscreenBufferSize)/this._bounds.size.height|0)*this._bounds.size.height-this._offscreenBufferSize)},\n_alignedRequestRectWithPoint:function(a){if(!(a.x<-this._offscreenBufferSize||a.y<-this._offscreenBufferSize||a.x>this._size.width||a.y>this._size.height))return new BMRect(this._alignedRequestOriginWithPoint(a),this._bounds.size)},_requestAttributesInRect:function(a){var b=this._layout.attributesForElementsInRect(a);this.attributeCache[a.origin.integerStringValue]={key:a,value:b};return b},_highFrequencyScrollingEnabled:NO,get highFrequencyScrollingEnabled(){return this._highFrequencyScrollingEnabled},\nset highFrequencyScrollingEnabled(a){var b=this._highFrequencyScrollingEnabled;this._highFrequencyScrollingEnabled=a;this.initialized&&!this.iScroll&&(this.container[0].removeEventListener(\"scroll\",this._boundContainerDidScrollWithEvent,{capture:b,passive:YES}),this.container[0].addEventListener(\"scroll\",this._boundContainerDidScrollWithEvent,{capture:a,passive:YES}))},containerDidScrollWithEvent:function(a){if(this._collectionEnabled){if(this._highFrequencyScrollingEnabled)return this._handleNewScrollFromEvent(a);\nthis.didRequestScrollAnimationFrame||(this.didRequestScrollAnimationFrame=YES,window.requestAnimationFrame(this._handleNewScrollFromEvent.bind(this,a)))}},_handleNewScrollFromEvent:function(a){this.didRequestScrollAnimationFrame=NO;if(this._collectionEnabled){var b=this._container[0],c=!this._isPerformingAnimatedScrolling&&this._layout.snapsScrollPosition;var d=this._bounds.origin.copy();this.customScroll?(this._bounds.origin.x=a.x-this._offscreenBufferSize,this._bounds.origin.y=a.y-this._offscreenBufferSize):\n(this._bounds.origin.x=Math.max(-this._offscreenBufferSize,b.scrollLeft-this._offscreenBufferSize),this._bounds.origin.y=Math.max(-this._offscreenBufferSize,b.scrollTop-this._offscreenBufferSize));if(d.x!=this._bounds.origin.x||d.y!=this._bounds.origin.y)if(this._layout.shouldInvalidateLayoutForBoundsChange(this._bounds))this.invalidateLayoutForBoundsChange(),this.delegate&&\"function\"==typeof this.delegate.collectionViewBoundsDidChange&&this.delegate.collectionViewBoundsDidChange(this,this._bounds),\nthis._layout.didInvalidateLayoutForBoundsChange(),c&&this._prepareForSnappingScrollOffsetWithPreviousOffset(d);else{for(var e=0;e<this.retainedCells.length;e++)a=this.retainedCells[e],a.attributes.frame.intersectsRect(this._bounds)||(a._unmanage(),e--);a=[];e=this._alignedRequestOriginWithPoint(this._bounds.origin);(b=this.attributeCache[e.integerStringValue])&&a.push(b);if(!e.isEqualToPoint(this._bounds.origin))if(e.x==this._bounds.origin.x){b=e;b.y+=this._bounds.size.height;var f=this.attributeCache[b.integerStringValue];\nf&&a.push(f)}else e.y==this._bounds.origin.y?(e.x+=this._bounds.size.width,(e=this.attributeCache[e.integerStringValue])&&a.push(e)):(b=e.copy(),b.y+=this._bounds.size.height,(f=this.attributeCache[b.integerStringValue])&&a.push(f),e.x+=this._bounds.size.width,(e=this.attributeCache[e.integerStringValue])&&a.push(e),b.x+=this._bounds.size.width,(b=this.attributeCache[b.integerStringValue])&&a.push(b));f=a.length;b=[this._bounds];for(var h=0;h<f;h++){var g=a[h].value,k=a[h].key;this._renderCellsWithAttributes(g);\ng=[];for(e=0;e<b.length;e++){var l=b[e].rectsWithDifferenceFromRect(k);l&&(g=g.concat(l))}b=g}if(f){if(b)for(e=0;e<b.length;e++)if(a=this._alignedRequestRectWithRect(b[e]))g=this._requestAttributesInRect(a),this._renderCellsWithAttributes(g);this.delegate&&\"function\"==typeof this.delegate.collectionViewBoundsDidChange&&this.delegate.collectionViewBoundsDidChange(this,this._bounds);this._isPerformingAnimatedScrolling||c&&this._prepareForSnappingScrollOffsetWithPreviousOffset(d)}else{b=[];a=this._alignedRequestRectWithPoint(this._bounds.origin);\nif(a.isEqualToRect(this._bounds))g=this._requestAttributesInRect(a),this._renderCellsWithAttributes(g);else if(a.origin.x==this._bounds.origin.x)e=this._alignedRequestRectWithPoint({x:a.origin.x,y:a.bottom+1}),g=this._requestAttributesInRect(a),this._renderCellsWithAttributes(g),e&&(g=this._requestAttributesInRect(e),this._renderCellsWithAttributes(g));else if(a.origin.y==this._bounds.origin.y)e=this._alignedRequestRectWithPoint({x:a.right+1,y:a.origin.y}),g=this._requestAttributesInRect(a),this._renderCellsWithAttributes(g),\ne&&(g=this._requestAttributesInRect(e),this._renderCellsWithAttributes(g));else for(b.push(a),(e=this._alignedRequestRectWithPoint({x:a.origin.x,y:a.bottom+1}))&&b.push(e),(e=this._alignedRequestRectWithPoint({x:a.right+1,y:a.origin.y}))&&b.push(e),(a=this._alignedRequestRectWithPoint({x:a.right+1,y:a.bottom+1}))&&b.push(a),e=0;e<b.length;e++)g=this._requestAttributesInRect(b[e]),this._renderCellsWithAttributes(g);this.delegate&&\"function\"==typeof this.delegate.collectionViewBoundsDidChange&&this.delegate.collectionViewBoundsDidChange(this,\nthis._bounds);c&&this._prepareForSnappingScrollOffsetWithPreviousOffset(d)}}}},_snappingScrollToken:void 0,_prepareForSnappingScrollOffsetWithPreviousOffset:function(a){this._snappingScrollToken&&window.clearTimeout(this._snappingScrollToken);var b=this;this._snappingScrollToken=window.setTimeout(function(){var c=b.layout.snappingScrollOffsetForScrollOffset(b.scrollOffset,{withVerticalDirection:Math.max(-1,Math.min(1,a.y-b._bounds.origin.y)),horizontalDirection:Math.max(-1,Math.min(1,a.x-b._bounds.origin.x))});\nBMAnimateWithBlock((a)=>{b.scrollOffset=c},{duration:200})},_BMCollectionViewSnappingScrollThreshold)},_renderCellsWithAttributes:function(a,b){var c=a.length;b=b||{};var d=b.exclusive||NO;for(b=0;b<c;b++){var e=a[b],f;e.frame.intersectsRect(this._bounds)&&((f=this.cellAtIndexPath(e.indexPath,{ofType:e.itemType,withIdentifier:e.identifier}))?(f.isManaged?f.attributes!==e&&(e.isHidden?(f._unmanage(),f.isRetained&&(f.attributes=a)):f.attributes=e):(e.isHidden||f._manage(),f.attributes=e),d&&(f._exclusivelyRendered=\nYES)):e.isHidden||(e.itemType===BMCollectionViewLayoutAttributesType.Cell?(f=this.indexPathForObjectAtRow(e.indexPath.row,{inSectionAtIndex:e.indexPath.section}),e.indexPath=f,f=this._dataSet.cellForItemAtIndexPath(f)):e.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&(f=this._dataSet.cellForSupplementaryViewWithIdentifier(e.identifier,{atIndexPath:e.indexPath})),f.attributes=e,f._manage(),d&&(f._exclusivelyRendered=YES)))}if(d)for(c=this.allCells.length,b=0;b<c;b++)f=this.allCells[b],\nf._exclusivelyRendered?f._exclusivelyRendered=void 0:(f.isManaged&&f._unmanage(),0<f.retainCount?f.itemType===BMCollectionViewLayoutAttributesType.Cell?(a=this._layout.attributesForCellAtIndexPath(f.indexPath),f.attributes=a):f.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&(a=this._layout.attributesForSupplementaryViewWithIdentifier(f.reuseIdentifier,{atIndexPath:f.indexPath}),f.attributes=a):(b--,c--))},refreshCellAtIndexPath:function(a,b){b=b&&b.animated;var c=this.cellAtIndexPath(a,\n{ofType:BMCollectionViewLayoutAttributesType.Cell});if(c){var d=c.attributes.copy();c._attributes=c.attributes.copy();c._attributes.indexPath=BMIndexPathNone;c._attributes._cell=c;if(b){h=this.dataSet.cellForItemAtIndexPath(a);var e=d.style.opacity;void 0===e&&(e=1);d.style.opacity=0;var f=c.attributes.style.opacity;void 0===f&&(f=1);h.attributes=d;d.isHidden||h._manage();c.retain();h.retain();c._unmanage();BMAnimateWithBlock(function(){h.attributes.style.opacity=e;c.attributes.style.opacity=0;h.attributes.style=\nh.attributes.style;c.attributes.style=c.attributes.style},{duration:100,easing:\"easeInOutQuad\",queue:NO,complete:function(){h.release();c.releaseRecycledCell();c.attributes.style.opacity=f}});return h}c.recycle();if(!d.isHidden){var h=this.dataSet.cellForItemAtIndexPath(a);h.attributes=d;h._manage();return h}}},dequeueCellForReuseIdentifier:function(a){var b=this.cellCache[a];if(b&&b.length){var c=b.pop();c.element[0].style.opacity=c._backingOpacity;return c}b=this._cellClasses[a]||this._cellClass;\nvar d=document.createElement(\"div\");d.style=\"position: absolute; left: 0px; top: 0px; visibility: hidden; overflow: visible;\";c=Object.create(b.prototype).initWithCollectionView(this,{reuseIdentifier:a,node:d});b==BMCollectionViewCell&&c.element.append(this._dataSet.contentsForCellWithReuseIdentifier(a));this._contentWrapper.append(c.element);var e=this,f=0,h=NO,g=BMPointMake(),k,l,m=NO,q=NO,n,u=a=NO;c.mousedownHandler=function(a){if(!_BMCoreUIIsDragging&&(a.originalEvent=a,a.which=a.which||a.button,\n(BMIsTouchDevice||1==a.which)&&\"BUTTON\"!=a.target.nodeName&&\"INPUT\"!=a.target.nodeName&&\"LABEL\"!=a.target.nodeName&&\"A\"!=a.target.nodeName&&\"BUTTON\"!=a.target.parentNode.nodeName&&\"INPUT\"!=a.target.parentNode.nodeName&&\"LABEL\"!=a.target.parentNode.nodeName)){if(\"touchstart\"==a.originalEvent.type){if(void 0!==n)return;n=a.originalEvent.touches[0].identifier}u=NO;e.delegate&&e.delegate.collectionViewCanMoveCell&&(u=e.delegate.collectionViewCanMoveCell(e,c,{atIndexPath:c.indexPath}));u&&a.preventDefault();\ng.x=a.pageX||a.originalEvent.touches&&a.originalEvent.touches[0].pageX||0;g.y=a.pageY||a.originalEvent.touches&&a.originalEvent.touches[0].pageY||0;h=NO;k=window.setTimeout(function(){k=void 0;h=YES;!e.cellWasLongClicked(c,{withEvent:a})&&u&&(e.delegate&&e.delegate.collectionViewWillBeginInteractiveMovementForCell&&e.delegate.collectionViewWillBeginInteractiveMovementForCell(e,c,{atIndexPath:c.indexPath}),e.beginDragWithEvent(a,{forCell:c,touchIdentifier:n}))},_BMCollectionViewLongClickDelay);q=NO;\ne.delegate&&e.delegate.collectionViewCanDoubleClickCell&&(q=e.delegate.collectionViewCanDoubleClickCell(e,c));q&&(l=window.setTimeout(function(){l=void 0;f&&(e.cellWasClicked(c,{withEvent:a}),f=0)},_BMCollectionViewDoubleClickDelay));m=YES}};c.element[0].addEventListener(\"mousedown\",c.mousedownHandler,a);c.element[0].addEventListener(\"touchstart\",c.mousedownHandler,a);c.mousemoveHandler=function(a){if(!_BMCoreUIIsDragging&&(u&&a.preventDefault(),a.originalEvent=a,a.which=a.which||a.button,m)){if(\"touchmove\"==\na.type){if(void 0===n)return;for(var b=0;b<a.originalEvent.changedTouches.length;b++)if(a.originalEvent.changedTouches[b].identifier==n){var d=a.originalEvent.changedTouches[b].pageX,h=a.originalEvent.changedTouches[b].pageY;break}if(b==a.originalEvent.changedTouches.length)return}else d=a.pageX,h=a.pageY;if(Math.abs(d-g.x)>_BMCollectionViewClickSlopeThreshold||Math.abs(h-g.y)>_BMCollectionViewClickSlopeThreshold)window.clearTimeout(k),window.clearTimeout(l),m=NO,f&&(e.cellWasClicked(c,{withEvent:a}),\nf=0),\"mousemove\"==a.type&&u&&(e.delegate&&e.delegate.collectionViewWillBeginInteractiveMovementForCell&&e.delegate.collectionViewWillBeginInteractiveMovementForCell(e,c,{atIndexPath:c.indexPath}),e.beginDragWithEvent(a,{forCell:c,touchIdentifier:n}))}};c.element[0].addEventListener(\"mousemove\",c.mousemoveHandler,a);c.element[0].addEventListener(\"touchmove\",c.mousemoveHandler,a);c.touchcancelHandler=function(a){if(!_BMCoreUIIsDragging&&(a.originalEvent=a,a.which=a.which||a.button,void 0!==n)){for(var b=\n0;b<a.originalEvent.changedTouches.length;b++)if(a.originalEvent.changedTouches[b].identifier==n){n=void 0;a.preventDefault();break}b!=a.originalEvent.changedTouches.length&&window.clearTimeout(l)}};c.element[0].addEventListener(\"touchcancel\",c.touchcancelHandler,a);c.mouseupHandler=function(a){if(!_BMCoreUIIsDragging&&(a.originalEvent=a,a.which=a.which||a.button,BMIsTouchDevice||1==a.which)){if(\"touchend\"==a.originalEvent.type){if(void 0===n)return;for(var b=0;b<a.originalEvent.changedTouches.length;b++)if(a.originalEvent.changedTouches[b].identifier==\nn){n=void 0;a.preventDefault();break}if(b==a.originalEvent.changedTouches.length)return}m&&(m=NO,!h)&&((window.clearTimeout(k),q)?l&&(f++,2<=f&&(f=0,e.cellWasDoubleClicked(c,{withEvent:a}),window.clearTimeout(l))):e.cellWasClicked(c,{withEvent:a}))}};c.element[0].addEventListener(\"mouseup\",c.mouseupHandler,a);c.element[0].addEventListener(\"touchend\",c.mouseupHandler,a);c.element.on(\"contextmenu.BMCollectionView\",function(a){e.cellWasRightClicked(c,{withEvent:a})&&(a.preventDefault(),a.stopPropagation())});\nreturn c},isDragging:NO,interactiveMovement:void 0,_draggingIndexPaths:void 0,invalidateDraggingIndexPaths(){this._draggingIndexPaths&&(this._draggingIndexPaths=this._draggingIndexPaths.map((a)=>this._dataSet.indexPathForObject(a.object)))},_canAcceptItems(a){return this.delegate&&this.delegate.collectionViewCanAcceptItems?this.delegate.collectionViewCanAcceptItems(this,a):NO},_insertItems:async function(a,b){this._droppedShadows=b.withDropShadows;this.dataSet.insertItems(a,b);await new Promise((a,\nb)=>{this.registerDataCompletionCallback(()=>{a()})})},beginDragWithEvent(a,b){if(!this.isDragging){var c,d=b.touchIdentifier;this.interactiveMovement=new Promise(function(a,b){c=a});_BMCoreUIIsDragging=this.isDragging=YES;var e=b.forCell,f=e.node.cloneNode(YES);f.classList.add(\"BMDragShadow\");document.body.appendChild(f);if(this.isCellAtIndexPathSelected(e.indexPath)){var h=[];this._selectedIndexPaths.sort((a,b)=>b.section==a.section?a.row-b.row:a.section-b.section).forEach((a)=>{a=this.retainCellForIndexPath(a);\nh.push(a);a.isDragging=YES;a.node.classList.add(\"BMCollectionViewCellDragging\")})}else h=[e],e.isDraggging=YES,e.retain(),e.node.classList.add(\"BMCollectionViewCellDragging\");var g=document.createElement(\"div\");g.classList.add(\"BMDragIndicator\");g.innerText=h.length;g.style.zIndex=99999999;if(void 0!==d)for(b=0;b<a.changedTouches.length;b++){if(a.changedTouches[b].identifier==d){var k=a.changedTouches[b].clientX;var l=a.changedTouches[b].clientY;break}}else k=a.clientX,l=a.clientY;a=BMRectMakeWithNodeFrame(e.node);\nvar m=BMPointMake(k-a.origin.x,l-a.origin.y),q=BMPointMake(k-m.x,l-m.y),n=[],u=new Map,w=YES,x=null;h.forEach((a)=>{if(!(a==e||10<=n.length)){var b=a.node.cloneNode(YES);b.classList.add(\"BMDragShadow\");b.classList.remove(\"BMCollectionViewCellDragging\");document.body.insertBefore(b,x);x=b;var c=BMRectMakeWithNodeFrame(a.node);u.set(b,a);b.style.pointerEvents=\"none\";b.style.position=\"fixed\";b.style.left=c.origin.x+\"px\";b.style.top=c.origin.y+\"px\";b.style.zIndex=99999997;n.push(b);var d=n.length;(window.Velocity||\n$.Velocity).animate(b,{tween:1},{easing:\"easeInOutQuad\",duration:300,progress:(a,e,l,f,k)=>{BMHook(b,{rotateZ:60*d/h.length*k+\"deg\"});b.style.left=BMNumberByInterpolatingNumbersWithFraction(c.origin.x,q.x,k)+\"px\";b.style.top=BMNumberByInterpolatingNumbersWithFraction(c.origin.y,q.y,k)+\"px\"},complete(){w=NO}})}});f.style.transform=\"\";f.style.pointerEvents=\"none\";f.style.position=\"fixed\";f.style.left=k-m.x+\"px\";f.style.top=l-m.y+\"px\";f.style.zIndex=99999998;g.style.left=k-m.x-12+\"px\";g.style.top=l-\nm.y-12+\"px\";BMHook(g,{scaleX:0,scaleY:0});document.body.appendChild(g);(window.Velocity||$.Velocity).animate(g,{opacity:[1,0],scaleX:[1,0],scaleY:[1,0]},{duration:300,easing:\"easeOutQuad\"});this.layout.prepareForDragOperation();var t=BMRectMakeWithNodeFrame(this.container[0]),p=0,D=0,r=()=>{A=window.requestAnimationFrame(r);if(D||p){let a=this.scrollOffset;a.x+=D;a.y+=p;a.x=Math.max(0,Math.min(a.x,this.size.width-this.frame.size.width));a.y=Math.max(0,Math.min(a.y,this.size.height-this.frame.size.height));\nthis.scrollOffset=a}},A=window.requestAnimationFrame(r),v=NO,z=NO;k=NO;this._draggingIndexPaths=h.map((a)=>a.indexPath);var E=[],B=new Map,H,G,R,N;this.delegate&&this.delegate.collectionViewCanTransferItemsAtIndexPaths&&(k=this.delegate.collectionViewCanTransferItemsAtIndexPaths(this,this._draggingIndexPaths))&&(_BMCollectionViews.forEach((a,b)=>{if(b!=this&&b._canAcceptItems(this._draggingIndexPaths.map((a)=>a.object))){E.push(b);if(!d){var c={mouseover:(a)=>{G=b;H=BMRectMakeWithNodeFrame(b._container[0]);\ng.classList.add(\"BMDragIndicatorBlue\");a.preventDefault();a.stopPropagation();return NO},mouseout:(a)=>{H=G=void 0;g.classList.remove(\"BMDragIndicatorBlue\");a.preventDefault();a.stopPropagation();return NO}};b._container[0].addEventListener(\"mouseover\",c.mouseover);b._container[0].addEventListener(\"mouseout\",c.mouseout)}b._container[0].classList.add(\"BMDropTarget\");B.set(b,c)}}),void 0!==d&&(N=(a)=>{let b,c;for(var e=0;e<a.changedTouches.length;e++)if(a.changedTouches[e].identifier==d){b=a.changedTouches[e].clientX;\nc=a.changedTouches[e].clientY;break}if(e==a.changedTouches.length)return NO;a=document.elementFromPoint(b,c);let l;if(a)for(let b of E)if(b._container[0].contains(a)){l=b;break}l!=G&&((G=l)?(H=BMRectMakeWithNodeFrame(G._container[0]),g.classList.add(\"BMDragIndicatorBlue\")):(H=void 0,g.classList.remove(\"BMDragIndicatorBlue\")))}));var S=(a)=>{a.preventDefault();let b,c;if(void 0!==d){a.preventDefault();for(var e=0;e<a.changedTouches.length;e++)if(a.changedTouches[e].identifier==d){b=a.changedTouches[e].clientX;\nc=a.changedTouches[e].clientY;break}if(e==a.changedTouches.length)return a.preventDefault()}else b=a.clientX,c=a.clientY;f.style.left=b-m.x+\"px\";f.style.top=c-m.y+\"px\";g.style.left=b-m.x-12+\"px\";g.style.top=c-m.y-12+\"px\";w?q=BMPointMake(b-m.x,c-m.y):n.forEach((a,d)=>{a.style.left=b-m.x+\"px\";a.style.top=c-m.y+\"px\"});if(this.isUpdatingData)return a.preventDefault(),a.stopPropagation();D=32>b-t.origin.x?(b-t.origin.x-32)/32*20:32>t.right-b?(32-t.right+b)/32*20:0;p=32>c-t.origin.y?(c-t.origin.y-32)/32*\n20:32>t.bottom-c?(32-t.bottom+c)/32*20:0;c<t.top||c>t.bottom||b<t.left||b>t.right?v||(v=YES,p=D=0,this.delegate&&this.delegate.collectionViewCanRemoveItemsAtIndexPaths&&(z=this.delegate.collectionViewCanRemoveItemsAtIndexPaths(this,this._draggingIndexPaths)),z&&g.classList.add(\"BMDragIndicatorRed\")):v&&(z=v=NO,g.classList.remove(\"BMDragIndicatorRed\"));if(G){p=D=0;let d=BMPointMake(b-H.origin.x,c-H.origin.y);d.x+=G.scrollOffset.x;d.y+=G.scrollOffset.y;e=BMRectMake(0,0,128,128);e.center=d;e=G.layout.attributesForElementsInRect(e);\nlet l,f=Number.MAX_SAFE_INTEGER,k=0;e.forEach((a,b)=>{a.itemType==BMCollectionViewLayoutAttributesType.Cell&&(a.frame.containsPoint(d)&&(l=a.indexPath.copy()),a=d.distanceToPoint(a.frame.center),a<f&&(f=a,k=b))});l?R=l:e.length&&(R=e[k].indexPath.copy());return a.preventDefault(),a.stopPropagation()}if(D||p)return a.preventDefault(),a.stopPropagation();let l=BMPointMake(b-t.origin.x,c-t.origin.y);l.x+=this.scrollOffset.x;l.y+=this.scrollOffset.y;e=BMRectMake(0,0,64,64);e.center=l;e=this.layout.attributesForElementsInRect(e);\nlet k,u=NO;e.forEach((a)=>{if(a.itemType==BMCollectionViewLayoutAttributesType.Cell&&!u){a.frame.containsPoint(l)&&(k=a.indexPath.copy());var b=YES;k&&(this._draggingIndexPaths.forEach((a)=>{k.row==a.row&&k.section==a.section&&(b=NO)}),b&&(u=YES,this.dataSet.moveItemsFromIndexPaths&&1!=h.length?this._draggingIndexPaths=this.dataSet.moveItemsFromIndexPaths(this._draggingIndexPaths,{toIndexPath:k}).sort((a,b)=>a.section==b.section?a.row-b.row:a.section-b.section):this._draggingIndexPaths.forEach((a,\nb)=>{let c=k.copy();c.object=a.object;c.row+=b;this.dataSet.moveItemFromIndexPath(a,{toIndexPath:c})&&(this._draggingIndexPaths[b]=c)})))}});a.preventDefault();a.stopPropagation()};window.addEventListener(void 0!==d?\"touchmove\":\"mousemove\",S,{capture:YES});void 0!==d&&window.addEventListener(\"touchmove\",N,{capture:YES});var P=async(a)=>{if(void 0!==d){for(var b=0;b<a.changedTouches.length&&a.changedTouches[b].identifier!=d;b++);if(b==a.changedTouches.length)return}window.removeEventListener(void 0!==\nd?\"touchmove\":\"mousemove\",S,{capture:YES});window.removeEventListener(void 0!==d?\"touchend\":\"mouseup\",P,{capture:YES});void 0!==d&&window.removeEventListener(\"touchcancel\",P,{capture:YES});d?(E.forEach((a)=>a._container[0].classList.remove(\"BMDropTarget\")),window.removeEventListener(\"touchmove\",N,{capture:YES})):B.forEach((a,b)=>{b._container[0].removeEventListener(\"mouseover\",a.mouseover);b._container[0].removeEventListener(\"mouseout\",a.mouseout);b._container[0].classList.remove(\"BMDropTarget\")});\nwindow.cancelAnimationFrame(A);_BMCoreUIIsDragging=this.isDragging=NO;a=BMRectMakeWithNodeFrame(f);b=BMRectMakeWithNodeFrame(e.node);this.delegate&&this.delegate.collectionViewWillFinishInteractiveMovementForCell&&this.delegate.collectionViewWillFinishInteractiveMovementForCell(this,e,{atIndexPath:e.indexPath});c();(window.Velocity||$.Velocity).animate(g,{scaleX:0,scaleY:0,opacity:0},{duration:300,easing:\"easeInOutQuad\"});if(G){a=R;a||(a=G.numberOfSections(),a=G.indexPathForObjectAtRow(G.numberOfObjectsInSectionAtIndex(a-\n1)-1,{inSectionAtIndex:a-1}));let c=new Map,d=this._draggingIndexPaths.map((a)=>JSON.parse(JSON.stringify(a.object))),l=0;(()=>{let a;for(let b=0;b<d.length;b++)this._draggingIndexPaths[b].row==e.indexPath.row&&this._draggingIndexPaths[b].section==e.indexPath.section&&(a=d[b]);c.set(a,{node:f,rotation:0})})();u.forEach((a,b)=>{let e;for(let b=0;b<d.length;b++)this._draggingIndexPaths[b].row==a.indexPath.row&&this._draggingIndexPaths[b].section==a.indexPath.section&&(e=d[b]);c.set(e,{node:b,rotation:60*\n(l+1)/h.length});l++});b=BMCollectionViewTransferPolicy.Copy;this.delegate&&this.delegate.collectionViewTransferPolicyForItemsAtIndexPaths&&(b=this.delegate.collectionViewTransferPolicyForItemsAtIndexPaths(this,this._draggingIndexPaths));let k=BMCollectionViewTransferPolicy.Copy;G.delegate&&G.delegate.collectionViewAcceptPolicyForItems&&(k=G.delegate.collectionViewAcceptPolicyForItems(G,d));(z=b==BMCollectionViewTransferPolicy.Move&&k==BMCollectionViewAcceptPolicy.Move?YES:NO)&&this.dataSet.removeItemsAtIndexPaths(this._draggingIndexPaths);\nh.forEach((a)=>{a.node.classList.remove(\"BMCollectionViewCellDragging\")});await G._insertItems(d,{toIndexPath:a,withDropShadows:c})}else z?(this.dataSet.removeItemsAtIndexPaths(this._draggingIndexPaths),h.forEach((a)=>{a.node.classList.remove(\"BMCollectionViewCellDragging\")}),n.forEach((a,b)=>{BMHook(a,{rotateZ:60*(b+1)/h.length+\"deg\"});(window.Velocity||$.Velocity).animate(a,{scaleX:1.5,scaleY:1.5,opacity:0},{easing:\"easeInQuad\",duration:200})}),await (window.Velocity||$.Velocity).animate(f,{scaleX:1.5,\nscaleY:1.5,opacity:0},{duration:200,easing:\"easeInQuad\"})):(n.forEach((a,b)=>{var c=u.get(a);c=BMRectMakeWithNodeFrame(c.node);(window.Velocity||$.Velocity).animate(a,{tween:1,left:c.origin.x+\"px\",top:c.origin.y+\"px\"},{easing:\"easeInOutQuad\",duration:300,progress:(c,d,e,l,f)=>{a.style.transform=\"rotate(\"+60*(b+1)/h.length*(1-f)+\"deg) translateZ(0)\"},complete(){w=NO}})}),await (window.Velocity||$.Velocity).animate(f,{translateX:-a.origin.x+b.origin.x+\"px\",translateY:-a.origin.y+b.origin.y+\"px\"},{duration:300,\neasing:\"easeInOutQuad\"}));f.remove();g.remove();n.forEach((a)=>a.remove());h.forEach((a)=>{a.node.classList.remove(\"BMCollectionViewCellDragging\");a.isDraggging=NO;a.release()});this.delegate&&this.delegate.collectionViewDidFinishInteractiveMovementForCell&&this.delegate.collectionViewDidFinishInteractiveMovementForCell(this,e,{atIndexPath:e.indexPath});this._draggingIndexPaths=void 0};window.addEventListener(void 0!==d?\"touchend\":\"mouseup\",P,{capture:YES});void 0!==d&&window.addEventListener(\"touchcancel\",\nP,{capture:YES})}},dequeueCellForSupplementaryViewWithIdentifier:function(a){var b=this.supplementaryViewCache[a];if(b&&b.length){var c=b.pop();c.element[0].style.opacity=c._backingOpacity;return c}c=document.createElement(\"div\");c.style=\"position: absolute; left: 0px; top: 0px; visibility: hidden; overflow: visible;\";b=this._supplementaryViewClasses[a]||this._cellClass;c=Object.create(b.prototype).initWithCollectionView(this,{reuseIdentifier:a,node:c});c.itemType=BMCollectionViewLayoutAttributesType.SupplementaryView;\nb==BMCollectionViewCell&&c.element.append(this._dataSet.contentsForSupplementaryViewWithIdentifier(a));this._contentWrapper.append(c.element);return c},cellShouldRender:function(a){this.delegate&&\"function\"==typeof this.delegate.collectionViewWillRenderCell&&this.delegate.collectionViewWillRenderCell(this,a);a.element[0].style.visibility=\"inherit\";this.allCells.push(a);a.rendered=YES;this.delegate&&\"function\"==typeof this.delegate.collectionViewDidRenderCell&&this.delegate.collectionViewDidRenderCell(this,\na)},cellWasManaged:function(a){this.retainedCells.push(a)},cellWasReleased:function(a){this.delegate&&\"function\"==typeof this.delegate.collectionViewWillRecycleCell&&this.delegate.collectionViewWillRecycleCell(this,a);a.element[0].style.visibility=\"hidden\";a._backingOpacity=a.attributes.style.opacity;void 0===a._backingOpacity&&(a._backingOpacity=BMCollectionViewLayoutAttributesStyleDefaults.opacity);a.element[0].style.opacity=0;BMHook(a.element,{translateX:\"0px\",translateY:\"0px\"});for(var b=this.allCells.length,\nc=0;c<b;c++)if(this.allCells[c]===a){this.allCells.splice(c,1);break}b=a.itemType==BMCollectionViewLayoutAttributesType.Cell?this.cellCache:this.supplementaryViewCache;b[a.reuseIdentifier]||(b[a.reuseIdentifier]=[]);b[a.reuseIdentifier].push(a);a.rendered=NO;this.delegate&&\"function\"==typeof this.delegate.collectionViewDidRecycleCell&&this.delegate.collectionViewDidRecycleCell(this,a)},cellWasUnmanaged:function(a){for(var b=this.retainedCells.length,c=0;c<b;c++)if(this.retainedCells[c]===a){this.retainedCells.splice(c,\n1);break}},cellWasInvalidated:function(a){this.delegate&&\"function\"==typeof this.delegate.collectionViewWillDestroyCell&&this.delegate.collectionViewWillDestroyCell(this,a);a.element[0].removeEventListener(\"mousedown\",a.mousedownHandler);a.element[0].removeEventListener(\"touchstart\",a.mousedownHandler);a.element[0].removeEventListener(\"mousemove\",a.mousemoveHandler);a.element[0].removeEventListener(\"touchmove\",a.mousemoveHandler);a.element[0].removeEventListener(\"mouseup\",a.mouseupHandler);a.element[0].removeEventListener(\"touchend\",\na.mouseupHandler);a.element[0].removeEventListener(\"touchcancel\",a.touchcancelHandler);a.element.off(\"contextmenu.BMCollectionView\");a.rendered=NO;a.element.remove();for(var b=this.retainedCells.length,c=0;c<b;c++)if(this.retainedCells[c]===a){this.retainedCells.splice(c,1);break}b=this.allCells.length;for(c=0;c<b;c++)if(this.allCells[c]===a){this.allCells.splice(c,1);break}this.delegate&&\"function\"==typeof this.delegate.collectionViewDidDestroyCell&&this.delegate.collectionViewDidDestroyCell(this,\na)},cellAtIndexPath:function(a,b){b||(b={ofType:BMCollectionViewLayoutAttributesType.Cell});b.ofType=b.ofType||BMCollectionViewLayoutAttributesType.Cell;if(b.ofType==BMCollectionViewLayoutAttributesType.SupplementaryView)return this.supplementaryViewWithIdentifier(b.withIdentifier,{atIndexPath:a});for(var c=0;c<this.allCells.length;c++){var d=this.allCells[c];if(d.itemType==b.ofType&&d.indexPath.isLooselyEqualToIndexPath(a,{usingComparator:this.identityComparator}))return d}},supplementaryViewWithIdentifier:function(a,\nb){for(var c=0;c<this.allCells.length;c++){var d=this.allCells[c];if(d.itemType==BMCollectionViewLayoutAttributesType.SupplementaryView&&d.reuseIdentifier==a&&d.indexPath.isEqualToIndexPath(b.atIndexPath,{usingComparator:this.identityComparator}))return d}},retainCellForIndexPath:function(a){if(!(a.section>this.numberOfSections()||a.row>this.numberOfObjectsInSectionAtIndex(a.section))){var b=this.cellAtIndexPath(a,{ofType:BMCollectionViewLayoutAttributesType.Cell});if(b)return b.retain(),b;b=this._dataSet.cellForItemAtIndexPath(a);\nb.attributes=this.layout.attributesForCellAtIndexPath(a);b.retain();return b}},retainSupplementaryViewWithIdentifier:function(a,b){var c=this.supplementaryViewWithIdentifier(a,{atIndexPath:b.forIndexPath});if(c)return c.retain(),c;var d=this.layout.attributesForSupplementaryViewWithIdentifier(a,{atIndexPath:b.forIndexPath});if(d)return c=this._dataSet.cellForSupplementaryViewWithIdentifier(a,{atIndexPath:b.forIndexPath}),c.attributes=d,c.retain(),c},cellWasClicked:function(a,b){var c=NO;this.delegate&&\nthis.delegate.collectionViewCellWasClicked&&(c=this.delegate.collectionViewCellWasClicked(this,a,{withEvent:b.withEvent}));c||(b=YES,(c=this.isCellAtIndexPathSelected(a.indexPath))?this.delegate&&\"function\"===typeof this.delegate.collectionViewCanDeselectCellAtIndexPath&&(b=this.delegate.collectionViewCanDeselectCellAtIndexPath(this,a.indexPath)):this.delegate&&\"function\"===typeof this.delegate.collectionViewCanSelectCellAtIndexPath&&(b=this.delegate.collectionViewCanSelectCellAtIndexPath(this,a.indexPath)),\nb&&(c?this.deselectCellAtIndexPath(a.indexPath):this.selectCellAtIndexPath(a.indexPath)))},cellWasDoubleClicked:function(a,b){this.delegate&&this.delegate.collectionViewCellWasDoubleClicked&&this.delegate.collectionViewCellWasDoubleClicked(this,a,{withEvent:b.withEvent})},cellWasLongClicked:function(a,b){this.delegate&&this.delegate.collectionViewCellWasLongClicked&&this.delegate.collectionViewCellWasLongClicked(this,a,{withEvent:b.withEvent})},cellWasRightClicked:function(a,b){var c=NO;this.delegate&&\nthis.delegate.collectionViewCellWasRightClicked&&(c=this.delegate.collectionViewCellWasRightClicked(this,a,{withEvent:b.withEvent}));return c},_selectedIndexPaths:void 0,get selectedIndexPaths(){return this._selectedIndexPaths},set selectedIndexPaths(a){var b=a.length,c=this._selectedIndexPaths;this._selectedIndexPaths=a;for(var d=0;d<b;d++){for(var e=a[d],f=NO,h=0;h<c.length;h++)if(c[h].isLooselyEqualToIndexPath(e,{usingComparator:this.identityComparator})){f=YES;c.splice(h,1);break}f||this.delegate&&\n\"function\"===typeof this.delegate.collectionViewDidSelectCellAtIndexPath&&this.delegate.collectionViewDidSelectCellAtIndexPath(this,e)}for(d=0;d<c.length;d++)this.delegate&&\"function\"===typeof this.delegate.collectionViewDidDeselectCellAtIndexPath&&this.delegate.collectionViewDidDeselectCellAtIndexPath(this,c[d])},_updateSelectionIndexPaths:function(){var a=this._selectedIndexPaths;this._selectedIndexPaths=[];for(var b=a.length,c=0;c<b;c++){var d=this.dataSet.indexPathForObject(a[c].object);d&&this._selectedIndexPaths.push(d)}},\nisCellAtIndexPathSelected:function(a){for(var b=this._selectedIndexPaths.length,c=0;c<b;c++)if(a.isLooselyEqualToIndexPath(this._selectedIndexPaths[c],{usingComparator:this.identityComparator}))return YES;return NO},selectCellAtIndexPath:function(a){this._selectedIndexPaths.push(a);this.delegate&&\"function\"===typeof this.delegate.collectionViewDidSelectCellAtIndexPath&&this.delegate.collectionViewDidSelectCellAtIndexPath(this,a)},deselectCellAtIndexPath:function(a){for(var b=this._selectedIndexPaths.length,\nc=0;c<b;c++)if(this._selectedIndexPaths[c].isLooselyEqualToIndexPath(a,{usingComparator:this.identityComparator})){this._selectedIndexPaths.splice(c,1);break}this.delegate&&\"function\"===typeof this.delegate.collectionViewDidDeselectCellAtIndexPath&&this.delegate.collectionViewDidDeselectCellAtIndexPath(this,a)},setLayout:function(a,b){if(this.isUpdatingData){var c=this;this.registerDataCompletionCallback(function(){c.setLayout(a,b)})}else if(b&&b.animated&&this.initialized){this.isUpdatingData=YES;\nfor(var d=[],e=this.allCells.length,f=[],h=0;h<e;h++)d.push(this.allCells[h].attributes),f.push(this.allCells[h]);a.collectionView=this;a.prepareLayout();e=a.contentSize();var g=this.scrollOffset,k=this._bounds.copy();h=a.preferredScrollOffsetForTransitionFromLayout(this._layout,{withOffset:this.scrollOffset.copy()});h.x=Math.max(0,Math.min(h.x,e.width-this.frame.size.width));h.y=Math.max(0,Math.min(h.y,e.height-this.frame.size.height));var l=BMRectMake(h.x-this._offscreenBufferSize,h.y-this._offscreenBufferSize,\nthis._bounds.size.width,this._bounds.size.height);this._bounds=l;h=a.attributesForElementsInRect(l.copy());for(var m=[],q=[];d.length;){var n=d[d.length-1],u=NO;if(n.itemType===BMCollectionViewLayoutAttributesType.Cell){for(var w,x=0;x<h.length;x++)if(w=h[x],w.itemType===BMCollectionViewLayoutAttributesType.Cell&&w.indexPath.isEqualToIndexPath(n.indexPath,{usingComparator:this.identityComparator})){u=YES;h.splice(x,1);break}u||(w=a.attributesForCellAtIndexPath(n.indexPath));n=_BMCollectionViewTransitionCellAttributesMakeWithSourceAttributes(n,\n{targetAttributes:w})}else{for(x=0;x<h.length;x++)if(w=h[x],w.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&w.identifier===n.identifier&&w.indexPath.isEqualToIndexPath(n.indexPath,{usingComparator:this.identityComparator})){u=YES;h.splice(x,1);break}u||(q.push(n),w=n.copy(),w._style||(h._style={}),w.style.opacity=0,isNaN(n.style.opacity)&&(n.style.opacity=1));n=_BMCollectionViewTransitionCellAttributesMakeWithSourceAttributes(n,{targetAttributes:w})}m.push(n);d.splice(d.length-\n1,1)}for(this._bounds=k;h.length;)n=h[h.length-1],n.itemType===BMCollectionViewLayoutAttributesType.Cell?d=this._layout.attributesForCellAtIndexPath(n.indexPath):(d=n.copy(),d.style.opacity=0,isNaN(n.style.opacity)&&(n.style.opacity=1)),n=_BMCollectionViewTransitionCellAttributesMakeWithSourceAttributes(d,{targetAttributes:n}),m.push(n),h.splice(h.length-1,1);this._bounds=l;var t=new _BMCollectionViewTransitionLayout(m,this._size,e,a);t.collectionView=this;d=this._layout;this._layout.collectionView=\nvoid 0;this._layout=t;var p={};this.delegate&&this.delegate.collectionViewAnimationOptionsForLayoutChangeFromLayout&&(p=this.delegate.collectionViewAnimationOptionsForLayoutChangeFromLayout(this,d,{toLayout:a}));d=BMExtend({duration:_BMCollectionViewAnimationDurationDefault,easing:_BMCollectionViewAnimationEasingDefault,queue:\"_BMCollectionViewTransitionLayoutQueue\"},p);f.forEach((a)=>a.retain());d.complete=function(){f.forEach((a)=>a.release());t._applyFinalAttributes();c.retainedCells.slice().forEach(function(a){a.attributes.isHidden&&\na._unmanage()});c._layout=a;c.iScroll&&c.iScroll.refresh();for(var d=0;d<q.length;d++){var e=q[d];(e=c.supplementaryViewWithIdentifier(e.identifier,{atIndexPath:e.indexPath}))&&e.isManaged&&e._unmanage()}c.isUpdatingData=NO;c._executeDataCompletionCallbacks();p.complete&&p.complete();b&&b.completionHandler&&b.completionHandler()};d.queue=NO;c=this;BMAnimateWithBlock(()=>{BMAnimationContextGetCurrent().controllerForObject(c._container[0],{node:c._container[0]}).registerCustomProperty(\"tween\",{withHandler:(a)=>\n{t.fraction=a;this._bounds=BMRectByInterpolatingRect(k,{toRect:l,withFraction:a});a=t.contentSize();this._size.isEqualToSize(a)||(this._size=a,this._contentWrapper.css({width:this._size.width+\"px\",height:this._size.height+\"px\"}));a=t.attributesForElementsInRect();this._renderCellsWithAttributes(a,{exclusive:YES})}});if(k.origin.x!=c._bounds.origin.x||k.origin.y!=c._bounds.origin.y){var a=c._bounds.origin.copy();a.x+=c._offscreenBufferSize;a.y+=c._offscreenBufferSize;let b=BMAnimationContextGetCurrent().controllerForObject(c._container[0],\n{node:c._container[0]});c.iScroll?b.registerCustomProperty(\"scrollOffset\",{withHandler:(b)=>{c.iScroll._translate(-(g.x+b*(a.x-g.x)),-(g.y+b*(a.y-g.y)))}}):b.registerCustomProperty(\"scrollOffset\",{withHandler:(b)=>{c._container[0].scrollTo(g.x+b*(a.x-g.x),g.y+b*(a.y-g.y))}})}},d)}else this.layout=a,this._executeDataCompletionCallbacks(),b&&b.completionHandler&&b.completionHandler()},_dataUpdateCallbacks:void 0,registerDataCompletionCallback:function(a){this._dataUpdateCallbacks=this._dataUpdateCallbacks||\n[];this._dataUpdateCallbacks.push(a)},_executeDataCompletionCallbacks:function(){if(this._dataUpdateCallbacks){for(var a=this._dataUpdateCallbacks.length,b=0;b<a;b++)this._dataUpdateCallbacks[b]();this._dataUpdateCallbacks=[]}},dataSetDidChangeFromDataSet:function(a){this.initialized?this.invalidateLayout():this._init()},usingOldDataSet:function(a){var b=this.dataSet.isUsingOldData();this.dataSet.useOldData(YES);this._bounds=this.oldBounds;a();this._bounds=this.newBounds;this.dataSet.useOldData(b)},\nusingNewDataSet:function(a){var b=this.dataSet.isUsingOldData();this.dataSet.useOldData(NO);a();this.dataSet.useOldData(b)},_dataUpdatePromise:void 0,updateEntireDataAnimated:function(a,b){if(this.initialized){void 0===a&&(a=YES);var c;this._dataUpdatePromise=new Promise(function(a,b){c=a});this._updateSelectionIndexPaths();if(!a){this.invalidateLayout();for(a=0;a<this.allCells.length;a++){var d=this.allCells[a];d.itemType===BMCollectionViewLayoutAttributesType.Cell?this.dataSet.updateCell&&this.dataSet.updateCell(d,\n{atIndexPath:d.indexPath}):d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&this.dataSet.updateSupplementaryView&&this.dataSet.updateSupplementaryView(d,{withIdentifier:d.reuseIdentifier,atIndexPath:d.indexPath})}this._executeDataCompletionCallbacks();c();return this._dataUpdatePromise}if(b&&b.updateLayout===NO){for(a=0;a<this.allCells.length;a++)d=this.allCells[a],d.itemType===BMCollectionViewLayoutAttributesType.Cell?(d.attributes.indexPath=this.dataSet.indexPathForObjectAtRow(d.indexPath.row,\n{inSectionAtIndex:d.indexPath.section}),this.dataSet.updateCell&&this.dataSet.updateCell(d,{atIndexPath:d.indexPath})):d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&this.dataSet.updateSupplementaryView&&this.dataSet.updateSupplementaryView(d,{withIdentifier:d.reuseIdentifier,atIndexPath:d.indexPath});b&&b.completionHandler&&b.completionHandler();this._executeDataCompletionCallbacks();c();return this._dataUpdatePromise}this._collectionEnabled=NO;this.isUpdatingData=YES;this.layout.collectionViewWillStartUpdates(void 0);\nvar e=this._bounds.copy();this.oldBounds=e;var f=this.layout.contentSize();a=this._size;this._size=f;var h=BMPointMake(this._bounds.origin.x+this._offscreenBufferSize,this._bounds.origin.y+this._offscreenBufferSize),g=this.layout.preferredScrollOffsetWithOffset(h);this._bounds.origin.x+=g.x-h.x;this._bounds.origin.y+=g.y-h.y;this._constrainBounds();this.newBounds=this._bounds;this._size=a;this._container[0].style.pointerEvents=\"none\";a=this.scrollOffset;this.iScroll||this._container[0].scrollTo(a.x,\na.y);this.scrollView&&(this.scrollView.scrollingEnabled=NO);g=this.layout.attributesForElementsInRect(this._bounds);this.attributeCache={};var k=[],l=[],m=this.layout.supplementaryViewsToInsert(),q=this.layout.supplementaryViewsToDelete(),n=this.allCells.slice(),u=new BMRect(BMPointMake(this._bounds.origin.x+this._offscreenBufferSize,this._bounds.origin.y+this._offscreenBufferSize),this._frame.size.copy()),w=new BMRect(BMPointMake(e.origin.x+this._offscreenBufferSize,e.origin.y+this._offscreenBufferSize),\nthis._frame.size.copy());for(a=0;a<n.length;a++){d=n[a];for(var x=NO,t=0;t<g.length;t++){var p=g[t];if(d.itemType===p.itemType&&d.indexPath.isLooselyEqualToIndexPath(p.indexPath,{usingComparator:this.identityComparator})&&(d.itemType!==BMCollectionViewLayoutAttributesType.SupplementaryView||d.reuseIdentifier===p.identifier)){d.targetAttributes=p;p.initialAttributes=d.attributes;x=YES;g.splice(t,1);d.itemType===BMCollectionViewLayoutAttributesType.Cell?this.dataSet.updateCell&&this.dataSet.updateCell(d,\n{atIndexPath:p.indexPath}):d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView&&this.dataSet.updateSupplementaryView&&this.dataSet.updateSupplementaryView(d,{withIdentifier:d.reuseIdentifier,atIndexPath:p.indexPath});break}}if(!x)if(d.itemType===BMCollectionViewLayoutAttributesType.Cell)(p=this.indexPathForObject(d.indexPath.object))?(p=this.layout.attributesForCellAtIndexPath(p),d.targetAttributes=p,l.push(d),this.dataSet.updateCell&&this.dataSet.updateCell(d,{atIndexPath:p.indexPath})):\n(p=this.layout.finalAttributesForDisappearingCellAtIndexPath(d.indexPath,{withTargetAttributes:d.attributes}),d.targetAttributes=p,k.push(d));else if(d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView){p=NO;for(t=0;t<q.length;t++)if(d.indexPath.isLooselyEqualToIndexPath(q[t].indexPath,{usingComparator:this.identityComparator})&&d.reuseIdentifier==q[t].identifier){p=YES;break}p?(d.targetAttributes=this.layout.finalAttributesForDisappearingSupplementaryViewWithIdentifier(d.reuseIdentifier,\n{atIndexPath:d.indexPath,withTargetAttributes:d.attributes}),k.push(d)):(p=this.layout.attributesForSupplementaryViewWithIdentifier(d.reuseIdentifier,{atIndexPath:d.indexPath}),d.targetAttributes=p,l.push(d),this.dataSet.updateSupplementaryView&&this.dataSet.updateSupplementaryView(d,{withIdentifier:d.reuseIdentifier,atIndexPath:p.indexPath}))}}this.dataSet.useOldData(YES);var D=[],r;this._droppedShadows&&(r=BMRectMakeWithNodeFrame(this._container[0]));for(a=0;a<g.length;a++)if(p=g[a],!p.initialAttributes)if(p.itemType===\nBMCollectionViewLayoutAttributesType.Cell){q=this.indexPathForObject(p.indexPath.object);this.dataSet.useOldData(NO);d=this.dataSet.cellForItemAtIndexPath(p.indexPath);if(q)q=this.layout.initialAttributesForMovingCellFromIndexPath(q,{toIndexPath:p.indexPath,withTargetAttributes:p}),p.initialAttributes=q;else{let a;if(this._droppedShadows&&(a=this._droppedShadows.get(p.indexPath.object))){q=p.copy();t=p.frame.copy();t.offset(-this.scrollOffset.x,-this.scrollOffset.y);t.offset(r.left,r.top);var A=BMRectMakeWithNodeFrame(a.node);\nx=t.rectWithTransformToRect(A);A=A.rectWithTransformToRect(t);a.transform=A;t.offset(this.scrollOffset.x,this.scrollOffset.y);t.offset(-r.left,-r.top);t.origin.x+=x.origin.x;t.origin.y+=x.origin.y;q.frame=t;q.style.rotateZ=a.rotation+\"deg\";q.style.scaleX=x.size.width;q.style.scaleY=x.size.height;q.style.opacity=0}else q=this.layout.initialAttributesForAppearingCellAtIndexPath(p.indexPath,{withTargetAttributes:p});p.initialAttributes=q}d.attributes=p.initialAttributes;d.targetAttributes=p;d._manage();\nD.push(d);this.dataSet.useOldData(YES)}else if(p.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView){this.dataSet.useOldData(NO);d=NO;for(t=0;t<m.length;t++)if(p.indexPath.isLooselyEqualToIndexPath(m[t].indexPath,{usingComparator:this.identityComparator})&&p.identifier==m[t].identifier){d=YES;break}q=d?this.layout.initialAttributesForAppearingSupplementaryViewWithIdentifier(p.identifier,{atIndexPath:p.indexPath,withTargetAttributes:p}):this.layout.initialAttributesForMovingSupplementaryViewWithIdentifier(p.identifier,\n{atIndexPath:p.indexPath,withTargetAttributes:p});p.initialAttributes=q;d=this.dataSet.cellForSupplementaryViewWithIdentifier(p.identifier,{atIndexPath:p.indexPath});d.attributes=p.initialAttributes;d.targetAttributes=p;d._manage();D.push(d);this.dataSet.useOldData(YES)}this.dataSet.useOldData(NO);var v=this,z=NO,E=NO;for(a=0;a<n.length;a++)d=n[a],u.intersectsRect(d.targetAttributes.frame)||u.intersectsRect(d.attributes.frame)||w.intersectsRect(d.targetAttributes.frame)||w.intersectsRect(d.attributes.frame)?\n(d.animatable=YES,d.targetAttributes.frame.intersectsRect(u)&&d._manage()):(d.animatable=NO,d.attributes=d.targetAttributes);for(a=0;a<D.length;a++)d=D[a],u.intersectsRect(d.targetAttributes.frame)||u.intersectsRect(d.attributes.frame)||w.intersectsRect(d.targetAttributes.frame)||w.intersectsRect(d.attributes.frame)?d.animatable=YES:(d.animatable=NO,d.attributes=d.targetAttributes);var B={};this.delegate&&this.delegate.collectionViewAnimationOptionsForUpdateAnimation&&(B=this.delegate.collectionViewAnimationOptionsForUpdateAnimation(this));\nr=BMExtend({duration:this.isDragging?200:_BMCollectionViewAnimationDurationDefault,easing:_BMCollectionViewAnimationEasingDefault,queue:NO},B);r.complete=function(){if(!G){G=YES;z||v._contentWrapper.css({width:f.width+\"px\"});E||v._contentWrapper.css({height:f.height+\"px\"});for(var a=0;a<l.length;a++)l[a].animatable=YES,l[a]._unmanage();for(a=0;a<H.length;a++)H[a].animatable=YES,H[a].release(),H[a].attributes.isHidden&&H[a]._unmanage();for(a=0;a<k.length;a++)k[a].animatable=YES,k[a].recycle();v._applyOverflows();\nv._container[0].style.pointerEvents=\"inherit\";v.scrollView&&(v.scrollView.scrollingEnabled=YES);v._collectionEnabled=YES;v.isUpdatingData=NO;v._executeDataCompletionCallbacks();b&&b.completionHandler&&b.completionHandler();B.complete&&B.complete.apply(this,arguments);c()}};var H=[],G=NO;BMAnimateWithBlock(function(){v._droppedShadows&&v._droppedShadows.forEach((a)=>{if(a.transform){BMHook(a.node,{rotateZ:a.rotation});let b=BMAnimationContextGetCurrent().controllerForObject(a,{node:a.node});b.registerBuiltInProperty(\"translateX\",\n{withValue:a.transform.origin.x+\"px\"});b.registerBuiltInProperty(\"translateY\",{withValue:a.transform.origin.y+\"px\"});b.registerBuiltInProperty(\"scaleX\",{withValue:a.transform.size.width});b.registerBuiltInProperty(\"scaleY\",{withValue:a.transform.size.height});b.registerBuiltInProperty(\"rotateZ\",{withValue:\"0deg\"});b.registerBuiltInProperty(\"opacity\",{withValue:0})}else BMHook(a.node,{rotateZ:a.rotation}),a=BMAnimationContextGetCurrent().controllerForObject(a,{node:a.node}),a.registerBuiltInProperty(\"scaleX\",\n{withValue:.33}),a.registerBuiltInProperty(\"scaleY\",{withValue:.33}),a.registerBuiltInProperty(\"opacity\",{withValue:0})});if(e.origin.x!=v._bounds.origin.x||e.origin.y!=v._bounds.origin.y){var a=v._bounds.origin.copy();a.x+=v._offscreenBufferSize;a.y+=v._offscreenBufferSize;var b=BMAnimationContextGetCurrent().controllerForObject(v._container[0],{node:v._container[0]});v.iScroll?b.registerCustomProperty(\"scrollOffset\",{withHandler:(b)=>{v.iScroll._translate(-(h.x+b*(a.x-h.x)),-(h.y+b*(a.y-h.y)))}}):\nb.registerCustomProperty(\"scrollOffset\",{withHandler:(b)=>{v._container[0].scrollTo(h.x+b*(a.x-h.x),h.y+b*(a.y-h.y))}})}for(b=0;b<n.length;b++){var c=n[b];c.animatable&&(c.attributes=c.targetAttributes,c.animatable=NO,H.push(c.retain()))}for(b=0;b<D.length;b++)c=D[b],c.animatable&&(c.attributes=c.targetAttributes,c.animatable=NO,H.push(c.retain()));v._size.width<f.width&&(v._contentWrapper.css({width:f.width+\"px\"}),z=YES);v._size.height<f.height&&(v._contentWrapper.css({height:f.height+\"px\"}),E=YES);\nv._size=f;v.layout.collectionViewDidStartUpdates()},r);this.oldBounds=this.newBounds=void 0;0==D.length&&0==n.length&&r.complete();return this._dataUpdatePromise}},beginUpdatesWithBlock:function(a){},scrollToCellAtIndexPath:function(a,b){(a=this._layout.rectWithScrollingPositionOfCellAtIndexPath(a))&&this.scrollToRect(a,{withVerticalGravity:b&&b.withVerticalGravity||BMCollectionViewScrollingGravityHorizontal.Top,horizontalGravity:b&&b.horizontalGravity||BMCollectionViewScrollingGravityHorizontal.Left,\nanimated:b&&b.animated})},scrollToSupplementaryViewWithIdentifier:function(a,b){(a=this._layout.rectWithScrollingPositionOfSupplementaryViewWithIdentifier(a,{atIndexPath:b.atIndexPath}))&&this.scrollToRect(a,{withVerticalGravity:b.verticalGravity||BMCollectionViewScrollingGravityHorizontal.Top,horizontalGravity:b.horizontalGravity||BMCollectionViewScrollingGravityHorizontal.Left,animated:b.animated})},scrollToRect:function(a,b){var c=BMPointMake();b.withVerticalGravity==BMCollectionViewScrollingGravityVertical.Top?\nc.y=a.origin.y:b.withVerticalGravity==BMCollectionViewScrollingGravityVertical.Center?c.y=a.origin.y+a.size.height/2-this.frame.size.height/2:b.withVerticalGravity==BMCollectionViewScrollingGravityVertical.Bottom&&(c.y=a.origin.y+a.size.height-this.frame.size.height/2);b.withVerticalGravity==BMCollectionViewScrollingGravityHorizontal.Left?c.x=a.origin.x:b.withVerticalGravity==BMCollectionViewScrollingGravityHorizontal.Center?c.x=a.origin.x+a.size.width/2-this.frame.size.width/2:b.withVerticalGravity==\nBMCollectionViewScrollingGravityHorizontal.Right&&(c.x=a.origin.x+a.size.width-this.frame.size.width/2);if(b.animated){var d=this;return BMAnimateWithBlock((a)=>{d.scrollOffset=c},{duration:300})}this.iScroll?this.iScroll.scrollTo(-(c.x|0),-(c.y|0)):(this._container[0].scrollLeft=c.x,this._container[0].scrollTop=c.y)},__UUID:void 0,get _UUID(){return this.__UUID||(this.__UUID=BMUUIDMake())},_isPerformingAnimatedScrolling:NO,_scrollToOffset:function(a){if(_BMAnimationStack.length){var b=_BMAnimationStack[_BMAnimationStack.length-\n1],c=b.subscribers.get(this),d=this;if(c)c.targetOffset=a.copy(),c.startingOffset=d.scrollOffset.copy();else{let e;e=d.iScroll?(a,b,e,k,l)=>{a=c.targetOffset;b=c.startingOffset;l=BMPointMake((a.x-b.x)*l+b.x|0,(a.y-b.y)*l+b.y|0);d.iScroll._translate(-l.x,-l.y);d._handleNewScrollFromEvent({x:l.x,y:l.y})}:(a,b,e,k,l)=>{a=c.targetOffset;b=c.startingOffset;d._container[0].scrollLeft=(a.x-b.x)*l+b.x|0;d._container[0].scrollTop=(a.y-b.y)*l+b.y|0;d._handleNewScrollFromEvent(null)};c={apply:function(a){d._isPerformingAnimatedScrolling&&\nd._stopAnimatedScrolling();d._container[0].style.pointerEvents=\"none\";d._isPerformingAnimatedScrolling=YES;a.targets.push({element:d._container,properties:{tween:1},complete:(a)=>{d._container[0].style.pointerEvents=\"inherit\";d._isPerformingAnimatedScrolling=NO},options:{progress:e,queue:d._UUID}})},targetOffset:a.copy(),startingOffset:d.scrollOffset.copy()};b.subscribers.set(this,c)}}else d=this,d._isPerformingAnimatedScrolling&&d._stopAnimatedScrolling(),this.iScroll?(this.iScroll.scrollTo(-(a.x|\n0),-(a.y|0)),this._handleNewScrollFromEvent({x:a.x,y:a.y})):(this._container[0].scrollLeft=a.x,this._container[0].scrollTop=a.y)},_stopAnimatedScrolling(){this._isPerformingAnimatedScrolling&&(this._container.velocity(\"stop\",self._UUID),this._container[0].style.pointerEvents=\"inherit\",this._isPerformingAnimatedScrolling=NO)},enumerateAllCellsWithBlock:function(a){for(var b=this.allCells.length,c=0;c<b;c++){var d=this.allCells[c];d=a(d,d.itemType,d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView?\nd.reuseIdentifier:void 0,YES);if(d===NO)break}for(var e in this.cellCache)if((b=this.cellCache[e])&&b.length){var f=b.length;for(c=0;c<f&&(d=b[c],d=a(d,d.itemType,void 0,NO),d!==NO);c++);}for(e in this.supplementaryViewCache){b=this.cellCache[e];var h=e;if(b&&b.length)for(f=b.length,c=0;c<f&&(d=b[c],d=a(d,d.itemType,h,NO),d!==NO);c++);}},enumerateRetainedCellsWithBlock:function(a){for(var b=this.allCells.length,c=0;c<b;c++){var d=this.allCells[c];if(a(d,d.itemType,d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView?\nd.reuseIdentifier:void 0)===NO)break}},enumerateVisibleCellsWithBlock:function(a){for(var b=this.retainedCells.length,c=0;c<b;c++){var d=this.retainedCells[c];if(a(d,d.itemType,d.itemType===BMCollectionViewLayoutAttributesType.SupplementaryView?d.reuseIdentifier:void 0)===NO)break}},flatten:function(){this.initialized&&(this.enumerateAllCellsWithBlock(function(a,b,c,d){d?a.attributes._flatten():a.element[0].style.display=\"none\"}),this._collectionEnabled=NO,this._container[0].style.overflow=\"hidden\",\nthis._container[0].style.pointerEvents=\"none\")},release:function(){var a=this;_BMCollectionViews.delete(this);this.initialized&&!this.iScroll&&this.container[0].removeEventListener(\"scroll\",this._boundContainerDidScrollWithEvent,this._highFrequencyScrollingEnabled);this.enumerateAllCellsWithBlock(function(b,c,d,e){a.delegate&&a.delegate.collectionViewWillDestroyCell&&a.delegate.collectionViewWillDestroyCell(a,b);a.delegate&&a.delegate.collectionViewDidDestroyCell&&a.delegate.collectionViewDidDestroyCell(a,\nb)});this.iScroll&&this.iScroll.destroy();this._container.empty();this._layout._collectionView=void 0}};function BMCollectionViewMakeWithContainer(a,b){b=b&&b.customScroll;var c=new BMCollectionView;_BMCollectionViews.set(c,!0);c._container=a;c.layout=new BMCollectionViewFlowLayout;c.cellCache={};c.retainedCells=[];c.allCells=[];c.supplementaryViewCache={};c.attributeCache={};c._selectedIndexPaths=[];c.customScrollRequired=b;c._cellClasses={};c._supplementaryViewClasses={};return c}\nvar _BMWindowAnimationDurationDefault=500,_BMWindowAnimationEasingDefault=\"easeInOutExpo\";function BMWindow(){}\nBMWindow.prototype={delegate:void 0,_frame:void 0,get frame(){return this._frame},set frame(a){this._frame=a.copy();BMCopyProperties(this._window.style,{left:a.origin.x+\"px\",top:a.origin.y+\"px\",width:a.size.width+\"px\",height:a.size.height+\"px\"})},_window:void 0,_toolbar:void 0,get toolbar(){return this._toolbar},_blocker:void 0,_content:void 0,get content(){return this._content},_visible:NO,get isVisible(){return this._visible},_fullScreen:NO,get isFullScreen(){return this._fullScreen},initWithFrame:function(a,\nb){this._blocker=document.createElement(\"div\");this._blocker.className=\"BMWindowBlocker\";BMCopyProperties(this._blocker.style,{opacity:0,display:\"none\",backdropFilter:\"blur(15px)\",webkitBackdropFilter:\"blur(15px)\"});var c=this;this._blocker.addEventListener(\"click\",function(a){a=YES;c.delegate&&c.delegate.windowShouldClose&&(a=c.delegate.windowShouldClose(c));var b=void 0,d=void 0;a&&(c.delegate&&c.delegate.rectForDismissedWindow&&(b=c.delegate.rectForDismissedWindow(c)),c.delegate&&c.delegate.DOMNodeForDismissedWindow&&\n(d=c.delegate.DOMNodeForDismissedWindow(c)),c.dismissAnimated(YES,{toRect:b,toNode:d}))});this._window=document.createElement(\"div\");this._window.className=\"BMWindow\";this.frame=a;BMCopyProperties(this._window.style,{opacity:0,display:\"none\"});this._content=document.createElement(\"div\");this._content.className=\"BMWindowContent\";this._window.appendChild(this._content);(b&&void 0!==b.toolbar?b.toolbar:YES)?(this._toolbar=document.createElement(\"div\"),this._toolbar.className=\"BMWindowToolbar\",this._window.appendChild(this._toolbar)):\nthis._content.className=\"BMWindowContent BMWindowFullContent\";document.body.appendChild(this._blocker);document.body.appendChild(this._window);return this},bringToFrontAnimated:function(a,b){this._visible=YES;a=void 0===a?YES:a;(window.Velocity||$.Velocity)(this._blocker,\"stop\");(window.Velocity||$.Velocity)(this._window,\"stop\");var c=this;c.delegate&&c.delegate.windowWillAppear&&c.delegate.windowWillAppear(c);if(a)if(this._blocker.style.pointerEvents=\"none\",this._window.style.pointerEvents=\"none\",\n(window.Velocity||$.Velocity)(this._blocker,{opacity:1,translateZ:0},{duration:500,easing:\"easeInOutQuint\",display:\"block\",complete:function(){c._blocker.style.pointerEvents=\"\";c._window.style.pointerEvents=\"\";c.delegate&&c.delegate.windowDidAppear&&c.delegate.windowDidAppear(c);b&&b.completionHandler&&b.completionHandler()}}),b&&b.fromRect){a=b.fromRect;var d=c._fullScreen?BMRectMake(0,0,window.innerWidth,window.innerHeight):c.frame;a=d.rectWithTransformToRect(a);(window.Velocity||$.Velocity)(this._window,\n{opacity:1,translateX:[\"0px\",a.origin.x+\"px\"],translateY:[\"0px\",a.origin.y+\"px\"],scaleX:[1,a.size.width],scaleY:[1,a.size.height]},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,display:\"block\"})}else if(b&&b.fromNode){var e=b.fromNode;a=BMRectMakeWithNodeFrame(e);var f=e.cloneNode(YES),h=e.style.display;f.style.position=\"fixed\";f.style.zIndex=2008;BMCopyProperties(f.style,{left:a.origin.x+\"px\",top:a.origin.y+\"px\",width:a.size.width+\"px\",height:a.size.height+\"px\",\nmargin:0});f.style.pointerEvents=\"none\";d=c._fullScreen?BMRectMake(0,0,window.innerWidth,window.innerHeight):c.frame;a=d.rectWithTransformToRect(a);document.body.appendChild(f);e.style.display=\"none\";(window.Velocity||$.Velocity)(this._window,{opacity:1,translateX:[\"0px\",a.origin.x+\"px\"],translateY:[\"0px\",a.origin.y+\"px\"],scaleX:[1,a.size.width],scaleY:[1,a.size.height]},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,display:\"block\"});(window.Velocity||$.Velocity)(f,\n{opacity:[0,1],translateX:-a.origin.x+\"px\",translateY:-a.origin.y+\"px\",scaleX:1/a.size.width,scaleY:1/a.size.height},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,complete:function(){f.remove();var a=NO;c.delegate&&c.delegate.windowShouldKeepNodeHidden&&(a=c.delegate.windowShouldKeepNodeHidden(c,e));a?c._nodeDisplay=h:e.style.display=h}})}else(window.Velocity||$.Velocity)(this._window,{opacity:1,scaleX:[1,1.2],scaleY:[1,1.2],translateZ:0},{duration:_BMWindowAnimationDurationDefault,\neasing:\"easeInOutQuint\",display:\"block\"});else this._blocker.style.opacity=1,this._blocker.style.display=\"block\",this._blocker.style.webkitBackdropFilter=\"blur(15px)\",this._blocker.style.backdropFilter=\"blur(15px)\",this._window.style.opacity=1,BMHook(this._window,{scaleX:1,scaleY:1}),this._window.style.display=\"block\",this._blocker.style.pointerEvents=\"\",this._window.style.pointerEvents=\"\",c.delegate&&c.delegate.windowDidAppear&&c.delegate.windowDidAppear(c),b&&b.completionHandler&&b.completionHandler()},\ndismissAnimated:function(a,b){this._visible=NO;a=void 0===a?YES:a;(window.Velocity||$.Velocity)(this._blocker,\"stop\");(window.Velocity||$.Velocity)(this._window,\"stop\");var c=this;this._blocker.style.pointerEvents=\"none\";this._window.style.pointerEvents=\"none\";c.delegate&&c.delegate.windowWillClose&&c.delegate.windowWillClose(c);if(a)if((window.Velocity||$.Velocity)(this._blocker,{opacity:0,translateZ:0},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,display:\"none\",\ncomplete:function(){c.delegate&&c.delegate.windowDidClose&&c.delegate.windowDidClose(c);b&&b.completionHandler&&b.completionHandler()}}),b&&b.toRect){a=b.toRect;var d=c._fullScreen?BMRectMake(0,0,window.innerWidth,window.innerHeight):c.frame;a=d.rectWithTransformToRect(a);(window.Velocity||$.Velocity)(this._window,{opacity:0,translateX:a.origin.x+\"px\",translateY:a.origin.y+\"px\",scaleX:a.size.width,scaleY:a.size.height},{duration:_BMWindowAnimationDurationDefault,easing:\"easeInOutQuint\",display:\"none\"})}else if(b&&\nb.toNode){var e=b.toNode;\"_nodeDisplay\"in c&&(e.style.display=c._nodeDisplay);a=BMRectMakeWithNodeFrame(e);var f=e.cloneNode(YES),h=\"_nodeDisplay\"in c?c._nodeDisplay:e.style.display;c._nodeDisplay=void 0;f.style.position=\"fixed\";f.style.zIndex=2008;BMCopyProperties(f.style,{left:a.origin.x+\"px\",top:a.origin.y+\"px\",width:a.size.width+\"px\",height:a.size.height+\"px\",margin:0});f.style.pointerEvents=\"none\";d=c._fullScreen?BMRectMake(0,0,window.innerWidth,window.innerHeight):c.frame;a=d.rectWithTransformToRect(a);\nBMHook(f,{translateX:-a.origin.x+\"px\",translateY:-a.origin.y+\"px\",scaleX:1/a.size.width,scaleY:1/a.size.height,opacity:0});document.body.appendChild(f);e.style.display=\"none\";(window.Velocity||$.Velocity)(this._window,{opacity:0,translateX:a.origin.x+\"px\",translateY:a.origin.y+\"px\",scaleX:a.size.width,scaleY:a.size.height},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,display:\"none\"});(window.Velocity||$.Velocity)(f,{opacity:[1,0],translateX:[\"0px\",-a.origin.x+\n\"px\"],translateY:[\"0px\",-a.origin.y+\"px\"],scaleX:[1,1/a.size.width],scaleY:[1,1/a.size.height]},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,complete:function(){e.style.display=h;f.remove()}})}else(window.Velocity||$.Velocity)(this._window,{opacity:0,scaleX:.9,scaleY:.9,translateZ:0},{duration:_BMWindowAnimationDurationDefault,easing:_BMWindowAnimationEasingDefault,display:\"none\"});else this._blocker.style.opacity=0,this._blocker.style.display=\"none\",this._window.style.opacity=\n0,this._window.style.display=\"none\",c.delegate&&c.delegate.windowDidClose&&c.delegate.windowDidClose(c),b&&b.completionHandler&&b.completionHandler()},enterFullScreenAnimated:function(a,b){this._fullScreen=YES;a=void 0===a?YES:a;(window.Velocity||$.Velocity)(this._blocker,\"stop\");(window.Velocity||$.Velocity)(this._window,\"stop\");var c=this;a?(window.Velocity||$.Velocity)(this._window,{left:\"0px\",top:\"0px\",width:window.innerWidth+\"px\",height:window.innerHeight+\"px\"},{duration:300,easing:\"easeInOutQuart\",\ncomplete:function(){c.delegate&&c.delegate.windowDidEnterFullScreen&&c.delegate.windowDidEnterFullScreen(c);b&&b.completionHandler&&b.completionHandler();c._window.classList.add(\"BMFullScreenWindow\")}}):(c._window.classList.add(\"BMFullScreenWindow\"),c.delegate&&c.delegate.windowDidEnterFullScreen&&c.delegate.windowDidEnterFullScreen(c),b&&b.completionHandler&&b.completionHandler())},exitFullScreenAnimated:function(a,b){this._fullScreen=NO;a=void 0===a?YES:a;(window.Velocity||$.Velocity)(this._blocker,\n\"stop\");(window.Velocity||$.Velocity)(this._window,\"stop\");var c=this;a?(c._window.classList.remove(\"BMFullScreenWindow\"),a=c.frame,BMCopyProperties(c._window.style,{left:\"0px\",top:\"0px\",width:window.innerWidth+\"px\",height:window.innerHeight+\"px\"}),(window.Velocity||$.Velocity)(this._window,{left:a.origin.x+\"px\",top:a.origin.y+\"px\",width:a.size.width+\"px\",height:a.size.height+\"px\"},{duration:300,easing:\"easeInOutQuart\",complete:function(){c.delegate&&c.delegate.windowDidEnterFullScreen&&c.delegate.windowDidEnterFullScreen(c);\nb&&b.completionHandler&&b.completionHandler();c.frame=c.frame}})):(c._window.classList.remove(\"BMFullScreenWindow\"),c.frame=c.frame,c.delegate&&c.delegate.windowDidEnterFullScreen&&c.delegate.windowDidEnterFullScreen(c),b&&b.completionHandler&&b.completionHandler())},release:function(){this._blocker.remove();this._window.remove()}};function BMWindowMakeWithFrame(a){return(new BMWindow).initWithFrame(a)}var BMCodeEditorLanguage=Object.freeze({Javascript:\"javascript\",CSS:\"css\",JSON:\"json\",Typescript:\"typescript\"});\nfunction BMCodeEditor(){}\nBMCodeEditor.prototype={_container:void 0,get container(){return this._container},delegate:void 0,initWithContainer:function(a){this._container=a;return this},get code(){},set code(a){},get requiresTranspilation(){return NO},async transpiledCode(){return this.code},get cursorPosition(){},set cursorPosition(a){},supportsExtensibleAutocomplete:NO,setBuiltinES6Library:function(a,b){},setImports(a){},addExternalLibraryNamed(a,b){},removeExternalLibraryNamed(a){},hasExternalLibraryNamed(a){return NO},get scope(){},\nset scope(a){},insertText:function(a){},acquireFocus:function(){},resignFocus:function(){},resized:function(){},release:function(){}};function BMCodeMirrorCodeEditor(){}function BMCodeMirrorCodeEditorMakeWithContainer(a,b){return(new BMCodeMirrorCodeEditor).initWithContainer(a,{code:b&&b.code,language:b&&b.language})}\nBMExtend(BMCodeMirrorCodeEditor.prototype,BMCodeEditor.prototype,{_codeMirror:void 0,initWithContainer:function(a,b){BMCodeEditor.prototype.initWithContainer.call(this,a);this._codeMirror=CodeMirror(this.container,{mode:b&&b.language||BMCodeEditorLanguage.Javascript,theme:\"eclipse\",lineNumbers:YES,firstLineNumber:0,matchBrackets:YES,extraKeys:{\"Ctrl-Q\":function(a){cm.foldCode(cm.getCursor())},\"Ctrl-S\":function(a){}},foldGutter:!0,gutters:[\"CodeMirror-lint-markers\",\"CodeMirror-foldgutter\"],indentUnit:4});\nthis.container.querySelectorAll(\".CodeMirror\")[0].style.height=\"100%\";var c=this;this._codeMirror.on(\"change\",function(){c.delegate&&c.delegate.codeEditorContentsDidChange&&c.delegate.codeEditorContentsDidChange(c)});a=b&&b.code;if(!a)return this;this.code=a;return this},get code(){return this._codeMirror.getValue()},set code(a){this._codeMirror.setValue(a)},get cursorPosition(){var a=this._codeMirror.getCursor();return BMPointMake(a.ch,a.line)},set cursorPosition(a){this._codeMirror.setCursor({ch:a.x,\nline:a.y});this._codeMirror.scrollIntoView({ch:0,line:a.y})},insertText:function(a){var b=this._codeMirror.getDoc(),c=this._codeMirror.getCursor();b.replaceRange(a,c)},acquireFocus:function(){this._codeMirror.focus()},resignFocus:function(){},resized:function(){this._codeMirror.refresh()}});function BMMonacoCodeEditor(){}var _BMMonacoCodeEditorThemesCreated=NO;\nBMMonacoCodeEditor.createThemes=function(){_BMMonacoCodeEditorThemesCreated||(_BMMonacoCodeEditorThemesCreated=YES,monaco.editor.defineTheme(\"BMMonacoCodeEditorTheme\",{base:\"vs\",inherit:YES,rules:[{token:\"comment\",foreground:\"CCCCCC\"},{token:\"string\",foreground:\"BC670F\",background:\"FDFBF3\"},{token:\"keyword\",foreground:\"6700B9\"},{token:\"identifier\",foreground:\"434343\"},{token:\"delimiter\",foreground:\"434343\"},{token:\"number\",foreground:\"7552c1\",background:\"E7E6FD\"},{token:\"tag\",foreground:\"434343\"},\n{token:\"attribute.name\",foreground:\"D4430D\"},{token:\"attribute.value\",foreground:\"43A202\"},{token:\"attribute.value.number\",foreground:\"5AA201\",background:\"F6FAEB\"},{token:\"attribute.value.unit\",foreground:\"5AA201\",background:\"F6FAEB\"},{token:\"attribute.value.hex\",foreground:\"43A202\"}]}))};function BMMonacoCodeEditorMakeWithContainer(a,b){return(new BMMonacoCodeEditor).initWithContainer(a,{code:b&&b.code,language:b&&b.language})}\nBMExtend(BMMonacoCodeEditor.prototype,BMCodeEditor.prototype,{_monaco:void 0,_autocompleteLibraries:void 0,_rootES6Library:void 0,_rootjQueryLibrary:void 0,_importsLibrary:void 0,_externalLibraries:void 0,_language:void 0,initWithContainer:function(a,b){BMCodeEditor.prototype.initWithContainer.call(this,a);BMMonacoCodeEditor.createThemes();var c={folding:YES,fontLigatures:NO,formatOnPaste:YES,mouseWheelZoom:YES,scrollBeyondLastLine:YES,value:b&&b.code,language:b&&b.language||BMCodeEditorLanguage.Javascript,\nfontFamily:\"Menlo, Meslo LG S, Fira Code, Monaco, monospace\",theme:\"BMMonacoCodeEditorTheme\",disableLayerHinting:YES};this._language=b.language||BMCodeEditorLanguage.Javascript;monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ESNext,allowNonTsExtensions:YES,experimentalDecorators:YES,strict:YES,inlineSourceMap:YES,module:monaco.languages.typescript.ModuleKind.CommonJS});monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ESNext,\nallowNonTsExtensions:YES,experimentalDecorators:YES,strict:YES,inlineSourceMap:YES,inlineSources:YES});this._monaco=monaco.editor.create(a,c);this._monaco.addAction({id:\"preventHome\",label:\"PreventHome\",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_DOWN],keybindingContext:null,contextMenuGroupId:\"service\",contextMenuOrder:1.5,run:function(a){}});this._monaco.addAction({id:\"preventHome2\",label:\"PreventHome2\",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_UP],keybindingContext:null,contextMenuGroupId:\"service\",\ncontextMenuOrder:1.5,run:function(a){}});var d=this;this._monaco.onDidChangeModelContent(function(a){d.delegate&&d.delegate.codeEditorContentsDidChange&&d.delegate.codeEditorContentsDidChange(d)});this._externalLibraries={};return this},setBuiltinES6Library:function(a,b){this._rootES6Library&&this._rootES6Library.dispose();this._rootjQueryLibrary&&this._rootjQueryLibrary.dispose();this._autocompleteLibraries&&this._autocompleteLibraries.dispose();this._language===BMCodeEditorLanguage.Javascript?(this._rootES6Library=\nmonaco.languages.typescript.javascriptDefaults.addExtraLib(a,\"ES6.d.ts\"),this._rootjQueryLibrary=monaco.languages.typescript.javascriptDefaults.addExtraLib(b.jQueryLibrary,\"jQuery.d.ts\"),this._autocompleteLibraries=b.additionalLibraries?monaco.languages.typescript.javascriptDefaults.addExtraLib(b.additionalLibraries.join(\"\\n\"),\"additional.d.ts\"):void 0):(this._rootES6Library=monaco.languages.typescript.typescriptDefaults.addExtraLib(a,\"ES6.d.ts\"),this._rootjQueryLibrary=monaco.languages.typescript.typescriptDefaults.addExtraLib(b.jQueryLibrary,\n\"jQuery.d.ts\"),this._autocompleteLibraries=b.additionalLibraries?monaco.languages.typescript.typescriptDefaults.addExtraLib(b.additionalLibraries.join(\"\\n\"),\"additional.d.ts\"):void 0)},setImports(a){this._importsLibrary&&this._importsLibrary.dispose();this._importsLibrary=this._language===BMCodeEditorLanguage.Javascript?monaco.languages.typescript.javascriptDefaults.addExtraLib(a,\"node_modules/@types/imports/index.d.ts\"):monaco.languages.typescript.typescriptDefaults.addExtraLib(a,\"node_modules/@types/imports/index.d.ts\")},\naddExternalLibraryNamed(a,b){this._externalLibraries[a]&&this._externalLibraries[a].dispose();this._externalLibraries[a]=this._language===BMCodeEditorLanguage.Javascript?monaco.languages.typescript.javascriptDefaults.addExtraLib(b.code,\"node_modules/@types/\"+a):monaco.languages.typescript.typescriptDefaults.addExtraLib(b.code,\"node_modules/@types/\"+a)},removeExternalLibraryNamed(a){this._externalLibraries[a]&&(this._externalLibraries[a].dispose(),delete this._externalLibraries[a])},hasExternalLibraryNamed(a){return a in\nthis._externalLibraries},get code(){return this._monaco.getValue()},set code(a){this._monaco.setValue(a)},get requiresTranspilation(){return this._language===BMCodeEditorLanguage.Typescript},transpiledCode(){return new Promise((a,b)=>{monaco.languages.typescript.getLanguageWorker(\"typescript\").then((b)=>{this._monaco.getModel()&&b(this._monaco.getModel().uri).then((b)=>{this._monaco.getModel()&&b.getEmitOutput(this._monaco.getModel().uri.toString()).then(function(b){a(b.outputFiles[0].text)})})})})},\nget cursorPosition(){var a=this._monaco.getSelection();return BMPointMake(a.startColumn,a.startLineNumber)},set cursorPosition(a){var b=new monaco.Range(a.y,a.x,a.y,a.x);this._monaco.setSelection(b);this._monaco.revealPositionInCenter({lineNumber:a.y,column:a.x})},insertText:function(a){this._monaco.executeEdits(\"insertSnippet\",[{range:this._monaco.getSelection(),text:a,forceMoveMarkers:!0}])},acquireFocus:function(){this._monaco.focus()},resignFocus:function(){},resized:function(){this._monaco.layout()},\nget supportsExtensibleAutocomplete(){return YES},get scope(){return this._scope},set scope(a){this._autocompleteLibrary&&this._autocompleteLibrary.dispose();this._scope=a;this._autocompleteLibrary=this._language===BMCodeEditorLanguage.Javascript?monaco.languages.typescript.javascriptDefaults.addExtraLib(a,\"BMMonacoCodeEditor.d.ts\"):monaco.languages.typescript.typescriptDefaults.addExtraLib(a,\"BMMonacoCodeEditor.d.ts\")},release:function(){this._monaco.dispose();this._autocompleteLibrary&&this._autocompleteLibrary.dispose();\nthis._autocompleteLibraries&&this._autocompleteLibraries.dispose();this._rootES6Library&&this._rootES6Library.dispose();this._rootjQueryLibrary&&this._rootjQueryLibrary.dispose();this._importsLibrary&&this._importsLibrary.dispose();Object.keys(this._externalLibraries).forEach((a)=>this._externalLibraries[a].dispose())}});\n(function(a,b){\"function\"===typeof define&&define.amd?define([],function(){return a.kiwi=b()}):\"object\"===typeof exports?module.exports=b():a.kiwi=b()})(this,function(){var a;(function(a){var b=function(){function a(a,b){\"undefined\"===typeof b&&(b=0);this._array=a;this._index=Math.max(0,Math.min(b,a.length))}a.prototype.__next__=function(){return this._array[this._index++]};a.prototype.__iter__=function(){return this};return a}();a.ArrayIterator=b;var c=function(){function a(a,b){\"undefined\"===typeof b&&\n(b=a.length);this._array=a;this._index=Math.max(0,Math.min(b,a.length))}a.prototype.__next__=function(){return this._array[--this._index]};a.prototype.__iter__=function(){return this};return a}();a.ReverseArrayIterator=c;a.iter=function(a){return a instanceof Array?new b(a):a.__iter__()};a.reversed=function(a){return a instanceof Array?new c(a):a.__reversed__()};a.next=function(a){return a.__next__()};a.forEach=function(a,b){if(a instanceof Array)for(var c=0,d=a.length;c<d&&!1!==b(a[c]);++c);else for(c=\na.__iter__();void 0!==(a=c.__next__())&&!1!==b(a););}})(a||(a={}));(function(a){var b=function(){function a(a,b){this.first=a;this.second=b}a.prototype.copy=function(){return new a(this.first,this.second)};return a}();a.Pair=b})(a||(a={}));(function(a){function b(a,b,c){for(var d=0,e=a.length,f,h;0<e;)f=e>>1,h=d+f,0>c(a[h],b)?(d=h+1,e-=f+1):e=f;return d}a.lowerBound=b;a.binarySearch=function(a,c,d){var e=b(a,c,d);return e===a.length||0!==d(a[e],c)?-1:e};a.binaryFind=function(a,c,d){var e=b(a,c,d);\nif(e!==a.length&&(a=a[e],0===d(a,c)))return a}})(a||(a={}));(function(a){var b=function(){function b(){this._array=[]}b.prototype.size=function(){return this._array.length};b.prototype.empty=function(){return 0===this._array.length};b.prototype.itemAt=function(a){return this._array[a]};b.prototype.takeAt=function(a){return this._array.splice(a,1)[0]};b.prototype.clear=function(){this._array=[]};b.prototype.swap=function(a){var b=this._array;this._array=a._array;a._array=b};b.prototype.__iter__=function(){return a.iter(this._array)};\nb.prototype.__reversed__=function(){return a.reversed(this._array)};return b}();a.ArrayBase=b})(a||(a={}));var b=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c};(function(a){function c(a){return function(b,c){return a(b.first,c)}}function d(a,b,c){for(var d=0,e=0,l=a.length,k=b.length,f=[];d<l&&e<k;){var h=a[d],g=b[e],p=c(h.first,g.first);0>p?(f.push(h.copy()),++d):(0<p?f.push(g.copy()):(f.push(g.copy()),\n++d),++e)}for(;d<l;)f.push(a[d].copy()),++d;for(;e<k;)f.push(b[e].copy()),++e;return f}var h=function(e){function k(a){e.call(this);this._compare=a;this._wrapped=c(a)}b(k,e);k.prototype.comparitor=function(){return this._compare};k.prototype.indexOf=function(b){return a.binarySearch(this._array,b,this._wrapped)};k.prototype.contains=function(b){return 0<=a.binarySearch(this._array,b,this._wrapped)};k.prototype.find=function(b){return a.binaryFind(this._array,b,this._wrapped)};k.prototype.setDefault=\nfunction(b,c){var d=this._array,e=a.lowerBound(d,b,this._wrapped);if(e===d.length)return b=new a.Pair(b,c()),d.push(b),b;var l=d[e];return 0!==this._compare(l.first,b)?(b=new a.Pair(b,c()),d.splice(e,0,b),b):l};k.prototype.insert=function(b,c){var d=this._array,e=a.lowerBound(d,b,this._wrapped);if(e===d.length)return b=new a.Pair(b,c),d.push(b),b;var l=d[e];if(0!==this._compare(l.first,b))return b=new a.Pair(b,c),d.splice(e,0,b),b;l.second=c;return l};k.prototype.update=function(b){var c=this;b instanceof\nk?this._array=d(this._array,b._array,this._compare):a.forEach(b,function(a){c.insert(a.first,a.second)})};k.prototype.erase=function(b){var c=this._array;b=a.binarySearch(c,b,this._wrapped);if(!(0>b))return c.splice(b,1)[0]};k.prototype.copy=function(){for(var a=new k(this._compare),b=a._array,c=this._array,d=0,e=c.length;d<e;++d)b.push(c[d].copy());return a};return k}(a.ArrayBase);a.AssociativeArray=h})(a||(a={}));var c;(function(a){(function(a){a[a.Le=0]=\"Le\";a[a.Ge=1]=\"Ge\";a[a.Eq=2]=\"Eq\"})(a.Operator||\n(a.Operator={}));var b=function(){function b(b,d,e,f){void 0===f&&(f=a.Strength.required);this._id=c++;this._operator=d;this._strength=a.Strength.clip(f);this._expression=void 0===e&&b instanceof a.Expression?b:b.minus(e)}b.Compare=function(a,b){return a.id()-b.id()};b.prototype.id=function(){return this._id};b.prototype.expression=function(){return this._expression};b.prototype.op=function(){return this._operator};b.prototype.strength=function(){return this._strength};b.prototype.toString=function(){return this._expression.toString()+\n\" \"+[\"<=\",\">=\",\"=\"][this._operator]+\" 0 (\"+this._strength.toString()+\")\"};return b}();a.Constraint=b;var c=0})(c||(c={}));(function(b){b.createMap=function(b){return new a.AssociativeArray(b)}})(c||(c={}));(function(a){var b=function(){function b(a){void 0===a&&(a=\"\");this._value=0;this._context=null;this._id=c++;this._name=a}b.Compare=function(a,b){return a.id()-b.id()};b.prototype.id=function(){return this._id};b.prototype.name=function(){return this._name};b.prototype.setName=function(a){this._name=\na};b.prototype.context=function(){return this._context};b.prototype.setContext=function(a){this._context=a};b.prototype.value=function(){return this._value};b.prototype.setValue=function(a){this._value=a};b.prototype.plus=function(b){return new a.Expression(this,b)};b.prototype.minus=function(b){return new a.Expression(this,\"number\"===typeof b?-b:[-1,b])};b.prototype.multiply=function(b){return new a.Expression([b,this])};b.prototype.divide=function(b){return new a.Expression([1/b,this])};b.prototype.toJSON=\nfunction(){return{name:this._name,value:this._value}};b.prototype.toString=function(){return this._context+\"[\"+this._name+\":\"+this._value+\"]\"};return b}();a.Variable=b;var c=0})(c||(c={}));(function(a){function b(b){for(var d=0,e=function(){return 0},l=a.createMap(a.Variable.Compare),f=0,h=b.length;f<h;++f){var n=b[f];if(\"number\"===typeof n)d+=n;else if(n instanceof a.Variable)l.setDefault(n,e).second+=1;else if(n instanceof c){d+=n.constant();n=n.terms();for(var u=0,w=n.size();u<w;u++){var x=n.itemAt(u);\nl.setDefault(x.first,e).second+=x.second}}else if(n instanceof Array){if(2!==n.length)throw Error(\"array must have length 2\");var t=n[0];n=n[1];if(\"number\"!==typeof t)throw Error(\"array item 0 must be a number\");if(n instanceof a.Variable)l.setDefault(n,e).second+=t;else if(n instanceof c)for(d+=n.constant()*t,n=n.terms(),u=0,w=n.size();u<w;u++)x=n.itemAt(u),l.setDefault(x.first,e).second+=x.second*t;else throw Error(\"array item 1 must be a variable or expression\");}else throw Error(\"invalid Expression argument: \"+\nn);}return{terms:l,constant:d}}var c=function(){function a(){var a=b(arguments);this._terms=a.terms;this._constant=a.constant}a.prototype.terms=function(){return this._terms};a.prototype.constant=function(){return this._constant};a.prototype.value=function(){for(var a=this._constant,b=0,c=this._terms.size();b<c;b++){var d=this._terms.itemAt(b);a+=d.first.value()*d.second}return a};a.prototype.plus=function(b){return new a(this,b)};a.prototype.minus=function(b){return new a(this,\"number\"===typeof b?\n-b:[-1,b])};a.prototype.multiply=function(b){return new a([b,this])};a.prototype.divide=function(b){return new a([1/b,this])};a.prototype.isConstant=function(){return 0==this._terms.size()};a.prototype.toString=function(){var a=this._terms._array.map(function(a,b){return a.second+\"*\"+a.first.toString()}).join(\" + \");this.isConstant()||0===this._constant||(a+=\" + \");return a+=this._constant};return a}();a.Expression=c})(c||(c={}));(function(a){(function(a){function b(a,b,c,d){void 0===d&&(d=1);a=1E6*\nMath.max(0,Math.min(1E3,a*d));a+=1E3*Math.max(0,Math.min(1E3,b*d));return a+=Math.max(0,Math.min(1E3,c*d))}a.create=b;a.required=b(1E3,1E3,1E3);a.strong=b(1,0,0);a.medium=b(0,1,0);a.weak=b(0,0,1);a.clip=function(b){return Math.max(0,Math.min(a.required,b))}})(a.Strength||(a.Strength={}))})(c||(c={}));(function(a){function b(a){return 0>a?1E-8>-a:1E-8>a}var c=function(){function c(){this._cnMap=a.createMap(a.Constraint.Compare);this._rowMap=a.createMap(g.Compare);this._varMap=a.createMap(a.Variable.Compare);\nthis._editMap=a.createMap(a.Variable.Compare);this._infeasibleRows=[];this._objective=new l;this._artificial=null;this._idTick=0}c.prototype.createConstraint=function(b,c,d,e){void 0===e&&(e=a.Strength.required);b=new a.Constraint(b,c,d,e);this.addConstraint(b);return b};c.prototype.addConstraint=function(a){if(void 0!==this._cnMap.find(a))throw Error(\"duplicate constraint\");var c=this._createRow(a),e=c.row;c=c.tag;var l=this._chooseSubject(e,c);if(l.type()===d.Invalid&&e.allDummies())if(b(e.constant()))l=\nc.marker;else throw Error(\"unsatisfiable constraint\");if(l.type()===d.Invalid){if(!this._addWithArtificialVariable(e))throw Error(\"unsatisfiable constraint\");}else e.solveFor(l),this._substitute(l,e),this._rowMap.insert(l,e);this._cnMap.insert(a,c);this._optimize(this._objective)};c.prototype.removeConstraint=function(a){var b=this._cnMap.erase(a);if(void 0===b)throw Error(\"unknown constraint\");this._removeConstraintEffects(a,b.second);a=b.second.marker;b=this._rowMap.erase(a);if(void 0===b){var c=\nthis._getMarkerLeavingSymbol(a);if(c.type()===d.Invalid)throw Error(\"failed to find leaving row\");b=this._rowMap.erase(c);b.second.solveForEx(c,a);this._substitute(a,b.second)}this._optimize(this._objective)};c.prototype.hasConstraint=function(a){return this._cnMap.contains(a)};c.prototype.addEditVariable=function(b,c){if(void 0!==this._editMap.find(b))throw Error(\"duplicate edit variable\");c=a.Strength.clip(c);if(c===a.Strength.required)throw Error(\"bad required strength\");var d=new a.Expression(b);\nc=new a.Constraint(d,a.Operator.Eq,void 0,c);this.addConstraint(c);c={tag:this._cnMap.find(c).second,constraint:c,constant:0};this._editMap.insert(b,c)};c.prototype.removeEditVariable=function(a){a=this._editMap.erase(a);if(void 0===a)throw Error(\"unknown edit variable\");this.removeConstraint(a.second.constraint)};c.prototype.hasEditVariable=function(a){return this._editMap.contains(a)};c.prototype.suggestValue=function(a,b){var c=this._editMap.find(a);if(void 0===c)throw Error(\"unknown edit variable\");\na=this._rowMap;var e=c.second;c=b-e.constant;e.constant=b;b=e.tag.marker;var l=a.find(b);if(void 0!==l)0>l.second.add(-c)&&this._infeasibleRows.push(b);else if(e=e.tag.other,l=a.find(e),void 0!==l)0>l.second.add(c)&&this._infeasibleRows.push(e);else{e=0;for(var f=a.size();e<f;++e){l=a.itemAt(e);var k=l.second,h=k.coefficientFor(b);0!==h&&0>k.add(c*h)&&l.first.type()!==d.External&&this._infeasibleRows.push(l.first)}}this._dualOptimize()};c.prototype.updateVariables=function(){for(var a=this._varMap,\nb=this._rowMap,c=0,d=a.size();c<d;++c){var e=a.itemAt(c),l=b.find(e.second);void 0!==l?e.first.setValue(l.second.constant()):e.first.setValue(0)}};c.prototype._getVarSymbol=function(a){var b=this;return this._varMap.setDefault(a,function(){return b._makeSymbol(d.External)}).second};c.prototype._createRow=function(c){var e=c.expression(),f=new l(e.constant());e=e.terms();for(var h=0,m=e.size();h<m;++h){var q=e.itemAt(h);if(!b(q.second)){var g=this._getVarSymbol(q.first),D=this._rowMap.find(g);void 0!==\nD?f.insertRow(D.second,q.second):f.insertSymbol(g,q.second)}}h=this._objective;m=c.strength();e={marker:k,other:k};switch(c.op()){case a.Operator.Le:case a.Operator.Ge:c=c.op()===a.Operator.Le?1:-1;q=this._makeSymbol(d.Slack);e.marker=q;f.insertSymbol(q,c);m<a.Strength.required&&(q=this._makeSymbol(d.Error),e.other=q,f.insertSymbol(q,-c),h.insertSymbol(q,m));break;case a.Operator.Eq:m<a.Strength.required?(c=this._makeSymbol(d.Error),q=this._makeSymbol(d.Error),e.marker=c,e.other=q,f.insertSymbol(c,\n-1),f.insertSymbol(q,1),h.insertSymbol(c,m),h.insertSymbol(q,m)):(c=this._makeSymbol(d.Dummy),e.marker=c,f.insertSymbol(c))}0>f.constant()&&f.reverseSign();return{row:f,tag:e}};c.prototype._chooseSubject=function(a,b){for(var c=a.cells(),e=0,l=c.size();e<l;++e){var f=c.itemAt(e);if(f.first.type()===d.External)return f.first}c=b.marker.type();if((c===d.Slack||c===d.Error)&&0>a.coefficientFor(b.marker))return b.marker;c=b.other.type();return(c===d.Slack||c===d.Error)&&0>a.coefficientFor(b.other)?b.other:\nk};c.prototype._addWithArtificialVariable=function(a){var c=this._makeSymbol(d.Slack);this._rowMap.insert(c,a.copy());this._artificial=a.copy();this._optimize(this._artificial);a=b(this._artificial.constant());this._artificial=null;var e=this._rowMap.erase(c);if(void 0!==e){e=e.second;if(e.isConstant())return a;var l=this._anyPivotableSymbol(e);if(l.type()===d.Invalid)return!1;e.solveForEx(c,l);this._substitute(l,e);this._rowMap.insert(l,e)}e=this._rowMap;l=0;for(var f=e.size();l<f;++l)e.itemAt(l).second.removeSymbol(c);\nthis._objective.removeSymbol(c);return a};c.prototype._substitute=function(a,b){for(var c=this._rowMap,e=0,l=c.size();e<l;++e){var f=c.itemAt(e);f.second.substitute(a,b);0>f.second.constant()&&f.first.type()!==d.External&&this._infeasibleRows.push(f.first)}this._objective.substitute(a,b);this._artificial&&this._artificial.substitute(a,b)};c.prototype._optimize=function(a){for(;;){var b=this._getEnteringSymbol(a);if(b.type()===d.Invalid)break;var c=this._getLeavingSymbol(b);if(c.type()===d.Invalid)throw Error(\"the objective is unbounded\");\nvar e=this._rowMap.erase(c).second;e.solveForEx(c,b);this._substitute(b,e);this._rowMap.insert(b,e)}};c.prototype._dualOptimize=function(){for(var a=this._rowMap,b=this._infeasibleRows;0!==b.length;){var c=b.pop(),e=a.find(c);if(void 0!==e&&0>e.second.constant()){var l=this._getDualEnteringSymbol(e.second);if(l.type()===d.Invalid)throw Error(\"dual optimize failed\");e=e.second;a.erase(c);e.solveForEx(c,l);this._substitute(l,e);a.insert(l,e)}}};c.prototype._getEnteringSymbol=function(a){a=a.cells();\nfor(var b=0,c=a.size();b<c;++b){var e=a.itemAt(b),l=e.first;if(0>e.second&&l.type()!==d.Dummy)return l}return k};c.prototype._getDualEnteringSymbol=function(a){var b=Number.MAX_VALUE,c=k;a=a.cells();for(var e=0,l=a.size();e<l;++e){var f=a.itemAt(e),h=f.first;f=f.second;0<f&&h.type()!==d.Dummy&&(f=this._objective.coefficientFor(h)/f,f<b&&(b=f,c=h))}return c};c.prototype._getLeavingSymbol=function(a){for(var b=Number.MAX_VALUE,c=k,e=this._rowMap,l=0,f=e.size();l<f;++l){var h=e.itemAt(l),m=h.first;if(m.type()!==\nd.External){h=h.second;var g=h.coefficientFor(a);0>g&&(h=-h.constant()/g,h<b&&(b=h,c=m))}}return c};c.prototype._getMarkerLeavingSymbol=function(a){for(var b=Number.MAX_VALUE,c=b,e=k,l=e,f=e,h=e,m=this._rowMap,g=0,q=m.size();g<q;++g){var v=m.itemAt(g),z=v.second,E=z.coefficientFor(a);0!==E&&(v=v.first,v.type()===d.External?h=v:0>E?(z=-z.constant()/E,z<c&&(c=z,l=v)):(z=z.constant()/E,z<b&&(b=z,f=v)))}return l!==e?l:f!==e?f:h};c.prototype._removeConstraintEffects=function(a,b){b.marker.type()===d.Error&&\nthis._removeMarkerEffects(b.marker,a.strength());b.other.type()===d.Error&&this._removeMarkerEffects(b.other,a.strength())};c.prototype._removeMarkerEffects=function(a,b){var c=this._rowMap.find(a);void 0!==c?this._objective.insertRow(c.second,-b):this._objective.insertSymbol(a,-b)};c.prototype._anyPivotableSymbol=function(a){a=a.cells();for(var b=0,c=a.size();b<c;++b){var e=a.itemAt(b),l=e.first.type();if(l===d.Slack||l===d.Error)return e.first}return k};c.prototype._makeSymbol=function(a){return new g(a,\nthis._idTick++)};return c}();a.Solver=c;var d;(function(a){a[a.Invalid=0]=\"Invalid\";a[a.External=1]=\"External\";a[a.Slack=2]=\"Slack\";a[a.Error=3]=\"Error\";a[a.Dummy=4]=\"Dummy\"})(d||(d={}));var g=function(){function a(a,b){this._id=b;this._type=a}a.Compare=function(a,b){return a.id()-b.id()};a.prototype.id=function(){return this._id};a.prototype.type=function(){return this._type};return a}(),k=new g(d.Invalid,-1),l=function(){function c(b){void 0===b&&(b=0);this._cellMap=a.createMap(g.Compare);this._constant=\nb}c.prototype.cells=function(){return this._cellMap};c.prototype.constant=function(){return this._constant};c.prototype.isConstant=function(){return this._cellMap.empty()};c.prototype.allDummies=function(){for(var a=this._cellMap,b=0,c=a.size();b<c;++b)if(a.itemAt(b).first.type()!==d.Dummy)return!1;return!0};c.prototype.copy=function(){var a=new c(this._constant);a._cellMap=this._cellMap.copy();return a};c.prototype.add=function(a){return this._constant+=a};c.prototype.insertSymbol=function(a,c){void 0===\nc&&(c=1);var d=this._cellMap.setDefault(a,function(){return 0});b(d.second+=c)&&this._cellMap.erase(a)};c.prototype.insertRow=function(a,b){void 0===b&&(b=1);this._constant+=a._constant*b;a=a._cellMap;for(var c=0,d=a.size();c<d;++c){var e=a.itemAt(c);this.insertSymbol(e.first,e.second*b)}};c.prototype.removeSymbol=function(a){this._cellMap.erase(a)};c.prototype.reverseSign=function(){this._constant=-this._constant;for(var a=this._cellMap,b=0,c=a.size();b<c;++b){var d=a.itemAt(b);d.second=-d.second}};\nc.prototype.solveFor=function(a){var b=this._cellMap;a=-1/b.erase(a).second;this._constant*=a;for(var c=0,d=b.size();c<d;++c)b.itemAt(c).second*=a};c.prototype.solveForEx=function(a,b){this.insertSymbol(a,-1);this.solveFor(b)};c.prototype.coefficientFor=function(a){a=this._cellMap.find(a);return void 0!==a?a.second:0};c.prototype.substitute=function(a,b){a=this._cellMap.erase(a);void 0!==a&&this.insertRow(b,a.second)};return c}()})(c||(c={}));return c});const BMViewDebug=NO;function BMView(){}\n(function(){var a=new WeakMap;BMView.viewForNode=function(b){var c=a.get(b);c||(c=Object.create(this.prototype).initWithDOMNode(b));return c};BMView.view=function(){var a=document.createElement(\"div\");return Object.create(this.prototype).initWithDOMNode(a)};BMView.prototype.release=function(){a.delete(this._node);this._superview&&this._superview._detachSubview(this);this._node=void 0};BMView.prototype.initWithDOMNode=function(b){this._node=b;this._constraints=[];this._subviews=[];var c;if(c=a.get(b)){if(c!=\nthis)throw Error(\"There is already a view associated with the given node.\");}else a.set(b,this);this._variables={[BMLayoutAttribute.Left]:new kiwi.Variable(this.node.id+\".\"+BMLayoutAttribute.Left),[BMLayoutAttribute.Width]:new kiwi.Variable(this.node.id+\".\"+BMLayoutAttribute.Width),[BMLayoutAttribute.Top]:new kiwi.Variable(this.node.id+\".\"+BMLayoutAttribute.Top),[BMLayoutAttribute.Height]:new kiwi.Variable(this.node.id+\".\"+BMLayoutAttribute.Height)};return this}})();\nBMView.prototype=BMExtend(BMView.prototype,{_node:void 0,get node(){return this._node},get contentNode(){return this._node},debuggingName:\"\",_layoutEditor:void 0,get layoutEditor(){return this._layoutEditor},set layoutEditor(a){this._layoutEditor=a},_frame:void 0,get frame(){return this._frame||BMRectMakeWithNodeFrame(this._node)},set frame(a){this._frame||(this._node.style.position=\"absolute\",this._node.style.right=\"auto\",this._node.style.bottom=\"auto\");this.isRootView?(this._node.style.left=\"0px\",\nthis._node.style.top=\"0px\",this._node.style.width=\"100%\",this._node.style.height=\"100%\"):BMAnimationContextGetCurrent()?(BMAnimationContextGetCurrent().controllerForObject(this,{node:this._node}).registerAnimatableProperty(\"frame\",{targetValue:a.copy(),startingValue:this._frame}),this._frame||(this._frame=BMRectMakeWithNodeFrame(this.node)),this._node.style.left=this._frame.origin.x+\"px\",this._node.style.top=this._frame.origin.y+\"px\",this._node.style.width=this._frame.size.width+\"px\",this._node.style.height=\nthis._frame.size.height+\"px\",this._frame=a.copy()):(this._frame=a.copy(),this._node.style.left=a.origin.x+\"px\",this._node.style.top=a.origin.y+\"px\",this._node.style.width=a.size.width+\"px\",this._node.style.height=a.size.height+\"px\");this.didSetFrame(a)},didSetFrame(a){},get bounds(){let a=this._frame.copy();a.origin=BMPointMake();return a},LTRLayout:YES,_isManagingLayout:NO,get isManagingLayout(){return this._isManagingLayout},_supportsAutomaticIntrinsicSize:YES,get supportsAutomaticIntrinsicSize(){return this._supportsAutomaticIntrinsicSize},\nset supportsAutomaticIntrinsicSize(a){this._supportsAutomaticIntrinsicSize=a},get supportsIntrinsicSize(){return this.supportsAutomaticIntrinsicSize},_requiredWidth:void 0,get requiredWidth(){return this._requiredWidth},_needsIntrinsicSizeMeasurement:YES,get needsIntrinsicSizeMeasurement(){if(this._needsIntrinsicSizeMeasurement&&this.supportsAutomaticIntrinsicSize)return YES;let a=this._subviews.length;for(let b=0;b<a;b++)if(this._subviews[b].needsIntrinsicSizeMeasurement)return YES;return NO},invalidateIntrinsicSize(){this.needsLayout=\nthis._needsIntrinsicSizeMeasurement=YES;this.rootView._scheduleImmediateLayout()},_intrinsicSize:void 0,get intrinsicSize(){if(this.supportsAutomaticIntrinsicSize){if(this._needsIntrinsicSizeMeasurement){let a=this._node;this._intrinsicSize=BMSizeMake(a.scrollWidth+1,a.scrollHeight)}return this._intrinsicSize}},compressionResistance:750,expansionResistance:250,_constraints:void 0,_variables:void 0,get activeConstraints(){let a=[];this._hasDeterministicConstraints&&(a=this._constraints.filter((a)=>\na.isActive));this._subviews.forEach((b)=>{a=a.concat(b.activeConstraints)});return a},get localConstraints(){return this._constraints.slice()},_addConstraint(a){this._constraints.push(a);this.rootView._invalidatedConstraints=YES;this._checkConstraints()},_removeConstraint(a){a=this._constraints.indexOf(a);this.rootView._invalidatedConstraints=YES;-1!=a&&this._constraints.splice(a,1);this._checkConstraints()},_hasDeterministicConstraints:NO,_checkConstraints(){let a=NO,b=NO,c=new Set,d=new Set;this.supportsIntrinsicSize&&\n(c.add(BMLayoutAttribute.Width),d.add(BMLayoutAttribute.Height));let e=this._constraints;for(var f=0;f<e.length;f++){var h=e[f];if(h.isActive){switch(h._kind){case BMLayoutConstraintKind.Horizontal:h.affectedAttributesForView(this).forEach((a)=>c.add(a));1<c.size&&(a=YES);break;case BMLayoutConstraintKind.Vertical:h.affectedAttributesForView(this).forEach((a)=>d.add(a)),1<d.size&&(b=YES)}if(a&&b)break}}if(a&&b)return this._hasDeterministicConstraints=YES;e=this.internalConstraints();for(f=0;f<e.length;f++){h=\ne[f];switch(h._kind){case BMLayoutConstraintKind.Horizontal:h.affectedAttributesForView(this).forEach((a)=>c.add(a));1<c.size&&(a=YES);break;case BMLayoutConstraintKind.Vertical:h.affectedAttributesForView(this).forEach((a)=>d.add(a)),1<d.size&&(b=YES)}if(a&&b)break}this._hasDeterministicConstraints=a&&b},_clearConstraints(){this.localConstraints.forEach((a)=>a.remove());this._subviews.forEach((a)=>a._clearConstraints())},_leftExpressionWithMultiplier(a){a=a||1;return this.isRootView?new kiwi.Expression([a,\nthis._variables[BMLayoutAttribute.Left]]):new kiwi.Expression(this.superview._leftExpressionWithMultiplier(),[a,this._variables[BMLayoutAttribute.Left]])},_topExpressionWithMultiplier(a){a=a||1;return this.isRootView?new kiwi.Expression([a,this._variables[BMLayoutAttribute.Top]]):new kiwi.Expression(this.superview._topExpressionWithMultiplier(),[a,this._variables[BMLayoutAttribute.Top]])},_cassowaryExpressionForLayoutAttribute(a,b){var c=b&&b.withMultiplier||1;if(a in this._variables)return a==BMLayoutAttribute.Left?\nthis._leftExpressionWithMultiplier(c):a==BMLayoutAttribute.Top?this._topExpressionWithMultiplier(c):new kiwi.Expression(1!=c?[c,this._variables[a]]:this._variables[a]);switch(a){case BMLayoutAttribute.Leading:return this.LTRLayout?this._cassowaryExpressionForLayoutAttribute(BMLayoutAttribute.Left,b):this._cassowaryExpressionForLayoutAttribute(BMLayoutAttribute.Right,b);case BMLayoutAttribute.Trailing:return this.LTRLayout?this._cassowaryExpressionForLayoutAttribute(BMLayoutAttribute.Right,b):this._cassowaryExpressionForLayoutAttribute(BMLayoutAttribute.Left,\nb);case BMLayoutAttribute.Right:return 1!=c?new kiwi.Expression([c,this._variables[BMLayoutAttribute.Width]],this._leftExpressionWithMultiplier(c)):new kiwi.Expression(this._variables[BMLayoutAttribute.Width],this._leftExpressionWithMultiplier(c));case BMLayoutAttribute.CenterX:return 1!=c?new kiwi.Expression([c/2,this._variables[BMLayoutAttribute.Width]],this._leftExpressionWithMultiplier(c)):new kiwi.Expression([.5,this._variables[BMLayoutAttribute.Width]],this._leftExpressionWithMultiplier(c));\ncase BMLayoutAttribute.Bottom:return 1!=c?new kiwi.Expression([c,this._variables[BMLayoutAttribute.Height]],this._topExpressionWithMultiplier(c)):new kiwi.Expression(this._variables[BMLayoutAttribute.Height],this._topExpressionWithMultiplier(c));case BMLayoutAttribute.CenterY:return 1!=c?new kiwi.Expression([c/2,this._variables[BMLayoutAttribute.Height]],this._topExpressionWithMultiplier(c)):new kiwi.Expression([.5,this._variables[BMLayoutAttribute.Height]],this._topExpressionWithMultiplier(c));case BMLayoutAttribute.AspectRatio:throw Error(\"Aspect ratio constraints are currently unsupported!\");\n}},get builtInConstraints(){var a=this.intrinsicSize,b=[];a||this.supportsAutomaticIntrinsicSize?this._widthCompressionConstraint?(this._widthCompressionConstraint.constant=a.width,this._widthExpansionConstraint.constant=a.width,this._heightCompressionConstraint.constant=a.height,this._heightCompressionConstraint.constant=a.height,b.push(this._widthCompressionConstraint,this._heightCompressionConstraint,this._widthExpansionConstraint,this._heightExpansionConstraint)):b.push(this._widthCompressionConstraint=\nBMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Width,relatedBy:BMLayoutConstraintRelation.GreaterThanOrEquals,constant:a.width,priority:this.compressionResistance}),this._heightCompressionConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Height,relatedBy:BMLayoutConstraintRelation.GreaterThanOrEquals,constant:a.height,priority:this.compressionResistance}),this._widthExpansionConstraint=BMLayoutConstraint.internalConstraintWithView(this,\n{attribute:BMLayoutAttribute.Width,relatedBy:BMLayoutConstraintRelation.LessThanOrEquals,constant:a.width,priority:this.expansionResistance}),this._heightExpansionConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Height,relatedBy:BMLayoutConstraintRelation.LessThanOrEquals,constant:a.height,priority:this.expansionResistance})):this.needsIntrinsicSizeMeasurement&&BMCopyProperties(this._node.style,{width:\"100%\",height:\"100%\"});this._internalConstraints=b=b.concat(this.internalConstraints());\nthis._subviews.forEach((a)=>{b=b.concat(a.builtInConstraints)});return b},internalConstraints(){var a=[];this.isRootView&&(this._rootViewLeftConstraint?(this._rootViewHeightConstraint.constant=this._node.parentNode.offsetHeight,this._rootViewWidthConstraint.constant=this._node.parentNode.offsetWidth,a.push(this._rootViewLeftConstraint,this._rootViewTopConstraint,this._rootViewWidthConstraint,this._rootViewHeightConstraint)):a.push(this._rootViewLeftConstraint=BMLayoutConstraint.internalConstraintWithView(this,\n{attribute:BMLayoutAttribute.Left,relatedBy:BMLayoutConstraintRelation.Equals,constant:0}),this._rootViewTopConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Top,relatedBy:BMLayoutConstraintRelation.Equals,constant:0}),this._rootViewWidthConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Width,relatedBy:BMLayoutConstraintRelation.Equals,constant:this._node.parentNode.offsetWidth}),this._rootViewHeightConstraint=BMLayoutConstraint.internalConstraintWithView(this,\n{attribute:BMLayoutAttribute.Height,relatedBy:BMLayoutConstraintRelation.Equals,constant:this._node.parentNode.offsetHeight})));return a},_assignWidth(){this._requiredWidth=this._variables[BMLayoutAttribute.Width].value();this._subviews.forEach((a)=>a._assignWidth())},_prepareForAutomaticIntrinsicSize(){if(void 0===this._requiredWidth){let a=BMRectMake(this.node.offsetLeft,this.node.offsetTop,this.node.offsetWidth,this.node.offsetHeight);if(a.width&&a.height||!this._referenceFrame)this._referenceFrame=\na}this.supportsAutomaticIntrinsicSize&&this._needsIntrinsicSizeMeasurement&&(this._requiredWidth?this._node.style.width=this._requiredWidth+\"px\":BMCopyProperties(this._node.style,{width:\"auto\",height:\"auto\",left:\"0px\",top:\"0px\",position:\"absolute\"}));this._subviews.forEach((a)=>a._prepareForAutomaticIntrinsicSize())},_updateInternalHeightConstraints(){var a=this.intrinsicSize;a&&this._heightCompressionConstraint&&(this._heightCompressionConstraint.constant=a.height,this._heightExpansionConstraint.constant=\na.height);this._subviews.forEach((a)=>a._updateInternalHeightConstraints())},get _horizontalLayoutVariables(){var a=[this._variables[BMLayoutAttribute.Left],this._variables[BMLayoutAttribute.Width]];this._subviews.forEach((b)=>a=a.concat(b._horizontalLayoutVariables));return a},get _verticalLayoutVariables(){var a=[this._variables[BMLayoutAttribute.Top],this._variables[BMLayoutAttribute.Height]];this._subviews.forEach((b)=>a=a.concat(b._verticalLayoutVariables));return a},_layoutAnimationFrameIdentifier:void 0,\n_scheduleLayout(){this._layoutAnimationFrameIdentifier||(this._layoutAnimationFrameIdentifier=window.requestAnimationFrame((a)=>{this._layoutAnimationFrameIdentifier=void 0;this.layoutSubviews()}))},_layoutIntrisicSizeInvalidationIdentifier:void 0,_scheduleImmediateLayout(){function a(){b._layoutIntrisicSizeInvalidationIdentifier=void 0;b.layoutSubviews();window.removeEventListener(\"message\",a)}if(!this._layoutIntrisicSizeInvalidationIdentifier){this._layoutIntrisicSizeInvalidationIdentifier=BMUUIDMake();\nvar b=this;window.addEventListener(\"message\",a);window.postMessage(this._layoutIntrisicSizeInvalidationIdentifier,\"*\")}},layout(){this.rootView.layoutSubviews()},layoutSubviews(){if(this._node){NO&&console.log(\"\\n        ***********************************************************************************************************\\n                                            [BMCoreUI] Layout pass began\\n        ***********************************************************************************************************\\n        \");\nvar a=new Set,b,c=NO;!this._solver||this._layoutEditor||this._invalidatedConstraints?(this._solver=b=new kiwi.Solver,c=YES,this._layoutEditor&&this.allSubviews.forEach((a)=>a._needsIntrinsicSizeMeasurement=YES),this._invalidatedConstraints=NO):(b=this._solver,c=NO);this._subviews.forEach((a)=>{a._prepareForAutomaticIntrinsicSize()});if(c)for(this.activeConstraints.forEach((b)=>{a.add(b)}),this.builtInConstraints.forEach((b)=>{a.add(b)}),this._horizontalLayoutVariables.forEach((a)=>b.addEditVariable(a,\nkiwi.Strength.strong));YES;){let c,d=[];try{a.forEach((a)=>{a._kind===BMLayoutConstraintKind.Horizontal&&(c=a,d.push(a),NO&&console.log(`[BMCoreUI] Horizontal constraint: ${a}`),a.constituentConstraints.forEach((a)=>{a._constraint=void 0;b.addConstraint(a._cassowaryConstraint);a._solver=b}))});break}catch(h){return console.error(`[BMCoreUI] Unsatisfiable constraints. The following constraints are not satisfiable and the\\n                                layout operation cannot be completed. Will attempt to solve the layout by breaking constraint \\n                                ${c}. Please check the following constraints at design-time to resolve the problem:\\n`),\nd.forEach((a)=>{console.error(`${a}`)}),c.isActive=NO,this.layoutSubviews()}}else this.builtInConstraints||console.log();b.suggestValue(this._variables[BMLayoutAttribute.Left],0);var d=this.allSubviews;d.forEach((a)=>{if(a._widthCompressionConstraint)try{b.suggestValue(a._variables[BMLayoutAttribute.Width],a._widthCompressionConstraint._constant)}catch(f){console.log(f)}});b.updateVariables();this._subviews.forEach((a)=>{a._assignWidth();a._prepareForAutomaticIntrinsicSize();a._updateInternalHeightConstraints()});\nc&&(this._verticalLayoutVariables.forEach((a)=>b.addEditVariable(a,kiwi.Strength.strong)),a.forEach((a)=>{if(a._kind===BMLayoutConstraintKind.Vertical)try{a.constituentConstraints.forEach((a)=>{b.addConstraint(a._cassowaryConstraint);a._solver=b})}catch(f){console.log(f)}}));b.suggestValue(this._variables[BMLayoutAttribute.Top],0);d.forEach((a)=>{if(a._heightCompressionConstraint)try{b.suggestValue(a._variables[BMLayoutAttribute.Height],a._heightCompressionConstraint._constant)}catch(f){console.log(f)}});\nb.updateVariables();this.frame=BMRectMake(0,0,this._variables[BMLayoutAttribute.Width].value()|0,this._variables[BMLayoutAttribute.Height].value()|0);this._needsIntrinsicSizeMeasurement=NO;this._subviews.forEach((a)=>a._updateFrames());NO&&console.log(\"\\n        ***********************************************************************************************************\\n                                            [BMCoreUI] Layout pass finished\\n        ***********************************************************************************************************\\n        \");\nthis._layoutEditor&&this._layoutEditor.viewDidLayoutSubviews(this)}},_updateFrames(){this._requiredWidth=void 0;this._needsIntrinsicSizeMeasurement=this._needsLayout=NO;this.frame=(this._constraints.length||this._internalConstraints.length)&&this._hasDeterministicConstraints?BMRectMake(this._variables[BMLayoutAttribute.Left].value()|0,this._variables[BMLayoutAttribute.Top].value()|0,this._variables[BMLayoutAttribute.Width].value()|0,this._variables[BMLayoutAttribute.Height].value()|0):this._referenceFrame;\nthis._subviews.forEach((a)=>a._updateFrames())},_needsLayout:NO,get needsLayout(){return this._needsLayout},set needsLayout(a){(this._needsLayout=a)&&this.rootView._scheduleLayout()},_rootView:void 0,get rootView(){for(var a=this;a;){if(!a.superview)return a;a=a.superview}},get isRootView(){return void 0===this.superview},_superview:void 0,get superview(){return this._superview},_subviews:void 0,get subviews(){return this._subviews.slice()},addToSuperview(a,b){return a.addSubview(this,b)},addSubview(a,\nb){if(a.superview!=this){b=b&&b.position;void 0===b&&(b=this._subviews.length);var c=this._subviews[b];this._subviews.splice(b,0,a);a.superview&&a.superview._detachSubview(a);a._superview=this;c?this.contentNode.insertBefore(a.node,c.node):this.contentNode.appendChild(a.node)}},removeSubview(a){var b=this._subviews.indexOf(a);-1!=b&&(this._subviews.splice(b,1),a._node.remove(),a._superview=void 0)},_detachSubview(a){a=this._subviews.indexOf(a);-1!=a&&this._subviews.splice(a,1)},_prepareForCloning(){this._BMTempID=\nBMUUIDMake();this._BMOriginalID=this.node.id;this.node.id=this._BMTempID;this._subviews.each((a)=>a._prepareForCloning)},get allSubviews(){let a=[this];this._subviews.forEach((b)=>a=a.concat(b.allSubviews));return a},_clone(){this._prepareForCloning();let a=this.node.cloneNode(YES);this._cloneForNode(a)},_cloneForNode(a,b){BMView.viewForNode.call(this.constructor,a)._BMOriginalView=this;this.node.id=this._BMOriginalID}});function BMScrollView(){}BMScrollView.scrollView=function(){return BMView.view.call(this)};\nBMScrollView.scrollViewForNode=function(a,b){return Object.create(BMScrollView.prototype).initWithWrapperDOMNode(a,b)};\nBMScrollView.prototype=BMExtend({},BMView.prototype,{get contentNode(){return this._node},set contentNode(a){},_contentView:void 0,get contentView(){return this._contentView},_iScroll:void 0,_scrollOffset:void 0,get supportsAutomaticIntrinsicSize(){return NO},initWithDOMNode(a){let b=document.createElement(\"div\");return this.initWithWrapperDOMNode(a,{contentNode:b})},initWithWrapperDOMNode(a,b){BMView.prototype.initWithDOMNode.call(this,a);this._contentView=BMView.viewForNode.call(BMScrollContentView,\nb.contentNode);BMView.prototype.addSubview.call(this,this._contentView);a.style.overflow=\"hidden\";a.className=\"BMScrollView\";BMAddSmoothMousewheelInteractionToNode(a);this._iScroll=new IScroll(a,{mouseWheel:YES,scrollbars:YES,probeType:3,click:NO,deceleration:.001,resizePolling:999999999999,scrollX:YES,freeScroll:YES,interactiveScrollbars:!BMIsTouchDevice,disableMouse:YES,disablePointer:YES,fadeScrollbars:BMIsTouchDevice});this._iScroll.on(\"scroll\",()=>this._iScrollDidScroll());this._scrollOffset=\nBMPointMake();return this},_iScrollDidScroll(){this._scrollOffset=BMPointMake(this._iScroll.x,this._iScroll.y);this.layout()},get bounds(){let a=this._frame.copy();a.origin=this._scrollOffset;return a},addSubview(a,b){this._contentView.addSubview(a,b)},release(){this._contentView.release();this._iScroll&&this._iScroll.destroy();BMView.prototype.release.call(this)}});function BMScrollContentView(){}\nBMScrollContentView.prototype=BMExtend({},BMView.prototype,{get contentNode(){return this._node},set contentNode(a){},_hasDeterministicConstraints:YES,debuggingName:\"Scroll View Content\",get supportsAutomaticIntrinsicSize(){return NO},_frame:void 0,get frame(){return this._frame||BMRectMakeWithNodeFrame(this._node)},set frame(a){a.origin=BMPointMake();this._frame||(this._node.style.position=\"absolute\",this._node.style.right=\"auto\",this._node.style.bottom=\"auto\");if(this.isRootView)this._node.style.left=\n\"0px\",this._node.style.top=\"0px\",this._node.style.width=\"100%\",this._node.style.height=\"100%\";else if(BMAnimationContextGetCurrent()){let b=BMAnimationContextGetCurrent().controllerForObject(this,{node:this._node});b.registerAnimatableProperty(\"frame\",{targetValue:a.copy(),startingValue:this._frame});b._options={complete:(a)=>this.superview._iScroll.refresh()};this._node.style.left=this._frame.origin.x+\"px\";this._node.style.top=this._frame.origin.y+\"px\";this._node.style.width=this._frame.size.width+\n\"px\";this._node.style.height=this._frame.size.height+\"px\";this._frame=a.copy()}else this._frame=a.copy(),this._node.style.left=a.origin.x+\"px\",this._node.style.top=a.origin.y+\"px\",this._node.style.width=a.size.width+\"px\",this._node.style.height=a.size.height+\"px\",this.superview._iScroll&&this.superview._iScroll.refresh();this.didSetFrame(a)},internalConstraints(){let a=BMView.prototype.internalConstraints.call(this);this._superviewLeftConstraint?(this._superviewLeftConstraint.constant=this.superview._scrollOffset.x,\nthis._superviewTopConstraint.constant=this.superview._scrollOffset.y,a.push(this._superviewWidthConstraint,this._superviewHeightConstraint,this._superviewLeftConstraint,this._superviewTopConstraint)):(a.push(this._superviewWidthConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Width,relatedBy:BMLayoutConstraintRelation.GreaterThanOrEquals,toView:this.superview,secondAttribute:BMLayoutAttribute.Width})),a.push(this._superviewHeightConstraint=BMLayoutConstraint.internalConstraintWithView(this,\n{attribute:BMLayoutAttribute.Height,relatedBy:BMLayoutConstraintRelation.GreaterThanOrEquals,toView:this.superview,secondAttribute:BMLayoutAttribute.Height})),a.push(this._superviewLeftConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Leading,relatedBy:BMLayoutConstraintRelation.Equals,toView:this.superview,secondAttribute:BMLayoutAttribute.Leading,constant:this.superview._scrollOffset.x})),a.push(this._superviewTopConstraint=BMLayoutConstraint.internalConstraintWithView(this,\n{attribute:BMLayoutAttribute.Top,relatedBy:BMLayoutConstraintRelation.Equals,toView:this.superview,secondAttribute:BMLayoutAttribute.Top,constant:this.superview._scrollOffset.y})));return a}});function BMLayoutGuide(){}\nBMLayoutGuide.prototype=BMExtend({},BMView.prototype,{get supportsAutomaticIntrinsicSize(){return NO},_position:BMPointMake(),_dragged:NO,initWithDOMNode(a){BMView.prototype.initWithDOMNode.call(this,a);a.addEventListener(\"mousedown\",(a)=>{this._dragged=YES;this._position=BMPointMake(this.node.offsetLeft,this.node.offsetTop);let b=BMPointMake(a.clientX,a.clientY),d=(a)=>{let c=BMPointMake(a.clientX,a.clientY);this._position=BMPointMake(this._position.x+c.x-b.x,this._position.y+c.y-b.y);b=c;this.superview&&\nthis.layout();a.preventDefault()},e=(a)=>{window.removeEventListener(\"mousemove\",d);window.removeEventListener(\"mouseup\",e)};window.addEventListener(\"mousemove\",d);window.addEventListener(\"mouseup\",e);a.preventDefault()});return this},set initialPosition(a){this._dragged||(this._position=a.copy(),this.superview&&this.layout())},internalConstraints(){let a=BMView.prototype.internalConstraints.call(this);this._superviewLeftConstraint?(this._superviewLeftConstraint.constant=this._position.x,this._superviewTopConstraint.constant=\nthis._position.y,a.push(this._superviewLeftConstraint,this._superviewTopConstraint)):(a.push(this._superviewLeftConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Leading,relatedBy:BMLayoutConstraintRelation.Equals,toView:this.superview,secondAttribute:BMLayoutAttribute.Leading,constant:this._position.x,priority:500})),a.push(this._superviewTopConstraint=BMLayoutConstraint.internalConstraintWithView(this,{attribute:BMLayoutAttribute.Top,relatedBy:BMLayoutConstraintRelation.Equals,\ntoView:this.superview,secondAttribute:BMLayoutAttribute.Top,constant:this._position.y,priority:500})));return a}});\nvar BMLayoutAttribute=Object.freeze({Leading:\"Leading\",Trailing:\"Trailing\",Left:\"Left\",Right:\"Right\",Top:\"Top\",Bottom:\"Bottom\",CenterX:\"CenterX\",CenterY:\"CenterY\",Width:\"Width\",Height:\"Height\",AspectRatio:\"AspectRatio\"}),BMLayoutConstraintRelation=Object.freeze({Equals:kiwi.Operator.Eq,LessThanOrEquals:kiwi.Operator.Le,GreaterThanOrEquals:kiwi.Operator.Ge}),BMLayoutConstraintKind=Object.freeze({Horizontal:\"BMLayoutConstraintKindHorizontal\",Vertical:\"BMLayoutConstraintKindVertical\",AspectRatio:\"BMLayoutConstraintKindAspectRatio\"});\nfunction BMLayoutConstraint(){}var BMLayoutConstraintPriorityRequired=1E3;BMLayoutConstraint.internalConstraintWithView=function(a,b){b._internal=YES;return BMLayoutConstraint.constraintWithView(a,b)};\nBMLayoutConstraint.constraintWithView=function(a,b){var c=new BMLayoutConstraint;c._sourceView=a;c._sourceViewAttribute=b.attribute;c._relation=void 0===b.relatedBy?BMLayoutConstraintRelation.Equals:b.relatedBy;c._targetView=b.toView;c._targetViewAttribute=b.secondAttribute;c._multiplier=isNaN(b.multiplier)?1:b.multiplier;c._constant=b.constant||0;b._internal||c._install();c._priority=b.priority?b.priority:BMLayoutConstraintPriorityRequired;c._kind=b.attribute===BMLayoutAttribute.AspectRatio?BMLayoutConstraintKind.AspectRatio:\nb.attribute===BMLayoutAttribute.Top||b.attribute==BMLayoutAttribute.Bottom||b.attribute===BMLayoutAttribute.Height||b.attribute===BMLayoutAttribute.CenterY?BMLayoutConstraintKind.Vertical:BMLayoutConstraintKind.Horizontal;return c};BMLayoutConstraint.constraintWithSerializedConstraint=function(a,b){return Object.create(window[a._class].prototype).initWithSerializedConstraint(a,b)};\nBMLayoutConstraint.prototype={_solver:void 0,_constraint:void 0,initWithSerializedConstraint(a,b){this._sourceViewAttribute=a._sourceViewAttribute;this._relation=a._relation;this._targetViewAttribute=a._targetViewAttribute;this._multiplier=a._multiplier;this._constant=a._constant;this._kind=a._kind;this._priority=a._priority;if(this._sourceView=b.viewIDs(a._sourceView)){if(a._targetView&&(this._targetView=b.viewIDs(a._targetView),!this._targetView))return;this._install();return this}},affectedAttributesForView(a){return a==\nthis._sourceView?[this._sourceViewAttribute]:a==this._targetView?[this._targetViewAttribute]:[]},get isConstraintCollection(){return NO},get constituentConstraints(){return[this]},get _hasEditableConstant(){return YES},_sourceView:void 0,_sourceViewAttribute:void 0,_targetView:void 0,_targetViewAttribute:void 0,_multiplier:1,_constant:0,get constant(){return this._constant},set constant(a){a!=this._constant&&(this._constant=a,this._solver&&(this._constraint&&(this._solver.removeConstraint(this._constraint),\nthis._constraint=void 0),this._solver.addConstraint(this._cassowaryConstraint)))},_priority:BMLayoutConstraintPriorityRequired,get priority(){return this._priority},set priority(a){this._priority!=a&&(this.priority=a,this._sourceView.needsLayout=YES,this._targetView&&(this._targetView.needsLayout=YES))},_relation:BMLayoutConstraintRelation.Equals,_kind:void 0,get categoryKind(){return this._kind==BMLayoutConstraintKind.Vertical?this._sourceViewAttribute==BMLayoutAttribute.Height?\"Height\":\"Vertical Position\":\nthis._sourceViewAttribute==BMLayoutAttribute.Width?\"Width\":\"Horizontal Position\"},_isActive:NO,get isActive(){return this._isActive},set isActive(a){if(a!=this._isActive&&(this._isActive=a,this._sourceView._checkConstraints(),this._sourceView.needsLayout=YES,this._sourceView.rootView._invalidatedConstraints=YES,this._targetView)){if(this._targetView.rootView!=this._sourceView.rootView)throw Error(\"[BMCoreUI] Incorrectly attempting to activate a layout constraint that affects two views that do not share a common ancestor.\");\nthis._targetView._checkConstraints();this._targetView.needsLayout=YES}},_install(){this._sourceView._addConstraint(this);this._targetView&&this._targetView._addConstraint(this);this._sourceView.rootView._invalidatedConstraints=YES},remove(){this._isActive&&(this._sourceView.needsLayout=YES);this._isActive=NO;this._sourceView._removeConstraint(this);this._sourceView.rootView._invalidatedConstraints=YES;this._targetView&&(this._targetView.needsLayout=YES,this._targetView._removeConstraint(this));this._targetView=\nthis._sourceView=void 0},get _cassowaryExpression(){if(this._targetView){if(this._sourceViewAttribute==BMLayoutAttribute.AspectRatio){if(this._targetViewAttribute!=BMLayoutAttribute.AspectRatio)throw Error(\"[BMCoreUI] Aspect ratio constraints must affect both views' aspect ratio.\");throw Error(\"[BMCoreUI] Non-constrant aspect ratio constraint are currently not supported.\");}var a=(new kiwi.Expression(this._sourceView._cassowaryExpressionForLayoutAttribute(this._sourceViewAttribute))).minus(this._targetView._cassowaryExpressionForLayoutAttribute(this._targetViewAttribute,\n{withMultiplier:this._multiplier}));this._constant&&(a=this._sourceView.LTRLayout||this._kind!=BMLayoutConstraintKind.Horizontal||this._sourceViewAttribute==BMLayoutAttribute.Width?a.minus(this._constant):a.plus(this._constant));return a}return this._sourceViewAttribute==BMLayoutAttribute.AspectRatio?new kiwi.Expression([this._constant,this._sourceView._variables[BMLayoutAttribute.Height]],[-1,this._sourceView._variables[BMLayoutAttribute.Width]]):this._constant?this._sourceView._cassowaryExpressionForLayoutAttribute(this._sourceViewAttribute).plus(-this._constant):\nthis._sourceView._cassowaryExpressionForLayoutAttribute(this._sourceViewAttribute)},get _cassowaryConstraint(){if(this._constraint)return this._constraint;var a=this._cassowaryExpression,b=this._priority==BMLayoutConstraintPriorityRequired?kiwi.Strength.required:this._priority/1E3*kiwi.Strength.required;let c=this._relation;this._sourceView.LTRLayout||this._kind!=BMLayoutConstraintKind.Horizontal||this._sourceViewAttribute==BMLayoutAttribute.Width||(this._relation==BMLayoutConstraintRelation.GreaterThanOrEquals?\nc=BMLayoutConstraintRelation.LessThanOrEquals:this._relation==BMLayoutConstraintRelation.LessThanOrEquals&&(c=BMLayoutConstraintRelation.GreaterThanOrEquals));return this._constraint=new kiwi.Constraint(a,c,void 0,b)},toString(){let a={[BMLayoutConstraintRelation.Equals]:\"=\",[BMLayoutConstraintRelation.GreaterThanOrEquals]:\"\\u2265\",[BMLayoutConstraintRelation.LessThanOrEquals]:\"\\u2264\"};return this._targetView?`${this._sourceView.debuggingName||this._sourceView.node.id}.${this._sourceViewAttribute} ${a[this._relation]} \\t\\t\\t${1!=\nthis._multiplier?this._multiplier+\"* \":\"\"}${this._targetView.debuggingName||this._targetView.node.id}.${this._targetViewAttribute} \\t\\t\\t${this._constant?`${0>this._constant?\"-\":\"+\"} ${0>this._constant?-this._constant:this._constant}`:\"\"}`:`${this._sourceView.debuggingName||this._sourceView.node.id}.${this._sourceViewAttribute} ${a[this._relation]} ${this._constant}`},toCompactString(){let a={[BMLayoutConstraintRelation.Equals]:\"=\",[BMLayoutConstraintRelation.GreaterThanOrEquals]:\"\\u2265\",[BMLayoutConstraintRelation.LessThanOrEquals]:\"\\u2264\"},\nb=this._sourceViewAttribute.charAt(0);this._sourceViewAttribute==BMLayoutAttribute.Left&&(b=\"Lf\");if(this._targetView){let c=this._targetViewAttribute.charAt(0);this._targetViewAttribute==BMLayoutAttribute.Left&&(c=\"Lf\");return`${this._sourceView.debuggingName||this._sourceView.node.id}.${b} ${a[this._relation]} \\t\\t\\t${1!=this._multiplier?this._multiplier+\"* \":\"\"}${this._targetView.debuggingName||this._targetView.node.id}.${c} \\t\\t\\t${this._constant?`${0>this._constant?\"-\":\"+\"} ${0>this._constant?\n-this._constant:this._constant}`:\"\"}`}return`${this._sourceView.debuggingName||this._sourceView.node.id}.${b} ${a[this._relation]} ${this._constant}`},serializedConstraintWithViewIDs(a){return{_class:\"BMLayoutConstraint\",_sourceViewAttribute:this._sourceViewAttribute,_relation:this._relation,_targetViewAttribute:this._targetViewAttribute,_constant:this._constant,_multiplier:this._multiplier,_priority:this._priority,_sourceView:a(this._sourceView),_targetView:this._targetView?a(this._targetView):void 0,\n_kind:this._kind}}};function BMEqualAttributeLayoutConstraint(){}BMEqualAttributeLayoutConstraint.constraintWithAttribute=function(a,b){let c=new BMEqualAttributeLayoutConstraint;c._views=b.forViews.slice();c._attribute=a;c._priority=b.priority||BMLayoutConstraintPriorityRequired;c._kind=a===BMLayoutAttribute.Top||a==BMLayoutAttribute.Bottom||a===BMLayoutAttribute.Height||a===BMLayoutAttribute.CenterY?BMLayoutConstraintKind.Vertical:BMLayoutConstraintKind.Horizontal;b._internal||c._install();return c};\nBMEqualAttributeLayoutConstraint.prototype=BMExtend({},BMLayoutConstraint.prototype,{initWithSerializedConstraint(a,b){this._views=a._views.map((a)=>b.viewIDs(a));for(var c=0;c<this._views.length;c++)if(!this._views[c])return;this._attribute=a._attribute;this._kind=a._kind;this._priority=a._priority;this._install();return this},_views:void 0,_attribute:void 0,affectedAttributesForView(a){return-1!=this._views.indexOf(a)?[this._attribute]:[]},get isConstraintCollection(){return YES},_constituentConstraints:void 0,\nget constituentConstraints(){if(this._constituentConstraints)return this._constituentConstraints;let a=[];for(let b=1;b<this._views.length;b++)a.push(BMLayoutConstraint.internalConstraintWithView(this._views[b-1],{attribute:this._attribute,relatedBy:BMLayoutConstraintRelation.Equals,toView:this._views[b],secondAttribute:this._attribute,constant:0,multiplier:1,priority:this._priority}));return this._constituentConstraints=a},get constant(){return this._constant},set constant(a){a!=this._constant&&\n(this._constant=a,this.constituentConstraints.forEach((b)=>b.constant=a))},get _hasEditableConstant(){return NO},get categoryKind(){return this._kind==BMLayoutConstraintKind.Vertical?this._attribute==BMLayoutAttribute.Height?\"Height\":\"Vertical Position\":this._attribute==BMLayoutAttribute.Width?\"Width\":\"Horizontal Position\"},_isActive:NO,get isActive(){return this._isActive},set isActive(a){a!=this._isActive&&(this._isActive=a,this._views[0].rootView._invalidatedConstraints=YES,this._views.forEach((a)=>\n{a._checkConstraints();a.needsLayout=YES}))},_install(){this._views.forEach((a)=>a._addConstraint(this));this._views[0].rootView._invalidatedConstraints=YES},remove(){this._isActive&&(this._isActive=NO);this._views.forEach((a)=>{a._removeConstraint(this);a._checkConstraints();a.needsLayout=YES});this._views[0].rootView._invalidatedConstraints=YES;this._views=void 0},toString(){return\"Equal \"+this._attribute},toCompactString(){return\"Equal \"+this._attribute},serializedConstraintWithViewIDs(a){return{_class:\"BMEqualAttributeLayoutConstraint\",\n_attribute:this._attribute,_priority:this._priority,_views:this._views.map((b)=>a(b)),_kind:this._kind}}});function BMEqualSpacingLayoutConstraint(){}\nBMEqualSpacingLayoutConstraint.constraintOfKind=function(a,b){let c=new BMEqualSpacingLayoutConstraint;c._views=b.forViews.slice();c._kind=a;c._priority=b.priority||BMLayoutConstraintPriorityRequired;c._constant=b.constant||0;if(b.withSuperview){c._withSuperview=b.withSuperview;let a=b.forViews[0].superview;b.forViews.forEach((b)=>{if(b.superview!=a)throw Error(\"The views must have the same superview.\");});c._superview=a}a==BMLayoutConstraintKind.Horizontal?(c._firstAttribute=BMLayoutAttribute.Leading,\nc._secondAttribute=BMLayoutAttribute.Trailing):(c._firstAttribute=BMLayoutAttribute.Top,c._secondAttribute=BMLayoutAttribute.Bottom);b._internal||c._install();return c};\nBMEqualSpacingLayoutConstraint.prototype=BMExtend({},BMLayoutConstraint.prototype,{initWithSerializedConstraint(a,b){this._views=a._views.map((a)=>b.viewIDs(a));for(var c=0;c<this._views.length;c++)if(!this._views[c])return;if(a._superview&&(this._superview=b.viewIDs(a._superview),!this._superview))return;this._firstAttribute=a._firstAttribute;this._secondAttribute=a._secondAttribute;this._constant=a._constant;this._kind=a._kind;this._priority=a._priority;this._install();return this},_views:void 0,\n_superview:void 0,_firstAttribute:void 0,_secondAttribute:void 0,_kind:void 0,affectedAttributesForView(a){let b;return a==this._superview?[this._firstAttribute,this._secondAttribute]:-1!=(b=this._views.indexOf(a))?this._superview?0==b?[this._secondAttribute]:b==this._views.length-1?[this._firstAttribute]:[this._firstAttribute,this._secondAttribute]:[this._firstAttribute,this._secondAttribute]:[]},get isConstraintCollection(){return YES},_constituentConstraints:void 0,get constituentConstraints(){if(this._constituentConstraints)return this._constituentConstraints;\nlet a=[];for(let b=1;b<this._views.length;b++)a.push(BMLayoutConstraint.internalConstraintWithView(this._views[b-1],{attribute:this._secondAttribute,relatedBy:BMLayoutConstraintRelation.Equals,toView:this._views[b],secondAttribute:this._firstAttribute,constant:-this._constant,multiplier:1,priority:this._priority}));this._superview&&(a.push(BMLayoutConstraint.internalConstraintWithView(this._views[0],{attribute:this._firstAttribute,relatedBy:BMLayoutConstraintRelation.Equals,toView:this._superview,\nsecondAttribute:this._firstAttribute,constant:this._constant,multiplier:1,priority:this._priority})),a.push(BMLayoutConstraint.internalConstraintWithView(this._views[this._views.length-1],{attribute:this._secondAttribute,relatedBy:BMLayoutConstraintRelation.Equals,toView:this._superview,secondAttribute:this._secondAttribute,constant:-this._constant,multiplier:1,priority:this._priority})));return this._constituentConstraints=a},get constant(){return this._constant},set constant(a){a!=this._constant&&\n(this._constant=a,this.constituentConstraints.forEach((b)=>b.constant=a))},get _hasEditableConstant(){return YES},get categoryKind(){return this._kind==BMLayoutConstraintKind.Vertical?\"Vertical Position\":\"Horizontal Position\"},_isActive:NO,get isActive(){return this._isActive},set isActive(a){a!=this._isActive&&(this._isActive=a,this._views[0].rootView._invalidatedConstraints=YES,this._views.forEach((a)=>{a._checkConstraints();a.needsLayout=YES}),this._superview&&(this._superview._checkConstraints(),\nthis._superview.needsLayout=YES))},_install(){this._views.forEach((a)=>a._addConstraint(this));this._views[0].rootView._invalidatedConstraints=YES;this._superview&&this._superview._addConstraint(this)},remove(){this._isActive&&(this._isActive=NO);this._views.forEach((a)=>{a._removeConstraint(this);a._checkConstraints();a.needsLayout=YES});this._views[0].rootView._invalidatedConstraints=YES;this._superview&&(this._superview._removeConstraint(this),this._superview._checkConstraints(),this._superview.needsLayout=\nYES);this._views=void 0},toString(){return\"Equal Spacing\"},toCompactString(){return\"Equal Spacing\"},serializedConstraintWithViewIDs(a){return{_class:\"BMEqualSpacingLayoutConstraint\",_priority:this._priority,_views:this._views.map((b)=>a(b)),_superview:this._superview?a(this._superview):void 0,_constant:this._constant,_firstAttribute:this._firstAttribute,_secondAttribute:this._secondAttribute,_kind:this._kind}}});function BMLayoutEditor(){}\nBMLayoutEditor.prototype=BMExtend({},BMWindow.prototype,{_view:void 0,get view(){return this._view},dismissAnimated(a,b){b=b||{};if(b.completionHandler)var c=b.completionHandler;b.completionHandler=()=>{this._view.layoutEditor=void 0;this._rootNode.appendChild(this._view.node);this._view.node.querySelectorAll(\".BMLayoutEditorViewSelector, .BMLayoutEditorConstraint, .BMLayoutEditorVerticalLeadLine, .BMLayoutEditorHorizontalLeadLine\").forEach((a)=>a.remove());this._view.allSubviews.forEach((a)=>a.node.classList.remove(\"BMLayoutEditorManagedView\"));\nc&&c();this._view.needsLayout=YES};window.removeEventListener(\"resize\",this.resizeListener);return BMWindow.prototype.dismissAnimated.call(this,a,b)},initWithView(a){this._view=a;this._rootNode=a.node.parentNode;this._view.layoutEditor=this;this.resizeListener=(b)=>a.needsLayout=YES;window.addEventListener(\"resize\",this.resizeListener);a.allSubviews.forEach((a)=>{let b=document.createElement(\"div\");b.className=\"BMLayoutEditorViewSelector\";a._selector=b;a.node.classList.add(\"BMLayoutEditorManagedView\");\nb.addEventListener(\"click\",(b)=>{this.selectView(a,{withEvent:b});b.stopPropagation();b.stopImmediatePropagation()});this.initDragEventListenerForNode(b,{view:a});b.addEventListener(\"mousedown\",(a)=>2!=a.button&&(a.stopPropagation(),a.stopImmediatePropagation()));b.addEventListener(\"mousemove\",(a)=>2!=a.button&&(a.stopPropagation(),a.stopImmediatePropagation()));b.addEventListener(\"mouseup\",(a)=>2!=a.button&&(a.stopPropagation(),a.stopImmediatePropagation()));a.node.childNodes.length?a.node.insertBefore(b,\na.node.childNodes[0]):a.node.appendChild(b)});var b=BMRectMake(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight);BMWindow.prototype.initWithFrame.call(this,b,{toolbar:NO});window.addEventListener(\"resize\",(a)=>{this.frame=BMRectMake(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight)});this.content.style.backgroundColor=\"rgba(255, 255, 255, .8)\";b=document.createElement(\"div\");b.classList.add(\"BMLayoutEditorTree\");this.treeNode=b;\"backdropFilter\"in\ndocument.body.style||\"webkitBackdropFilter\"in document.body.style||(b.style.backgroundColor=\"#F8F8F8\");this.content.appendChild(b);this.tree=_BMLayoutEditorTree.editorTreeWithView(a,{node:b,editor:this});var c=document.createElement(\"div\");c.className=\"BMWindowToolbarButton BMCHToolbarButton BMCHCloseButton BMCHFullscreen\";c.innerHTML='<i class=\"material-icons\">&#xE5CD;</i>';c.style.opacity=1;c.style.pointerEvents=\"all\";c.addEventListener(\"click\",(a)=>this.dismissAnimated(YES));b=document.createElement(\"div\");\nb.className=\"BMLayoutEditorWorkspaceArea\";this.content.appendChild(b);this.workspaceArea=b;this.content.appendChild(c);c=document.createElement(\"div\");c.className=\"BMLayoutEditorWorkspaceToolbar\";b.appendChild(c);this._initToolbar(c);c=document.createElement(\"div\");c.className=\"BMLayoutEditorWorkspaceWrapper\";b.appendChild(c);b=document.createElement(\"div\");b.className=\"BMLayoutEditorWorkspace\";c.appendChild(b);this.workspaceNode=b;b=document.createElement(\"div\");b.className=\"BMLayoutEditorDetails\";\nthis.content.appendChild(b);this.detailsNode=b;c=document.createElement(\"div\");c.className=\"BMWindowTitle\";b.appendChild(c);this.detailsNodeTitle=c;c=document.createElement(\"div\");c.className=\"BMLayoutEditorDetailsContent\";b.appendChild(c);this.detailsNodeContent=c;return this},_isFullScreen:NO,toggleFullscreenWithEvent(a){this._isFullScreen?(this._isFullScreen=NO,(window.Velocity||$.Velocity).animate(a.target,{marginLeft:\"8px\"},{queue:NO,duration:300,easing:\"easeInOutQuad\",progress:(a,c)=>{this.view.layout()}}),\nBMCopyProperties(this.workspaceArea.style,{left:\"\"}),BMCopyProperties(this.treeNode.style,{width:\"\",paddingLeft:\"\",paddingRight:\"\"})):(this._isFullScreen=YES,(window.Velocity||$.Velocity).animate(a.target,{marginLeft:\"72px\"},{queue:NO,duration:300,easing:\"easeInOutQuad\",progress:(a,c)=>{this.view.layout()}}),BMCopyProperties(this.workspaceArea.style,{left:\"0px\"}),BMCopyProperties(this.treeNode.style,{width:\"0px\",paddingLeft:\"0px\",paddingRight:\"0px\"}))},_isSettingsPaneHidden:NO,toggleSettingsPaneWithEvent(a){this._isSettingsPaneHidden?\n(this._isSettingsPaneHidden=NO,(window.Velocity||$.Velocity).animate(a.target,{tween:1},{queue:NO,duration:316,easing:\"easeInOutQuad\",progress:(a,c)=>{this.view.layout()}}),BMCopyProperties(this.workspaceArea.style,{right:\"\"}),BMCopyProperties(this.detailsNode.style,{width:\"\"})):(this._isSettingsPaneHidden=YES,(window.Velocity||$.Velocity).animate(a.target,{tween:1},{queue:NO,duration:316,easing:\"easeInOutQuad\",progress:(a,c)=>{this.view.layout()}}),BMCopyProperties(this.workspaceArea.style,{right:\"0px\"}),\nBMCopyProperties(this.detailsNode.style,{width:\"0px\"}))},_initToolbar(a){var b=document.createElement(\"div\");b.className=\"BMWindowToolbarButton BMCHToolbarButton\";b.innerHTML='<i class=\"material-icons\" style=\"pointer-events: none;\">&#xE5DC;</i>';b.style.opacity=1;b.style.pointerEvents=\"all\";b.addEventListener(\"click\",(a)=>this.toggleFullscreenWithEvent(a));a.appendChild(b);b=document.createElement(\"div\");b.className=\"BMWindowToolbarLabel\";b.innerText=\"View:\";a.appendChild(b);let c=document.createElement(\"select\");\nc.className=\"BMWindowInput BMWindowToolbarInput\";c.appendChild(this.optionNamed(\"Fill\"));c.appendChild(this.optionNamed(\"Tablet Landscape\"));c.appendChild(this.optionNamed(\"Tablet Portrait\"));c.appendChild(this.optionNamed(\"Phone Portrait\"));c.appendChild(this.optionNamed(\"Phone Landscape\"));c.appendChild(this.optionNamed(\"Custom\"));a.appendChild(c);let d=document.createElement(\"input\");d.type=\"number\";d.style=\"width: 64px !important; margin-left: 64px !important; text-align: center;\";d.className=\n\"BMWindowInput BMWindowToolbarInput\";d.disabled=!0;a.appendChild(d);d.addEventListener(\"input\",(a)=>{a=parseInt(d.value,10);isNaN(a)||(BMCopyProperties(this.workspaceNode.style,{width:a+\"px\"}),this.view.layout())});b=document.createElement(\"div\");b.className=\"BMWindowToolbarLabel\";b.innerText=\"\\u2a2f\";a.appendChild(b);let e=document.createElement(\"input\");e.type=\"number\";e.style=\"width: 64px !important; text-align: center;\";e.className=\"BMWindowInput BMWindowToolbarInput\";e.disabled=!0;a.appendChild(e);\ne.addEventListener(\"input\",(a)=>{a=parseInt(e.value,10);isNaN(a)||(BMCopyProperties(this.workspaceNode.style,{height:a+\"px\"}),this.view.layout())});c.addEventListener(\"change\",(a)=>{a=c.value;\"Fill\"==a?(BMCopyProperties(this.workspaceNode.style,{left:\"0px\",top:\"0px\",right:\"0px\",bottom:\"0px\",width:\"auto\",height:\"auto\",position:\"absolute\",margin:0}),this.view.layout(),d.value=\"\",e.value=\"\",d.disabled=!0,e.disabled=!0):(\"Tablet Portrait\"==a&&(this._setStaticWorkspaceSize(BMSizeMake(768,1024),{animated:YES}),\nd.value=768,e.value=1024),\"Tablet Landscape\"==a&&(this._setStaticWorkspaceSize(BMSizeMake(1024,768),{animated:YES}),d.value=1024,e.value=768),\"Phone Portrait\"==a&&(this._setStaticWorkspaceSize(BMSizeMake(375,667),{animated:YES}),d.value=375,e.value=667),\"Phone Landscape\"==a&&(this._setStaticWorkspaceSize(BMSizeMake(667,375),{animated:YES}),d.value=667,e.value=375),\"Custom\"==a?(this._setStaticWorkspaceSize(BMSizeMake(parseInt(d.value,10)||800,parseInt(e.value,10)||600)),d.value=d.value||800,e.value=\ne.value||600,d.disabled=!1,e.disabled=!1):(d.disabled=!0,e.disabled=!0))});b=document.createElement(\"div\");b.className=\"BMWindowFlexibleSpace\";a.appendChild(b);b=document.createElement(\"div\");b.className=\"BMWindowToolbarButton BMCHToolbarButton\";b.innerHTML='<i class=\"material-icons\" style=\"pointer-events: none;\">&#xE5DD;</i>';b.style.opacity=1;b.style.pointerEvents=\"all\";b.addEventListener(\"click\",(a)=>this.toggleSettingsPaneWithEvent(a));a.appendChild(b)},_setStaticWorkspaceSize(a,b){BMCopyProperties(this.workspaceNode.style,\n{left:\"auto\",top:\"auto\",right:\"auto\",bottom:\"auto\",width:a.width+\"px\",height:a.height+\"px\",position:\"relative\",margin:\"auto\"});this.view.layout()},bringToFrontAnimated(a,b){b=b||{};if(b.completionHandler)var c=b.completionHandler;b.completionHandler=(a)=>{c&&c();this._view.needsLayout=YES};BMWindow.prototype.bringToFrontAnimated.apply(this,arguments);this._view.node.style.display=\"block\";this.workspaceNode.appendChild(this._view.node);requestAnimationFrame((a)=>this._view.needsLayout=YES)},selectView(a,\nb){if((b=b&&b.withEvent)&&(b.metaKey||b.ctrlKey))return this.toggleSelectionForView(a);this.tree.selectView(a);a._checkConstraints();a._hasDeterministicConstraints?this.workspaceNode.classList.remove(\"BMLayoutEditorWorkspaceInvalidLayout\"):this.workspaceNode.classList.add(\"BMLayoutEditorWorkspaceInvalidLayout\");this.detailsNodeTitle.innerText=a.debuggingName||a.node.id;this._view.node.querySelectorAll(\".BMLayoutEditorViewSelectorSelected, .BMLayoutEditorViewSelectorConstrained\").forEach((a)=>{a.classList.remove(\"BMLayoutEditorViewSelectorSelected\");\na.classList.remove(\"BMLayoutEditorViewSelectorConstrained\")});this._view.node.querySelectorAll(\".BMLayoutEditorConstraint, .BMLayoutEditorLeadLine\").forEach((a)=>a.remove());this.selectedView=a;this.selectedViews=this.selectedConstraint=void 0;a&&(a._selector.classList.add(\"BMLayoutEditorViewSelectorSelected\"),this._clearOffsets(),a.localConstraints.forEach((b)=>{b.isConstraintCollection?b._views.forEach((b)=>b!=a&&b._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\")):(b._sourceView!=\na&&b._sourceView._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\"),b._targetView&&b._targetView!=a&&b._targetView._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\"));this._drawConstraint(b,{withReferenceView:a})}),this.detailsNodeContent.innerHTML=\"\",this.createSettingsForView(a))},toggleSelectionForView(a){this.selectedViews=this.selectedViews||[];this.selectedView&&this.selectedViews.push(this.selectedView);this.selectedConstraint=this.selectedView=void 0;this.workspaceNode.classList.remove(\"BMLayoutEditorWorkspaceInvalidLayout\");\nthis._view.node.querySelectorAll(\".BMLayoutEditorViewSelectorConstrained\").forEach((a)=>{a.classList.remove(\"BMLayoutEditorViewSelectorConstrained\")});this._view.node.querySelectorAll(\".BMLayoutEditorConstraint, .BMLayoutEditorLeadLine\").forEach((a)=>a.remove());if(1!=this.selectedViews.length||this.selectedViews[0]!=a){var b;-1==(b=this.selectedViews.indexOf(a))?(this.selectedViews.push(a),a._selector.classList.add(\"BMLayoutEditorViewSelectorSelected\"),this.tree.selectView(a,{continuous:YES})):(this.selectedViews.splice(b,\n1),a._selector.classList.remove(\"BMLayoutEditorViewSelectorSelected\"),this.tree.deselectView(a));this.createSettingsForMultipleViews()}},viewDidLayoutSubviews(){this.selectedConstraint&&requestAnimationFrame((a)=>{this._clearOffsets();this._view.node.querySelectorAll(\".BMLayoutEditorConstraint, .BMLayoutEditorLeadLine\").forEach((a)=>a.remove());this._drawConstraint(this.selectedConstraint,{withReferenceView:this.selectedConstraintReferenceView})});this.selectedView&&requestAnimationFrame((a)=>{this._clearOffsets();\nthis._view.node.querySelectorAll(\".BMLayoutEditorConstraint, .BMLayoutEditorLeadLine\").forEach((a)=>a.remove());this.selectedView.localConstraints.forEach((a)=>this._drawConstraint(a,{withReferenceView:this.selectedView}))})},initDragEventListenerForNode(a,b){let c=b.view;a.addEventListener(\"contextmenu\",(a)=>a.preventDefault());a.addEventListener(\"mousedown\",(b)=>{if(2==b.button){this.isCreatingConstraint=YES;this.constraintTarget=this.constraintSource=c;a.classList.add(\"BMLayoutEditorDragSource\");\nvar d=(a)=>a.preventDefault();window.addEventListener(\"contextmenu\",d);var f=(a)=>{window.removeEventListener(\"mouseup\",f);requestAnimationFrame((a)=>window.removeEventListener(\"contextmenu\",d));this.isCreatingConstraint=NO;this.content.querySelectorAll(\".BMLayoutEditorDragTarget\").forEach((a)=>a.classList.remove(\"BMLayoutEditorDragTarget\"));this.content.querySelectorAll(\".BMLayoutEditorDragSource\").forEach((a)=>a.classList.remove(\"BMLayoutEditorDragSource\"));this.showConstraintOptionsFromView(this.constraintSource,\n{toView:this.constraintTarget,atPoint:BMPointMake(a.clientX,a.clientY)});a.preventDefault()};window.addEventListener(\"mouseup\",f);b.preventDefault()}});a.addEventListener(\"mousedown\",(a)=>{if(0==a.button){var b=c.frame||BMRectMakeWithNodeFrame(c.node),d=!1,h=BMPointMake(a.pageX,a.pageY),g=(a)=>{d=!0;let e=BMPointMake(a.pageX-h.x,a.pageY-h.y),l=b.copy();l.offsetWithX(e.x,{y:e.y});c.frame=l;this.selectView(c);a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()},k=(a)=>{window.removeEventListener(\"mouseup\",\nk,{capture:YES});window.removeEventListener(\"mousemove\",g,{capture:YES});d&&(a.preventDefault(),a.stopImmediatePropagation(),a.stopPropagation())};window.addEventListener(\"mouseup\",k,{capture:YES});window.addEventListener(\"mousemove\",g,{capture:YES})}});a.addEventListener(\"mouseenter\",(b)=>{this.isCreatingConstraint&&(this.content.querySelectorAll(\".BMLayoutEditorDragTarget\").forEach((a)=>a.classList.remove(\"BMLayoutEditorDragTarget\")),a.classList.add(\"BMLayoutEditorDragTarget\"),this.constraintTarget=\nc,b.preventDefault())})},constraintOptionWithLabel(a,b){let c=document.createElement(\"div\");c.className=\"BMLayoutEditorConstraintPopupOption\";c.innerText=a;c.addEventListener(\"click\",b.action);return c},addConstraint(a){this.tree.addConstraint(a);this.selectConstraint(a,{withReferenceView:a._sourceView});a.isActive=YES},showConstraintOptionsFromView(a,b){let c=b.toView,d=document.createElement(\"div\");d.className=\"BMLayoutEditorConstraintPopup\";c&&c!==a?(this.horizontalConstraintOptionsFromView(a,\n{toView:c}).forEach((a)=>d.appendChild(a)),d.appendChild(this.settingsDivider()),this.verticalConstraintOptionsFromView(a,{toView:c}).forEach((a)=>d.appendChild(a)),d.appendChild(this.settingsDivider()),d.appendChild(this.constraintOptionWithLabel(\"Equal Width\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Width,toView:c,secondAttribute:BMLayoutAttribute.Width}))}})),d.appendChild(this.constraintOptionWithLabel(\"Equal Height\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,\n{attribute:BMLayoutAttribute.Height,toView:c,secondAttribute:BMLayoutAttribute.Height}))}}))):(d.appendChild(this.constraintOptionWithLabel(\"Width\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Width,constant:a.node.offsetWidth}))}})),d.appendChild(this.constraintOptionWithLabel(\"Height\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Height,constant:a.node.offsetHeight}))}})));let e=document.createElement(\"div\");\ne.className=\"BMLayoutEditorConstraintPopupContainer\";\"backdropFilter\"in document.body.style||\"webkitBackdropFilter\"in document.body.style||(d.style.backgroundColor=\"white\");e.appendChild(d);BMHook(d,{scaleX:.75,scaleY:.75,opacity:0});document.body.appendChild(e);let f=d.offsetHeight;d.style.transformOrigin=\"0% 0%\";f+b.atPoint.y>document.documentElement.clientHeight&&(d.style.transformOrigin=\"0% 100%\",b.atPoint.y-=f);d.style.left=b.atPoint.x+\"px\";d.style.top=b.atPoint.y+\"px\";d.addEventListener(\"click\",\n(a)=>a.preventDefault());(window.Velocity||$.Velocity).animate(d,{scaleX:1,scaleY:1,opacity:1,translateZ:0},{duration:150,easing:\"easeOutQuint\",complete:(a)=>(d.style.pointerEvents=\"all\",e.style.pointerEvents=\"all\")});e.addEventListener(\"click\",(a)=>{(window.Velocity||$.Velocity).animate(d,{scaleX:.75,scaleY:.75,opacity:0,translateZ:0},{duration:150,easing:\"easeInQuint\",complete:(a)=>e.remove()})})},horizontalConstraintOptionsFromView(a,b){var c=b.toView;return[this.constraintOptionWithLabel(\"Align Leading\",\n{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Leading,toView:c,secondAttribute:BMLayoutAttribute.Leading,constant:BMRectMakeWithNodeFrame(a.node).left-BMRectMakeWithNodeFrame(c.node).left}))}}),this.constraintOptionWithLabel(\"Align Horizontal Center\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.CenterX,toView:c,secondAttribute:BMLayoutAttribute.CenterX,constant:BMRectMakeWithNodeFrame(a.node).center.x-\nBMRectMakeWithNodeFrame(c.node).center.x}))}}),this.constraintOptionWithLabel(\"Align Trailing\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Trailing,toView:c,secondAttribute:BMLayoutAttribute.Trailing,constant:BMRectMakeWithNodeFrame(a.node).right-BMRectMakeWithNodeFrame(c.node).right}))}}),this.constraintOptionWithLabel(\"Horizontal Spacing\",{action:(b)=>{b=BMRectMakeWithNodeFrame(a.node);let d=BMRectMakeWithNodeFrame(c.node);b.origin.x>=d.right?\nthis.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Leading,toView:c,secondAttribute:BMLayoutAttribute.Trailing,constant:-BMRectMakeWithNodeFrame(a.node).right+BMRectMakeWithNodeFrame(c.node).origin.x})):this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Trailing,toView:c,secondAttribute:BMLayoutAttribute.Leading,constant:BMRectMakeWithNodeFrame(a.node).origin.x-BMRectMakeWithNodeFrame(c.node).right}))}})]},verticalConstraintOptionsFromView(a,\nb){var c=b.toView;return[this.constraintOptionWithLabel(\"Align Top\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Top,toView:c,secondAttribute:BMLayoutAttribute.Top,constant:BMRectMakeWithNodeFrame(a.node).top-BMRectMakeWithNodeFrame(c.node).top}))}}),this.constraintOptionWithLabel(\"Align Vertical Center\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.CenterY,toView:c,secondAttribute:BMLayoutAttribute.CenterY,\nconstant:BMRectMakeWithNodeFrame(a.node).center.y-BMRectMakeWithNodeFrame(c.node).center.y}))}}),this.constraintOptionWithLabel(\"Align Bottom\",{action:(b)=>{this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Bottom,toView:c,secondAttribute:BMLayoutAttribute.Bottom,constant:BMRectMakeWithNodeFrame(a.node).bottom-BMRectMakeWithNodeFrame(c.node).bottom}))}}),this.constraintOptionWithLabel(\"Vertical Spacing\",{action:(b)=>{b=BMRectMakeWithNodeFrame(a.node);let d=BMRectMakeWithNodeFrame(c.node);\nb.origin.y>=d.bottom?this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Top,toView:c,secondAttribute:BMLayoutAttribute.Bottom,constant:-BMRectMakeWithNodeFrame(a.node).bottom+BMRectMakeWithNodeFrame(c.node).origin.y})):this.addConstraint(BMLayoutConstraint.constraintWithView(a,{attribute:BMLayoutAttribute.Top,toView:c,secondAttribute:BMLayoutAttribute.Bottom,constant:BMRectMakeWithNodeFrame(a.node).origin.y-BMRectMakeWithNodeFrame(c.node).bottom}))}})]},selectConstraint(a,\nb){this.selectedViews=this.selectedView=void 0;this.selectedConstraint=a;this.selectedConstraintReferenceView=b.withReferenceView;this.tree.selectConstraint(a);this.workspaceNode.classList.remove(\"BMLayoutEditorWorkspaceInvalidLayout\");this.detailsNodeTitle.innerText=\"Constraint\";this._view.node.querySelectorAll(\".BMLayoutEditorViewSelectorSelected, .BMLayoutEditorViewSelectorConstrained\").forEach((a)=>{a.classList.remove(\"BMLayoutEditorViewSelectorSelected\");a.classList.remove(\"BMLayoutEditorViewSelectorConstrained\")});\nthis._view.node.querySelectorAll(\".BMLayoutEditorConstraint, .BMLayoutEditorLeadLine\").forEach((a)=>a.remove());a&&(this._clearOffsets(),this._drawConstraint(a,{withReferenceView:b.withReferenceView}),a.isConstraintCollection?a._views.forEach((a)=>a._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\")):(a._sourceView&&a._sourceView._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\"),a._targetView&&a._targetView._selector.classList.add(\"BMLayoutEditorViewSelectorConstrained\")),\nthis.detailsNodeContent.innerHTML=\"\",this.createSettingsForConstraint(a,{withReferenceView:b.withReferenceView}))},_clearOffsets(){this._centerYOffset=this._bottomOffset=this._topOffset=this._heightOffset=this._widthOffset=this._centerXOffset=this._rightOffset=this._leftOffset=-1},_drawConstraint(a,b){let c=b.sourceConstraint;if(a.isConstraintCollection)return a.constituentConstraints.forEach((b)=>{this._drawConstraint(b,{withReferenceView:b._sourceView,sourceConstraint:a})});if(a._targetView){var d=\nBMRectMakeWithNodeFrame(this._view.node);b=b.withReferenceView;if(a._sourceView==b){var e=a._targetView;var f=\"_sourceViewAttribute\";var h=\"_targetViewAttribute\"}else e=a._sourceView,f=\"_targetViewAttribute\",h=\"_sourceViewAttribute\";if(a._kind==BMLayoutConstraintKind.Horizontal){var g=BMRectMakeWithNodeFrame(b.node);e=BMRectMakeWithNodeFrame(e.node);var k=BMPointMake(0,0),l=BMPointMake(0,e.center.y-d.origin.y);switch(a[f]){case BMLayoutAttribute.Left:case BMLayoutAttribute.Leading:k.x=g.origin.x-\nd.origin.x;var m=++this._leftOffset;break;case BMLayoutAttribute.CenterX:k.x=g.center.x-d.origin.x;m=++this._centerXOffset;break;case BMLayoutAttribute.Right:case BMLayoutAttribute.Trailing:k.x=g.right-d.origin.x;m=++this._rightOffset;break;case BMLayoutAttribute.Width:m=++this._widthOffset,k.y=g.bottom-12-8*m-d.origin.y,l.y=k.y,k.x=g.origin.x-d.origin.x,l.x=g.right-d.origin.x,this._drawHorizontalConstraint(a,{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c})}k.y=g.center.y+8*m-\nd.origin.y;switch(a[h]){case BMLayoutAttribute.Left:case BMLayoutAttribute.Leading:l.x=e.origin.x-d.origin.x;break;case BMLayoutAttribute.CenterX:l.x=e.center.x-d.origin.x;break;case BMLayoutAttribute.Right:case BMLayoutAttribute.Trailing:l.x=e.right-d.origin.x;break;case BMLayoutAttribute.Width:k.y=e.bottom-12-8*m-d.origin.y;l.y=k.y;k.x=e.origin.x-d.origin.x;l.x=e.right-d.origin.x;this._drawHorizontalConstraint(a,{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c});return}return this._drawHorizontalConstraint(a,\n{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c})}g=BMRectMakeWithNodeFrame(b.node);e=BMRectMakeWithNodeFrame(e.node);k=BMPointMake(0,0);l=BMPointMake(e.center.x-d.origin.x,0);switch(a[f]){case BMLayoutAttribute.Top:k.y=g.origin.y-d.origin.y;m=++this._topOffset;break;case BMLayoutAttribute.CenterY:k.y=g.center.y-d.origin.y;m=++this._centerYOffset;break;case BMLayoutAttribute.Bottom:k.y=g.bottom-d.origin.y;m=++this._bottomOffset;break;case BMLayoutAttribute.Height:m=++this._heightOffset,\nk.x=g.right-12-8*m-d.origin.x,l.x=k.x,k.y=g.origin.y-d.origin.y,l.y=g.bottom-d.origin.y,this._drawVerticalConstraint(a,{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c})}k.x=g.center.x-d.origin.x+8*m;switch(a[h]){case BMLayoutAttribute.Top:l.y=e.origin.y-d.origin.y;break;case BMLayoutAttribute.CenterY:l.y=e.center.y-d.origin.y;break;case BMLayoutAttribute.Bottom:l.y=e.bottom-d.origin.y;break;case BMLayoutAttribute.Height:k.x=e.right-12-8*m-d.origin.x;l.x=k.x;k.y=e.origin.y-d.origin.y;\nl.y=e.bottom-d.origin.y;this._drawVerticalConstraint(a,{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c});return}return this._drawVerticalConstraint(a,{fromSourcePoint:k,toPoint:l,withReferenceView:b,sourceConstraint:c})}},_drawHorizontalConstraint(a,b){let c=b.sourceConstraint,d=b.fromSourcePoint,e=b.toPoint;var f=Math.abs(d.x-e.x);let h=Math.min(d.x,e.x),g=document.createElement(\"div\");g.className=\"BMLayoutEditorConstraint BMLayoutEditorHorizontalConstraint\";BMCopyProperties(g.style,\n{width:f+\"px\",height:\"5px\",left:h+\"px\",top:d.y+\"px\"});f=document.createElement(\"div\");f.className=\"BMLayoutEditorHorizontalConstraintLine\";g.appendChild(f);a._priority<BMLayoutConstraintPriorityRequired&&f.classList.add(\"BMLayoutEditorConstraintLineOptional\");f=document.createElement(\"div\");f.className=\"BMLayoutEditorLeadLine BMLayoutEditorVerticalLeadLine\";BMCopyProperties(f.style,{width:\"1px\",height:Math.abs(d.y-e.y)+\"px\",left:(e.x<d.x?e.x:e.x-1)+\"px\",top:Math.min(e.y,d.y)+\"px\"});this._view.node.appendChild(f);\nthis._view.node.appendChild(g);g.addEventListener(\"click\",(d)=>{this.selectConstraint(c||a,{withReferenceView:b.withReferenceView});d.stopPropagation()})},_drawVerticalConstraint(a,b){let c=b.sourceConstraint,d=b.fromSourcePoint,e=b.toPoint;var f=Math.abs(d.y-e.y);let h=Math.min(d.y,e.y),g=document.createElement(\"div\");g.className=\"BMLayoutEditorConstraint BMLayoutEditorVerticalConstraint\";BMCopyProperties(g.style,{width:\"5px\",height:f+\"px\",left:d.x+\"px\",top:h+\"px\"});f=document.createElement(\"div\");\nf.className=\"BMLayoutEditorVerticalConstraintLine\";g.appendChild(f);a._priority<BMLayoutConstraintPriorityRequired&&f.classList.add(\"BMLayoutEditorConstraintLineOptional\");f=document.createElement(\"div\");f.className=\"BMLayoutEditorLeadLine BMLayoutEditorHorizontalLeadLine\";BMCopyProperties(f.style,{width:Math.abs(d.x-e.x)+\"px\",height:\"1px\",top:(e.y<d.y?e.y:e.y-1)+\"px\",left:Math.min(e.x,d.x)+\"px\"});this._view.node.appendChild(f);this._view.node.appendChild(g);g.addEventListener(\"click\",(d)=>{this.selectConstraint(c||\na,{withReferenceView:b.withReferenceView});d.stopPropagation()})},readonlySettingWithName(a,b){let c=document.createElement(\"div\");c.className=\"BMLayoutEditorDetailsItem\";let d=document.createElement(\"div\");d.className=\"BMLayoutEditorDetailsItemTitle\";d.innerText=a;c.appendChild(d);let e;b.value?(e=document.createElement(\"div\"),e.className=\"BMLayoutEditorDetailsItemReadonlyValue\",e.innerText=b.value,c.appendChild(e)):d.style.width=\"240px\";b.action&&(e.classList.add(\"BMLayoutEditorDetailsItemReadonlyValueClickable\"),\ne.addEventListener(\"click\",b.action));return c},numericSettingWithName(a,b){let c=b.forConstraint,d=b.propertyName,e=b.withReferenceView,f=document.createElement(\"div\");f.className=\"BMLayoutEditorDetailsItem\";let h=document.createElement(\"div\");h.className=\"BMLayoutEditorDetailsItemTitle\";h.innerText=a;f.appendChild(h);let g=document.createElement(\"input\");g.type=\"number\";g.className=\"BMWindowInput BMLayoutEditorDetailsItemNumericValue\";g.value=b.value;f.appendChild(g);g.addEventListener(\"input\",\n(a)=>{a=parseFloat(g.value);isNaN(a)||(c?(c[d]=a,c._constraint=void 0,c._constituentConstraints=void 0,c._sourceView?c._sourceView.needsLayout=YES:c._views[0].needsLayout=YES):(e[d]=a,e.needsLayout=YES))});return f},optionNamed(a,b){let c=document.createElement(\"option\");c.value=b?b.value:a;c.innerText=a;return c},dropdownSettingWithName(a,b){let c=b.forConstraint,d=b.propertyName,e=document.createElement(\"div\");e.className=\"BMLayoutEditorDetailsItem\";let f=document.createElement(\"div\");f.className=\n\"BMLayoutEditorDetailsItemTitle\";f.innerText=a;e.appendChild(f);let h=document.createElement(\"select\");h.className=\"BMWindowInput BMLayoutEditorDetailsItemNumericValue\";c._kind==BMLayoutConstraintKind.Horizontal?c._sourceViewAttribute===BMLayoutAttribute.Width?h.appendChild(this.optionNamed(c._sourceViewAttribute)):(h.appendChild(this.optionNamed(BMLayoutAttribute.Leading)),h.appendChild(this.optionNamed(BMLayoutAttribute.CenterX)),h.appendChild(this.optionNamed(BMLayoutAttribute.Trailing)),h.appendChild(this.optionNamed(BMLayoutAttribute.Left)),\nh.appendChild(this.optionNamed(BMLayoutAttribute.Right))):c._sourceViewAttribute===BMLayoutAttribute.Height?h.appendChild(this.optionNamed(c._sourceViewAttribute)):(h.appendChild(this.optionNamed(BMLayoutAttribute.Top)),h.appendChild(this.optionNamed(BMLayoutAttribute.CenterY)),h.appendChild(this.optionNamed(BMLayoutAttribute.Bottom)));h.value=b.value;e.appendChild(h);h.addEventListener(\"change\",(a)=>{c[d]=h.value;c._cassowaryConstraint=void 0;c._constituentConstraints=void 0;c._sourceView.needsLayout=\nYES});return e},equalitySettingWithName(a,b){let c=b.forConstraint,d=document.createElement(\"div\");d.className=\"BMLayoutEditorDetailsItem\";let e=document.createElement(\"div\");e.className=\"BMLayoutEditorDetailsItemTitle\";e.innerText=a;d.appendChild(e);let f=document.createElement(\"select\");f.className=\"BMWindowInput BMLayoutEditorDetailsItemNumericValue\";f.appendChild(this.optionNamed(\"=\",{value:BMLayoutConstraintRelation.Equals}));f.appendChild(this.optionNamed(\"\\u2265\",{value:BMLayoutConstraintRelation.GreaterThanOrEquals}));\nf.appendChild(this.optionNamed(\"\\u2264\",{value:BMLayoutConstraintRelation.LessThanOrEquals}));f.value=\"\"+b.value;d.appendChild(f);f.addEventListener(\"change\",(a)=>{c._relation=parseInt(f.value,10);c._sourceView.needsLayout=YES});return d},buttonSettingWithName(a,b){if(b.class){var c=document.createElement(\"div\");c.className=\"BMLayoutEditorImageButton \"+b.class}else c=document.createElement(\"button\"),c.className=\"BMWindowButton\",c.innerText=a;c.addEventListener(\"click\",b.action);return c},settingsDivider(){let a=\ndocument.createElement(\"div\");a.className=\"BMLayoutEditorDetailsDivider\";return a},viewSettingWithView(a){let b=document.createElement(\"div\");b.classList.add(\"BMLayoutEditorDetailsConstraintItem\");b.innerText=a.debuggingName||a.node.id;b.addEventListener(\"click\",(b)=>this.selectView(a));return b},createSettingsForConstraint(a,b){if(a.isConstraintCollection)return this.createSettingsForConstraintCollection(a);var c=this.detailsNodeContent;c.classList.remove(\"BMLayoutEditorViewDetails\");let d={[BMLayoutConstraintRelation.Equals]:\"=\",\n[BMLayoutConstraintRelation.GreaterThanOrEquals]:\"\\u2265\",[BMLayoutConstraintRelation.LessThanOrEquals]:\"\\u2264\"};c.appendChild(this.readonlySettingWithName(\"First View:\",{value:a._sourceView.debuggingName||a._sourceView.node.id,action:(b)=>this.selectView(a._sourceView)}));c.appendChild(this.dropdownSettingWithName(\"Attribute:\",{value:a._sourceViewAttribute,forConstraint:a,propertyName:\"_sourceViewAttribute\",withReferenceView:b.withReferenceView}));c.appendChild(this.settingsDivider());c.appendChild(this.equalitySettingWithName(\"Relation:\",\n{value:d[a._relation],forConstraint:a,withReferenceView:b.withReferenceView}));c.appendChild(this.settingsDivider());a._targetView&&(c.appendChild(this.numericSettingWithName(\"Multiplier:\",{value:a._multiplier,forConstraint:a,propertyName:\"_multiplier\",withReferenceView:b.withReferenceView})),c.appendChild(this.readonlySettingWithName(\"Second View:\",{value:a._targetView.debuggingName||a._targetView.node.id,action:(b)=>this.selectView(a._targetView)})),c.appendChild(this.dropdownSettingWithName(\"Attribute:\",\n{value:a._targetViewAttribute,forConstraint:a,propertyName:\"_targetViewAttribute\",withReferenceView:b.withReferenceView})));let e;c.appendChild(e=this.numericSettingWithName(\"Constant:\",{value:a._constant,forConstraint:a,propertyName:\"_constant\",withReferenceView:b.withReferenceView}));requestAnimationFrame((a)=>e.querySelectorAll(\"input\")[0].focus(),e.querySelectorAll(\"input\")[0].select());c.appendChild(this.settingsDivider());c.appendChild(this.numericSettingWithName(\"Priority:\",{value:a._priority,\nforConstraint:a,propertyName:\"_priority\",withReferenceView:b.withReferenceView}));c.appendChild(this.settingsDivider());c.appendChild(this.buttonSettingWithName(\"Remove Constraint\",{action:(c)=>{this.tree.removeConstraint(a);a.remove();this.selectView(b.withReferenceView)}}))},createSettingsForConstraintCollection(a,b){var c=this.detailsNodeContent;c.classList.remove(\"BMLayoutEditorViewDetails\");let d;a._hasEditableConstant&&(c.appendChild(d=this.numericSettingWithName(\"Constant:\",{value:a._constant,\nforConstraint:a,propertyName:\"_constant\"})),requestAnimationFrame((a)=>d.querySelectorAll(\"input\")[0].focus(),d.querySelectorAll(\"input\")[0].select()),c.appendChild(this.settingsDivider()));b=this.readonlySettingWithName(\"Affected Views\",{value:\"\"});b.childNodes[0].style.textAlign=\"left\";b.childNodes[0].style.paddingLeft=\"16px\";c.appendChild(b);a._views.forEach((a)=>c.appendChild(this.viewSettingWithView(a)));c.appendChild(this.settingsDivider());c.appendChild(this.numericSettingWithName(\"Priority:\",\n{value:a._priority,forConstraint:a,propertyName:\"_priority\",withReferenceView:a._views[0]}));c.appendChild(this.settingsDivider());c.appendChild(this.buttonSettingWithName(\"Remove Constraint\",{action:(b)=>{this.tree.removeConstraint(a);b=a._views[0];a.remove();this.selectView(b)}}))},constraintSettingWithConstraint(a,b){let c=document.createElement(\"div\");c.classList.add(\"BMLayoutEditorDetailsConstraintItem\");c.innerText=a.toString();500<a._priority&&1E3>a._priority?c.classList.add(\"BMLayoutEditorDetailsConstraintItemStrong\"):\n500>=a._priority&&c.classList.add(\"BMLayoutEditorDetailsConstraintItemWeak\");b.internal?c.classList.add(\"BMLayoutEditorDetailsConstraintItemReadonly\"):c.addEventListener(\"click\",(c)=>this.selectConstraint(a,{withReferenceView:b.referenceView}));return c},createSettingsForView(a){var b=this.detailsNodeContent;b.classList.add(\"BMLayoutEditorViewDetails\");b.appendChild(this.numericSettingWithName(\"Compression Resistance:\",{value:a.compressionResistance,propertyName:\"compressionResistance\",withReferenceView:a}));\nb.appendChild(this.numericSettingWithName(\"Expansion Resistance:\",{value:a.expansionResistance,propertyName:\"expansionResistance\",withReferenceView:a}));b.appendChild(this.settingsDivider());b.appendChild(this.readonlySettingWithName(\"Intrinsic Size:\",{value:a.supportsIntrinsicSize?\"Yes\":\"No\"}));let c={};a.localConstraints.forEach((a)=>{let b=a.categoryKind;c[b]=c[b]||[];c[b].push(a)});Object.keys(c).sort().forEach((d)=>{b.appendChild(this.settingsDivider());let e=this.readonlySettingWithName(d+\" Constraints\",\n{value:\"\"});e.childNodes[0].style.textAlign=\"left\";e.childNodes[0].style.paddingLeft=\"16px\";b.appendChild(e);c[d].forEach((c)=>b.appendChild(this.constraintSettingWithConstraint(c,{referenceView:a})))});b.appendChild(this.settingsDivider());let d=this.readonlySettingWithName(\"Internal Constraints\",{value:\"\"});d.childNodes[0].style.textAlign=\"left\";d.childNodes[0].style.paddingLeft=\"16px\";b.appendChild(d);a.internalConstraints().forEach((c)=>b.appendChild(this.constraintSettingWithConstraint(c,{referenceView:a,\ninternal:YES})))},equalConstraintSettingWithName(a,b){return this.buttonSettingWithName(a,{class:b.class,action:(a)=>{let c=BMEqualAttributeLayoutConstraint.constraintWithAttribute(b.attribute,{forViews:this.selectedViews,_internal:a.shiftKey});a.shiftKey?c.constituentConstraints.forEach((a)=>{a._install();this.addConstraint(a)}):this.addConstraint(c)}})},createSettingsForMultipleViews(){this.detailsNodeTitle.innerText=this.selectedViews.length+\" selected\";this.detailsNodeContent.innerHTML=\"\";let a=\nthis.detailsNodeContent,b=this.readonlySettingWithName(\"Align Horizontal\",{value:\"\"});b.childNodes[0].style.textAlign=\"center\";b.childNodes[0].style.width=\"100%\";a.appendChild(b);var c=document.createElement(\"div\");c.style=\"display: flex; flex-direction: row; align-self: center; padding-top: 8px; padding-bottom: 8px\";a.appendChild(c);c.appendChild(this.equalConstraintSettingWithName(\"Align Top\",{class:\"BMLayoutEditorImageButtonAlignAlignTop\",attribute:BMLayoutAttribute.Top}));c.appendChild(this.equalConstraintSettingWithName(\"Align Center\",\n{class:\"BMLayoutEditorImageButtonAlignCenterY\",attribute:BMLayoutAttribute.CenterY}));c.appendChild(this.equalConstraintSettingWithName(\"Align Bottom\",{class:\"BMLayoutEditorImageButtonAlignBottom\",attribute:BMLayoutAttribute.Bottom}));a.appendChild(this.settingsDivider());c=this.readonlySettingWithName(\"Distribute Horizontal\",{value:\"\"});b.childNodes[0].style.textAlign=\"center\";b.childNodes[0].style.width=\"100%\";a.appendChild(c);c=document.createElement(\"div\");c.style=\"display: flex; flex-direction: row; align-self: center; padding-top: 8px; padding-bottom: 8px\";\na.appendChild(c);c.appendChild(this.buttonSettingWithName(\"Equal Spacing\",{class:\"BMLayoutEditorImageButtonEqualHorizontalSpacing\",action:(a)=>{let b=BMEqualSpacingLayoutConstraint.constraintOfKind(BMLayoutConstraintKind.Horizontal,{forViews:this.selectedViews.slice().sort((a,b)=>a.node.getBoundingClientRect().left-b.node.getBoundingClientRect().left),withSuperview:NO,_internal:a.shiftKey});a.shiftKey?b.constituentConstraints.forEach((a)=>{a._install();this.addConstraint(a)}):this.addConstraint(b)}}));\nc.appendChild(this.buttonSettingWithName(\"Equal Spacing In Superview\",{class:\"BMLayoutEditorImageButtonEqualHorizontalSpacingInSuperview\",action:(a)=>{let b=BMEqualSpacingLayoutConstraint.constraintOfKind(BMLayoutConstraintKind.Horizontal,{forViews:this.selectedViews.slice().sort((a,b)=>a.node.getBoundingClientRect().left-b.node.getBoundingClientRect().left),withSuperview:YES,_internal:a.shiftKey});a.shiftKey?b.constituentConstraints.forEach((a)=>{a._install();this.addConstraint(a)}):this.addConstraint(b)}}));\nc.appendChild(this.equalConstraintSettingWithName(\"Equal Width\",{class:\"BMLayoutEditorImageButtonEqualWidth\",attribute:BMLayoutAttribute.Width}));a.appendChild(this.settingsDivider());c=this.readonlySettingWithName(\"Align Vertical\",{value:\"\"});b.childNodes[0].style.textAlign=\"center\";b.childNodes[0].style.width=\"100%\";a.appendChild(c);c=document.createElement(\"div\");c.style=\"display: flex; flex-direction: row; align-self: center; padding-top: 8px; padding-bottom: 8px\";a.appendChild(c);c.appendChild(this.equalConstraintSettingWithName(\"Align Leading\",\n{class:\"BMLayoutEditorImageButtonAlignLeading\",attribute:BMLayoutAttribute.Leading}));c.appendChild(this.equalConstraintSettingWithName(\"Align Center\",{class:\"BMLayoutEditorImageButtonAlignCenterX\",attribute:BMLayoutAttribute.CenterX}));c.appendChild(this.equalConstraintSettingWithName(\"Align Trailing\",{class:\"BMLayoutEditorImageButtonAlignTrailing\",attribute:BMLayoutAttribute.Trailing}));a.appendChild(this.settingsDivider());c=this.readonlySettingWithName(\"Distribute Vertical\",{value:\"\"});b.childNodes[0].style.textAlign=\n\"center\";b.childNodes[0].style.width=\"100%\";a.appendChild(c);c=document.createElement(\"div\");c.style=\"display: flex; flex-direction: row; align-self: center; padding-top: 8px; padding-bottom: 8px\";a.appendChild(c);c.appendChild(this.buttonSettingWithName(\"Equal Spacing\",{class:\"BMLayoutEditorImageButtonEqualVerticalSpacing\",action:(a)=>{let b=BMEqualSpacingLayoutConstraint.constraintOfKind(BMLayoutConstraintKind.Vertical,{forViews:this.selectedViews.slice().sort((a,b)=>a.node.getBoundingClientRect().top-\nb.node.getBoundingClientRect().top),withSuperview:NO,_internal:a.shiftKey});a.shiftKey?b.constituentConstraints((a)=>{a._install();this.addConstraint(a)}):this.addConstraint(b)}}));c.appendChild(this.buttonSettingWithName(\"Equal Spacing In Superview\",{class:\"BMLayoutEditorImageButtonEqualVerticalSpacingInSuperview\",action:(a)=>{let b=BMEqualSpacingLayoutConstraint.constraintOfKind(BMLayoutConstraintKind.Vertical,{forViews:this.selectedViews.slice().sort((a,b)=>a.node.getBoundingClientRect().top-b.node.getBoundingClientRect().top),\nwithSuperview:YES,_internal:a.shiftKey});a.shiftKey?b.constituentConstraints((a)=>{a._install();this.addConstraint(a)}):this.addConstraint(b)}}));c.appendChild(this.equalConstraintSettingWithName(\"Equal Height\",{class:\"BMLayoutEditorImageButtonEqualHeight\",attribute:BMLayoutAttribute.Height}))}});BMLayoutEditor.editorForView=function(a){return(new BMLayoutEditor).initWithView(a)};function _BMLayoutEditorTree(){}\n_BMLayoutEditorTree.prototype={_node:void 0,_view:void 0,_editor:void 0,_viewNodeMap:void 0,_constraintNodeMap:void 0,initWithView(a,b){this._node=b.node;this._view=a;this._editor=b.editor;this._viewNodeMap=new Map;this._constraintNodeMap=new Map;this._buildTree();return this},_buildTree(){this._node.innerHTML=\"\";this._node.appendChild(this.treeNodeForView(this._view))},treeNodeForView(a){let b=document.createElement(\"div\");b.classList.add(\"BMLayoutTreeView\");let c=document.createElement(\"div\");c.classList.add(\"BMLayoutTreeViewTitle\");\nc.classList.add(\"BMLayoutTreeViewEntity\");b.appendChild(c);this._editor.initDragEventListenerForNode(c,{view:a});this._viewNodeMap.set(a,c);let d=document.createElement(\"div\");d.classList.add(\"BMDisclosureTriangle\");d.classList.add(\"BMDisclosureTriangleExpanded\");c.appendChild(d);c.appendChild(document.createTextNode(a.debuggingName||a.node.id));let e=document.createElement(\"div\");e.classList.add(\"BMLayoutTreeViewContainer\");e.classList.add(\"BMLayoutTreeViewContainerExpanded\");b.appendChild(e);a.subviews.forEach((a)=>\ne.appendChild(this.treeNodeForView(a)));a.subviews.length||(d.style.visibility=\"hidden\");let f=document.createElement(\"div\");f.classList.add(\"BMLayoutTreeViewConstraintsTitle\");f.classList.add(\"BMLayoutTreeViewEntity\");f.style.display=\"none\";let h=document.createElement(\"div\");h.classList.add(\"BMDisclosureTriangle\");f.appendChild(h);f.appendChild(document.createTextNode(\"Constraints\"));e.appendChild(f);let g=document.createElement(\"div\");g.classList.add(\"BMLayoutTreeViewConstraintsContainer\");g.classList.add(\"BMLayoutTreeViewContainer\");\ng.style.display=\"none\";e.appendChild(g);h.addEventListener(\"click\",(a)=>{g.classList.contains(\"BMLayoutTreeViewContainerExpanded\")?(g.classList.remove(\"BMLayoutTreeViewContainerExpanded\"),h.classList.remove(\"BMDisclosureTriangleExpanded\")):(g.classList.add(\"BMLayoutTreeViewContainerExpanded\"),h.classList.add(\"BMDisclosureTriangleExpanded\"));a.stopPropagation()});c.addEventListener(\"click\",(b)=>this._editor.selectView(a,{withEvent:b}));d.addEventListener(\"click\",(a)=>{e.classList.contains(\"BMLayoutTreeViewContainerExpanded\")?\n(e.classList.remove(\"BMLayoutTreeViewContainerExpanded\"),d.classList.remove(\"BMDisclosureTriangleExpanded\")):(e.classList.add(\"BMLayoutTreeViewContainerExpanded\"),d.classList.add(\"BMDisclosureTriangleExpanded\"));a.stopPropagation()});a.localConstraints.forEach((b)=>g.appendChild(this.treeNodeForConstraint(b,{withReferenceView:a})));return b},treeNodeForConstraint(a,b){let c=document.createElement(\"div\");c.classList.add(\"BMLayoutTreeViewConstraintsTitle\");c.classList.add(\"BMLayoutTreeViewEntity\");\nc.innerText=a.toCompactString();c.addEventListener(\"click\",(c)=>this._editor.selectConstraint(a,{withReferenceView:b.withReferenceView}));let d=this._constraintNodeMap.get(a);d||(d=[],this._constraintNodeMap.set(a,d));d.push(c);return c},selectView(a,b){b&&b.continuous||this._node.querySelectorAll(\".BMLayoutTreeViewEntitySelected\").forEach((a)=>a.classList.remove(\"BMLayoutTreeViewEntitySelected\"));(a=this._viewNodeMap.get(a))&&a.classList.add(\"BMLayoutTreeViewEntitySelected\")},deselectView(a,b){(a=\nthis._viewNodeMap.get(a))&&a.classList.remove(\"BMLayoutTreeViewEntitySelected\")},selectConstraint(a){this._node.querySelectorAll(\".BMLayoutTreeViewEntitySelected\").forEach((a)=>a.classList.remove(\"BMLayoutTreeViewEntitySelected\"));(a=this._constraintNodeMap.get(a))&&a.forEach((a)=>a.classList.add(\"BMLayoutTreeViewEntitySelected\"))},removeConstraint(a){var b=this._constraintNodeMap.get(a);b&&b.forEach((a)=>a.remove());this._constraintNodeMap.delete(a)},addConstraint(a){var b=[],c=this._viewNodeMap.get(a._firstView);\nif(c){var d=this.treeNodeForConstraint(a),e=c.parentNode.childNodes;e=e[e.length-1];e.appendChild(d);b.push(d)}this._viewNodeMap.get(a._secondView)&&(d=this.treeNodeForConstraint(a),e=c.parentNode.childNodes,e=e[e.length-1],e.appendChild(d),b.push(d));this._constraintNodeMap.set(a,b)}};_BMLayoutEditorTree.editorTreeWithView=function(a,b){return(new _BMLayoutEditorTree).initWithView(a,b)};var BMLayoutEditorAvailable=YES;\n(function(a){function b(a){var b=a.length,d=c.type(a);return\"function\"===d||c.isWindow(a)?!1:1===a.nodeType&&b?!0:\"array\"===d||0===b||\"number\"===typeof b&&0<b&&b-1 in a}if(!a.jQuery){var c=function(a,b){return new c.fn.init(a,b)};c.isWindow=function(a){return a&&a===a.window};c.type=function(a){return a?\"object\"===typeof a||\"function\"===typeof a?e[h.call(a)]||\"object\":typeof a:a+\"\"};c.isArray=Array.isArray||function(a){return\"array\"===c.type(a)};c.isPlainObject=function(a){var b;if(!a||\"object\"!==\nc.type(a)||a.nodeType||c.isWindow(a))return!1;try{if(a.constructor&&!f.call(a,\"constructor\")&&!f.call(a.constructor.prototype,\"isPrototypeOf\"))return!1}catch(q){return!1}for(b in a);return void 0===b||f.call(a,b)};c.each=function(a,c,d){var e=0,l=a.length;var k=b(a);if(d)if(k)for(;e<l&&(k=c.apply(a[e],d),!1!==k);e++);else for(e in a){if(k=c.apply(a[e],d),!1===k)break}else if(k)for(;e<l&&(k=c.call(a[e],e,a[e]),!1!==k);e++);else for(e in a)if(k=c.call(a[e],e,a[e]),!1===k)break;return a};c.data=function(a,\nb,e){if(void 0===e){e=(e=a[c.expando])&&d[e];if(void 0===b)return e;if(e&&b in e)return e[b]}else if(void 0!==b)return a=a[c.expando]||(a[c.expando]=++c.uuid),d[a]=d[a]||{},d[a][b]=e};c.removeData=function(a,b){var e=(a=a[c.expando])&&d[a];e&&(b?c.each(b,function(a,b){delete e[b]}):delete d[a])};c.extend=function(){var a,b,d,e=arguments[0]||{},k=1,f=arguments.length,h=!1;\"boolean\"===typeof e&&(h=e,e=arguments[k]||{},k++);\"object\"!==typeof e&&\"function\"!==c.type(e)&&(e={});k===f&&(e=this,k--);for(;k<\nf;k++)if(d=arguments[k])for(b in d){var g=e[b];var p=d[b];e!==p&&(h&&p&&(c.isPlainObject(p)||(a=c.isArray(p)))?(a?(a=!1,g=g&&c.isArray(g)?g:[]):g=g&&c.isPlainObject(g)?g:{},e[b]=c.extend(h,g,p)):void 0!==p&&(e[b]=p))}return e};c.queue=function(a,d,e){function l(a,c){c=c||[];if(a)if(b(Object(a))){a=\"string\"===typeof a?[a]:a;for(var d=+a.length,e=0,l=c.length;e<d;)c[l++]=a[e++];if(d!==d)for(;void 0!==a[e];)c[l++]=a[e++];c.length=l}else[].push.call(c,a);return c}if(a){d=(d||\"fx\")+\"queue\";var k=c.data(a,\nd);if(!e)return k||[];!k||c.isArray(e)?k=c.data(a,d,l(e)):k.push(e);return k}};c.dequeue=function(a,b){c.each(a.nodeType?[a]:a,function(a,d){b=b||\"fx\";a=c.queue(d,b);var e=a.shift();\"inprogress\"===e&&(e=a.shift());e&&(\"fx\"===b&&a.unshift(\"inprogress\"),e.call(d,function(){c.dequeue(d,b)}))})};c.fn=c.prototype={init:function(a){if(a.nodeType)return this[0]=a,this;throw Error(\"Not a DOM node.\");},offset:function(){var b=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:b.top+\n(a.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:b.left+(a.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){var a=this[0],b;for(b=a.offsetParent||document;b&&\"html\"!==b.nodeType.toLowerCase&&\"static\"===b.style.position;)b=b.offsetParent;b=b||document;var d=this.offset(),e=/^(?:body|html)$/i.test(b.nodeName)?{top:0,left:0}:c(b).offset();d.top-=parseFloat(a.style.marginTop)||0;d.left-=parseFloat(a.style.marginLeft)||0;b.style&&(e.top+=parseFloat(b.style.borderTopWidth)||\n0,e.left+=parseFloat(b.style.borderLeftWidth)||0);return{top:d.top-e.top,left:d.left-e.left}}};var d={};c.expando=\"velocity\"+(new Date).getTime();c.uuid=0;for(var e={},f=e.hasOwnProperty,h=e.toString,g=\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"),k=0;k<g.length;k++)e[\"[object \"+g[k]+\"]\"]=g[k].toLowerCase();c.fn.init.prototype=c.fn;a.Velocity={Utilities:c}}})(window);\n(function(a){\"object\"===typeof module&&\"object\"===typeof module.exports?module.exports=a():\"function\"===typeof define&&define.amd?define(a):a()})(function(){return function(a,b,c,d){function e(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function f(a){w.isWrapped(a)?a=[].slice.call(a):w.isNode(a)&&(a=[a]);return a}function h(a){a=t.data(a,\"velocity\");return null===a?d:a}function g(a){return function(b){return 1/a*Math.round(b*a)}}function k(a,c,d,e){function l(a,b,\nc){return(((1-3*c+3*b)*a+(3*c-6*b))*a+3*b)*a}var k=\"Float32Array\"in b;if(4!==arguments.length)return!1;for(var f=0;4>f;++f)if(\"number\"!==typeof arguments[f]||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;a=Math.min(a,1);d=Math.min(d,1);a=Math.max(a,0);d=Math.max(d,0);var h=k?new Float32Array(11):Array(11),g=!1;k=function(b){if(!g&&(g=!0,a!==c||d!==e))for(var k=0;11>k;++k)h[k]=l(.1*k,a,d);if(a===c&&d===e)return b;if(0===b)return 0;if(1===b)return 1;var f=0;for(k=1;10!==k&&h[k]<=b;++k)f+=.1;\n--k;k=f+(b-h[k])/(h[k+1]-h[k])*.1;var m=3*(1-3*d+3*a)*k*k+2*(3*d-6*a)*k+3*a;if(.001<=m){for(f=0;4>f;++f){m=3*(1-3*d+3*a)*k*k+2*(3*d-6*a)*k+3*a;if(0===m)break;var q=l(k,a,d)-b;k-=q/m}b=k}else if(0===m)b=k;else{k=f;f+=.1;var n=0;do q=k+(f-k)/2,m=l(q,a,d)-b,0<m?f=q:k=q;while(1E-7<Math.abs(m)&&10>++n);b=q}return l(b,c,e)};k.getControlPoints=function(){return[{x:a,y:c},{x:d,y:e}]};var m=\"generateBezier(\"+[a,c,d,e]+\")\";k.toString=function(){return m};return k}function l(a,b){var c=a;w.isString(a)?p.Easings[a]||\n(c=!1):c=w.isArray(a)&&1===a.length?g.apply(null,a):w.isArray(a)&&2===a.length?D.apply(null,a.concat([b])):w.isArray(a)&&4===a.length?k.apply(null,a):!1;!1===c&&(c=p.Easings[p.defaults.easing]?p.defaults.easing:\"swing\");return c}function m(a){if(a){a=(new Date).getTime();var b=p.State.calls.length;1E4<b&&(p.State.calls=e(p.State.calls),b=p.State.calls.length);for(var c=0;c<b;c++)if(p.State.calls[c]){var k=p.State.calls[c],l=k[0],f=k[2],g=k[3],n=!!g,u=null;g||(g=p.State.calls[c][3]=a-16);for(var z=\nMath.min((a-g)/f.duration,1),x=0,D=l.length;x<D;x++){var F=l[x],y=F.element;if(h(y)){var A=!1;f.display!==d&&null!==f.display&&\"none\"!==f.display&&(\"flex\"===f.display&&t.each([\"-webkit-box\",\"-moz-box\",\"-ms-flexbox\",\"-webkit-flex\"],function(a,b){r.setPropertyValue(y,\"display\",b)}),r.setPropertyValue(y,\"display\",f.display));f.visibility!==d&&\"hidden\"!==f.visibility&&r.setPropertyValue(y,\"visibility\",f.visibility);for(var K in F)if(\"element\"!==K){var C=F[K];var L=w.isString(C.easing)?p.Easings[C.easing]:\nC.easing;if(1===z)L=C.endValue;else{var M=C.endValue-C.startValue;L=C.startValue+M*L(z,f,M);if(!n&&L===C.currentValue)continue}C.currentValue=L;if(\"tween\"===K)u=L;else{if(r.Hooks.registered[K]){var J=r.Hooks.getRoot(K);if(M=h(y).rootPropertyValueCache[J])C.rootPropertyValue=M}C=r.setPropertyValue(y,K,C.currentValue+(0===parseFloat(L)?\"\":C.unitType),C.rootPropertyValue,C.scrollData);r.Hooks.registered[K]&&(r.Normalizations.registered[J]?h(y).rootPropertyValueCache[J]=r.Normalizations.registered[J](\"extract\",\nnull,C[1]):h(y).rootPropertyValueCache[J]=C[1]);\"transform\"===C[0]&&(A=!0)}}f.mobileHA&&h(y).transformCache.translate3d===d&&(h(y).transformCache.translate3d=\"(0px, 0px, 0px)\",A=!0);A&&r.flushTransformCache(y)}}f.display!==d&&\"none\"!==f.display&&(p.State.calls[c][2].display=!1);f.visibility!==d&&\"hidden\"!==f.visibility&&(p.State.calls[c][2].visibility=!1);f.progress&&f.progress.call(k[1],k[1],z,Math.max(0,g+f.duration-a),g,u);1===z&&q(c)}}p.State.isTicking&&v(m)}function q(a,b){if(!p.State.calls[a])return!1;\nfor(var c=p.State.calls[a][0],e=p.State.calls[a][1],k=p.State.calls[a][2],l=p.State.calls[a][4],f=!1,g=0,m=c.length;g<m;g++){var q=c[g].element;b||k.loop||(\"none\"===k.display&&r.setPropertyValue(q,\"display\",k.display),\"hidden\"===k.visibility&&r.setPropertyValue(q,\"visibility\",k.visibility));var n=h(q);if(!0!==k.loop&&(t.queue(q)[1]===d||!/\\.velocityQueueEntryFlag/i.test(t.queue(q)[1]))&&n){n.isAnimating=!1;n.rootPropertyValueCache={};var u=!1;t.each(r.Lists.transforms3D,function(a,b){a=/^scale/.test(b)?\n1:0;var c=n.transformCache[b];n.transformCache[b]!==d&&(new RegExp(\"^\\\\(\"+a+\"[^.]\")).test(c)&&(u=!0,delete n.transformCache[b])});k.mobileHA&&(u=!0,delete n.transformCache.translate3d);u&&r.flushTransformCache(q);r.Values.removeClass(q,\"velocity-animating\")}if(!b&&k.complete&&!k.loop&&g===m-1)try{k.complete.call(e,e)}catch(F){setTimeout(function(){throw F;},1)}l&&!0!==k.loop&&l(e);n&&!0===k.loop&&!b&&(t.each(n.tweensContainer,function(a,b){if(/^rotate/.test(a)&&0===(parseFloat(b.startValue)-parseFloat(b.endValue))%\n360){var c=b.startValue;b.startValue=b.endValue;b.endValue=c}/^backgroundPosition/.test(a)&&100===parseFloat(b.endValue)&&\"%\"===b.unitType&&(b.endValue=0,b.startValue=100)}),p(q,\"reverse\",{loop:!0,delay:k.delay}));!1!==k.queue&&t.dequeue(q,k.queue)}p.State.calls[a]=!1;a=0;for(b=p.State.calls.length;a<b;a++)if(!1!==p.State.calls[a]){f=!0;break}!1===f&&(p.State.isTicking=!1,delete p.State.calls,p.State.calls=[])}var n=function(){if(c.documentMode)return c.documentMode;for(var a=7;4<a;a--){var b=c.createElement(\"div\");\nb.innerHTML=\"\\x3c!--[if IE \"+a+\"]><span></span><![endif]--\\x3e\";if(b.getElementsByTagName(\"span\").length)return a}return d}(),u=function(){var a=0;return b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||function(b){var c=(new Date).getTime();var d=Math.max(0,16-(c-a));a=c+d;return setTimeout(function(){b(c+d)},d)}}(),w={isString:function(a){return\"string\"===typeof a},isArray:Array.isArray||function(a){return\"[object Array]\"===Object.prototype.toString.call(a)},isFunction:function(a){return\"[object Function]\"===\nObject.prototype.toString.call(a)},isNode:function(a){return a&&a.nodeType},isNodeList:function(a){return\"object\"===typeof a&&/^\\[object (HTMLCollection|NodeList|Object)\\]$/.test(Object.prototype.toString.call(a))&&a.length!==d&&(0===a.length||\"object\"===typeof a[0]&&0<a[0].nodeType)},isWrapped:function(a){return a&&(a.jquery||b.Zepto&&b.Zepto.zepto.isZ(a))},isSVG:function(a){return b.SVGElement&&a instanceof b.SVGElement},isEmptyObject:function(a){for(var b in a)return!1;return!0}},x=!1;if(a.fn&&\na.fn.jquery){var t=a;x=!0}else t=b.Velocity.Utilities;if(8>=n&&!x)throw Error(\"Velocity: IE8 and below require jQuery to be loaded before Velocity.\");if(7>=n)jQuery.fn.velocity=jQuery.fn.animate;else{var p={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\\.3\\.[3-7]/i.test(navigator.userAgent),isChrome:b.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:c.createElement(\"div\"),\nprefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:t,Redirects:{},Easings:{},Promise:b.Promise,defaults:{queue:\"\",duration:400,easing:\"swing\",begin:d,complete:d,progress:d,display:d,visibility:d,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(a){t.data(a,\"velocity\",{isSVG:w.isSVG(a),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,\nminor:3,patch:0},debug:!1};b.pageYOffset!==d?(p.State.scrollAnchor=b,p.State.scrollPropertyLeft=\"pageXOffset\",p.State.scrollPropertyTop=\"pageYOffset\"):(p.State.scrollAnchor=c.documentElement||c.body.parentNode||c.body,p.State.scrollPropertyLeft=\"scrollLeft\",p.State.scrollPropertyTop=\"scrollTop\");var D=function(){function a(a,b,c){var d=a.v+c.dv*b;return{dx:d,dv:-a.tension*(a.x+c.dx*b)-a.friction*d}}function b(b,c){var d={dx:b.v,dv:-b.tension*b.x-b.friction*b.v},e=a(b,.5*c,d),k=a(b,.5*c,e),l=a(b,c,\nk),f=1/6*(d.dv+2*(e.dv+k.dv)+l.dv);b.x+=1/6*(d.dx+2*(e.dx+k.dx)+l.dx)*c;b.v+=f*c;return b}return function N(a,c,d){var e={x:-1,v:0,tension:null,friction:null},k=[0],l=0,f;a=parseFloat(a)||500;c=parseFloat(c)||20;d=d||null;e.tension=a;e.friction=c;(f=null!==d)?(l=N(a,c),a=l/d*.016):a=.016;for(;;){var h=b(h||e,a);k.push(1+h.x);l+=16;if(!(1E-4<Math.abs(h.x)&&1E-4<Math.abs(h.v)))break}return f?function(a){return k[a*(k.length-1)|0]}:l}}();p.Easings={linear:function(a){return a},swing:function(a){return.5-\nMath.cos(a*Math.PI)/2},spring:function(a){return 1-Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)}};t.each([[\"ease\",[.25,.1,.25,1]],[\"ease-in\",[.42,0,1,1]],[\"ease-out\",[0,0,.58,1]],[\"ease-in-out\",[.42,0,.58,1]],[\"easeInSine\",[.47,0,.745,.715]],[\"easeOutSine\",[.39,.575,.565,1]],[\"easeInOutSine\",[.445,.05,.55,.95]],[\"easeInQuad\",[.55,.085,.68,.53]],[\"easeOutQuad\",[.25,.46,.45,.94]],[\"easeInOutQuad\",[.455,.03,.515,.955]],[\"easeInCubic\",[.55,.055,.675,.19]],[\"easeOutCubic\",[.215,.61,.355,1]],[\"easeInOutCubic\",\n[.645,.045,.355,1]],[\"easeInQuart\",[.895,.03,.685,.22]],[\"easeOutQuart\",[.165,.84,.44,1]],[\"easeInOutQuart\",[.77,0,.175,1]],[\"easeInQuint\",[.755,.05,.855,.06]],[\"easeOutQuint\",[.23,1,.32,1]],[\"easeInOutQuint\",[.86,0,.07,1]],[\"easeInExpo\",[.95,.05,.795,.035]],[\"easeOutExpo\",[.19,1,.22,1]],[\"easeInOutExpo\",[1,0,0,1]],[\"easeInCirc\",[.6,.04,.98,.335]],[\"easeOutCirc\",[.075,.82,.165,1]],[\"easeInOutCirc\",[.785,.135,.15,.86]]],function(a,b){p.Easings[b[0]]=k.apply(null,b[1])});var r=p.CSS={RegEx:{isHex:/^#([A-f\\d]{3}){1,2}$/i,\nvalueUnwrap:/^[A-z]+\\((.*)\\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\\(.+\\))|(([A-z0-9#-.]+?)(?=\\s|$))/ig},Lists:{colors:\"fill stroke stopColor color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor outlineColor\".split(\" \"),transformsBase:\"translateX translateY scale scaleX scaleY skewX skewY rotateZ\".split(\" \"),transforms3D:[\"transformPerspective\",\"translateZ\",\"scaleZ\",\"rotateX\",\"rotateY\"]},Hooks:{templates:{textShadow:[\"Color X Y Blur\",\n\"black 0px 0px 0px\"],boxShadow:[\"Color X Y Blur Spread\",\"black 0px 0px 0px 0px\"],clip:[\"Top Right Bottom Left\",\"0px 0px 0px 0px\"],backgroundPosition:[\"X Y\",\"0% 0%\"],transformOrigin:[\"X Y Z\",\"50% 50% 0px\"],perspectiveOrigin:[\"X Y\",\"50% 50%\"]},registered:{},register:function(){for(var a=0;a<r.Lists.colors.length;a++)r.Hooks.templates[r.Lists.colors[a]]=[\"Red Green Blue Alpha\",\"color\"===r.Lists.colors[a]?\"0 0 0 1\":\"255 255 255 1\"];var b;if(n)for(b in r.Hooks.templates){var c=r.Hooks.templates[b];a=c[0].split(\" \");\nc=c[1].match(r.RegEx.valueSplit);\"Color\"===a[0]&&(a.push(a.shift()),c.push(c.shift()),r.Hooks.templates[b]=[a.join(\" \"),c.join(\" \")])}for(b in r.Hooks.templates){c=r.Hooks.templates[b];a=c[0].split(\" \");for(var d in a)r.Hooks.registered[b+a[d]]=[b,d]}},getRoot:function(a){var b=r.Hooks.registered[a];return b?b[0]:a},cleanRootPropertyValue:function(a,b){r.RegEx.valueUnwrap.test(b)&&(b=b.match(r.RegEx.valueUnwrap)[1]);r.Values.isCSSNullValue(b)&&(b=r.Hooks.templates[a][1]);return b},extractValue:function(a,\nb){if(a=r.Hooks.registered[a]){var c=a[1];b=r.Hooks.cleanRootPropertyValue(a[0],b);return b.toString().match(r.RegEx.valueSplit)[c]}return b},injectValue:function(a,b,c){var d=r.Hooks.registered[a];return d?(a=d[1],c=r.Hooks.cleanRootPropertyValue(d[0],c),c=c.toString().match(r.RegEx.valueSplit),c[a]=b,c.join(\" \")):c}},Normalizations:{registered:{clip:function(a,b,c){switch(a){case \"name\":return\"clip\";case \"extract\":return a=r.RegEx.wrappedValueAlreadyExtracted.test(c)?c:(a=c.toString().match(r.RegEx.valueUnwrap))?\na[1].replace(/,(\\s+)?/g,\" \"):c,a;case \"inject\":return\"rect(\"+c+\")\"}},blur:function(a,b,c){switch(a){case \"name\":return p.State.isFirefox?\"filter\":\"-webkit-filter\";case \"extract\":return a=parseFloat(c),a||0===a||(a=(c=c.toString().match(/blur\\(([0-9]+[A-z]+)\\)/i))?c[1]:0),a;case \"inject\":return parseFloat(c)?\"blur(\"+c+\")\":\"none\"}},opacity:function(a,b,c){if(8>=n)switch(a){case \"name\":return\"filter\";case \"extract\":return c=(a=c.toString().match(/alpha\\(opacity=(.*)\\)/i))?a[1]/100:1;case \"inject\":return b.style.zoom=\n1,1<=parseFloat(c)?\"\":\"alpha(opacity=\"+parseInt(100*parseFloat(c),10)+\")\"}else switch(a){case \"name\":return\"opacity\";case \"extract\":return c;case \"inject\":return c}}},register:function(){n&&!(9<n)||p.State.isGingerbread||(r.Lists.transformsBase=r.Lists.transformsBase.concat(r.Lists.transforms3D));for(var a=0;a<r.Lists.transformsBase.length;a++)(function(){var b=r.Lists.transformsBase[a];r.Normalizations.registered[b]=function(a,c,e){switch(a){case \"name\":return\"transform\";case \"extract\":return h(c)===\nd||h(c).transformCache[b]===d?/^scale/i.test(b)?1:0:h(c).transformCache[b].replace(/[()]/g,\"\");case \"inject\":a=!1;switch(b.substr(0,b.length-1)){case \"translate\":a=!/(%|px|em|rem|vw|vh|\\d)$/i.test(e);break;case \"scal\":case \"scale\":p.State.isAndroid&&h(c).transformCache[b]===d&&1>e&&(e=1);a=!/(\\d)$/i.test(e);break;case \"skew\":a=!/(deg|\\d)$/i.test(e);break;case \"rotate\":a=!/(deg|\\d)$/i.test(e)}a||(h(c).transformCache[b]=\"(\"+e+\")\");return h(c).transformCache[b]}}})();for(var b=0;b<r.Lists.colors.length;b++)(function(){var a=\nr.Lists.colors[b];r.Normalizations.registered[a]=function(b,c,e){switch(b){case \"name\":return a;case \"extract\":if(!r.RegEx.wrappedValueAlreadyExtracted.test(e)){b={black:\"rgb(0, 0, 0)\",blue:\"rgb(0, 0, 255)\",gray:\"rgb(128, 128, 128)\",green:\"rgb(0, 128, 0)\",red:\"rgb(255, 0, 0)\",white:\"rgb(255, 255, 255)\"};if(/^[A-z]+$/i.test(e))var k=b[e]!==d?b[e]:b.black;else r.RegEx.isHex.test(e)?k=\"rgb(\"+r.Values.hexToRgb(e).join(\" \")+\")\":/^rgba?\\(/i.test(e)||(k=b.black);e=(k||e).toString().match(r.RegEx.valueUnwrap)[1].replace(/,(\\s+)?/g,\n\" \")}(!n||8<n)&&3===e.split(\" \").length&&(e+=\" 1\");return e;case \"inject\":return 8>=n?4===e.split(\" \").length&&(e=e.split(/\\s+/).slice(0,3).join(\" \")):3===e.split(\" \").length&&(e+=\" 1\"),(8>=n?\"rgb\":\"rgba\")+\"(\"+e.replace(/\\s+/g,\",\").replace(/\\.(\\d)+(?=,)/g,\"\")+\")\"}}})()}},Names:{camelCase:function(a){return a.replace(/-(\\w)/g,function(a,b){return b.toUpperCase()})},SVGAttribute:function(a){var b=\"width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2\";if(n||p.State.isAndroid&&!p.State.isChrome)b+=\"|transform\";\nreturn(new RegExp(\"^(\"+b+\")$\",\"i\")).test(a)},prefixCheck:function(a){if(p.State.prefixMatches[a])return[p.State.prefixMatches[a],!0];for(var b=[\"\",\"Webkit\",\"Moz\",\"ms\",\"O\"],c=0,d=b.length;c<d;c++){var e=0===c?a:b[c]+a.replace(/^\\w/,function(a){return a.toUpperCase()});if(w.isString(p.State.prefixElement.style[e]))return p.State.prefixMatches[a]=e,[e,!0]}return[a,!1]}},Values:{hexToRgb:function(a){a=a.replace(/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,function(a,b,c,d){return b+b+c+c+d+d});return(a=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(a))?\n[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:[0,0,0]},isCSSNullValue:function(a){return!a||/^(none|auto|transparent|(rgba\\(0, ?0, ?0, ?0\\)))$/i.test(a)},getUnitType:function(a){return/^(rotate|skew)/i.test(a)?\"deg\":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(a)?\"\":\"px\"},getDisplayType:function(a){a=a&&a.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(a)?\n\"inline\":/^(li)$/i.test(a)?\"list-item\":/^(tr)$/i.test(a)?\"table-row\":/^(table)$/i.test(a)?\"table\":/^(tbody)$/i.test(a)?\"table-row-group\":\"block\"},addClass:function(a,b){a.classList?a.classList.add(b):a.className+=(a.className.length?\" \":\"\")+b},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.toString().replace(new RegExp(\"(^|\\\\s)\"+b.split(\" \").join(\"|\")+\"(\\\\s|$)\",\"gi\"),\" \")}},getPropertyValue:function(a,c,e,k){function l(a,c){var e=0;if(8>=n)e=t.css(a,c);else{var f=\n!1;/^(width|height)$/.test(c)&&0===r.getPropertyValue(a,\"display\")&&(f=!0,r.setPropertyValue(a,\"display\",r.Values.getDisplayType(a)));var g=function(){f&&r.setPropertyValue(a,\"display\",\"none\")};if(!k){if(\"height\"===c&&\"border-box\"!==r.getPropertyValue(a,\"boxSizing\").toString().toLowerCase())return c=a.offsetHeight-(parseFloat(r.getPropertyValue(a,\"borderTopWidth\"))||0)-(parseFloat(r.getPropertyValue(a,\"borderBottomWidth\"))||0)-(parseFloat(r.getPropertyValue(a,\"paddingTop\"))||0)-(parseFloat(r.getPropertyValue(a,\n\"paddingBottom\"))||0),g(),c;if(\"width\"===c&&\"border-box\"!==r.getPropertyValue(a,\"boxSizing\").toString().toLowerCase())return c=a.offsetWidth-(parseFloat(r.getPropertyValue(a,\"borderLeftWidth\"))||0)-(parseFloat(r.getPropertyValue(a,\"borderRightWidth\"))||0)-(parseFloat(r.getPropertyValue(a,\"paddingLeft\"))||0)-(parseFloat(r.getPropertyValue(a,\"paddingRight\"))||0),g(),c}e=h(a)===d?b.getComputedStyle(a,null):h(a).computedStyle?h(a).computedStyle:h(a).computedStyle=b.getComputedStyle(a,null);\"borderColor\"===\nc&&(c=\"borderTopColor\");e=9===n&&\"filter\"===c?e.getPropertyValue(c):e[c];if(\"\"===e||null===e)e=a.style[c];g()}\"auto\"===e&&/^(top|right|bottom|left)$/i.test(c)&&(g=l(a,\"position\"),\"fixed\"===g||\"absolute\"===g&&/top|left/i.test(c))&&(e=t(a).position()[c]+\"px\");return e}if(r.Hooks.registered[c]){var f=r.Hooks.getRoot(c);e===d&&(e=r.getPropertyValue(a,r.Names.prefixCheck(f)[0]));r.Normalizations.registered[f]&&(e=r.Normalizations.registered[f](\"extract\",a,e));f=r.Hooks.extractValue(c,e)}else if(r.Normalizations.registered[c]){e=\nr.Normalizations.registered[c](\"name\",a);if(\"transform\"!==e){var g=l(a,r.Names.prefixCheck(e)[0]);r.Values.isCSSNullValue(g)&&r.Hooks.templates[c]&&(g=r.Hooks.templates[c][1])}f=r.Normalizations.registered[c](\"extract\",a,g)}if(!/^[\\d-]/.test(f))if((e=h(a))&&e.isSVG&&r.Names.SVGAttribute(c))if(/^(height|width)$/i.test(c))try{f=a.getBBox()[c]}catch(S){f=0}else f=a.getAttribute(c);else f=l(a,r.Names.prefixCheck(c)[0]);r.Values.isCSSNullValue(f)&&(f=0);2<=p.debug&&console.log(\"Get \"+c+\": \"+f);return f},\nsetPropertyValue:function(a,c,d,e,k){var l=c;if(\"scroll\"===c)k.container?k.container[\"scroll\"+k.direction]=d:\"Left\"===k.direction?b.scrollTo(d,k.alternateValue):b.scrollTo(k.alternateValue,d);else if(r.Normalizations.registered[c]&&\"transform\"===r.Normalizations.registered[c](\"name\",a))r.Normalizations.registered[c](\"inject\",a,d),l=\"transform\",d=h(a).transformCache[c];else{r.Hooks.registered[c]&&(l=c,c=r.Hooks.getRoot(c),e=e||r.getPropertyValue(a,c),d=r.Hooks.injectValue(l,d,e));r.Normalizations.registered[c]&&\n(d=r.Normalizations.registered[c](\"inject\",a,d),c=r.Normalizations.registered[c](\"name\",a));l=r.Names.prefixCheck(c)[0];if(8>=n)try{a.style[l]=d}catch(N){p.debug&&console.log(\"Browser does not support [\"+d+\"] for [\"+l+\"]\")}else(e=h(a))&&e.isSVG&&r.Names.SVGAttribute(c)?a.setAttribute(c,d):a.style[l]=d;2<=p.debug&&console.log(\"Set \"+c+\" (\"+l+\"): \"+d)}return[l,d]},flushTransformCache:function(a){var b=\"\",c=h(a);if((n||p.State.isAndroid&&!p.State.isChrome)&&c&&c.isSVG){c=function(b){return parseFloat(r.getPropertyValue(a,\nb))};var d={translate:[c(\"translateX\"),c(\"translateY\")],skewX:[c(\"skewX\")],skewY:[c(\"skewY\")],scale:1!==c(\"scale\")?[c(\"scale\"),c(\"scale\")]:[c(\"scaleX\"),c(\"scaleY\")],rotate:[c(\"rotateZ\"),0,0]};t.each(h(a).transformCache,function(a){/^translate/i.test(a)?a=\"translate\":/^scale/i.test(a)?a=\"scale\":/^rotate/i.test(a)&&(a=\"rotate\");d[a]&&(b+=a+\"(\"+d[a].join(\" \")+\") \",delete d[a])})}else{var e,k;t.each(h(a).transformCache,function(c){e=h(a).transformCache[c];if(\"transformPerspective\"===c)return k=e,!0;9===\nn&&\"rotateZ\"===c&&(c=\"rotate\");b+=c+e+\" \"});k&&(b=\"perspective\"+k+\" \"+b)}r.setPropertyValue(a,\"transform\",b)}};r.Hooks.register();r.Normalizations.register();p.hook=function(a,b,c){var e;a=f(a);t.each(a,function(a,k){h(k)===d&&p.init(k);c===d?e===d&&(e=p.CSS.getPropertyValue(k,b)):(a=p.CSS.setPropertyValue(k,b,c),\"transform\"===a[0]&&p.CSS.flushTransformCache(k),e=a)});return e};var A=function(){function a(a,e){function k(k){if(f.begin&&0===Q)try{f.begin.call(n,n)}catch(V){setTimeout(function(){throw V;\n},1)}if(\"scroll\"===O){var u=/^x$/i.test(f.axis)?\"Left\":\"Top\";var y=parseFloat(f.offset)||0;if(f.container)if(w.isWrapped(f.container)||w.isNode(f.container)){f.container=f.container[0]||f.container;var B=f.container[\"scroll\"+u];var z=B+t(a).position()[u.toLowerCase()]+y}else f.container=null;else{B=p.State.scrollAnchor[p.State[\"scrollProperty\"+u]];var H=p.State.scrollAnchor[p.State[\"scrollProperty\"+(\"Left\"===u?\"Top\":\"Left\")]];z=t(a).offset()[u.toLowerCase()]+y}g={scroll:{rootPropertyValue:!1,startValue:B,\ncurrentValue:B,endValue:z,unitType:\"\",easing:f.easing,scrollData:{container:f.container,direction:u,alternateValue:H}},element:a};p.debug&&console.log(\"tweensContainer (scroll): \",g.scroll,a)}else if(\"reverse\"===O){var A=h(a);if(!A)return;if(A.tweensContainer){\"none\"===A.opts.display&&(A.opts.display=\"auto\");\"hidden\"===A.opts.visibility&&(A.opts.visibility=\"visible\");A.opts.loop=!1;A.opts.begin=null;A.opts.complete=null;v.easing||delete f.easing;v.duration||delete f.duration;f=t.extend({},A.opts,\nf);u=t.extend(!0,{},A?A.tweensContainer:null);for(var E in u)\"element\"!==E&&(y=u[E].startValue,u[E].startValue=u[E].currentValue=u[E].endValue,u[E].endValue=y,w.isEmptyObject(v)||(u[E].easing=f.easing),p.debug&&console.log(\"reverse tweensContainer (\"+E+\"): \"+JSON.stringify(u[E]),a));g=u}else{t.dequeue(a,f.queue);return}}else if(\"start\"===O){(A=h(a))&&A.tweensContainer&&!0===A.isAnimating&&(u=A.tweensContainer);var T=function(b,c){if(w.isArray(b)){var k=b[0];if(!w.isArray(b[1])&&/^[\\d-]/.test(b[1])||\nw.isFunction(b[1])||r.RegEx.isHex.test(b[1]))var g=b[1];else if(w.isString(b[1])&&!r.RegEx.isHex.test(b[1])||w.isArray(b[1])){var h=c?b[1]:l(b[1],f.duration);b[2]!==d&&(g=b[2])}}else k=b;c||(h=h||f.easing);w.isFunction(k)&&(k=k.call(a,e,D));w.isFunction(g)&&(g=g.call(a,e,D));return[k||0,h,g]};t.each(x,function(a,b){if(RegExp(\"^\"+r.Lists.colors.join(\"$|^\")+\"$\").test(r.Names.camelCase(a))){var c=T(b,!0),e=c[0];b=c[1];var k=c[2];if(r.RegEx.isHex.test(e)){c=[\"Red\",\"Green\",\"Blue\"];e=r.Values.hexToRgb(e);\nk=k?r.Values.hexToRgb(k):d;for(var f=0;f<c.length;f++){var l=[e[f]];b&&l.push(b);k!==d&&l.push(k[f]);x[r.Names.camelCase(a)+c[f]]=l}delete x[a]}}});for(y in x)if(z=T(x[y]),B=z[0],H=z[1],z=z[2],y=r.Names.camelCase(y),k=r.Hooks.getRoot(y),E=!1,A&&A.isSVG||\"tween\"===k||!1!==r.Names.prefixCheck(k)[1]||r.Normalizations.registered[k]!==d){(f.display!==d&&null!==f.display&&\"none\"!==f.display||f.visibility!==d&&\"hidden\"!==f.visibility)&&/opacity|filter/.test(y)&&!z&&0!==B&&(z=0);f._cacheValues&&u&&u[y]?(z===\nd&&(z=u[y].endValue+u[y].unitType),E=A.rootPropertyValueCache[k]):r.Hooks.registered[y]?z===d?(E=r.getPropertyValue(a,k),z=r.getPropertyValue(a,y,E)):E=r.Hooks.templates[k][1]:z===d&&(z=r.getPropertyValue(a,y));var G=!1,J=function(a,b){var c;b=(b||\"0\").toString().toLowerCase().replace(/[%A-z]+$/,function(a){c=a;return\"\"});c||(c=r.Values.getUnitType(a));return[b,c]};var F=J(y,z);z=F[0];k=F[1];F=J(y,B);B=F[0].replace(/^([+-\\/*])=/,function(a,b){G=b;return\"\"});F=F[1];z=parseFloat(z)||0;B=parseFloat(B)||\n0;\"%\"===F&&(/^(fontSize|lineHeight)$/.test(y)?(B/=100,F=\"em\"):/^scale/.test(y)?(B/=100,F=\"\"):/(Red|Green|Blue)$/i.test(y)&&(B=B/100*255,F=\"\"));J=function(){var d=a.parentNode||c.body,e=r.getPropertyValue(a,\"position\"),k=r.getPropertyValue(a,\"fontSize\"),f=e===C.lastPosition&&d===C.lastParent,l=k===C.lastFontSize;C.lastParent=d;C.lastPosition=e;C.lastFontSize=k;var g={};if(l&&f)g.emToPx=C.lastEmToPx,g.percentToPxWidth=C.lastPercentToPxWidth,g.percentToPxHeight=C.lastPercentToPxHeight;else{var h=A&&\nA.isSVG?c.createElementNS(\"http://www.w3.org/2000/svg\",\"rect\"):c.createElement(\"div\");p.init(h);d.appendChild(h);t.each([\"overflow\",\"overflowX\",\"overflowY\"],function(a,b){p.CSS.setPropertyValue(h,b,\"hidden\")});p.CSS.setPropertyValue(h,\"position\",e);p.CSS.setPropertyValue(h,\"fontSize\",k);p.CSS.setPropertyValue(h,\"boxSizing\",\"content-box\");t.each(\"minWidth maxWidth width minHeight maxHeight height\".split(\" \"),function(a,b){p.CSS.setPropertyValue(h,b,\"100%\")});p.CSS.setPropertyValue(h,\"paddingLeft\",\n\"100em\");g.percentToPxWidth=C.lastPercentToPxWidth=(parseFloat(r.getPropertyValue(h,\"width\",null,!0))||1)/100;g.percentToPxHeight=C.lastPercentToPxHeight=(parseFloat(r.getPropertyValue(h,\"height\",null,!0))||1)/100;g.emToPx=C.lastEmToPx=(parseFloat(r.getPropertyValue(h,\"paddingLeft\"))||1)/100;d.removeChild(h)}null===C.remToPx&&(C.remToPx=parseFloat(r.getPropertyValue(c.body,\"fontSize\"))||16);null===C.vwToPx&&(C.vwToPx=parseFloat(b.innerWidth)/100,C.vhToPx=parseFloat(b.innerHeight)/100);g.remToPx=C.remToPx;\ng.vwToPx=C.vwToPx;g.vhToPx=C.vhToPx;1<=p.debug&&console.log(\"Unit ratios: \"+JSON.stringify(g),a);return g};if(/[\\/*]/.test(G))F=k;else if(k!==F&&0!==z)if(0===B)F=k;else{q=q||J();J=/margin|padding|left|right|width|text|word|letter/i.test(y)||/X$/.test(y)||\"x\"===y?\"x\":\"y\";switch(k){case \"%\":z*=\"x\"===J?q.percentToPxWidth:q.percentToPxHeight;break;case \"px\":break;default:z*=q[k+\"ToPx\"]}switch(F){case \"%\":z*=1/(\"x\"===J?q.percentToPxWidth:q.percentToPxHeight);break;case \"px\":break;default:z*=1/q[F+\"ToPx\"]}}switch(G){case \"+\":B=\nz+B;break;case \"-\":B=z-B;break;case \"*\":B*=z;break;case \"/\":B=z/B}g[y]={rootPropertyValue:E,startValue:z,currentValue:z,endValue:B,unitType:F,easing:H};p.debug&&console.log(\"tweensContainer (\"+y+\"): \"+JSON.stringify(g[y]),a)}else p.debug&&console.log(\"Skipping [\"+k+\"] due to a lack of browser support.\");g.element=a}if(g.element){r.Values.addClass(a,\"velocity-animating\");L.push(g);if(A=h(a))\"\"===f.queue&&(A.tweensContainer=g,A.opts=f),A.isAnimating=!0;Q===D-1?(p.State.calls.push([L,n,f,null,I.resolver]),\n!1===p.State.isTicking&&(p.State.isTicking=!0,m())):Q++}}var f=t.extend({},p.defaults,v),g={},q;h(a)===d&&p.init(a);parseFloat(f.delay)&&!1!==f.queue&&t.queue(a,f.queue,function(b){p.velocityQueueEntryFlag=!0;h(a).delayTimer={setTimeout:setTimeout(b,parseFloat(f.delay)),next:b}});switch(f.duration.toString().toLowerCase()){case \"fast\":f.duration=200;break;case \"normal\":f.duration=400;break;case \"slow\":f.duration=600;break;default:f.duration=parseFloat(f.duration)||1}!1!==p.mock&&(!0===p.mock?f.duration=\nf.delay=1:(f.duration*=parseFloat(p.mock)||1,f.delay*=parseFloat(p.mock)||1));f.easing=l(f.easing,f.duration);f.begin&&!w.isFunction(f.begin)&&(f.begin=null);f.progress&&!w.isFunction(f.progress)&&(f.progress=null);f.complete&&!w.isFunction(f.complete)&&(f.complete=null);f.display!==d&&null!==f.display&&(f.display=f.display.toString().toLowerCase(),\"auto\"===f.display&&(f.display=p.CSS.Values.getDisplayType(a)));f.visibility!==d&&null!==f.visibility&&(f.visibility=f.visibility.toString().toLowerCase());\nf.mobileHA=f.mobileHA&&p.State.isMobile&&!p.State.isGingerbread;!1===f.queue?f.delay?setTimeout(k,f.delay):k():t.queue(a,f.queue,function(a,b){if(!0===b)return I.promise&&I.resolver(n),!0;p.velocityQueueEntryFlag=!0;k(a)});\"\"!==f.queue&&\"fx\"!==f.queue||\"inprogress\"===t.queue(a)[0]||t.dequeue(a)}var e=arguments[0]&&(arguments[0].p||t.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||w.isString(arguments[0].properties));if(w.isWrapped(this)){var k=!1;var g=0;var n=this;var u=this}else k=\n!0,g=1,n=e?arguments[0].elements||arguments[0].e:arguments[0];if(n=f(n)){if(e){var x=arguments[0].properties||arguments[0].p;var v=arguments[0].options||arguments[0].o}else x=arguments[g],v=arguments[g+1];var D=n.length,Q=0;if(!/^(stop|finish|finishAll)$/i.test(x)&&!t.isPlainObject(v))for(v={},e=g+1;e<arguments.length;e++)w.isArray(arguments[e])||!/^(fast|normal|slow)$/i.test(arguments[e])&&!/^\\d/.test(arguments[e])?w.isString(arguments[e])||w.isArray(arguments[e])?v.easing=arguments[e]:w.isFunction(arguments[e])&&\n(v.complete=arguments[e]):v.duration=arguments[e];var I={promise:null,resolver:null,rejecter:null};k&&p.Promise&&(I.promise=new p.Promise(function(a,b){I.resolver=a;I.rejecter=b}));switch(x){case \"scroll\":var O=\"scroll\";break;case \"reverse\":O=\"reverse\";break;case \"finish\":case \"finishAll\":case \"stop\":t.each(n,function(a,b){h(b)&&h(b).delayTimer&&(clearTimeout(h(b).delayTimer.setTimeout),h(b).delayTimer.next&&h(b).delayTimer.next(),delete h(b).delayTimer);\"finishAll\"!==x||!0!==v&&!w.isString(v)||(t.each(t.queue(b,\nw.isString(v)?v:\"\"),function(a,b){w.isFunction(b)&&b()}),t.queue(b,w.isString(v)?v:\"\",[]))});var F=[];t.each(p.State.calls,function(a,b){b&&t.each(b[1],function(c,e){var k=v===d?\"\":v;if(!0!==k&&b[2].queue!==k&&(v!==d||!1!==b[2].queue))return!0;t.each(n,function(c,d){if(d===e){if(!0===v||w.isString(v))t.each(t.queue(d,w.isString(v)?v:\"\"),function(a,b){w.isFunction(b)&&b(null,!0)}),t.queue(d,w.isString(v)?v:\"\",[]);if(\"stop\"===x)(c=h(d))&&c.tweensContainer&&!1!==k&&t.each(c.tweensContainer,function(a,\nb){b.endValue=b.currentValue}),F.push(a);else if(\"finish\"===x||\"finishAll\"===x)b[2].duration=1}})})});\"stop\"===x&&(t.each(F,function(a,b){q(b,!0)}),I.promise&&I.resolver(n));return k?I.promise||null:u;default:if(t.isPlainObject(x)&&!w.isEmptyObject(x))O=\"start\";else{if(w.isString(x)&&p.Redirects[x]){var y=t.extend({},v);var U=y.duration,K=y.delay||0;!0===y.backwards&&(n=t.extend(!0,[],n).reverse());t.each(n,function(a,b){parseFloat(y.stagger)?y.delay=K+parseFloat(y.stagger)*a:w.isFunction(y.stagger)&&\n(y.delay=K+y.stagger.call(b,a,D));y.drag&&(y.duration=parseFloat(U)||(/^(callout|transition)/.test(x)?1E3:400),y.duration=Math.max(y.duration*(y.backwards?1-a/D:(a+1)/D),.75*y.duration,200));p.Redirects[x].call(b,b,y||{},a,D,n,I.promise?I:d)})}else e=\"Velocity: First argument (\"+x+\") was not a property map, a known action, or a registered redirect. Aborting.\",I.promise?I.rejecter(Error(e)):console.log(e);return k?I.promise||null:u}}var C={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,\nlastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},L=[];t.each(n,function(b,c){w.isNode(c)&&a(c,b)});y=t.extend({},p.defaults,v);y.loop=parseInt(y.loop,10);e=2*y.loop-1;if(y.loop)for(g=0;g<e;g++){var M={delay:y.delay,progress:y.progress};g===e-1&&(M.display=y.display,M.visibility=y.visibility,M.complete=y.complete);A(n,\"reverse\",M)}return k?I.promise||null:u}};p=t.extend(A,p);p.animate=A;var v=b.requestAnimationFrame||u;p.State.isMobile||c.hidden===d||c.addEventListener(\"visibilitychange\",\nfunction(){c.hidden?(v=function(a){return setTimeout(function(){a(!0)},16)},m()):v=b.requestAnimationFrame||u});a.Velocity=p;a!==b&&(a.fn.velocity=A,a.fn.velocity.defaults=p.defaults);t.each([\"Down\",\"Up\"],function(a,b){p.Redirects[\"slide\"+b]=function(a,c,e,k,f,l){c=t.extend({},c);var g=c.begin,h=c.complete,m={height:\"\",marginTop:\"\",marginBottom:\"\",paddingTop:\"\",paddingBottom:\"\"},q={};c.display===d&&(c.display=\"Down\"===b?\"inline\"===p.CSS.Values.getDisplayType(a)?\"inline-block\":\"block\":\"none\");c.begin=\nfunction(){g&&g.call(f,f);for(var c in m){q[c]=a.style[c];var d=p.CSS.getPropertyValue(a,c);m[c]=\"Down\"===b?[d,0]:[0,d]}q.overflow=a.style.overflow;a.style.overflow=\"hidden\"};c.complete=function(){for(var b in q)a.style[b]=q[b];h&&h.call(f,f);l&&l.resolver(f)};p(a,m,c)}});t.each([\"In\",\"Out\"],function(a,b){p.Redirects[\"fade\"+b]=function(a,c,e,k,f,l){a=t.extend({},c);var g=a.complete;c={opacity:\"In\"===b?1:0};a.complete=e!==k-1?a.begin=null:function(){g&&g.call(f,f);l&&l.resolver(f)};a.display===d&&\n(a.display=\"In\"===b?\"auto\":\"none\");p(this,c,a)}});return p}}(window.jQuery||window.Zepto||window,window,document)});\n(function(a,b,c){function d(c,d){this.wrapper=\"string\"==typeof c?b.querySelector(c):c;this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,disablePointer:!g.hasPointer,disableTouch:g.hasPointer||!g.hasTouch,disableMouse:g.hasPointer||g.hasTouch,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:\"\",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},\nHWCompositing:!0,useTransition:!0,useTransform:!0,bindToWrapper:\"undefined\"===typeof a.onmousedown};for(var e in d)this.options[e]=d[e];this.translateZ=this.options.HWCompositing&&g.hasPerspective?\" translateZ(0)\":\"\";this.options.useTransition=g.hasTransition&&this.options.useTransition;this.options.useTransform=g.hasTransform&&this.options.useTransform;this.options.eventPassthrough=!0===this.options.eventPassthrough?\"vertical\":this.options.eventPassthrough;this.options.preventDefault=!this.options.eventPassthrough&&\nthis.options.preventDefault;this.options.scrollY=\"vertical\"==this.options.eventPassthrough?!1:this.options.scrollY;this.options.scrollX=\"horizontal\"==this.options.eventPassthrough?!1:this.options.scrollX;this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough;this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold;this.options.bounceEasing=\"string\"==typeof this.options.bounceEasing?g.ease[this.options.bounceEasing]||g.ease.circular:\nthis.options.bounceEasing;this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling;!0===this.options.tap&&(this.options.tap=\"tap\");this.options.useTransition||this.options.useTransform||/relative|absolute/i.test(this.scrollerStyle.position)||(this.scrollerStyle.position=\"relative\");\"scale\"==this.options.shrinkScrollbars&&(this.options.useTransition=!1);this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1;3==this.options.probeType&&(this.options.useTransition=\n!1);this.directionY=this.directionX=this.y=this.x=0;this._events={};this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY);this.enable()}function e(a,c,d){var e=b.createElement(\"div\"),k=b.createElement(\"div\");!0===d&&(e.style.cssText=\"position:absolute;z-index:9999\",k.style.cssText=\"-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px\");k.className=\n\"iScrollIndicator\";\"h\"==a?(!0===d&&(e.style.cssText+=\";height:7px;left:2px;right:2px;bottom:0\",k.style.height=\"100%\"),e.className=\"iScrollHorizontalScrollbar\"):(!0===d&&(e.style.cssText+=\";width:7px;bottom:2px;top:2px;right:1px\",k.style.width=\"100%\"),e.className=\"iScrollVerticalScrollbar\");e.style.cssText+=\";overflow:hidden\";c||(e.style.pointerEvents=\"none\");e.appendChild(k);return e}function f(c,d){this.wrapper=\"string\"==typeof d.el?b.querySelector(d.el):d.el;this.wrapperStyle=this.wrapper.style;\nthis.indicator=this.wrapper.children[0];this.indicatorStyle=this.indicator.style;this.scroller=c;this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in d)this.options[e]=d[e];this.sizeRatioY=this.sizeRatioX=1;this.maxPosY=this.maxPosX=0;this.options.interactive&&(this.options.disableTouch||(g.addEvent(this.indicator,\"touchstart\",this),g.addEvent(a,\"touchend\",this)),this.options.disablePointer||(g.addEvent(this.indicator,\ng.prefixPointerEvent(\"pointerdown\"),this),g.addEvent(a,g.prefixPointerEvent(\"pointerup\"),this)),this.options.disableMouse||(g.addEvent(this.indicator,\"mousedown\",this),g.addEvent(a,\"mouseup\",this)));if(this.options.fade){this.wrapperStyle[g.style.transform]=this.scroller.translateZ;var k=g.style.transitionDuration;if(k){this.wrapperStyle[k]=g.isBadAndroid?\"0.0001ms\":\"0ms\";var f=this;g.isBadAndroid&&h(function(){\"0.0001ms\"===f.wrapperStyle[k]&&(f.wrapperStyle[k]=\"0s\")});this.wrapperStyle.opacity=\"0\"}}}\nvar h=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1E3/60)},g=function(){function d(a){return!1===g?!1:\"\"===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement(\"div\").style,g=function(){for(var a=[\"t\",\"webkitT\",\"MozT\",\"msT\",\"OT\"],b,c=0,d=a.length;c<d;c++)if(b=a[c]+\"ransform\",b in f)return a[c].substr(0,a[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()};\ne.extend=function(a,b){for(var c in b)a[c]=b[c]};e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)};e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)};e.prefixPointerEvent=function(b){return a.MSPointerEvent?\"MSPointer\"+b.charAt(7).toUpperCase()+b.substr(8):b};e.momentum=function(a,b,d,e,k,f){b=a-b;d=c.abs(b)/d;f=void 0===f?6E-4:f;var l=a+d*d/(2*f)*(0>b?-1:1);f=d/f;l<e?(l=k?e-k/2.5*(d/8):e,b=c.abs(l-a),f=b/d):0<l&&(l=k?k/2.5*(d/8):0,b=c.abs(a)+l,f=b/d);return{destination:c.round(l),\nduration:f}};var h=d(\"transform\");e.extend(e,{hasTransform:!1!==h,hasPerspective:d(\"perspective\")in f,hasTouch:\"ontouchstart\"in a,hasPointer:!(!a.PointerEvent&&!a.MSPointerEvent),hasTransition:d(\"transition\")in f});e.isBadAndroid=function(){var b=a.navigator.appVersion;return/Android/.test(b)&&!/Chrome\\/\\d/.test(b)?(b=b.match(/Safari\\/(\\d+.\\d)/))&&\"object\"===typeof b&&2<=b.length?535.19>parseFloat(b[1]):!0:!1}();e.extend(e.style={},{transform:h,transitionTimingFunction:d(\"transitionTimingFunction\"),\ntransitionDuration:d(\"transitionDuration\"),transitionDelay:d(\"transitionDelay\"),transformOrigin:d(\"transformOrigin\")});e.hasClass=function(a,b){return(new RegExp(\"(^|\\\\s)\"+b+\"(\\\\s|$)\")).test(a.className)};e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(\" \");c.push(b);a.className=c.join(\" \")}};e.removeClass=function(a,b){e.hasClass(a,b)&&(a.className=a.className.replace(new RegExp(\"(^|\\\\s)\"+b+\"(\\\\s|$)\",\"g\"),\" \"))};e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=\na.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}};e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1};e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3});e.extend(e.ease={},{quadratic:{style:\"cubic-bezier(0.25, 0.46, 0.45, 0.94)\",fn:function(a){return a*(2-a)}},circular:{style:\"cubic-bezier(0.1, 0.57, 0.1, 1)\",\nfn:function(a){return c.sqrt(1- --a*a)}},back:{style:\"cubic-bezier(0.175, 0.885, 0.32, 1.275)\",fn:function(a){return--a*a*(5*a+4)+1}},bounce:{style:\"\",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:\"\",fn:function(a){return 0===a?0:1==a?1:.4*c.pow(2,-10*a)*c.sin(2*(a-.055)*c.PI/.22)+1}}});e.tap=function(a,c){var d=b.createEvent(\"Event\");d.initEvent(c,!0,!0);d.pageX=a.pageX;\nd.pageY=a.pageY;a.target.dispatchEvent(d)};e.click=function(c){var d=c.target;if(!/(SELECT|INPUT|TEXTAREA)/i.test(d.tagName)){var e=b.createEvent(a.MouseEvent?\"MouseEvents\":\"Event\");e.initEvent(\"click\",!0,!0);e.view=c.view||a;e.detail=1;e.screenX=d.screenX||0;e.screenY=d.screenY||0;e.clientX=d.clientX||0;e.clientY=d.clientY||0;e.ctrlKey=!!c.ctrlKey;e.altKey=!!c.altKey;e.shiftKey=!!c.shiftKey;e.metaKey=!!c.metaKey;e.button=0;e.relatedTarget=null;e._constructed=!0;d.dispatchEvent(e)}};return e}();d.prototype=\n{version:\"5.2.0\",_init:function(){this._initEvents();(this.options.scrollbars||this.options.indicators)&&this._initIndicators();this.options.mouseWheel&&this._initWheel();this.options.snap&&this._initSnap();this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0);clearTimeout(this.resizeTimeout);this.resizeTimeout=null;this._execEvent(\"destroy\")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||\n(this.isInTransition=!1,this._execEvent(\"scrollEnd\")))},_start:function(a){if(!(1!=g.eventType[a.type]&&0!==(a.which?a.button:2>a.button?0:4==a.button?1:2)||!this.enabled||this.initiated&&g.eventType[a.type]!==this.initiated)){!this.options.preventDefault||g.isBadAndroid||g.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b=a.touches?a.touches[0]:a;this.initiated=g.eventType[a.type];this.moved=!1;this.directionLocked=this.directionY=this.directionX=this.distY=\nthis.distX=0;this.startTime=g.getTime();this.options.useTransition&&this.isInTransition?(this._transitionTime(),this.isInTransition=!1,a=this.getComputedPosition(),this._translate(c.round(a.x),c.round(a.y)),this._execEvent(\"scrollEnd\")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent(\"scrollEnd\"));this.startX=this.x;this.startY=this.y;this.absStartX=this.x;this.absStartY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this._execEvent(\"beforeScrollStart\")}},_move:function(a){if(this.enabled&&\ng.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b=a.touches?a.touches[0]:a,d=b.pageX-this.pointX,e=b.pageY-this.pointY,f=g.getTime();this.pointX=b.pageX;this.pointY=b.pageY;this.distX+=d;this.distY+=e;b=c.abs(this.distX);var k=c.abs(this.distY);if(!(300<f-this.endTime&&10>b&&10>k)){this.directionLocked||this.options.freeScroll||(this.directionLocked=b>k+this.options.directionLockThreshold?\"h\":k>=b+this.options.directionLockThreshold?\"v\":\"n\");if(\"h\"==this.directionLocked){if(\"vertical\"==\nthis.options.eventPassthrough)a.preventDefault();else if(\"horizontal\"==this.options.eventPassthrough){this.initiated=!1;return}e=0}else if(\"v\"==this.directionLocked){if(\"horizontal\"==this.options.eventPassthrough)a.preventDefault();else if(\"vertical\"==this.options.eventPassthrough){this.initiated=!1;return}d=0}d=this.hasHorizontalScroll?d:0;e=this.hasVerticalScroll?e:0;b=this.x+d;k=this.y+e;if(0<b||b<this.maxScrollX)b=this.options.bounce?this.x+d/3:0<b?0:this.maxScrollX;if(0<k||k<this.maxScrollY)k=\nthis.options.bounce?this.y+e/3:0<k?0:this.maxScrollY;this.directionX=0<d?-1:0>d?1:0;this.directionY=0<e?-1:0>e?1:0;this.moved||this._execEvent(\"scrollStart\");this.moved=!0;this._translate(b,k);300<f-this.startTime&&(this.startTime=f,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent(\"scroll\"));1<this.options.probeType&&this._execEvent(\"scroll\");this.options.stopPropagation&&a.stopPropagation()}}},_end:function(a){if(this.enabled&&g.eventType[a.type]===this.initiated){this.options.preventDefault&&\n!g.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b=g.getTime()-this.startTime;var d=c.round(this.x),e=c.round(this.y),f=c.abs(d-this.startX),k=c.abs(e-this.startY);var h=0;var x=\"\";this.initiated=this.isInTransition=0;this.endTime=g.getTime();if(!this.resetPosition(this.options.bounceTime))if(this.scrollTo(d,e),this.moved)if(this._events.flick&&200>b&&100>f&&100>k)this._execEvent(\"flick\");else if(this.options.momentum&&300>b&&(h=this.hasHorizontalScroll?\ng.momentum(this.x,this.startX,b,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:d,duration:0},b=this.hasVerticalScroll?g.momentum(this.y,this.startY,b,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:e,duration:0},d=h.destination,e=b.destination,h=c.max(h.duration,b.duration),this.isInTransition=1),this.options.snap&&(this.currentPage=x=this._nearestSnap(d,e),h=this.options.snapSpeed||c.max(c.max(c.min(c.abs(d-\nx.x),1E3),c.min(c.abs(e-x.y),1E3)),300),d=x.x,e=x.y,this.directionY=this.directionX=0,x=this.options.bounceEasing),d!=this.x||e!=this.y){if(0<d||d<this.maxScrollX||0<e||e<this.maxScrollY)x=g.ease.quadratic;this.scrollTo(d,e,h,x)}else this._execEvent(\"scrollEnd\");else this.options.tap&&g.tap(a,this.options.tap),this.options.click&&g.click(a),this._execEvent(\"scrollCancel\")}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},\nresetPosition:function(a){var b=this.x,c=this.y;!this.hasHorizontalScroll||0<this.x?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX);!this.hasVerticalScroll||0<this.y?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY);if(b==this.x&&c==this.y)return!1;this.scrollTo(b,c,a||0,this.options.bounceEasing);return!0},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;this.scrollerWidth=\nthis.scroller.offsetWidth;this.scrollerHeight=this.scroller.offsetHeight;this.maxScrollX=this.wrapperWidth-this.scrollerWidth;this.maxScrollY=this.wrapperHeight-this.scrollerHeight;this.hasHorizontalScroll=this.options.scrollX&&0>this.maxScrollX;this.hasVerticalScroll=this.options.scrollY&&0>this.maxScrollY;this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth);this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight);this.directionY=this.directionX=\nthis.endTime=0;this.wrapperOffset=g.offset(this.wrapper);this._execEvent(\"refresh\");this.resetPosition()},on:function(a,b){this._events[a]||(this._events[a]=[]);this._events[a].push(b)},off:function(a,b){this._events[a]&&(b=this._events[a].indexOf(b),-1<b&&this._events[a].splice(b,1))},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;b<c;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a;b=this.y+b;this.scrollTo(a,\nb,c||0,d)},scrollTo:function(a,b,c,d){d=d||g.ease.circular;this.isInTransition=this.options.useTransition&&0<c;var e=this.options.useTransition&&d.style;!c||e?(e&&(this._transitionTimingFunction(d.style),this._transitionTime(c)),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var k=g.offset(a);k.left-=this.wrapperOffset.left;k.top-=this.wrapperOffset.top;!0===d&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/\n2));!0===e&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2));k.left-=d||0;k.top-=e||0;k.left=0<k.left?0:k.left<this.maxScrollX?this.maxScrollX:k.left;k.top=0<k.top?0:k.top<this.maxScrollY?this.maxScrollY:k.top;b=void 0===b||null===b||\"auto\"===b?c.max(c.abs(this.x-k.left),c.abs(this.y-k.top)):b;this.scrollTo(k.left,k.top,b,f)}},_transitionTime:function(a){if(this.options.useTransition){a=a||0;var b=g.style.transitionDuration;if(b){this.scrollerStyle[b]=a+\"ms\";if(!a&&g.isBadAndroid){this.scrollerStyle[b]=\n\"0.0001ms\";var c=this;h(function(){\"0.0001ms\"===c.scrollerStyle[b]&&(c.scrollerStyle[b]=\"0s\")})}if(this.indicators)for(var d=this.indicators.length;d--;)this.indicators[d].transitionTime(a)}}},_transitionTimingFunction:function(a){this.scrollerStyle[g.style.transitionTimingFunction]=a;if(this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},_translate:function(a,b){this.options.useTransform?this.scrollerStyle[g.style.transform]=\"translate(\"+a+\"px,\"+\nb+\"px)\"+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+\"px\",this.scrollerStyle.top=b+\"px\");this.x=a;this.y=b;if(this.indicators)for(a=this.indicators.length;a--;)this.indicators[a].updatePosition()},_initEvents:function(b){b=b?g.removeEvent:g.addEvent;var c=this.options.bindToWrapper?this.wrapper:a;b(a,\"orientationchange\",this);b(a,\"resize\",this);this.options.click&&b(this.wrapper,\"click\",this,!0);this.options.disableMouse||(b(this.wrapper,\"mousedown\",this),b(c,\"mousemove\",this),\nb(c,\"mousecancel\",this),b(c,\"mouseup\",this));g.hasPointer&&!this.options.disablePointer&&(b(this.wrapper,g.prefixPointerEvent(\"pointerdown\"),this),b(c,g.prefixPointerEvent(\"pointermove\"),this),b(c,g.prefixPointerEvent(\"pointercancel\"),this),b(c,g.prefixPointerEvent(\"pointerup\"),this));g.hasTouch&&!this.options.disableTouch&&(b(this.wrapper,\"touchstart\",this),b(c,\"touchmove\",this),b(c,\"touchcancel\",this),b(c,\"touchend\",this));b(this.scroller,\"transitionend\",this);b(this.scroller,\"webkitTransitionEnd\",\nthis);b(this.scroller,\"oTransitionEnd\",this);b(this.scroller,\"MSTransitionEnd\",this)},getComputedPosition:function(){var b=a.getComputedStyle(this.scroller,null);if(this.options.useTransform){b=b[g.style.transform].split(\")\")[0].split(\", \");var c=+(b[12]||b[4]);b=+(b[13]||b[5])}else c=+b.left.replace(/[^-\\d.]/g,\"\"),b=+b.top.replace(/[^-\\d.]/g,\"\");return{x:c,y:b}},_initIndicators:function(){function a(a){if(g.indicators)for(var b=g.indicators.length;b--;)a.call(g.indicators[b])}var b=this.options.interactiveScrollbars,\nc=\"string\"!=typeof this.options.scrollbars,d=[],g=this;this.indicators=[];if(this.options.scrollbars){if(this.options.scrollY){var h={el:e(\"v\",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:c,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1};this.wrapper.appendChild(h.el);d.push(h)}this.options.scrollX&&(h={el:e(\"h\",b,this.options.scrollbars),interactive:b,defaultScrollbars:!0,customStyle:c,resize:this.options.resizeScrollbars,\nshrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(h.el),d.push(h))}this.options.indicators&&(d=d.concat(this.options.indicators));for(b=d.length;b--;)this.indicators.push(new f(this,d[b]));this.options.fadeScrollbars&&(this.on(\"scrollEnd\",function(){a(function(){this.fade()})}),this.on(\"scrollCancel\",function(){a(function(){this.fade()})}),this.on(\"scrollStart\",function(){a(function(){this.fade(1)})}),this.on(\"beforeScrollStart\",function(){a(function(){this.fade(1,\n!0)})}));this.on(\"refresh\",function(){a(function(){this.refresh()})});this.on(\"destroy\",function(){a(function(){this.destroy()});delete this.indicators})},_initWheel:function(){g.addEvent(this.wrapper,\"wheel\",this);g.addEvent(this.wrapper,\"mousewheel\",this);g.addEvent(this.wrapper,\"DOMMouseScroll\",this);this.on(\"destroy\",function(){clearTimeout(this.wheelTimeout);this.wheelTimeout=null;g.removeEvent(this.wrapper,\"wheel\",this);g.removeEvent(this.wrapper,\"mousewheel\",this);g.removeEvent(this.wrapper,\n\"DOMMouseScroll\",this)})},_wheel:function(a){if(this.enabled){a.preventDefault();var b=this;void 0===this.wheelTimeout&&b._execEvent(\"scrollStart\");clearTimeout(this.wheelTimeout);this.wheelTimeout=setTimeout(function(){b.options.snap||b._execEvent(\"scrollEnd\");b.wheelTimeout=void 0},400);if(\"deltaX\"in a)if(1===a.deltaMode){var d=-a.deltaX*this.options.mouseWheelSpeed;a=-a.deltaY*this.options.mouseWheelSpeed}else d=-a.deltaX,a=-a.deltaY;else if(\"wheelDeltaX\"in a)d=a.wheelDeltaX/120*this.options.mouseWheelSpeed,\na=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if(\"wheelDelta\"in a)d=a=a.wheelDelta/120*this.options.mouseWheelSpeed;else if(\"detail\"in a)d=a=-a.detail/3*this.options.mouseWheelSpeed;else return;d*=this.options.invertWheelDirection;a*=this.options.invertWheelDirection;this.hasVerticalScroll||(d=a,a=0);if(this.options.snap){var e=this.currentPage.pageX;var f=this.currentPage.pageY;0<d?e--:0>d&&e++;0<a?f--:0>a&&f++;this.goToPage(e,f)}else e=this.x+c.round(this.hasHorizontalScroll?d:0),f=this.y+\nc.round(this.hasVerticalScroll?a:0),this.directionX=0<d?-1:0>d?1:0,this.directionY=0<a?-1:0>a?1:0,0<e?e=0:e<this.maxScrollX&&(e=this.maxScrollX),0<f?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0),1<this.options.probeType&&this._execEvent(\"scroll\")}},_initSnap:function(){this.currentPage={};\"string\"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap));this.on(\"refresh\",function(){var a=0,b,d=0,e,f=0,g;var h=this.options.snapStepX||this.wrapperWidth;\nvar x=this.options.snapStepY||this.wrapperHeight;this.pages=[];if(this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap){var t=c.round(h/2);for(e=c.round(x/2);f>-this.scrollerWidth;){this.pages[a]=[];for(g=b=0;g>-this.scrollerHeight;)this.pages[a][b]={x:c.max(f,this.maxScrollX),y:c.max(g,this.maxScrollY),width:h,height:x,cx:f-t,cy:g-e},g-=x,b++;f-=h;a++}}else for(x=this.options.snap,b=x.length,h=-1;a<b;a++){if(0===a||x[a].offsetLeft<=x[a-1].offsetLeft)d=\n0,h++;this.pages[d]||(this.pages[d]=[]);f=c.max(-x[a].offsetLeft,this.maxScrollX);g=c.max(-x[a].offsetTop,this.maxScrollY);t=f-c.round(x[a].offsetWidth/2);e=g-c.round(x[a].offsetHeight/2);this.pages[d][h]={x:f,y:g,width:x[a].offsetWidth,height:x[a].offsetHeight,cx:t,cy:e};f>this.maxScrollX&&d++}this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0);0===this.options.snapThreshold%1?this.snapThresholdY=this.snapThresholdX=this.options.snapThreshold:(this.snapThresholdX=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*\nthis.options.snapThreshold),this.snapThresholdY=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}});this.on(\"flick\",function(){var a=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.x-this.startX),1E3),c.min(c.abs(this.y-this.startY),1E3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,b){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var d=0,e=this.pages.length,\nf=0;if(c.abs(a-this.absStartX)<this.snapThresholdX&&c.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;0<a?a=0:a<this.maxScrollX&&(a=this.maxScrollX);0<b?b=0:b<this.maxScrollY&&(b=this.maxScrollY);for(;d<e;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;f<e;f++)if(b>=this.pages[0][f].cy){b=this.pages[0][f].y;break}d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x);f==this.currentPage.pageY&&\n(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),b=this.pages[0][f].y);return{x:a,y:b,pageX:d,pageY:f}},goToPage:function(a,b,d,e){e=e||this.options.bounceEasing;a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0);b>=this.pages[a].length?b=this.pages[a].length-1:0>b&&(b=0);var f=this.pages[a][b].x,k=this.pages[a][b].y;d=void 0===d?this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-this.x),1E3),c.min(c.abs(k-this.y),1E3)),300):d;this.currentPage={x:f,y:k,pageX:a,pageY:b};\nthis.scrollTo(f,k,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++;c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++);this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--;0>c&&this.hasVerticalScroll&&(c=0,d--);this.goToPage(c,d,a,b)},_initKeys:function(b){b={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};var c;if(\"object\"==typeof this.options.keyBindings)for(c in this.options.keyBindings)\"string\"==\ntypeof this.options.keyBindings[c]&&(this.options.keyBindings[c]=this.options.keyBindings[c].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(c in b)this.options.keyBindings[c]=this.options.keyBindings[c]||b[c];g.addEvent(a,\"keydown\",this);this.on(\"destroy\",function(){g.removeEvent(a,\"keydown\",this)})},_key:function(a){if(this.enabled){var b=this.options.snap,d=b?this.currentPage.pageX:this.x,e=b?this.currentPage.pageY:this.y,f=g.getTime(),k=this.keyTime||0;if(this.options.useTransition&&\nthis.isInTransition){var h=this.getComputedPosition();this._translate(c.round(h.x),c.round(h.y));this.isInTransition=!1}this.keyAcceleration=200>f-k?c.min(this.keyAcceleration+.25,50):0;switch(a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?d+=b?1:this.wrapperWidth:e+=b?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?d-=b?1:this.wrapperWidth:e-=b?1:this.wrapperHeight;break;case this.options.keyBindings.end:d=\nb?this.pages.length-1:this.maxScrollX;e=b?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=d=0;break;case this.options.keyBindings.left:d+=b?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:e+=b?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:d-=b?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:e-=b?1:5+this.keyAcceleration>>0;break;default:return}b?this.goToPage(d,e):(0<d?this.keyAcceleration=d=0:d<this.maxScrollX&&\n(d=this.maxScrollX,this.keyAcceleration=0),0<e?this.keyAcceleration=e=0:e<this.maxScrollY&&(e=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(d,e,0),this.keyTime=f)}},_animate:function(a,b,c,d){function e(){var n=g.getTime();if(n>=p)f.isAnimating=!1,f._translate(a,b),f.resetPosition(f.options.bounceTime)||f._execEvent(\"scrollEnd\");else{n=(n-m)/c;var q=d(n);n=(a-k)*q+k;f._translate(n,(b-l)*q+l);f.isAnimating&&h(e);3==f.options.probeType&&f._execEvent(\"scroll\")}}var f=this,k=this.x,l=this.y,m=\ng.getTime(),p=m+c;this.isAnimating=!0;e()},handleEvent:function(a){switch(a.type){case \"touchstart\":case \"pointerdown\":case \"MSPointerDown\":case \"mousedown\":this._start(a);break;case \"touchmove\":case \"pointermove\":case \"MSPointerMove\":case \"mousemove\":this._move(a);break;case \"touchend\":case \"pointerup\":case \"MSPointerUp\":case \"mouseup\":case \"touchcancel\":case \"pointercancel\":case \"MSPointerCancel\":case \"mousecancel\":this._end(a);break;case \"orientationchange\":case \"resize\":this._resize();break;case \"transitionend\":case \"webkitTransitionEnd\":case \"oTransitionEnd\":case \"MSTransitionEnd\":this._transitionEnd(a);\nbreak;case \"wheel\":case \"DOMMouseScroll\":case \"mousewheel\":this._wheel(a);break;case \"keydown\":this._key(a);break;case \"click\":this.enabled&&!a._constructed&&(a.preventDefault(),a.stopPropagation())}}};f.prototype={handleEvent:function(a){switch(a.type){case \"touchstart\":case \"pointerdown\":case \"MSPointerDown\":case \"mousedown\":this._start(a);break;case \"touchmove\":case \"pointermove\":case \"MSPointerMove\":case \"mousemove\":this._move(a);break;case \"touchend\":case \"pointerup\":case \"MSPointerUp\":case \"mouseup\":case \"touchcancel\":case \"pointercancel\":case \"MSPointerCancel\":case \"mousecancel\":this._end(a)}},\ndestroy:function(){this.options.fadeScrollbars&&(clearTimeout(this.fadeTimeout),this.fadeTimeout=null);this.options.interactive&&(g.removeEvent(this.indicator,\"touchstart\",this),g.removeEvent(this.indicator,g.prefixPointerEvent(\"pointerdown\"),this),g.removeEvent(this.indicator,\"mousedown\",this),g.removeEvent(a,\"touchmove\",this),g.removeEvent(a,g.prefixPointerEvent(\"pointermove\"),this),g.removeEvent(a,\"mousemove\",this),g.removeEvent(a,\"touchend\",this),g.removeEvent(a,g.prefixPointerEvent(\"pointerup\"),\nthis),g.removeEvent(a,\"mouseup\",this));this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(b){var c=b.touches?b.touches[0]:b;b.preventDefault();b.stopPropagation();this.transitionTime();this.initiated=!0;this.moved=!1;this.lastPointX=c.pageX;this.lastPointY=c.pageY;this.startTime=g.getTime();this.options.disableTouch||g.addEvent(a,\"touchmove\",this);this.options.disablePointer||g.addEvent(a,g.prefixPointerEvent(\"pointermove\"),this);this.options.disableMouse||\ng.addEvent(a,\"mousemove\",this);this.scroller._execEvent(\"beforeScrollStart\")},_move:function(a){var b=a.touches?a.touches[0]:a,c=g.getTime();this.moved||this.scroller._execEvent(\"scrollStart\");this.moved=!0;var d=b.pageX-this.lastPointX;this.lastPointX=b.pageX;var e=b.pageY-this.lastPointY;this.lastPointY=b.pageY;this._pos(this.x+d,this.y+e);1==this.scroller.options.probeType&&300<c-this.startTime?(this.startTime=c,this.scroller._execEvent(\"scroll\")):1<this.scroller.options.probeType&&this.scroller._execEvent(\"scroll\");\na.preventDefault();a.stopPropagation()},_end:function(b){if(this.initiated){this.initiated=!1;b.preventDefault();b.stopPropagation();g.removeEvent(a,\"touchmove\",this);g.removeEvent(a,g.prefixPointerEvent(\"pointermove\"),this);g.removeEvent(a,\"mousemove\",this);if(this.scroller.options.snap){b=this.scroller._nearestSnap(this.scroller.x,this.scroller.y);var d=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.scroller.x-b.x),1E3),c.min(c.abs(this.scroller.y-b.y),1E3)),300);if(this.scroller.x!=b.x||\nthis.scroller.y!=b.y)this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=b,this.scroller.scrollTo(b.x,b.y,d,this.scroller.options.bounceEasing)}this.moved&&this.scroller._execEvent(\"scrollEnd\")}},transitionTime:function(a){a=a||0;var b=g.style.transitionDuration;if(b&&(this.indicatorStyle[b]=a+\"ms\",!a&&g.isBadAndroid)){this.indicatorStyle[b]=\"0.0001ms\";var c=this;h(function(){\"0.0001ms\"===c.indicatorStyle[b]&&(c.indicatorStyle[b]=\"0s\")})}},transitionTimingFunction:function(a){this.indicatorStyle[g.style.transitionTimingFunction]=\na},refresh:function(){this.transitionTime();this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?\"block\":\"none\":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?\"block\":\"none\":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?\"block\":\"none\";this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(g.addClass(this.wrapper,\"iScrollBothScrollbars\"),g.removeClass(this.wrapper,\"iScrollLoneScrollbar\"),\nthis.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right=\"8px\":this.wrapper.style.bottom=\"8px\")):(g.removeClass(this.wrapper,\"iScrollBothScrollbars\"),g.addClass(this.wrapper,\"iScrollLoneScrollbar\"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right=\"2px\":this.wrapper.style.bottom=\"2px\"));this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=c.max(c.round(this.wrapperWidth*\nthis.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),32),this.indicatorStyle.width=this.indicatorWidth+\"px\"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,\"clip\"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX);this.options.listenY&&\n(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=c.max(c.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),32),this.indicatorStyle.height=this.indicatorHeight+\"px\"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,\"clip\"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=\nthis.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY);this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&c.round(this.sizeRatioX*this.scroller.x)||0,b=this.options.listenY&&c.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?(\"scale\"==this.options.shrink&&(this.width=c.max(this.indicatorWidth+a,8),this.indicatorStyle.width=\nthis.width+\"px\"),a=this.minBoundaryX):a>this.maxBoundaryX?\"scale\"==this.options.shrink?(this.width=c.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+\"px\",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:\"scale\"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+\"px\"),b<this.minBoundaryY?(\"scale\"==this.options.shrink&&(this.height=c.max(this.indicatorHeight+3*b,8),this.indicatorStyle.height=\nthis.height+\"px\"),b=this.minBoundaryY):b>this.maxBoundaryY?\"scale\"==this.options.shrink?(this.height=c.max(this.indicatorHeight-3*(b-this.maxPosY),8),this.indicatorStyle.height=this.height+\"px\",b=this.maxPosY+this.indicatorHeight-this.height):b=this.maxBoundaryY:\"scale\"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+\"px\"));this.x=a;this.y=b;this.scroller.options.useTransform?this.indicatorStyle[g.style.transform]=\"translate(\"+\na+\"px,\"+b+\"px)\"+this.scroller.translateZ:(this.indicatorStyle.left=a+\"px\",this.indicatorStyle.top=b+\"px\")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX);0>b?b=0:b>this.maxPosY&&(b=this.maxPosY);a=this.options.listenX?c.round(a/this.sizeRatioX):this.scroller.x;b=this.options.listenY?c.round(b/this.sizeRatioY):this.scroller.y;this.scroller.scrollTo(a,b)},fade:function(a,b){if(!b||this.visible)clearTimeout(this.fadeTimeout),this.fadeTimeout=null,b=a?0:300,this.wrapperStyle[g.style.transitionDuration]=\n(a?250:500)+\"ms\",this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a;this.visible=+a}.bind(this,a?\"1\":\"0\"),b)}};d.utils=g;\"undefined\"!=typeof module&&module.exports?module.exports=d:\"function\"==typeof define&&define.amd?define(function(){return d}):a.IScroll=d})(window,document,Math);\n// ----END: extensions/BMCoreUI/ui/BMCoreUI/BMCoreUI.min.js\n\nTW.Runtime.Widgets.collection = function () { // <BMCollectionViewDelegate, BMCollectionViewDataSet>\n\n    var self = this;\n\n    /**\n     * The collection view managed by this widget.\n     */\n    var collectionView; // <BMCollectionView>\n\n    /**\n     * The raw infotable data set.\n     */\n    var data; // <[Object]>\n\n    /**\n     * When using the SortField or Filter properties, this variable will hold a reference to the original unmodified data.\n     */\n    var originalData; // <[Object]>\n\n    /**\n     * Temporary storage variables holding references to the old and new data sets during an\n     * animated data update.\n     */\n    var oldData, newData; // <[Object]>\n\n    /**\n     * The infotable field that uniquely identifies an object.\n     */\n    var UIDField; // <String>\n\n    /**\n     * The infotable field that uniquely identifies an object's section.\n     */\n    var sectionField; // <String>\n\n    /**\n     * The infotable field by which section contents are sorted.\n     */\n    var sortField; // <String>\n\n    /**\n     * Whether the sort should be ascending or descending.\n     */\n    var sortAscending; // <Boolean>\n\n    /**\n     * The predicate used to filter the data set.\n     */\n    var filter; // <BMPredicate>\n\n    /**\n     * The name of the mashup to use for cells.\n     */\n    var cellMashupName; // <String>\n\n    /**\n     * The name of the infotable field that contains the mashup name.\n     */\n    var cellMashupNameField; // <String, nullable>\n\n    /**\n     * The infotable field that contains the cell width.\n     */\n    var cellWidthField; // <String, nullable>\n\n    /**\n     * The infotable field that contains the cell height.\n     */\n    var cellHeightField; // <String, nullable>\n\n    /**\n     * The mapping between infotable fields and mashup parameters.\n     */\n    var cellMashupPropertyBinding; // <Object>\n\n    /**\n     * The mashup parameter that represents the selected state of its associated data object.\n     */\n    var cellMashupSelectedField; // <String, nullable>\n\n    /**\n     * The name of the mashup to use for headers.\n     */\n    var headerMashupName; // <String>\n\n    /**\n     * The mashup property that will receive the section identifier.\n     */\n    var headerMashupSectionProperty; // <Object>\n\n    /**\n     * The name of the mashup to use for footers.\n     */\n    var footerMashupName; // <String>\n\n    /**\n     * The mashup property that will receive the section identifier.\n     */\n    var footerMashupSectionProperty; // <Object>\n\n    /**\n     * The array of sections.\n     */\n    var sections; // <[Object]>\n\n    /**\n     * The name of the mashup displayed when the data set is empty.\n     */\n    var emptyMashupName; // <String, nullable>\n\n    /**\n     * The property setting for cell height in pixels.\n     */\n    var cellHeight = this.getProperty(\"MashupHeight\", 200); // <String, nullable>\n\n    /**\n     * The property setting for cell width in pixels.\n     */\n    var cellWidth = this.getProperty(\"MashupWidth\", 400); // <String, nullable>\n\n    /**\n     * Controls whether cells can be selected and whether more than one cell can be selected at a time.\n     */\n    var canSelectCells = YES; // <Boolean>\n    var canSelectMultipleCells = YES; // <Boolean>\n\n    /**\n     * Controls the behavior of multiple selection.\n     */\n    var multipleSelectionType = BMCollectionViewCellMultipleSelectionType.Disabled; // <BMCollectionViewCellMultipleSelectionType>\n\n    /**\n     * Set to YES if the multiple selection type is set to Ctrl+Click and ctrl or cmd are pressed.\n     */\n    var isCtrlPressed = NO; // <Boolean>\n\n    /**\n     * Set to YES while selection mode is enabled.\n     * When selection mode is enabled, canSelectCells is ignored and selection will always work.\n     */\n    var isSelectionModeEnabled = NO; // <Boolean>\n\n    /**\n     * Set to YES if long click should select cells.\n     * Long click selects cells if the long click is bound to BeginSelectionMode.\n     */\n    var longClickSelectsCell = NO; // <Boolean>\n\n    /**\n     * Controls whether the collection view auto-scrolls to the first selected cell when the selection changes.\n     */\n    var scrollsToSelectedCell = NO; // <Boolean>\n\n    /**\n     * Controls whether the collection view auto-selectes the first index path when new data arrives and there is no selected cell.\n     */\n    var autoSelectsFirstCell = NO; // <Boolean>\n\n    /**\n     * Set to YES if the cells in this collection view respond to right clicks.\n     */\n    var canRightClick = NO; // <Boolean>\n    \n    var collectionLoaded = NO;\n\n    /**\n     * Controls whether collection handles selection updates when data binding is shared by another widget in a mashup.\n     */\n    var handleSelectionUpdates = (this.getProperty(\"HandleSelectionUpdates\") == true);\n\n    /**\n     * Used to store and compare document size to validate resize has actually occurred.\n     */\n    var documentSize = {};\n    \n    // ******************************************** STYLE PROPERTIES ********************************************\n\n    /**\n     * The style to use forselected cells.\n     */\n    var cellStyleSelected; // <TWXStyle, nullable>\n\n    /**\n     * The opacity of the selected background color.\n     */\n    var cellStyleSelectedAlpha; // <Number>\n\n    /**\n     * The color of the selected cells, without the alpha component.\n     */\n    var cellStyleSelectedColorComponents; // <[Number, Number, Number]>\n\n\n    /**\n     * The color of the selected cells.\n     */\n    var cellStyleSelectedColor; // <BMColor, nullable>\n\n    /**\n     * The cell background style.\n     */\n    var cellStyle; // <TWXStyle, nullable>\n\n    /**\n     * The cell background style color.\n     */\n    var cellStyleColor; // <BMColor, nullable>\n\n    /**\n     * The mashup to use for selected cells.\n     */\n    var cellMashupNameSelected; // <String, nullable>\n\n    var oldSections, newSections;\n\n    /**\n     * When CellHoverStyle is defined, this represents the CSS rule added to the document\n     * that changes the cell's hover style.\n     */\n    var hoverStyleBlock; // <$, nullable>\n\n    /**\n     * Whether or not ripples are enabled.\n     */\n    var usesRipple; // <Boolean>\n\n    /**\n     * The ripple color style.\n     */\n    var rippleStyle; // <String, nullable>\n\n    /**\n     * The border radius to apply to the cells.\n     */\n    var cellBorderRadius; // <String>\n\n    /**\n     * The box shadow to apply to the cells.\n     */\n    var cellBoxShadow; // <String>\n\n\n    // ******************************************** MENU PROPERTIES ********************************************\n    /**\n     * The array of menu entries.\n     */\n    var menuDefinition; // <[String]>\n\n    /**\n     * The array of state definitions for the menu.\n     */\n    var menuStateDefinition; // <[TWStateDefinition]>\n\n    /**\n     * Should be set to YES to use the default gestures to invoke the slide menu.\n     * If set to NO, the menu controller must be used to control the slide menu.\n     */\n    var menuUseBuiltin = YES; // <Boolean>\n\n    /**\n     * Controls how menu entries are laid out.\n     */\n    var menuOrientation; // <String>\n\n    /**\n     * Controls the size of the menu icons.\n     */\n    var menuIconSize; // <Int>\n\n    /**\n     * Controls the placement of the menu icons.\n     */\n    var menuIconGravity; // <String>\n\n    /**\n     * The type of slide menu to use.\n     */\n    var menuType = 'Auto'; // <String>\n\n    this.runtimeProperties = function () {\n        return {needsDataLoadingAndError : NO};\n    };\n\n\n    // ******************************************** GLOBAL PROPERTIES ********************************************\n    /**\n     * The map of global properties with their data types.\n     */\n    var globalDataShape; // <Object<String, String>>\n\n\n    // ******************************************** DATA MANIPULATION PROPERTIES ********************************************\n\n    /**\n     * The data shape to use when manipulating data.\n     */\n    var dataShape;\n\n    /**\n     * The mashup to use for editing cells.\n     */\n    var cellMashupNameEditing; // <String, nullable>\n\n    /**\n     * The mashup to use for editing cells.\n     */\n    var cellMashupEditingParameter; // <String, nullable>\n\n\n    // ******************************************** DELEGATE PROPERTIES ********************************************\n    /**\n     * A scriptable function allowing variable mashup contents depending on the target objects.\n     */\n    this.reuseIdentifierForCellAtIndexPath = undefined; // <String ^ (BMIndexPath), nullable>\n\n    /**\n     * A scriptable function allowing variable mashup contents depending on the target objects.\n     */\n    this.mashupNameForCellAtIndexPath = undefined; // <String ^ (BMIndexPath), nullable>\n\n\n    // ******************************************** LAYOUT METHODS ********************************************\n\n    // @override - BMCollectionViewFlowLayoutDelegate\n    this.collectionViewSizeForCellAtIndexPath = function (collectionView, indexPath) {\n        return BMSizeMake(cellWidth, cellHeight);\n    };\n\n    // @override - BMCollectionViewMasonryLayoutDelegate\n    this.collectionViewHeightForCellAtIndexPath = function (collectionView, indexPath, options) {\n        return cellHeight;\n    };\n\n    /**\n     * Constructs and configures a flow layout based on this widget's property vlaues.\n     * @return <BMCollectionViewFlowLayout>        A flow layout.\n     */\n    this.createFlowLayout = function () {\n        var layout = new BMCollectionViewFlowLayout();\n        layout.rowSpacing = this.getProperty('RowSpacing');\n        layout.minimumSpacing = this.getProperty('MinimumSpacing');\n        layout.gravity = BMCollectionViewFlowLayoutGravity[this.getProperty('FlowLayoutGravity')];\n        layout.alignment = BMCollectionViewFlowLayoutAlignment[this.getProperty('FlowLayoutAlignment') || 'Center'];\n        layout.leftAlignFinalRow = this.getProperty('LeftAlignFinalRow');\n\n\n        if ((self.getProperty('UseMashupDimensions') && cellMashupNameField) || cellWidthField || cellHeightField) {\n            layout.cellSize = undefined;\n        }\n        else {\n            layout.cellSize = BMSizeMake(cellWidth, cellHeight);\n        }\n\n        layout.topPadding = this.getProperty('TopPadding');\n        layout.bottomPadding = this.getProperty('BottomPadding');\n\n        layout.contentGravity = BMCollectionViewFlowLayoutAlignment[this.getProperty('FlowLayoutContentGravity')];\n\n        if (sectionField) {\n\n            layout.showsHeaders = this.getProperty('ShowHeaders');\n            layout.headerHeight = this.getProperty('HeaderHeight');\n\n            layout.showsFooters = this.getProperty('ShowFooters');\n            layout.footerHeight = this.getProperty('FooterHeight');\n\n            layout.pinsHeadersToContentEdge = this.getProperty('PinHeadersToTop', NO);\n            layout.pinsFootersToContentEdge = this.getProperty('PinFootersToBottom', NO);\n\n        }\n\n        layout.sectionInsets = BMInsetMake(this.getProperty('SectionInsetLeft') | 0,\n            this.getProperty('SectionInsetTop') | 0,\n            this.getProperty('SectionInsetRight') | 0,\n            this.getProperty('SectionInsetBottom') | 0\n        );\n\n        return layout;\n    };\n\n    /**\n     * Constructs and configures a masonry layout based on this widget's property vlaues.\n     * @return <BMCollectionViewMasonryLayout>        A masonry layout.\n     */\n    this.createMasonryLayout = function () {\n        var layout = new BMCollectionViewMasonryLayout();\n\n        var speeds = this.getProperty('MasonryLayoutColumnSpeeds').split(',');\n\n        for (var i = 0; i < speeds.length; i++) {\n            speeds[i] = parseFloat(speeds[i].trim());\n        }\n\n        layout.columnSpeeds = speeds;\n        layout.numberOfColumns = this.getProperty('MasonryLayoutNumberOfColumns');\n        layout.minimumColumnWidth = this.getProperty('MasonryLayoutColumnWidth');\n        layout.columnSpacing = this.getProperty('MasonryLayoutColumnSpacing');\n        layout.cellSpacing = this.getProperty('MasonryLayoutCellSpacing');\n\n        layout.topPadding = this.getProperty('MasonryLayoutTopPadding');\n        layout.bottomPadding = this.getProperty('MasonryLayoutBottomPadding');\n\n        return layout;\n    };\n\n    /**\n     * Constructs and configures a table layout based on this widget's property vlaues.\n     * @return <BMCollectionViewTableLayout>        A table layout.\n     */\n    this.createTableLayout = function () {\n        var layout = new BMCollectionViewTableLayout();\n        if ((self.getProperty('UseMashupDimensions') && cellMashupNameField) || cellHeightField) {\n            layout.rowHeight = BMCollectionViewTableLayoutRowHeightVariable;\n        }\n        else {\n            layout.rowHeight = cellHeight;\n        }\n\n        if (sectionField) {\n\n            layout.showsHeaders = this.getProperty('ShowHeaders');\n            layout.headerHeight = this.getProperty('HeaderHeight');\n\n            layout.showsFooters = this.getProperty('ShowFooters');\n            layout.footerHeight = this.getProperty('FooterHeight');\n\n            layout.pinsHeadersToContentEdge = this.getProperty('PinHeadersToTop', NO);\n            layout.pinsFootersToContentEdge = this.getProperty('PinFootersToBottom', NO);\n        }\n\n        layout.sectionInsets = BMInsetMake(this.getProperty('SectionInsetLeft') | 0,\n            this.getProperty('SectionInsetTop') | 0,\n            this.getProperty('SectionInsetRight') | 0,\n            this.getProperty('SectionInsetBottom') | 0\n        );\n\n        return layout;\n    };\n\n\n    // ******************************************** WIDGET LIFECYCLE METHODS ********************************************\n\n    /**\n     * Invoked by the Thingworx runtime to obtain the HTML to inject for this widget.\n     * @return <String>            The HTML representation of this widget's content.\n     */\n    this.renderHtml = function () {\n        UIDField = this.getProperty(\"UIDField\");\n\n        var html = '<div class=\"widget-content BMCollectionViewWidget' + (BMIsTouchDevice ? '' : ' BMCollectionViewDesktop') + '\" style=\"overflow: auto; -webkit-overflow-scrolling: touch;\"></div>';\n        return html;\n    };\n\n    /**\n     * Invoked by the Thingworx runtime immediately after the HTML returned by renderHtml() has been added to the document.\n     * At this point, the jqElement and boundingBox properties are available to use.\n     */\n    this.afterRender = function () {\n\n        if (this.getProperty('_EventDataShape') === '{}') {\n            this.addNoBindingWarning();\n        } else if (this.getProperty('UIDField') === '') {\n            this.addNoUIDFieldWarning();\n        } else {\n            this.loadCollectionItems();\n        }\n\n        documentSize.width = $(window).width();\n        documentSize.height = $(window).height();\n\n    };\n    \n    /**\n     * If an update arrives while the collection view is already processing another update request\n     * that update info is temporarily saved to this variable until the collection view has finished processing its current update request.\n     * When that update request is finished, this update is then applied and the pendingDataUpdate variable is reset to undefined.\n     */\n    var pendingDataUpdate; // <TWUpdatePropertyInfo>\n    var pendingDataArgs;\n    \n    this.loadCollectionItems = function () {\n        var useCustomScrollbar = YES;\n\n        // Load the menu properties\n        try {\n            menuDefinition = JSON.parse(self.getProperty('_MenuDefinition'));\n        }\n        catch (err) {\n            menuDefinition = [];\n        }\n        menuStateDefinition = TW.getStateDefinition(self.getProperty('CellMenuStates'));\n        menuStateDefinition = menuStateDefinition && menuStateDefinition.content && menuStateDefinition.content.stateDefinitions;\n        menuOrientation = self.getProperty('CellMenuStatesOrientation');\n        menuIconSize = self.getProperty('CellMenuStatesIconSize');\n        menuIconGravity = self.getProperty('CellMenuStatesIconGravity');\n        menuUseBuiltin = self.getProperty('CellMenuStatesUseBuiltin');\n\n        // Load the global data shape\n        try {\n            globalDataShape = JSON.parse(self.getProperty('_GlobalDataShape'));\n        }\n        catch (e) {\n            globalDataShape = {};\n        }\n\n        var canDoubleClick = NO;\n        // To figure out if this widget supports double clicking or right clicking, it is required to check the event bindings to find out if the 'CellWasDoubleClicked' event\n        // has any targets\n        var eventBindings = this.mashup.Events;\n        var eventBindingsCount = eventBindings.length;\n        var collectionViewWidgetId = this.idOfThisElement;\n        for (var i = 0; i < eventBindingsCount; i++) {\n            var binding = eventBindings[i];\n\n            if (binding.EventTriggerId === collectionViewWidgetId && binding.EventTriggerEvent === 'CellWasLongClicked' &&\n                binding.EventHandlerId === collectionViewWidgetId && binding.EventHandlerService === 'BeginSelectionMode') {\n                longClickSelectsCell = YES;\n                if (canRightClick && canDoubleClick) break;\n            }\n\n            if (binding.EventTriggerId === collectionViewWidgetId && binding.EventTriggerEvent === 'CellWasDoubleClicked') {\n                // It is sufficient to find a single binding for this event to enable double clicking\n                canDoubleClick = YES;\n                if (canRightClick && longClickSelectsCell) break;\n            }\n\n            if (binding.EventTriggerId === collectionViewWidgetId && binding.EventTriggerEvent === 'CellWasRightClicked') {\n                // It is sufficient to find a single binding for this event to enable rick clicking\n                canRightClick = YES;\n                if (canDoubleClick && longClickSelectsCell) break;\n            }\n        }\n        self.setProperty('_CanDoubleClick', canDoubleClick);\n\n        // Set the HasSelectedCells property to NO by default, until data arrives and can be selected\n        this.setProperty('HasSelectedCells', NO);\n\n        // Custom scrollbars are required for the masonry layout\n        var layout = this.getProperty('View');\n\n        collectionView = BMCollectionViewMakeWithContainer(self.jqElement, {customScroll : useCustomScrollbar});\n        collectionView.offscreenBufferFactor = this.getProperty('OffScreenBufferFactor');\n\n        this.collectionView = collectionView;\n\n        sectionField = this.getProperty('SectionField');\n\n        if (sectionField) {\n            headerMashupName = this.getProperty('HeaderMashupName');\n            footerMashupName = this.getProperty('FooterMashupName');\n\n            headerMashupSectionProperty = this.getProperty('HeaderSectionParam');\n            footerMashupSectionProperty = this.getProperty('FooterSectionParam');\n        }\n\n        // Create the handlers for the mashup name field\n        cellMashupNameField = self.getProperty('MashupNameField');\n        if (cellMashupNameField) {\n            self.reuseIdentifierForCellAtIndexPath = function (indexPath) {\n                return indexPath.object[cellMashupNameField];\n            };\n\n            self.mashupNameForCellAtIndexPath = function (indexPath) {\n                return indexPath.object[cellMashupNameField];\n            };\n        }\n\n        // Get the dynamic size properties\n        cellWidthField = self.getProperty('CellWidthField');\n        cellHeightField = self.getProperty('CellHeightField');\n\n        var cellWidth = self.getProperty('MashupWidth');\n        var cellHeight = self.getProperty('MashupHeight');\n        // Create the handlers for intrinsic sizes\n        if (self.getProperty('UseMashupDimensions') && cellMashupNameField) {\n            self.collectionViewSizeForCellAtIndexPath = function (collectionView, indexPath) {\n                var mashupDefinition = BMCollectionViewMashupDefinitionCache[indexPath.object[cellMashupNameField]] || self.definitionForMashupNamed(indexPath.object[cellMashupNameField]);\n\n                var content = mashupDefinition._BMDeserializedContent || (mashupDefinition._BMDeserializedContent = JSON.parse(mashupDefinition.mashupContent));\n\n                return BMSizeMake(content.UI.Properties.Width, content.UI.Properties.Height);\n            };\n\n            self.collectionViewRowHeightForCellAtIndexPath = function (collectionView, indexPath) {\n                var mashupDefinition = BMCollectionViewMashupDefinitionCache[indexPath.object[cellMashupNameField]] || self.definitionForMashupNamed(indexPath.object[cellMashupNameField]);\n\n                var content = mashupDefinition._BMDeserializedContent || (mashupDefinition._BMDeserializedContent = JSON.parse(mashupDefinition.mashupContent));\n\n                return content.UI.Properties.Height;\n            };\n\n            self.collectionViewHeightForCellAtIndexPath = function (collectionView, indexPath, args) {\n                var mashupDefinition = BMCollectionViewMashupDefinitionCache[indexPath.object[cellMashupNameField]] || self.definitionForMashupNamed(indexPath.object[cellMashupNameField]);\n\n                var content = mashupDefinition._BMDeserializedContent || (mashupDefinition._BMDeserializedContent = JSON.parse(mashupDefinition.mashupContent));\n\n                return content.UI.Properties.Height;\n            }\n        }\n        // Create the handlers for dynamic sizes if they are set\n        else if (cellWidthField || cellHeightField) {\n            self.collectionViewSizeForCellAtIndexPath = function (collectionView, indexPath) {\n                return BMSizeMake((cellWidthField && indexPath.object[cellWidthField]) || cellWidth, (cellHeightField && indexPath.object[cellHeightField]) || cellHeight);\n            };\n\n            self.collectionViewRowHeightForCellAtIndexPath = function (collectionView, indexPath) {\n                return (cellHeightField && indexPath.object[cellHeightField]) || cellHeight;\n            };\n\n            self.collectionViewHeightForCellAtIndexPath = function (collectionView, indexPath, args) {\n                return (cellHeightField && indexPath.object[cellHeightField]) || cellHeight;\n            };\n        }\n\n        if (layout === 'flow') {\n            this.collectionView.layout = this.createFlowLayout();\n        }\n        else if (layout === 'masonry') {\n            this.collectionView.layout = this.createMasonryLayout();\n        }\n        else if (layout === 'table') {\n            this.collectionView.layout = this.createTableLayout();\n        }\n\n        collectionView.delegate = self;\n        collectionView.identityComparator = function (o1, o2) {\n            if (!o1 && !o2) return YES;\n            if (!o1 || !o2) return NO;\n\n            return o1[UIDField] === o2[UIDField];\n        };\n        cellMashupName = this.getProperty('Mashup');\n\n        canSelectCells = this.getProperty('AllowSelection');\n        canSelectMultipleCells = this.getProperty('MultiSelect');\n        multipleSelectionType = BMCollectionViewCellMultipleSelectionType[self.getProperty('CellMultipleSelectionType') || 'Disabled'];\n\n        scrollsToSelectedCell = this.getProperty('ScrollsToSelectedCell');\n        autoSelectsFirstCell = this.getProperty('AutoSelectFirstRow');\n\n        cellStyleSelected = TW.getStyleFromStyleDefinition(this.getProperty('CellSelectedStyle'));\n        cellMashupNameSelected = this.getProperty('SelectedMashupName');\n        cellMashupSelectedField = this.getProperty('CellMashupSelectedField');\n        cellStyle = TW.getStyleFromStyleDefinition(this.getProperty('CellStyle'));\n\n        if (cellStyle && cellStyle.backgroundColor) {\n            cellStyleColor = BMColorMakeWithString(cellStyle.backgroundColor);\n        }\n\n        usesRipple = this.getProperty('UseRippleEffect');\n        rippleStyle = this.getProperty('RippleEffectStyle');\n        if (rippleStyle) rippleStyle = TW.getStyleFromStyleDefinition(rippleStyle);\n        cellBorderRadius = this.getProperty('CellBorderRadius');\n\n        cellBoxShadow = this.getProperty('CellBoxShadow');\n\n        emptyMashupName = this.getProperty('EmptyMashupName');\n\n        if (cellStyleSelected && cellStyleSelected.backgroundColor) {\n            cellStyleSelectedColor = BMColorMakeWithString(cellStyleSelected.backgroundColor);\n        }\n\n        try {\n            cellMashupPropertyBinding = JSON.parse(this.getProperty('MashupPropertyBinding'));\n        }\n        catch (e) {\n            cellMashupPropertyBinding = {};\n        }\n\n        // Load the inline data manipulation data shape if it was specified\n        if (self.getProperty('DataShape')) {\n            TW.Runtime.GetDataShapeInfo(self.getProperty('DataShape'), function (info) {\n                if (!dataShape) dataShape = info;\n            });\n        }\n\n        cellMashupEditingParameter = self.getProperty('CellMashupEditingParameter');\n        cellMashupNameEditing = self.getProperty('CellMashupNameEditing');\n\n        sortField = self.getProperty('SortField');\n        sortAscending = self.getProperty('SortAscending');\n\n        var hoverStyle = TW.getStyleFromStyleDefinition(this.getProperty('CellHoverStyle'));\n        var activeStyle = TW.getStyleFromStyleDefinition(this.getProperty('CellActiveStyle'));\n\n        var hoverStyleBlockText;\n\n        if (hoverStyle && hoverStyle.backgroundColor) {\n            hoverStyleBlockText = '<style>\t\t\t\t\t\t#' + this.jqElementId + ' .BMCollectionViewCellHoverable {transition: background-color .1s ease;}\t\t\t\t\t\t#' + this.jqElementId + ' .BMCollectionViewCellHoverable:hover {background-color: ' + hoverStyle.backgroundColor + ';}';\n        }\n\n        if (activeStyle && activeStyle.backgroundColor) {\n            if (hoverStyleBlockText) {\n                hoverStyleBlockText += '\t\t\t\t\t#' + this.jqElementId + ' .BMCollectionViewCellHoverable:active {background-color: ' + activeStyle.backgroundColor + ';}';\n            }\n            else {\n                hoverStyleBlockText = '<style>\t\t\t\t\t\t\t#' + this.jqElementId + ' .BMCollectionViewCellHoverable {transition: background-color .1s ease;}\t\t\t\t\t\t\t#' + this.jqElementId + ' .BMCollectionViewCellHoverable:active {background-color: ' + activeStyle.backgroundColor + ';}';\n            }\n        }\n\n        if (hoverStyleBlockText) {\n            hoverStyleBlockText += '</style>';\n            hoverStyleBlock = $(hoverStyleBlockText);\n            $(document.head).append(hoverStyleBlock);\n        }\n        \n        this.collectionLoaded = YES;\n        \n        if (pendingDataUpdate) {\n            // For synchronous non-layout updates, the pendingDataUpdate property must be cleared before performing the actual update\n            // otherwise, this function will be inifitely called recursively\n            var data = pendingDataUpdate;\n            var args = pendingDataArgs;\n            pendingDataUpdate = undefined;\n            self.updateProperty(data, args);\n        }\n    };\n\n    this.updateLayoutDelayed = _.debounce(function (shouldUpdateLayout, updatePropertyInfo, args, animated) {\n        this.updateLayout(shouldUpdateLayout, updatePropertyInfo, args, animated);\n    }, 300, true);\n\n    // updateLayout can be called from propertyUpdate when new data received and is triggered from redraw under IE11\n    this.updateLayout = function(shouldUpdateLayout, updatePropertyInfo, args, animated){\n        // reload collection cells - pull the following out of the property update handler for new data\n        var shouldUpdateLayout = (shouldUpdateLayout === undefined) ? true : shouldUpdateLayout;\n        var updatePropertyInfo = (updatePropertyInfo === undefined) ? undefined : updatePropertyInfo;\n        var args = (args === undefined) ? undefined : args;\n        var animated = (animated === undefined) ? NO : this.getProperty('PlaysIntroAnimation', YES);\n\n        // Retain a reference to the data shape to allow the collection view to create data\n        if (updatePropertyInfo && updatePropertyInfo.RawSinglePropertyValue) {\n            dataShape = updatePropertyInfo.RawSinglePropertyValue.dataShape;\n        }\n\n        // If the collection view is already updating its data, delay the data update\n        // until after the update animation is finished.\n        if (args && updatePropertyInfo && collectionView === undefined || collectionView.isUpdatingData) {\n            pendingDataUpdate = updatePropertyInfo;\n            pendingDataArgs = args;\n            return;\n        }\n\n        collectionView.updateEntireDataAnimated(animated, {\n            updateLayout : shouldUpdateLayout, completionHandler : function () {\n                oldData = undefined;\n                oldSections = undefined;\n\n                // Select the first index path if there is no selection and the behavior is enabled\n                if (autoSelectsFirstCell && collectionView.selectedIndexPaths.length === 0 && self.numberOfSections()) {\n                    collectionView.selectedIndexPaths = [self.indexPathForObjectAtRow(0, {inSectionAtIndex : 0})];\n                }\n\n                // After updating the data, update the selection as well\n                self.updateThingworxSelection();\n\n                // If there was a data update pending, apply it here\n                if (pendingDataUpdate) {\n                    // For synchronous non-layout updates, the pendingDataUpdate property must be cleared before performing the actual update\n                    // otherwise, this function will be inifitely called recursively\n                    var data = pendingDataUpdate;\n                    pendingDataUpdate = undefined;\n                    pendingDataArgs = undefined;\n                    self.updateProperty(data, args);\n                }\n\n                collectionView.adjustScrollIndicator();\n            }\n        });\n    };\n\n\n    /**\n     * Invoked by the Thingworx runtime after this widget was resized.\n     * @param width <Int>            The widget's new width.\n     * @param height <Int>            The widget's new height.\n     */\n    this.resize = function (width, height) {\n        if (documentSize.height !== $(window).height() || documentSize.width !== $(window).width() ||\n        \t(collectionView && collectionView.frame && collectionView.frame.size &&\n        \t (collectionView.frame.size.width <= 0 && width > 0) || (collectionView.frame.size.height <= 0 && height > 0))) {\n            this.updateLayoutDelayed();\n            this.collectionViewBoundsDidChange();\n            collectionView.resized();\n        }\n        documentSize.height = $(window).height();\n        documentSize.width = $(window).width();\n    };\n\n    /**\n     * Invoked by the Thingworx runtime whenever any of this widget's bound properties was updated as a result of a binding.\n     * @param updatePropertyInfo <TWUpdatePropertyInfo>        An object describing this property update.\n     * {\n     *    @param completionHandler <void ^(), nullable>        If this is a data update and this parameter is specified, this is a handler that will be invoked when the data update completes.\n     * }\n     */\n    this.updateProperty = function (updatePropertyInfo, args) {\n        var property = updatePropertyInfo.TargetProperty;\n\n        if (property == 'Data') {\n\n            // Retain a reference to the data shape to allow the collection view to create data\n            if (updatePropertyInfo.RawSinglePropertyValue) {\n                dataShape = updatePropertyInfo.RawSinglePropertyValue.dataShape;\n            }\n\n            // If the collection view is already updating its data, delay the data update\n            // until after the update animation is finished.\n            if (collectionView === undefined || collectionView.isUpdatingData) {\n                pendingDataUpdate = updatePropertyInfo;\n                pendingDataArgs = args;\n                return;\n            }\n\n            indexPathHeights = [];\n\n            var shouldUpdateLayout = YES;\n\n            oldData = data;\n            // If the new data is undefined, construct a new empty infotable for it\n            // Additionally, always work on a copy, in case the contained mashups try to change any properties\n            data = (updatePropertyInfo.ActualDataRows || []);\n            newData = data;\n\n            if (sortField) {\n                // Keep a reference to the original data and create a copy of it\n                // which will be sorted according to the SortField\n                originalData = data;\n                newData = newData.slice();\n\n                // When using the sortField, the original indexes have to be retained in order for selections to work reliably\n                var newDataLength = newData.length;\n                for (var i = 0; i < newDataLength; i++) {\n                    newData[i]._BMCollectionViewInfoTableIndex = i;\n                }\n\n                // Sort the data by the sortField when it is defined\n                newData.sort(function (o1, o2) {\n                    return (!sortAscending ? (o1[sortField] < o2[sortField]) : (o1[sortField] > o2[sortField])) ? 1 : (o1[sortField] == o2[sortField] ? 0 : -1);\n                });\n\n                data = newData;\n            }\n\n            if (filter) {\n\n            }\n\n            // The layout should not update if the data sets have the same items in the same positions\n            if (oldData && oldData.length == newData.length) {\n                shouldUpdateLayout = NO;\n\n                var dataLength = data.length;\n                for (var i = 0; i < dataLength; i++) {\n                    // If any single item changes position or section, the layout must be invalidated\n                    var oldObject = oldData[i];\n                    var newObject = newData[i];\n\n                    // If the UIDs are different at any index, the layout must be invalidated\n                    if (UIDField && oldObject[UIDField] !== newObject[UIDField]) {\n                        shouldUpdateLayout = YES;\n                        break;\n                    }\n\n                    // If an object changes section, the layout must be invalidated\n                    if (sectionField && oldObject[sectionField] !== newObject[sectionField]) {\n                        shouldUpdateLayout = YES;\n                        break;\n                    }\n\n                }\n            }\n\n            // When using the section field, the data structure is changed from a flat array to a two-level array of sections containing the actual data rows\n            if (sectionField) {\n                oldSections = sections;\n                sections = [];\n\n                var sectionIdentifiers = {};\n                var dataLength = data.length;\n                for (var i = 0; i < dataLength; i++) {\n                    var sectionIdentifier = data[i][sectionField];\n\n                    if (!sectionIdentifiers[sectionIdentifier]) {\n                        sectionIdentifiers[sectionIdentifier] = {rows : [], identifier : sectionIdentifier};\n                    }\n\n                    // When using the sortField, the index no longer matches the object's original position within the Infotable\n                    // so the _BMCollectionViewInfoTableIndex property is used instead\n                    sectionIdentifiers[sectionIdentifier].rows.push({\n                        data : data[i],\n                        index : sortField ? data[i]._BMCollectionViewInfoTableIndex : i\n                    });\n                }\n\n                var keys = Object.keys(sectionIdentifiers);\n                for (var i = 0; i < keys.length; i++) {\n                    sections.push(sectionIdentifiers[keys[i]]);\n                }\n\n                newSections = sections;\n\n            }\n\n            self.updateEditingIndexPaths();\n\n            // Update the exposed outgoing data infotable\n            var outgoingInfotable = {\n                dataShape : updatePropertyInfo.RawSinglePropertyValue.dataShape,\n                rows : data\n            };\n            self.setProperty('Data', outgoingInfotable);\n\n            if (!collectionView.dataSet) {\n                collectionView.dataSet = this;\n\n                // Select the first index path if there is no selection and the behavior is enabled\n                if (autoSelectsFirstCell && collectionView.selectedIndexPaths.length === 0 && self.numberOfSections()) {\n                    collectionView.selectedIndexPaths = [this.indexPathForObjectAtRow(0, {inSectionAtIndex : 0})];\n                }\n\n                // After updating the data, update the selection as well\n                self.updateThingworxSelection();\n            }\n            else {\n                if(animated === undefined) {\n                    var animated = NO;\n                }\n            \tthis.updateLayoutDelayed(shouldUpdateLayout, updatePropertyInfo, args, animated);\n            }\n\n            return;\n        }\n        else if (property == 'View') {\n            var layoutName = updatePropertyInfo.SinglePropertyValue;\n\n            if (layoutName == 'flow') {\n                var layout = this.createFlowLayout();\n\n                collectionView.setLayout(layout, {animated : YES});\n            }\n            else if (layoutName == 'masonry') {\n                var layout = this.createMasonryLayout();\n\n                collectionView.setLayout(layout, {animated : YES});\n            }\n            else if (layoutName == 'table') {\n                var layout = this.createTableLayout();\n\n                collectionView.setLayout(layout, {animated : YES});\n            }\n\n            return;\n        }\n        else if (property == 'SortField') {\n            sortField = updatePropertyInfo.SinglePropertyValue;\n\n            self.updateProperty({TargetProperty : 'Data', ActualDataRows : data, SinglePropertyValue : self.getProperty('Data')});\n        }\n        else if (property == 'SortAscending') {\n            sortAscending = updatePropertyInfo.SinglePropertyValue;\n\n            if (!sortField) return;\n            self.updateProperty({TargetProperty : 'Data', ActualDataRows : data, SinglePropertyValue : self.getProperty('Data')});\n        }\n        else if (property == 'CreateIndex') {\n            self.setProperty('CreateIndex', updatePropertyInfo.SinglePropertyValue);\n        }\n        else if (property == 'DeletionUID') {\n            self.setProperty('DeletionUID', updatePropertyInfo.SinglePropertyValue);\n        }\n        else if (property == 'Filter') {\n            filter = BMPredicateMakeWithQuery(updatePropertyInfo.SinglePropertyValue);\n\n            self.updateProperty({TargetProperty : 'Data', ActualDataRows : data, SinglePropertyValue : self.getProperty('Data')});\n        }\n        else if (globalDataShape !== undefined && property in globalDataShape) {\n            this.setProperty(property, updatePropertyInfo.SinglePropertyValue);\n            this.globalProperty(property, {didUpdateToValue : updatePropertyInfo.SinglePropertyValue});\n        }\n        else if (property === 'SelectedItems') {\n            // number of rows in collection\n            var nRows = data.length;\n            var selectedRowIndices = [];\n            var selectionRows = updatePropertyInfo.ActualDataRows;\n            var nSelectedRows = selectionRows.length;\n            var rowid, selectedId, i;\n            // Collection requires an id field in property UIDField\n            var UIDFieldName = this.getProperty('UIDField');\n\n            for (rowid = 0; rowid < nSelectedRows; rowid++) {\n                selectedId = selectionRows[rowid][UIDFieldName];\n\n                // iterate through selected rows to match up the data rows it contains\n                for ( i = 0; i < nRows; i++) {\n                    var valueInRow = originalData[i][UIDFieldName];\n                    if (valueInRow === selectedId) {\n                        selectedRowIndices.push(i);\n                        if (!canSelectMultipleCells) {\n                            break; // can only select one unless we're in multiselect\n                        }\n                    }\n                }\n            }\n\n            this.handleSelectionUpdate(\"Data\", undefined /* not used by us anyway */, selectedRowIndices);\n        } else if (property === 'Mashup') {\n        \tif (updatePropertyInfo.SinglePropertyValue !== undefined && updatePropertyInfo.SinglePropertyValue !== '' && collectionLoaded === NO) {\n        \t\tthis.setProperty('Mashup', updatePropertyInfo.SinglePropertyValue);\n        \t\tthis.loadCollectionItems();\n        \t}\n        } else if (property === 'SelectedMashupName') {\n            cellMashupNameSelected = updatePropertyInfo.SinglePropertyValue;\n        } else if (property === 'CellMashupNameEditing') {\n        \tcellMashupNameEditing = updatePropertyInfo.SinglePropertyValue;\n        } else if (updatePropertyInfo.TargetProperty === \"CustomClass\") {\n            this.resize(thisWidget.jqElement.outerWidth(), thisWidget.jqElement.outerHeight());\n        }\n\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.useOldData = function (use) {\n        if (use) {\n            data = oldData;\n            sections = oldSections;\n        }\n        else {\n            data = newData;\n            sections = newSections;\n        }\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.isUsingOldData = function () {\n        return data === oldData;\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewWillDestroyCell = function (collectionView, cell) {\n        // When cells are destroyed, their corresponding mashup should be destroyed as well\n        var mashup = cell.BM_mashup;\n        delete cell.BM_mashup;\n\n        if (mashup) try {\n            mashup.destroyMashup();\n        }\n        catch (err) {\n            TW.log.error('CollectionView was unable to destroy the mashup associated with the cell at index path ' + cell.indexPath);\n            TW.log.error(err);\n        }\n\n    };\n\n    /**\n     * Invoked by the platform when this widget is removed.\n     */\n    this.beforeDestroy = function () {\n\n        // Remove the style block if it was added\n        if (hoverStyleBlock) hoverStyleBlock.remove();\n\n        // Release the collection view, this will in turn destroy all the cells causing their associated mashups to be destroyed as well\n        collectionView.release();\n\n        // Standard TW beforeDestroy\n        try {\n            this.jqElement.unbind();\n        }\n        catch (e) {\n            TW.log.error(e);\n        }\n    };\n\n    /**\n     * Invoked by the platform when ever any other widget updates the selection of any of this widget's bound infotables.\n     * @param propertyName <String>                The name of the infotable property whose selection was updated.\n     * @param selectedRows <[AnyObject]>        An array of selected row objects.\n     * @param selectedRowIndices <[Int]>        An array of selected row indices.\n     */\n    this.handleSelectionUpdate = function (propertyName, selectedRows, selectedRowIndices) {\n        // propertyName: Data, selectedRows: [object:Object],[object:Object]; selectedRowIndices: [0 - nRows, 0-nRows]\n        if (handleSelectionUpdates) {\n            // Construct the selection indexPaths\n            var selectedIndexPaths = [];\n            var selRowIndices = [];\n            if (canSelectMultipleCells === false) {\n                selRowIndices[0] = selectedRowIndices[selectedRowIndices.length - 1];\n            } else {\n                selRowIndices = selectedRowIndices;\n            }\n            // When the sortField, the object has to be looked up using the _BMCollectionViewInfoTableIndex property\n            var i;\n            var indexPath;\n            if (sortField) {\n                for (i = 0; i < selRowIndices.length; i++) {\n                    for (var j = 0; j < data.length; j++) {\n                        if (data[j]._BMCollectionViewInfoTableIndex === selRowIndices[i]) {\n                            indexPath = this.indexPathForObject(data[j]);\n                            if (indexPath) selectedIndexPaths.push(indexPath);\n                        }\n                    }\n                }\n            }\n            else {\n                for (i = 0; i < selRowIndices.length; i++) {\n                    indexPath = this.indexPathForObject(data[selRowIndices[i]]);\n                    if (indexPath) selectedIndexPaths.push(indexPath);\n                }\n            }\n\n            // Select the new indexes in the collection view.\n            this.selectionUpdateBlocked = YES;\n            collectionView.selectedIndexPaths = selectedIndexPaths;\n            this.selectionUpdateBlocked = NO;\n\n            // Update the HasSelectedCells property to match the current selection state\n            var hasSelectedCells = !!selectedIndexPaths.length;\n            if (hasSelectedCells != this.getProperty('HasSelectedCells')) {\n                this.setProperty('HasSelectedCells', hasSelectedCells);\n            }\n\n            // Update the SelectedCellsCount property to match the current selection state\n            this.setProperty('SelectedCellsCount', collectionView.selectedIndexPaths.length);\n\n            // Scroll to the first selected cell is this behavior is enabled\n            if (scrollsToSelectedCell) {\n                if (collectionView.selectedIndexPaths.length) {\n                    collectionView.scrollToCellAtIndexPath(collectionView.selectedIndexPaths[0], {\n                        withVerticalGravity : BMCollectionViewScrollingGravityVertical.Center,\n                        horizontalGravity : BMCollectionViewScrollingGravityHorizontal.Center,\n                        animated : YES\n                    });\n                }\n            }\n        }\n    };\n\n    /**\n     * Invoked by the Thingworx runtime whenever any widget service is triggered.\n     * @param service <String>        The name of the triggered service.\n     */\n    this.serviceInvoked = function (service) {\n        if (service == 'Deselect') {\n            collectionView.selectedIndexPaths = [];\n            this.updateThingworxSelection();\n        }\n        else if (service == 'SelectAll') {\n            if (sectionField) {\n                var indexPaths = [];\n                var sectionsLength = this.numberOfSections();\n                for (var j = 0; j < sectionsLength; j++) {\n                    var length = this.numberOfObjectsInSectionAtIndex(j);\n                    for (var i = 0; i < length; i++) {\n                        indexPaths.push(this.indexPathForObjectAtRow(i, {inSectionAtIndex : j}));\n                    }\n                }\n\n                collectionView.selectedIndexPaths = indexPaths;\n                this.updateThingworxSelection();\n            }\n            else {\n                var indexPaths = [];\n                var length = this.numberOfObjectsInSectionAtIndex(0);\n                for (var i = 0; i < length; i++) {\n                    indexPaths.push(this.indexPathForObjectAtRow(i, {inSectionAtIndex : 0}));\n                }\n\n                collectionView.selectedIndexPaths = indexPaths;\n                this.updateThingworxSelection();\n            }\n\n        }\n        else if (service == 'InvalidateLayout') {\n            collectionView.invalidateLayout();\n        }\n        else if (service == 'CreateItemAtBeginning') {\n            self.insertItemAtIndex(0);\n        }\n        else if (service == 'CreateItemAtEnd') {\n            self.insertItemAtIndex(-1);\n        }\n        else if (service == 'CreateItemAtIndex') {\n            self.insertItemAtIndex(self.getProperty('CreationIndex'));\n        }\n        else if (service == 'DeleteItem') {\n            self.deleteItemWithUID(self.getProperty('DeletionUID'));\n        }\n        else if (service == 'BeginSelectionMode') {\n            isSelectionModeEnabled = YES;\n            self.setProperty('MultiSelect', isSelectionModeEnabled);\n        }\n        else if (service == 'FinishSelectionMode') {\n            isSelectionModeEnabled = NO;\n            collectionView.selectedIndexPaths = [];\n            this.updateThingworxSelection();\n            self.setProperty('MultiSelect', isSelectionModeEnabled);\n        }\n    };\n\n    /**\n     * Invoked whenever any bound global property's value is updated as a result of a binding.\n     * @param property <String>                        The name of the global property.\n     * @param didUpdateToValue <AnyObject>            The global property's new value.\n     */\n    this.globalProperty = function (property, args) {\n        self.collectionView.enumerateVisibleCellsWithBlock(function (cell, type, identifier) {\n\n            var mashup = cell.BM_mashup;\n\n            try {\n                mashup.BM_setParameterInternal(property, args.didUpdateToValue);\n            }\n            catch (e) {\n                TW.log.error(e);\n            }\n        });\n    };\n\n    // *************************** BMCollectionViewDataSet & BMCollectionViewDelegate *****************************\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewShouldRunIntroAnimation = function () {\n        return self.getProperty('PlaysIntroAnimation');\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.numberOfSections = function () {\n        return sectionField ? sections.length : 1;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.numberOfObjectsInSectionAtIndex = function (i) {\n        return sectionField ? sections[i].rows.length : data.length;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.indexPathForObjectAtRow = function (row, options) {\n        if (sectionField) {\n            return BMIndexPathMakeWithRow(row, {\n                section : options.inSectionAtIndex,\n                forObject : sections[options.inSectionAtIndex].rows[row].data\n            });\n        }\n        else {\n            return BMIndexPathMakeWithRow(row, {section : options.inSectionAtIndex, forObject : data[row]});\n        }\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.indexPathForObject = function (object) {\n        if (sectionField) {\n            for (var section = 0; section < sections.length; section++) {\n                var sectionData = sections[section].rows;\n                for (var row = 0; row < sectionData.length; row++) {\n                    if (sectionData[row].data[UIDField] == object[UIDField]) return BMIndexPathMakeWithRow(row, {\n                        section : section,\n                        forObject : sectionData[row].data\n                    });\n                }\n            }\n        }\n        else {\n            var section = 0;\n\n            for (var i = 0; i < data.length; i++) {\n                if (data[i][UIDField] == object[UIDField]) return BMIndexPathMakeWithRow(i, {section : section, forObject : data[i]});\n            }\n\n        }\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.cellForItemAtIndexPath = function (indexPath) {\n        var cell;\n\n        if (cellMashupNameEditing && self.isCellAtIndexPathEditing(indexPath)) {\n            cell = collectionView.dequeueCellForReuseIdentifier('mashupEditing');\n        }\n        else if (cellMashupNameSelected && collectionView.isCellAtIndexPathSelected(indexPath)) {\n            cell = collectionView.dequeueCellForReuseIdentifier('mashupSelected');\n        }\n        else {\n            var reuseIdentifier = 'mashup';\n            if (this.reuseIdentifierForCellAtIndexPath) {\n                reuseIdentifier = this.reuseIdentifierForCellAtIndexPath(indexPath);\n            }\n\n            cell = collectionView.dequeueCellForReuseIdentifier(reuseIdentifier);\n        }\n\n        if (cell.initialized) {\n            this.updateCell(cell, {atIndexPath : indexPath});\n        }\n\n        return cell;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.updateCell = function (cell, options) {\n        var indexPath = options.atIndexPath;\n\n        var selected = collectionView.isCellAtIndexPathSelected(indexPath);\n        if (cellStyleSelected && cellStyleSelected.backgroundColor && !cellMashupNameSelected) {\n            if (selected) {\n                cell.element.velocity('finish').css({background : cellStyleSelected.backgroundColor});\n            }\n            else {\n                cell.element.velocity('finish').css({background : 'transparent'});\n            }\n        }\n\n        if (cellStyle && cellStyle.backgroundColor && !selected) {\n            cell.element.velocity('finish').css({background : cellStyle.backgroundColor});\n        }\n\n        if (cell._isSelected != selected) {\n            cell._isSelected = selected;\n            cell.element[0].classList[selected ? 'add' : 'remove']('BMCollectionViewCellSelected');\n        }\n\n        //var mashup = cell.element.children('.BMCollectionViewCell').data('mashup').mashupInstance;\n        var mashup = cell.BM_mashup;\n\n        if (sectionField) {\n            var row = sections[indexPath.section].rows[indexPath.row].data;\n        }\n        else {\n            var row = data[indexPath.row];\n        }\n\n        for (var key in cellMashupPropertyBinding) {\n            // Setting mashup parameters can fail which will break the collection view\n            try {\n                mashup.BM_setParameterInternal(cellMashupPropertyBinding[key], row[key]);\n            }\n            catch (e) {\n                TW.log.error(e);\n            }\n        }\n\n        // Update the global properties as well\n        for (var key in globalDataShape) {\n            try {\n                mashup.BM_setParameterInternal(key, this.getProperty(key));\n            }\n            catch (e) {\n                TW.log.error(e);\n            }\n        }\n\n        // Update the selected parameter if it was set\n        if (cellMashupSelectedField) try {\n            mashup.BM_setParameterInternal(cellMashupSelectedField, collectionView.isCellAtIndexPathSelected(indexPath));\n        }\n        catch (e) {\n            TW.log.error(e);\n        }\n\n        // Update the editing parameter if it was set\n        if (cellMashupEditingParameter) try {\n            mashup.BM_setParameterInternal(cellMashupEditingParameter, self.isCellAtIndexPathEditing(indexPath));\n        }\n        catch (e) {\n            TW.log.error(e);\n        }\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.contentsForCellWithReuseIdentifier = function (identifier) {\n        var contents = $('<div class=\"BMCollectionViewCell BMCollectionViewCellHoverable\" style=\"width: 100%; height: 100%; cursor: ' + (self.getProperty('CellPointer')) + ';\">');\n\n        return contents;\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewDidRenderCell = function (collectionView, cell) {\n        var indexPath = cell.indexPath;\n\n        if (!cell.initialized) {\n            cell.initialized = YES;\n\n            if (cell.itemType == BMCellAttributesType.Cell) {\n                cell.element[0].classList.add('BMCollectionViewCellWrapper');\n\n                // Apply the border radius if needed\n                if (cellBorderRadius) {\n                    cell.element.css({\n                        overflow : 'hidden',\n                        'border-radius' : cellBorderRadius\n                    });\n                }\n\n                // Construct and initialize the ripple if needed\n                if (usesRipple) {\n                    var ripple = $('<div style=\"position: absolute; border-radius: 50%; background:' + rippleStyle.backgroundColor + '; top: 0px; left: 0px; pointer-events: none;\">');\n                    cell.element.css({overflow : 'hidden'});\n\n                    cell.element.append(ripple);\n                    BMRippleMakeWithElement(ripple, {forTarget : cell.element});\n                }\n\n                // Apply the box shadow if needed\n                if (cellBoxShadow) {\n                    cell.element.css({'box-shadow' : cellBoxShadow});\n                }\n\n                if (cellStyle && cellStyle.backgroundColor) {\n                    cell.element.css({backgroundColor : cellStyle.backgroundColor});\n                }\n\n// \t\t\t\tcell.element.css({'backface-visibility': 'hidden', perspective: 1000});\n\n                var mashupParameters = {};\n                for (var key in cellMashupPropertyBinding) {\n                    mashupParameters[cellMashupPropertyBinding[key]] = indexPath.object[key];\n                }\n\n                var mashupName = cellMashupName;\n                if (cellMashupNameSelected && collectionView.isCellAtIndexPathSelected(cell.indexPath)) {\n                    mashupName = cellMashupNameSelected;\n                }\n\n                if (cellMashupNameEditing && self.isCellAtIndexPathEditing(indexPath)) {\n                    mashupName = cellMashupNameEditing;\n                }\n\n                if (this.mashupNameForCellAtIndexPath) {\n                    mashupName = this.mashupNameForCellAtIndexPath(indexPath);\n                }\n\n                if (cellMashupSelectedField) {\n                    mashupParameters[cellMashupSelectedField] = collectionView.isCellAtIndexPathSelected(indexPath);\n                }\n\n                if (cellMashupEditingParameter) {\n                    mashupParameters[cellMashupEditingParameter] = self.isCellAtIndexPathEditing(indexPath);\n                }\n\n                // Push the global properties to the parameters as well\n                for (var key in globalDataShape) {\n                    mashupParameters[key] = this.getProperty(key);\n                }\n\n                // Constructing mashups can fail, which will break the collection view\n                try {\n                    //cell.element.children('.BMCollectionViewCell').mashup({mashupName: mashupName, async: NO, mashupParameters: mashupParameters});\n                    self.renderMashupNamed(mashupName, {\n                        inContainer : cell.element.children('.BMCollectionViewCell'),\n                        withParameters : mashupParameters,\n                        forCell : cell\n                    });\n                }\n                catch (e) {\n                    TW.log.error(e);\n                }\n\n                // Initialize the menu touch event handler if there are menu entries\n                if (menuDefinition.length) {\n                    self.initializeMenuTouchEventHandlersForCell(cell);\n                }\n\n            }\n            else {\n                cell.element[0].classList.add('BMCollectionViewSupplementaryView');\n                // When the cell is the empty supplementary view, the section identifier's value will be set to NO,\n                // preventing an exception being thrown due to trying to access the identifier of an undefined object.\n                try {\n                    var sectionIdentifier = (cell.reuseIdentifier !== BMCollectionViewTableLayoutSupplementaryView.Empty && sections[indexPath.section].identifier);\n                }\n                catch (e) {\n                    // TODO: lazy fix for custom supplementary view identifier\n                }\n\n                if (cell.reuseIdentifier == BMCollectionViewTableLayoutSupplementaryView.Header) {\n                    var mashupParameters = {};\n                    if (headerMashupSectionProperty && headerMashupName !== \"\" && headerMashupName !== undefined) {\n                        mashupParameters[headerMashupSectionProperty] = sectionIdentifier;\n\n                        // Constructing mashups can fail, which will break the collection view\n                        try {\n                            //cell.element.children('.BMCollectionViewCell').mashup({mashupName: headerMashupName, async: NO, mashupParameters: mashupParameters});\n                            self.renderMashupNamed(headerMashupName, {\n                                inContainer : cell.element.children('.BMCollectionViewCell'),\n                                withParameters : mashupParameters,\n                                forCell : cell\n                            });\n                        }\n                        catch (e) {\n                            TW.log.error(e);\n                        }\n                    }\n                }\n                else if (cell.reuseIdentifier === BMCollectionViewTableLayoutSupplementaryView.Footer) {\n                    var mashupParameters = {};\n                    if (footerMashupSectionProperty && footerMashupName !== \"\" && footerMashupName !== undefined) {\n                        mashupParameters[footerMashupSectionProperty] = sectionIdentifier;\n\n                        // Constructing mashups can fail, which will break the collection view\n                        try {\n                            //cell.element.children('.BMCollectionViewCell').mashup({mashupName: footerMashupName, async: NO, mashupParameters: mashupParameters});\n                            self.renderMashupNamed(footerMashupName, {\n                                inContainer : cell.element.children('.BMCollectionViewCell'),\n                                withParameters : mashupParameters,\n                                forCell : cell\n                            });\n                        }\n                        catch (e) {\n                            TW.log.error(e);\n                        }\n                    }\n                }\n                else if (cell.reuseIdentifier === BMCollectionViewTableLayoutSupplementaryView.Empty && emptyMashupName) {\n                    // Constructing mashups can fail, which will break the collection view\n                    try {\n                        //cell.element.children('.BMCollectionViewCell').mashup({mashupName: emptyMashupName, async: NO, mashupParameters: {}});\n                        self.renderMashupNamed(emptyMashupName, {\n                            inContainer : cell.element.children('.BMCollectionViewCell'),\n                            withParameters : {},\n                            forCell : cell\n                        });\n                    }\n                    catch (e) {\n                        TW.log.error(e);\n                    }\n\n                }\n\n            }\n\n\n        }\n\n        // If this cell is being edited, retain it indefinitely until the editing is finished\n        if (self.isCellAtIndexPathEditing(indexPath)) {\n            cell.retain();\n        }\n\n        // Let the delegate know that this cell has been bound to a new index path.\n        if (!cell.BM_mashup) return;\n        if (cell.BM_mashup.BMCellDelegate && cell.BM_mashup.BMCellDelegate.collectionViewDidAssignIndexPath) {\n            cell.BM_mashup.BMCellDelegate.collectionViewDidAssignIndexPath(collectionView, cell.indexPath);\n        }\n\n        cell.BM_recycled = NO;\n\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewWillRecycleCell = function (collectionView, cell) {\n        cell.BM_recycled = YES;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.cellForSupplementaryViewWithIdentifier = function (identifier, options) {\n        var cell = collectionView.dequeueCellForSupplementaryViewWithIdentifier(identifier);\n\n        if (cell.initialized) {\n            this.updateSupplementaryView(cell, {withIdentifier : identifier, atIndexPath : options.atIndexPath});\n        }\n\n        return cell;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.contentsForSupplementaryViewWithIdentifier = function (identifier) {\n        var contents = $('<div class=\"BMCollectionViewCell\" style=\"width: 100%; height: 100%;\">');\n\n        return contents;\n    };\n\n    // @override - BMCollectionViewDataSet\n    this.updateSupplementaryView = function (cell, options) {\n        var indexPath = options.atIndexPath;\n\n        var sectionIdentifier = (cell.reuseIdentifier !== BMCollectionViewTableLayoutSupplementaryView.Empty && sections[options.atIndexPath.section].identifier);\n// \t\tvar mashup = cell.element.children('.BMCollectionViewCell').data('mashup').mashupInstance;\n        var mashup = cell.BM_mashup;\n\n        try {\n            if (cell.reuseIdentifier == BMCollectionViewTableLayoutSupplementaryView.Header) {\n                if (headerMashupSectionProperty) mashup.BM_setParameterInternal(headerMashupSectionProperty, sectionIdentifier);\n            }\n            else if (cell.reuseIdentifier == BMCollectionViewTableLayoutSupplementaryView.Footer) {\n                if (footerMashupSectionProperty) mashup.BM_setParameterInternal(footerMashupSectionProperty, sectionIdentifier);\n            }\n\n            // This data set does not handle the update for the empty supplementary view\n        }\n        catch (e) {\n\n        }\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCanSelectCellAtIndexPath = function (collectionView, indexPath) {\n        if (isSelectionModeEnabled) return YES;\n\n        return canSelectCells && (canSelectMultipleCells || multipleSelectionType === BMCollectionViewCellMultipleSelectionType.ClickTap || !collectionView.isCellAtIndexPathSelected(indexPath));\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCanDeselectCellAtIndexPath = function (collectionView, indexPath) {\n        if (isSelectionModeEnabled) return YES;\n\n        return canSelectCells && (canSelectMultipleCells || multipleSelectionType === BMCollectionViewCellMultipleSelectionType.ClickTap);\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewDidSelectCellAtIndexPath = function (collectionView, indexPath) {\n        var cell = collectionView.cellAtIndexPath(indexPath, {ofType : BMCellAttributesType.Cell});\n\n        if (!canSelectMultipleCells && !isSelectionModeEnabled && !isCtrlPressed && multipleSelectionType !== BMCollectionViewCellMultipleSelectionType.ClickTap) {\n            collectionView.selectedIndexPaths = [indexPath];\n            /*var indexPaths = collectionView.selectedIndexPaths;\n\n             // In single selection mode, deselect all other index paths\n             for (var i = 0; i < indexPaths.length; i++) {\n             if (!indexPaths[i].isLooselyEqualToIndexPath(indexPath, {usingComparator: collectionView.identityComparator}))  {\n             collectionView.deselectCellAtIndexPath(indexPaths[i]);\n             }\n             }*/\n        }\n\n        this.updateThingworxSelection();\n\n        if (!cell) return;\n\n        if (!cell._isSelected) {\n            cell._isSelected = YES;\n            cell.element[0].classList.add('BMCollectionViewCellSelected');\n        }\n\n// \t\tvar mashup = cell.element.children('.BMCollectionViewCell').data('mashup').mashupInstance;\n        var mashup = cell.BM_mashup;\n\n        // Notify the cell delegate if it was set and if the collection view doesn't use a separate selected mashup\n        if (!cellMashupNameSelected) {\n\n            if (mashup.BMCellDelegate && mashup.BMCellDelegate.collectionViewDidSelectCell) {\n                mashup.BMCellDelegate.collectionViewDidSelectCell(collectionView);\n            }\n        }\n\n        // Update the selected field if it was set\n        if (cellMashupSelectedField) try {\n            mashup.BM_setParameterInternal(cellMashupSelectedField, YES);\n        }\n        catch (e) {\n            TW.log.error(e);\n        }\n\n        if (cellMashupNameSelected) {\n            collectionView.refreshCellAtIndexPath(indexPath, {animated : YES});\n        }\n        else if (cellStyleSelected && cellStyleSelected.backgroundColor) {\n\n            BMHook(cell.element, {\n                backgroundColorRed : cellStyleSelectedColor.red, //cellStyleSelectedColorComponents[0],\n                backgroundColorGreen : cellStyleSelectedColor.green, //cellStyleSelectedColorComponents[1],\n                backgroundColorBlue : cellStyleSelectedColor.blue, //cellStyleSelectedColorComponents[2],\n                backgroundColorAlpha : 0\n            });\n\n            cell.element.velocity({backgroundColorAlpha : cellStyleSelectedColor.alpha}, {duration : 150, easing : 'easeInOutQuad'});\n        }\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewDidDeselectCellAtIndexPath = function (collectionView, indexPath) {\n        var cell = collectionView.cellAtIndexPath(indexPath, {ofType : BMCellAttributesType.Cell});\n        this.updateThingworxSelection();\n\n        if (!cell) return;\n\n        if (cell._isSelected) {\n            cell._isSelected = NO;\n            cell.element[0].classList.remove('BMCollectionViewCellSelected');\n        }\n\n// \t\tvar mashup = cell.element.children('.BMCollectionViewCell').data('mashup').mashupInstance;\n        var mashup = cell.BM_mashup;\n\n        // Notify the cell delegate if it was set and if the collection view doesn't use a separate selected mashup\n        if (!cellMashupNameSelected) {\n\n            if (mashup.BMCellDelegate && mashup.BMCellDelegate.collectionViewDidSelectCell) {\n                mashup.BMCellDelegate.collectionViewDidSelectCell(collectionView);\n            }\n        }\n\n        // Update the selected field if it was set\n        if (cellMashupSelectedField) try {\n            mashup.BM_setParameterInternal(cellMashupSelectedField, NO);\n        }\n        catch (e) {\n            TW.log.error(e);\n        }\n\n        if (cellMashupNameSelected) {\n            collectionView.refreshCellAtIndexPath(indexPath, {animated : YES});\n        }\n        else if (cellStyleSelected && cellStyleSelected.backgroundColor) {\n            if (cellStyle && cellStyle.backgroundColor) {\n                cell.element.velocity({\n                    backgroundColorAlpha : cellStyleColor.alpha,\n                    backgroundColorBlue : cellStyleColor.blue,\n                    backgroundColorGreen : cellStyleColor.green,\n                    backgroundColorRed : cellStyleColor.red\n                }, {duration : 150, easing : 'easeInOutQuad'});\n            }\n            else {\n                cell.element.velocity({backgroundColorAlpha : 0}, {duration : 150, easing : 'easeInOutQuad'});\n            }\n        }\n    };\n\n\n    // ******************************************** EVENT AND SELECTION HANDLERS ********************************************\n\n    /**\n     * Invoked to notify Thingworx of any selection changes.\n     */\n    this.updateThingworxSelection = function () {\n        if (this.selectionUpdateBlocked) return;\n        var selectedIndexPaths = collectionView.selectedIndexPaths;\n        var selectedDataIndices = [];\n        for (var i = 0; i < selectedIndexPaths.length; i++) {\n            if (sectionField) {\n                var indexPath = selectedIndexPaths[i];\n                selectedDataIndices.push(sections[indexPath.section].rows[indexPath.row].index);\n            }\n            else {\n                // if data is sorted, unMap the sorted row position clicked against the row index in original data\n                selectedDataIndices.push(sortField ? data[selectedIndexPaths[i].row]._BMCollectionViewInfoTableIndex : selectedIndexPaths[i].row);\n            }\n        }\n\n        // Update the HasSelectedCells property to match the current selection state\n        var hasSelectedCells = !!selectedDataIndices.length;\n        if (hasSelectedCells != this.getProperty('HasSelectedCells')) {\n            this.setProperty('HasSelectedCells', hasSelectedCells);\n        }\n        if(handleSelectionUpdates) {\n            this.updateSelection('Data', selectedDataIndices);\n        }\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCanDoubleClickCell = function (collectionView, cell, options) {\n        return self.getProperty('_CanDoubleClick');\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCellWasClicked = function (collectionView, cell, args) {\n        if (currentMenuCell) {\n            this.collapseMenuInCell(currentMenuCell, {animated : YES});\n            currentMenuCell = undefined;\n        }\n\n        if (currentMenuCell && this.getProperty(\"SelectedCellsCount\") < 2) {\n            collectionView.selectCellAtIndexPath(cell.indexPath);\n        }\n\n        this.triggerEvent('CellWasClicked', {withCell : cell});\n\n        if (multipleSelectionType === BMCollectionViewCellMultipleSelectionType.CtrlClick && canSelectCells) {\n            // When a cell is clicked while holding ctrl, toggle its selection state\n            if (args.withEvent.ctrlKey || args.withEvent.metaKey) {\n                isCtrlPressed = YES;\n                if (collectionView.isCellAtIndexPathSelected(cell.indexPath)) {\n                    collectionView.deselectCellAtIndexPath(cell.indexPath);\n                }\n                else {\n                    collectionView.selectCellAtIndexPath(cell.indexPath);\n                }\n                isCtrlPressed = NO;\n\n                // For Ctrl-Clicking to select or deselect cells, inhibit the default behaviour\n                return YES;\n            }\n\n            // Otherwise invoke the default behaviour which selects the cell and deselects all other cells\n        }\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCellWasDoubleClicked = function (collectionView, cell) {\n        if (currentMenuCell) {\n            this.collapseMenuInCell(currentMenuCell, {animated : YES});\n            currentMenuCell = undefined;\n        }\n\n        this.triggerEvent('CellWasDoubleClicked', {withCell : cell});\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCellWasLongClicked = function (collectionView, cell) {\n        if (currentMenuCell) {\n            this.collapseMenuInCell(currentMenuCell, {animated : YES});\n            currentMenuCell = undefined;\n        }\n\n        this.triggerEvent('CellWasLongClicked', {withCell : cell});\n\n        if (longClickSelectsCell) {\n            if (collectionView.isCellAtIndexPathSelected(cell.indexPath)) {\n                collectionView.deselectCellAtIndexPath(cell.indexPath);\n            }\n            else {\n                collectionView.selectCellAtIndexPath(cell.indexPath);\n            }\n        }\n    };\n\n    /**\n     * The cell currently hosting the context menu. Only one cell should host the context menu at a time.\n     */\n    var currentMenuCell; // <BMCell, nullable>\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewCellWasRightClicked = function (collectionView, cell, options) {\n\n        this.triggerEvent('CellWasRightClicked', {withCell : cell});\n\n        if (!self.getProperty('CellMenuStatesUseBuiltin') || self.getProperty(\"CellMenuStates\") === undefined) return canRightClick;\n\n        if (currentMenuCell) {\n            self.collapseMenuInCell(currentMenuCell, {animated : YES});\n\n            options.withEvent.preventDefault();\n            options.withEvent.stopPropagation();\n        }\n\n        // When right clicking the current cell, just dismiss the menu\n        if (cell == currentMenuCell) {\n            currentMenuCell = undefined;\n        }\n\n        if (menuDefinition.length) {\n            currentMenuCell = cell;\n\n            self.expandMenuInCell(cell, {animated : YES});\n\n            options.withEvent.preventDefault();\n            options.withEvent.stopPropagation();\n        }\n\n        return canRightClick;\n    };\n\n    // @override - BMCollectionViewDelegate\n    this.collectionViewBoundsDidChange = function (collectionView, bounds) {\n        if (currentMenuCell) {\n            this.collapseMenuInCell(currentMenuCell, {animated : YES});\n            currentMenuCell = undefined;\n        }\n    };\n\n    /**\n     * Should be invoked to populate the event properties with the values from the given cell and trigger the specified event.\n     * @param event <String>        The event's name.\n     * {\n     *    @param withCell <BMCell>    The cell that should trigger this event.\n     * }\n     */\n    this.triggerEvent = function (event, options) {\n        var object = options.withCell.indexPath.object;\n\n        // Retrieve the event data shape\n        var dataShape = JSON.parse(this.getProperty('_EventDataShape') || '{}');\n        var fields = Object.keys(dataShape);\n\n        // Populate the event properties\n        for (var i = 0; i < fields.length; i++) {\n            this.setProperty('Event:' + fields[i], object[fields[i]]);\n        }\n\n        // Fire the event\n        this.jqElement.triggerHandler(event);\n    };\n\n\n    // *************************** MENU AND MENU ENTRY GENERATORS *****************************\n\n    /**\n     * Should be invoked to construct and return a new menu entry.\n     * @param name <String>                            The menu entry's name.\n     * {\n     *    @param style <TWStyleDefinition>        The style definition to apply to this menu entry.\n     *    @param handler <void ^ (String)>        A handler that will be invoked when this menu option is selected.\n     *                                            This handler will receive the menu entry's name as its paramters.\n     * }\n     */\n    this.menuEntryWithName = function (name, options) {\n\n        var entry = $('<div class=\"BMCollectionViewMenuEntry\"></div>');\n\n        var icon = $('<div class=\"BMCollectionViewMenuEntryIcon\"></div>');\n        var iconSrc = options.style.image;\n\n        icon.css({\n            backgroundImage : 'url(' + iconSrc + ')',\n            backgroundSize : menuIconSize + 'px',\n            width : menuIconSize + 'px',\n            height : menuIconSize + 'px'\n        });\n\n        switch (menuIconGravity) {\n            case 'Left':\n                entry.addClass('BMCollectionViewMenuEntryLeft');\n                entry.text(name);\n                entry.prepend(icon);\n                break;\n            case 'Right':\n                entry.addClass('BMCollectionViewMenuEntryRight');\n                entry.text(name);\n                entry.append(icon);\n                break;\n            case 'Above':\n                entry.addClass('BMCollectionViewMenuEntryAbove');\n                icon.css({display : 'block'});\n                entry.text(name);\n                entry.prepend(icon);\n                break;\n            case 'Below':\n                entry.addClass('BMCollectionViewMenuEntryBelow');\n                icon.css({display : 'block'});\n                entry.text(name);\n                entry.append(icon);\n                break;\n        }\n\n        var fontSize = TW.getTextSize(options.style.textSize).substring(11);\n        fontSize = fontSize.substring(0, fontSize.length - 1);\n\n        entry.css({\n            'background-color' : options.style.backgroundColor,\n            color : options.style.foregroundColor,\n            'font-size' : fontSize\n        });\n\n        if (options.style.fontEmphasisBold) {\n            entry.css({'font-weight' : 'bold'});\n        }\n\n        if (options.style.fontEmphasisUnderline) {\n            entry.css({'text-decoration' : 'underline'});\n        }\n\n        if (options.style.fontEmphasisItalic) {\n            entry.css({'font-style' : 'italic'});\n        }\n\n        /*entry.on('click', function (event) {\n         options.handler(name);\n         event.stopPropagation();\n         });*/\n\n        // Stop the collection view events from stealing this entry's events\n        entry.on('touchstart touchmove touchend mousedown mouseup mousemove click', function (event) {\n            event.stopPropagation();\n        });\n\n        // Use capture to prevent other elements from stealing the events\n        var captureListener = function (event) {\n            event.stopPropagation();\n        };\n\n        var clickListener = function (event) {\n            options.handler(name);\n            event.stopPropagation();\n        };\n\n        entry[0].addEventListener('touchstart', captureListener, YES);\n        entry[0].addEventListener('touchmove', captureListener, YES);\n        entry[0].addEventListener('touchend', captureListener, YES);\n        entry[0].addEventListener('mousedown', captureListener, YES);\n        entry[0].addEventListener('mouseup', captureListener, YES);\n        entry[0].addEventListener('mousemove', captureListener, YES);\n        entry[0].addEventListener('click', clickListener, YES);\n\n        return entry;\n\n    };\n\n    /**\n     * Should be invoked to construct and return a menu.\n     * @param handler <void ^ (String)>        A handler that will be invoked whenever any menu option is selected.\n     *                                        This handler will receive the selected menu entry's name as its paramters.\n     */\n    this.renderMenuWithHandler = function (handler) {\n        var menu = $('<div class=\"BMCollectionViewMenu\">');\n        var menuWrapper = $('<div class=\"BMCollectionViewMenuWrapper\">');\n\n        for (var i = 0; i < menuDefinition.length; i++) {\n            var style = TW.getStyleFromStyleDefinition(menuStateDefinition[i].defaultStyleDefinition);\n\n            menu.append(self.menuEntryWithName(menuDefinition[i], {style : style, handler : handler}));\n        }\n\n        switch (menuOrientation) {\n            case 'Horizontal':\n                menu.addClass('BMCollectionViewMenuHorizontal');\n                break;\n            case 'Vertical':\n                menu.addClass('BMCollectionViewMenuVertical');\n                break;\n        }\n\n        menuWrapper.append(menu);\n        return menuWrapper;\n    };\n\n    /**\n     * Should be invoked to collapse the menu in the given cell. If the given cell doesn't current host a menu, this method does nothing.\n     * This action will cause the cell to be released at the end of the animation.\n     * @param cell <BMCell>                        The cell from which to collapse the menu.\n     * {\n     *    @param animated <Boolean, nullable>        Defaults to NO. If set to YES, this change will be animated, otherwise it will be instant.\n     *    @param duration <Number, nullable>        Defaults to 300. If specified, this is the duration of the animation.\n     * }\n     */\n    this.collapseMenuInCell = function (cell, options) {\n        if (!cell.BM_hasMenu) return;\n\n        if (!options || !options.animated) {\n            // If the change isn't animated, just instantly remove the menu and move the mashup back to its original position\n            cell.element.children('.BMCollectionViewMenuWrapper').remove();\n            BMHook(cell.element.children.eq(0), {translateX : '0px'});\n            return;\n        }\n\n        var mashup = cell.element.children().eq(0);\n        var oldMenuWrapper = cell.element.children('.BMCollectionViewMenuWrapper');\n\n        var menu = oldMenuWrapper.children();\n        var menuWidth = menu.outerWidth();\n\n        // Slide the mashup in the cell back to its original position\n        mashup.velocity('stop', NO).velocity({\n            translateX : 0,\n            translateZ : 0\n        }, {\n            duration : (options && options.duration) || 300,\n            easing : 'easeInOutQuart',\n            queue : NO,\n            complete : function () {\n                cell.release();\n                cell.BM_hasMenu = NO;\n                oldMenuWrapper.remove();\n            }\n        });\n\n        // Slide the menu towards the right, outside the cell\n        oldMenuWrapper.velocity('stop', NO).velocity({\n            translateX : menuWidth + 'px',\n            translateZ : 0\n        }, {\n            duration : (options && options.duration) || 300,\n            easing : 'easeInOutQuart',\n            queue : NO\n        });\n\n        if (menuOrientation == 'Horizonta') {\n            // Additionally, for horizontal menus, compact the menu entries on top of eachother\n            var menuEntries = menu.children();\n            var menuEntriesLength = menuEntries.length;\n            var menuEntryWidth = menuWidth / menuEntriesLength;\n            for (var i = 0; i < menuEntriesLength; i++) {\n                var menuEntry = menuEntries.eq(i);\n\n                menuEntry.velocity('stop', NO).velocity({\n                    translateX : [(-menuEntryWidth * i) + 'px', '0px'],\n                    translateZ : 0\n                }, {\n                    duration : (options && options.duration) || 300,\n                    easing : 'easeInOutQuart',\n                    queue : NO\n                });\n            }\n        }\n    };\n\n    /**\n     * Should be invoked to expand a new menu in the given cell. If the cell already has a menu, this method does nothing.\n     * This action will cause the cell to be retained until the menu is dismissed.\n     * @param cell <BMCell>                        The cell in which to expand a new menu.\n     * {\n     *    @param animated <Boolean, nullable>        Defaults to NO. If set to YES, this change will be animated, otherwise it will be instant.\n     *    @param duration <Number, nullable>        Defaults to 300. If specified, this is the duration of the animation.\n     *    @param inPlace <Boolean, nullable>        Defaults to NO. If set to YES, the menu will not be constructed and the cell's currently existing menu\n     *                                            will be expanded instead.\n     * }\n     */\n    this.expandMenuInCell = function (cell, options) {\n        var inPlace = options && options.inPlace;\n\n        if (cell.BM_hasMenu && !inPlace) return;\n\n        if (inPlace) {\n            // If the expand is to be performed in place, it expected that the cell already has a menu and is retained\n            var menuWrapper = cell.element.find('.BMCollectionViewMenuWrapper');\n        }\n        else {\n            // Retain the cell and add a property that indicates that it does have a menu associated with it\n            cell.BM_hasMenu = YES;\n            cell.retain();\n\n            // Construct the menu and add it to the cell\n            var menuWrapper = self.renderMenuWithHandler(function (name) {\n                self.triggerEvent('Menu:' + name, {withCell : cell});\n                if (currentMenuCell === cell) self.collapseMenuInCell(cell, {animated : YES});\n            });\n            cell.element.append(menuWrapper);\n        }\n\n        var menu = menuWrapper.children();\n\n        var menuWidth = menu.outerWidth();\n        var mashup = cell.element.children().eq(0);\n\n        if (!options || !options.animated) {\n            // If the change is not animated, it is sufficient to just slide the mashup towards the left\n            BMHook(mashup, {translateX : (-menuWidth) + 'px'});\n\n            return;\n        }\n\n        if (!inPlace) {\n            // Otherwise start with a hidden visibility for the menu wrapper, so it doesn't flash at its regular position before the animation starts\n            menuWrapper.css({visibility : 'hidden'});\n\n            // Apply the initial positioning to the menuWrapper\n            BMHook(menuWrapper, {translateX : menuWidth + 'px'});\n        }\n\n        // Slide the mashup towards the left\n        mashup.velocity('stop', NO).velocity({\n            translateX : (-menuWidth) + 'px',\n            translateZ : 0\n        }, {\n            duration : (options && options.duration) || 300,\n            easing : 'easeInOutQuart',\n            queue : NO\n        });\n\n        // Slide the menu from outside the cell to its usual position\n        menuWrapper.velocity('stop', NO).velocity({\n            translateX : '0px',\n            translateZ : 0\n        }, {\n            duration : (options && options.duration) || 300,\n            easing : 'easeInOutQuart',\n            queue : NO,\n            visibility : 'visible'\n        });\n\n        if (menuOrientation == 'Horizontal') {\n            // Additionally, for horizontal menus, the entries will first be on top of eachother and slide towards their usual positions\n            var menuEntries = menu.children();\n            var menuEntriesLength = menuEntries.length;\n            var menuEntryWidth = menuWidth / menuEntriesLength;\n            for (var i = 0; i < menuEntriesLength; i++) {\n                var menuEntry = menuEntries.eq(i);\n\n                menuEntry.velocity('stop', NO).velocity({\n                    translateX : inPlace ? '0px' : ['0px', (-menuEntryWidth * i) + 'px'],\n                    translateZ : 0\n                }, {\n                    duration : (options && options.duration) || 300,\n                    easing : 'easeInOutQuart',\n                    queue : NO\n                });\n            }\n        }\n    };\n\n    /**\n     * Should be invoked to set up the touch event handlers that implement the touch-based slide menu behaviours.\n     * @param cell <BMCell>                The cell for which to initialize the touch event handlers.\n     */\n    this.initializeMenuTouchEventHandlersForCell = function (cell) {\n        // Don't install event handlers if use builtin is disabled\n        if (!self.getProperty('CellMenuStatesUseBuiltin') || self.getProperty(\"CellMenuStates\") !== undefined) return NO;\n\n        var startingX, startingY;\n        var lastX, lastY;\n\n        var direction;\n\n        var steps;\n        var isTrackingMenuEvent;\n\n        var menuWrapper, menu, menuEntries;\n        var menuWidth;\n\n        cell.element.on('touchstart.BMCollectionViewMenu', function (event) {\n            if (cell == currentMenuCell) return;\n\n            startingX = event.originalEvent.touches[0].pageX;\n            startingY = event.originalEvent.touches[0].pageY;\n\n            steps = 0;\n            isTrackingMenuEvent = NO;\n        });\n\n        cell.element.on('touchmove.BMCollectionViewMenu', function (event) {\n            if (cell == currentMenuCell) return;\n\n            // Allow a few movement steps to make sure that this is a horizontal gesture rather than a vertical one\n            // And that the horizontal direction is towards the left rather than towards the right\n            steps++;\n\n            // If this cell is already hosting a menu, don't allow it to open another one\n            if (steps == 3 && currentMenuCell != cell) {\n                // At 3 steps, it should be relatively safe to determine whether the gesture is a horizontal or vertical slide\n                var x = event.originalEvent.touches[0].pageX;\n                var y = event.originalEvent.touches[0].pageY;\n\n                // It is also required for the event to go from right to left initially; past this, the gesture may move back and forth\n                if (Math.abs(x - startingX) > Math.abs(y - startingY) && x < startingX) {\n                    isTrackingMenuEvent = YES;\n\n                    // Construct the menu which will be used for the remainder of this track\n                    cell.BM_hasMenu = YES;\n                    menuWrapper = self.renderMenuWithHandler(function (name) {\n                        self.triggerEvent('Menu:' + name, {withCell : cell});\n                        if (currentMenuCell === cell) self.collapseMenuInCell(cell, {animated : YES});\n                    });\n                    menu = menuWrapper.children();\n                    menuEntries = menu.children();\n\n                    cell.element.append(menuWrapper);\n\n                    // The cell will be retained for the duration of this event tracking; if an update happens before this tracking is finalized,\n                    // the collection will completely discard this cell\n                    cell.retain();\n\n                    menuWidth = menu.outerWidth();\n\n                    // Quickly collapse the current menu if it exists\n                    if (currentMenuCell) {\n                        self.collapseMenuInCell(currentMenuCell, {animated : YES, duration : 200});\n                    }\n                }\n\n            }\n\n            if (isTrackingMenuEvent) {\n                var x = event.originalEvent.touches[0].pageX;\n                var y = event.originalEvent.touches[0].pageY;\n\n                direction = x - lastX;\n\n                // Take control of the event while tracking menu events;\n                // By stopping propagation, this event will not reach the collection view, preventing scrolling for the duration of the menu tracking\n                event.stopPropagation();\n                event.preventDefault();\n\n                // Slide over the menu and mashup, but only towards the right\n                var displacement = Math.max(startingX - x, 0);\n\n                // Slide over the menu; the menu itself should never slide past its final position\n                BMHook(menuWrapper, {translateX : Math.max(menuWidth - displacement, 0) + 'px'});\n\n                // The mashup may slide past its final position, but it should generate greater resistance once it passes that position\n                BMHook(cell.element.children().eq(0), {translateX : -displacement + Math.max((displacement - menuWidth) / 2, 0) + 'px'});\n\n                if (menuOrientation == 'Horizontal') {\n                    // Additionally, for horizontal menus, the entries will first be on top of eachother and slide towards their usual positions\n                    var menuEntriesLength = menuEntries.length;\n                    var menuEntryWidth = menuWidth / menuEntriesLength;\n                    var displacementPercentage = BMNumberByConstrainingNumberToBounds(displacement / menuWidth, 0, 1);\n                    TW.log.error('Raw displacement is ' + (displacement / menuWidth));\n                    for (var i = 0; i < menuEntriesLength; i++) {\n                        var menuEntry = menuEntries.eq(i);\n\n                        BMHook(menuEntry, {translateX : (-menuEntryWidth * i) + (menuEntryWidth * i * displacementPercentage) + 'px'});\n                    }\n                }\n\n                // Store the current touch X and Y position\n                // These will be used in the touchend handler to determine the final direction of the gesture\n                lastX = x;\n                lastY = y;\n            }\n        });\n\n        cell.element.on('touchend.BMCollectionViewMenu', function (event) {\n            if (cell == currentMenuCell) return;\n            if (!isTrackingMenuEvent) return;\n\n            if (direction > 0) {\n                // If the direction is positive, the gesture moves towards the right and the menu should be closed\n                // This will also release the cell at the end of the animation\n                self.collapseMenuInCell(cell, {animated : YES, duration : 200});\n\n                // Clear the menu references so the garbage collector can reclaim their contents\n                menuWrapper = undefined;\n                menu = undefined;\n                menuEntries = undefined;\n            }\n            else {\n                // Otherwise the menu should be fully expanded\n                currentMenuCell = cell;\n                self.expandMenuInCell(cell, {animated : YES, duration : 200, inPlace : YES});\n            }\n\n        });\n    };\n\n\n    // *************************** CELL MENU CONTROLLER OUTLETS *****************************\n\n    /**\n     * Should be invoked by cell menu controller to expand the menu in their cell.\n     * @param cell <BMCell>                The cell in which to expand the menu.\n     */\n    this.requestExpandMenuInCell = function (cell) {\n\n        if (currentMenuCell != cell) {\n            if (currentMenuCell) self.collapseMenuInCell(currentMenuCell, {animated : YES});\n\n            if (menuDefinition.length) {\n                currentMenuCell = cell;\n\n                self.expandMenuInCell(cell, {animated : YES});\n            }\n\n        }\n\n    };\n\n    /**\n     * Should be invoked by cell menu controller to collapse the menu in their cell.\n     * @param cell <BMCell>                The cell in which to collapse the menu.\n     */\n    this.requestCollapseMenuInCell = function (cell) {\n\n        if (currentMenuCell == cell) {\n            self.collapseMenuInCell(currentMenuCell, {animated : YES});\n            currentMenuCell = undefined;\n        }\n\n    };\n\n    /**\n     * Should be invoked by cell menu controller to toggle the menu in their cell.\n     * @param cell <BMCell>                The cell in which to toggle the menu.\n     */\n    this.requestToggleMenuInCell = function (cell) {\n\n        if (currentMenuCell == cell) {\n            self.requestCollapseMenuInCell(cell);\n        }\n        else {\n            self.requestExpandMenuInCell(cell);\n        }\n\n    };\n\n\n    // *************************** DATA MANIPULATION METHODS *****************************\n\n    // The index paths currently being edited.\n    var editingIndexPaths = []; // <[BMIndexPath]>\n\n    /**\n     * Invoked when the data set updates. Updates the index paths being edited to point to the correct rows and sections.\n     */\n    this.updateEditingIndexPaths = function () {\n        for (var i = 0; i < editingIndexPaths.length; i++) {\n            var indexPath = self.indexPathForObject(editingIndexPaths[i].object);\n            if (indexPath) {\n                editingIndexPaths[i] = indexPath;\n            }\n            else {\n                editingIndexPaths.splice(i, 1);\n                i--;\n            }\n        }\n    };\n\n    /**\n     * Marks the cell at the specified index path as being edited.\n     * If the cell is visible and the editing mashup is specified, the cell is refreshed.\n     * @param indexPath <BMIndexPath>        The index path to begin editing.\n     */\n    this.beginEditingCellAtIndexPath = function (indexPath) {\n        editingIndexPaths.push(indexPath);\n\n        var cell = this.collectionView.cellAtIndexPath(indexPath);\n\n        // If an editing mashup is specified and the edited cell is visible, refresh the target cell\n        if (cell && cellMashupNameEditing) {\n            // The update method will handle passing in the editing paramater and indefinitely retaining the cell\n            // to prevent loss of focus and loss of in-progress values being edited\n            cell = this.collectionView.refreshCellAtIndexPath(indexPath, {animated : YES});\n        }\n        // Otherwise, just update the editing parameter and retain the cell\n        else if (cell && cellMashupEditingParameter) {\n            var mashup = cell.BM_mashup;\n            cell.retain();\n\n            if (!mashup) return;\n\n            try {\n                mashup.BM_setParameterInternal(cellMashupEditingParameter, YES);\n            }\n            catch (e) {\n                TW.log.error(e);\n            }\n\n        }\n        else if (cell) {\n            cell.retain();\n        }\n    };\n\n    /**\n     * Marks the cell at the specified index path as not being edited.\n     * If the cell is visible and the editing mashup is specified, the cell is refreshed.\n     * @param indexPath <BMIndexPath>        The index path to finish editing.\n     */\n    this.finishEditingCellAtIndexPath = function (indexPath) {\n        // Find the index path in the editing index paths\n        for (var i = 0; i < editingIndexPaths.length; i++) {\n            var editingIndexPath = editingIndexPaths[i];\n\n            if (indexPath.isLooselyEqualToIndexPath(editingIndexPath, {usingComparator : self.collectionView.identityComparator})) {\n\n                // Remove the index path from the editing index paths list\n                editingIndexPaths.splice(i, 1);\n\n                var cell = this.collectionView.cellAtIndexPath(indexPath);\n\n                // If an editing mashup is specified and the edited cell is visible, release the cell and if it is still visible, refresh its contents\n                if (cell && cellMashupNameEditing) {\n\n                    cell.release();\n\n                    // Upon releasing the cell, check to see if there is still a cell bound to the specified index path\n                    cell = this.collectionView.cellAtIndexPath(indexPath);\n\n                    // If there is one, refresh it back to the readonly mashup\n                    if (cell) this.collectionView.refreshCellAtIndexPath(indexPath, {animated : YES});\n\n                }\n                // Otherwise, just update the editing parameter and release the cell\n                else if (cell && cellMashupEditingParameter) {\n                    var mashup = cell.BM_mashup;\n                    cell.release();\n\n                    if (!mashup) return;\n\n                    try {\n                        mashup.BM_setParameterInternal(cellMashupEditingParameter, YES);\n                    }\n                    catch (e) {\n                        TW.log.error(e);\n                    }\n                }\n                else if (cell) {\n                    cell.release();\n                }\n\n                return;\n            }\n        }\n    };\n\n    /**\n     * Returns YES if the cell at the specified index path is being edited.\n     * @param indexPath <BMIndexPath>        The index path to verify.\n     * @return <Boolean>                    YES if the cell at specified index path is being edited, NO otherwise.\n     */\n    this.isCellAtIndexPathEditing = function (indexPath) {\n        for (var i = 0; i < editingIndexPaths.length; i++) {\n            if (indexPath.isLooselyEqualToIndexPath(editingIndexPaths[i], {usingComparator : self.collectionView.identityComparator})) {\n                return YES;\n            }\n        }\n\n        return NO;\n    };\n\n    /**\n     * Creates a new item and inserts it into the data set at the specified index, then updates the collection view.\n     * @param index <Integer>                The data integer at which to insert the new item.\n     */\n    this.insertItemAtIndex = function (index) {\n        // Cannot create items without a predefined data shape\n        if (!dataShape) return;\n\n        // If the data has not been set yet, create it now\n        var newData;\n        if (!data) {\n            newData = {\n                dataShape : dataShape,\n                rows : []\n            };\n\n            // If data has not been set, skip the intro animation and immediately assign the data source\n            self.setProperty('PlaysIntroAnimation', NO);\n            self.updateProperty({TargetProperty : 'Data', SinglePropertyValue : newData, ActualDataRows : []});\n        }\n        else {\n            newData = {\n                dataShape : dataShape,\n                rows : data.slice()\n            }\n        }\n\n        // Create and insert the item\n        var newItem = {};\n        for (var key in dataShape.fieldDefinitions) {\n            if (key == UIDField) {\n                newItem[key] = self.uniqueIdentifier();\n            }\n            else {\n                newItem[key] = undefined;\n            }\n        }\n\n        newData.rows.splice(index == -1 ? newData.rows.length : index, 0, newItem);\n\n        // Publish the data update\n        self.updateProperty({TargetProperty : 'Data', SinglePropertyValue : newData, ActualDataRows : newData.rows}, {\n            completionHandler : function () {\n                // And mark the newly created cell as editing\n                self.beginEditingCellAtIndexPath(self.indexPathForObject(newItem));\n            }\n        });\n    };\n\n    /**\n     * Deletes the item with the given UID, then updates the collection view.\n     * @param uid <AnyObject>            The UID of the item to delete.\n     */\n    this.deleteItemWithUID = function (uid) {\n        if (!data || !dataShape) return;\n\n        for (var i = 0; i < data.length; i++) {\n            if (data[i][UIDField] == uid) {\n                var newData = {\n                    dataShape : dataShape,\n                    rows : data.slice()\n                };\n\n                newData.rows.splice(i, 1);\n\n                self.updateProperty({\n                    TargetProperty : 'Data',\n                    SinglePropertyValue : newData,\n                    ActualDataRows : newData.rows\n                });\n\n                return;\n            }\n        }\n    };\n\n\n    /**\n     * Generates and returns an identifier that is guaranteed to be unique for the current data set.\n     * @return <AnyObject, nullable>            A unique identifier, or undefined if there is no data shape defined or if the UID field is of an unsupported type.\n     */\n    this.uniqueIdentifier = function () {\n\n        if (!dataShape) return;\n\n        var baseType = dataShape.fieldDefinitions[UIDField].baseType;\n        if (baseType == 'STRING' || baseType == 'GUID') {\n            // For strings, generate an UUID\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n                return v.toString(16);\n            });\n        }\n        else if (baseType == 'NUMBER' || baseType == 'INTEGER') {\n            // For numbers, return one number over the highest UID in the data set\n            return data.reduce(function (max, value) {\n                    return value > max ? value : max;\n                }, 0) + 1;\n        }\n\n    };\n\n\n    // *************************** MASHUP LOADER AND UTILITIES *****************************\n\n    /**\n     * Retrieves and caches the definition for the given mashup.\n     * If the mashup definition is already cached, it is returned synchronously.\n     * @param name <String>                                                                                The name of the mashup whose definition to retrieve.\n     * {\n     *    @param atomic <Boolean, nullable>                                                                Defaults to YES. If set to YES, the request will be synchronous, otherwise it will by asynchronous.\n     *  @param completionHandler <void ^(nullable TWMashupDefinition, nullable error), nullable>        A completion handler to invoke when the mashup definition was retrieved or an error occurs.\n     *                                                                                                    The handler returns nothing and receives two parameters:\n     *                                                                                                        - The mashup definition if it could be retrieved\n     *                                                                                                        - The error if the mashup definition could not be retrieved\n     * }\n     * @return <TWMashupDefinition, nullable>                                                            The mashup definition if the request was atomic and it could be retrieved,\n     *                                                                                                    undefined otherwise.\n     */\n    this.definitionForMashupNamed = function (name, args) {\n        args = args || {};\n        if (args.atomic === undefined) args.atomic = YES;\n\n        // Return the cached definition if it is already available\n        if (BMCollectionViewMashupDefinitionCache[name]) {\n            if (args.completionHandler) {\n                args.completionHandler(BMCollectionViewMashupDefinitionCache[name]);\n            }\n\n            return BMCollectionViewMashupDefinitionCache[name];\n        }\n\n        var request = new XMLHttpRequest();\n\n        request.open('GET', \"/Thingworx/Mashups/\" + TW.encodeEntityName(name), !args.atomic);\n\n        request.setRequestHeader('Content-Type', 'application/json');\n        request.setRequestHeader('Accept', 'application/json');\n        request.setRequestHeader('x-thingworx-session', 'true');\n\n        // This will hold the actual mashup object once the XHR finishes loading\n        var mashupDefinition;\n\n        request.onload = function (data) {\n            if (this.status == 200) {\n                mashupDefinition = JSON.parse(request.responseText);\n                // Cache the mashup definition\n                BMCollectionViewMashupDefinitionCache[name] = mashupDefinition;\n\n                // Then invoke the completion handler\n                if (args.completionHandler) {\n                    args.completionHandler(mashupDefinition);\n                }\n            }\n            else {\n                if (args.completionHandler) {\n                    args.completionHandler(undefined, new Error('The mashup could not be loaded. The server returned status code ' + this.status));\n                }\n            }\n        };\n\n        request.onerror = function (error) {\n            TW.Runtime.showStatusText('permission-error', 'Could not load \"' + Encoder.htmlEncode(name) + '\". Reason: ' + request.status + ' - ' + request.responseText, true);\n            if (args.completionHandler) {\n                args.completionHandler(undefined, eror);\n            }\n        };\n\n        request.send();\n        return mashupDefinition;\n    };\n\n    /**\n     * Should be invoked to construct the mashup with the given name within the specified container.\n     * Invoking this method will cause the container's HTML ID to change to a newly generated unique ID.\n     * @param name <String>                                                    The mashup's name.\n     * {\n     *    @param inContainer <$>                                                The container in which the mashup should be rendered.\n     *    @param withParameters <Dictionary<String, AnyObject>, nullable>        An optional list of parameters to pass to the mashup.\n     *    @param forCell <BMCell>                                                The cell instance that this mashup will be rendered in.\n     * }\n     * @return <TWMashup>                                                    The created mashup object.\n     */\n    this.renderMashupNamed = function (name, options) {\n        var mashupDefinition;\n        if (mashupDefinition = BMCollectionViewMashupDefinitionCache[name]) {\n            return self.renderMashupWithDefinition(mashupDefinition, {\n                inContainer : options.inContainer,\n                parameters : options.withParameters,\n                forCell : options.forCell\n            });\n        }\n        else {\n            // Load the mashup's definition if it doesn't already exist\n            // TODO maybe make asnyc?\n            return self.renderMashupWithDefinition(self.definitionForMashupNamed(name, {atomic : YES}), {\n                inContainer : options.inContainer,\n                parameters : options.withParameters,\n                forCell : options.forCell\n            });\n        }\n    };\n\n    /**\n     * Should be invoked to construct the mashup with the given definition within the specified container.\n     * Invoking this method will cause the container's HTML ID to change to a newly generated unique ID.\n     * @param definition <Object>                                            The mashup's JSON definition.\n     * {\n     *    @param inContainer <$>                                                The container in which the mashup should be rendered.\n     *    @param parameters <Dictionary<String, AnyObject>, nullable>            An optional list of parameters to pass to the mashup.\n     *    @param forCell <BMCell>                                                The cell instance that this mashup will be rendered in.\n     * }\n     * @return <TWMashup>                                                    The created mashup object.\n     */\n    this.renderMashupWithDefinition = function (definition, options) {\n        // Save a reference to the currently loaded mashup and its HTML ID, so it can be restored afterwards\n        var currentHTMLID = TW.Runtime.HtmlIdOfCurrentlyLoadedMashup;\n        var currentMashup = TW.Runtime.Workspace.Mashups.Current;\n\n        var container = options.inContainer;\n\n        // Increment the mashup serial version to generate a unique ID for this mashup\n        BMCollectionViewWidgetSerialVersion++;\n\n        var mashupContent = definition.mashupContent;\n\n        // Construct the mashup object and its associated data object\n        var mashup = new TW.MashupDefinition();\n\n        // Add a hook into setParameter, to allow data updates\n        mashup.BM_setParameterInternal = mashup.setParameter;\n        mashup.setParameter = function (key, value) {\n            // Allow the mashup to update the parameter internally\n            this.BM_setParameterInternal(key, value);\n\n            // Don't publish changes originating from unbound cells\n            if (this._BMCell.BM_recycled) return;\n\n            // Global keys will update the associated global property, rather than the data attribute\n            if (key in globalDataShape) {\n                self.setProperty(key, value);\n                return;\n            }\n\n            // Otherwise publish the update to the data property\n            var updatedParameters = BMKeysForValue(key, {inObject : cellMashupPropertyBinding});\n\n            updatedParameters.forEach(function (parameter) {\n                // Use the typecast value rather than the raw value\n                mashup._BMCell.indexPath.object[parameter] = mashup.rootWidget.getProperty(key);\n            });\n\n            // Dispatch a property update to the Thingworx runtime\n            self.setProperty('Data', self.getProperty('Data'));\n\n        };\n\n        mashup.dataMgr = new DataManager();\n\n        // Set up the unique IDs\n        // Replace dots with underscores so they don't throw off the jQuery selectors used by Thingworx\n        mashup.rootName = definition.name.replace(/./g, '_') + '-' + BMCollectionViewWidgetSerialVersion;\n        container.attr('id', mashup.rootName);\n        mashup.htmlIdOfMashup = '#' + mashup.rootName;\n        TW.Runtime.HtmlIdOfCurrentlyLoadedMashup = mashup.htmlIdOfMashup;\n\n        mashup.mashupName = definition.name;\n\n        // Trigger the mashup load\n        mashup.loadFromJSON(mashupContent, definition);\n\n        // Construct the bindings\n        mashup.dataMgr.migrateAnyBindings(mashup);\n        TW.Runtime.Workspace.Mashups.Current = mashup;\n\n        // Use fast widget append if enabled\n        if (self.getProperty('[Experimental] Fast widget append')) {\n            self.fastWidgetAppend.call(mashup.rootWidget, container);\n        }\n        else {\n            // Move the mashup into the container\n            mashup.rootWidget.appendTo(container);\n        }\n        mashup.dataMgr.loadFromMashup(mashup);\n\n        mashup.parameterDefinitions = definition.parameterDefinitions;\n\n        mashup._BMCell = options.forCell;\n        mashup._BMCollectionView = collectionView;\n        mashup._BMCollectionViewController = self;\n\n        options.forCell.BM_mashup = mashup;\n\n        // Store a reference to this mashup in the container's data dictionary\n        container.data('mashup', mashup);\n\n        // Set up the parameter values\n        for (var parameter in options.parameters) {\n            mashup.BM_setParameterInternal(parameter, options.parameters[parameter]);\n        }\n\n        // Fire the MashupLoaded event to signal that loading is complete\n        mashup.fireMashupLoadedEvent();\n\n        // Let the delegate know that the mashup was rendered if needed\n        if (mashup.BMCellDelegate && mashup.BMCellDelegate.collectionViewDidRenderCell) {\n            mashup.BMCellDelegate.collectionViewDidRenderCellForIndexPath(collectionView, cell);\n        }\n\n        // Restore the previous mashup ID and object\n        TW.Runtime.HtmlIdOfCurrentlyLoadedMashup = currentHTMLID;\n        TW.Runtime.Workspace.Mashups.Current = currentMashup;\n\n        return mashup;\n\n    };\n\n\n    /**\n     * Highly experimental fast widget append method. This will skip creating the bounding boxes and outer containers and simply\n     * create and insert the renderHTML result directly into the page.\n     * When this method is invoked, it will have the widget element as its context.\n     * Note that unlike the regular widget appendTo prototype method, this will invoke all widget methods without catching errors.\n     * Additionally, this method does not handle page mashup containers, dashboards and Internet Explorer specific fixes.\n     * @param container <$>            The jQuery container in which the widget should be added.\n     * @param mashup <TWMashup>        The mashup to which this widget belongs.\n     */\n    this.fastWidgetAppend = function (container, mashup) {\n        var widget = this;\n\n        // Create a unique ID for this widget and assign it to the jqElementId property\n        var ID = TW.Runtime.Workspace.Mashups.Current.rootName + \"_\" + this.properties.Id;\n        this.jqElementId = ID;\n\n        // Get the property attributes\n        var runtimeProperties = this.runtimeProperties();\n        this.propertyAttributes = runtimeProperties.propertyAttributes || {};\n\n        // Data loading and error are never supported by this method\n        runtimeProperties.needsDataLoadingAndError = NO;\n        runtimeProperties.needsError = NO;\n        this.properties.ShowDataLoading = NO;\n\n        // Set up the mashup reference\n        this.mashup = TW.Runtime.Workspace.Mashups.Current;\n        this.idOfThisMashup = TW.Runtime.HtmlIdOfCurrentlyLoadedMashup;\n        this.idOfThisElement = this.properties.Id;\n\n        // TODO inspect what this does\n        for (var name in this.propertyAttributes) {\n            var attributes = this.propertyAttributes[name];\n            if (attributes.localizedString) {\n                if (this.properties[name]) {\n                    TW.log.error('Runtime Widget is using localizedString for a property already defined in ide.js, widget:\"' + ID + '\", property:\"' + name + '\"');\n                }\n                else {\n                    properties[name] = TW.Runtime.convertLocalizableString('[[' + localizedString + ']]');\n                }\n            }\n        }\n\n        // Add mashup styles for mashup widgets\n        if (this.properties.Type === 'mashup' || this.properties.Type === 'targetmashup' ||\n            this.properties.Type === 'thingtemplatemashup' || this.properties.Type === 'thingshapemashup') {\n            container.prepend('<div class=\"mashup-styles\"></div>');\n        }\n\n        // Find out if this is a responsive widget\n        var isResponsive = (this.properties.ResponsiveLayout || this.properties.Type === 'container');\n\n        // The layout CSS is generated based on whether this widget is responsive or not\n        var layoutCSS;\n        if (isResponsive) {\n            // Responsive widgets fill their container from the top-left corner\n            layoutCSS = {\n                width : '100%',\n                height : '100%',\n                position : 'absolute',\n                left : '0px',\n                top : '0px'\n            };\n        }\n        else {\n            // Non-responsive widgets have variable sizes and positions\n            layoutCSS = {\n                width : this.properties.Width + 'px',\n                height : this.properties.Height + 'px',\n                position : 'absolute',\n                left : this.properties.Left + 'px',\n                top : this.properties.Top + 'px'\n            };\n        }\n\n        // NOTE: Labels are not supported by this method.\n\n        // Obtain the HTML representation of this widget\n        var widgetElement = $(this.renderHtml());\n\n        // Set up the ID and layout of the element\n        widgetElement.attr('id', ID);\n        // Some widgets use the jQuery method closest() to find their bounding box instead of the platform standard boundingBox property.\n        // As fastWidgetAppend does not create bounding boxes, this will cause those widget to obtain bounding boxes belonging to other widgets.\n        // To counter this, the widget element will get the widget-bounding-box class in addition to the widget-content class.\n        widgetElement.addClass('widget-bounding-box');\n        widgetElement.css(layoutCSS);\n\n        // The bounding box and jQuery element are identical for this method\n        // NOTE: this may cause certain widgets to behave in an unexpected manner.\n        this.jqElement = widgetElement;\n        this.boundingBox = widgetElement;\n\n        // Add the widget element to the container\n        container.append(widgetElement);\n\n        // Mashup containers and page mashup containers need an additional containerInfo object\n        if (runtimeProperties.isMashupContainer || runtimeProperties.isPageMashupContainers) {\n            this.containerInfo = {thisPropertyId : ID};\n        }\n\n        // Add data structures to the jQuery element\n        widgetElement.data('widget', this);\n        widgetElement.data('properties', this.properties);\n\n        // Invoke afterRender\n        if (this.afterRender) {\n            // All responsive widgets should have their sizing properties initialized before invoking afterRender\n            if (this.properties.ResponsiveLayout || this.properties.supportsAutoResize) {\n                this.properties.Width = widgetElement.outerWidth();\n                this.properties.Height = widgetElement.outerHeight();\n            }\n\n            this.afterRender();\n        }\n\n        // NOTE: this method does not support older versions of internet explorer\n\n        // Add the styles to the mashup if supported\n        if (this.renderStyles) {\n            this.mashup.addStyles(this.renderStyles());\n        }\n\n        // Append the contained widgets\n        var widgets = this.getWidgets();\n        var widgetCount = widgets.length;\n\n        // Containers with declarative spots for sub-widgets need to have their widgets added to specific containers whenever possible\n        if (runtimeProperties.isContainerWithDeclarativeSpotsForSubWidgets) {\n            for (var i = 0; i < widgetCount; i++) {\n                // Find the container in which this widget should go\n                var widgetContainer = widgetElement.find('[sub-widget-container-id=\"' + this.properties.Id + '\"][sub-widget=\"' + (i + 1) + '\"]');\n                if (widgetContainer.length > 0) {\n                    // If it was found, add it to that container\n                    self.fastWidgetAppend.call(widgets[i], widgetContainer);\n                }\n                else {\n                    // If it wasn't found, just add it to the widget directly\n                    self.fastWidgetAppend.call(widgets[i], widgetElement);\n                }\n            }\n        }\n        else {\n            for (var i = 0; i < widgetCount; i++) {\n                // Sub widgets are also rendered using fastWidgetAppend instead of the platform standard appendTo\n                self.fastWidgetAppend.call(widgets[i], widgetElement);\n            }\n        }\n\n        // Set up the z-index\n        // To keep things consistent with the rest of the platform, 1500 is added to all non-mashup z-indexes, with a maximum value of 6500\n        if (this.properties['Z-index']) {\n            if (this.properties.Id === 'mashup-root') {\n                widgetElement.css('z-index', this.properties['Z-index']);\n            }\n            else {\n                widgetElement.css('z-index', Math.min(this.properties['Z-index'] + 1500, 6500));\n            }\n        }\n\n        // If the widget has a border, it needs its box-sizing set to border-box so it doesn't overflow its bounds\n        if (runtimeProperties.borderWidth) {\n            widgetElement.css('box-sizing', 'border-box');\n        }\n\n        // Invoke afterWidgetsRendered if available\n        if (this.afterWidgetsRendered) {\n            this.afterWidgetsRendered();\n        }\n\n        // Hide widgets that are not visible\n        if (!this.properties.Visible) {\n            widgetElement.hide();\n        }\n\n        // NOTE: dashboards are not supported\n        // NOTE: page mashup containers are not supported\n\n        // Check to see if this widget supports selection updates\n        if (this.handleSelectionUpdate) {\n            this.lastSelectionUpdateCount = 0;\n\n            // Find and enumerate this widget's bindings, looking for 'All Data' bindings.\n            var bindings = this.mashup.findDataBindingsByTargetAreaAndId('UI', this.properties.Id);\n            $.each(bindings, function (index, binding) {\n                var isBoundToSelectedRows = TW.Runtime.isBindingBoundToSelectedRows(this);\n\n                if (!isBoundToSelectedRows && this.PropertyMaps[0].TargetPropertyBaseType === 'INFOTABLE') {\n                    // If this binding is an 'All Data' infotable binding, register this widget as an observer for selected rows\n                    widget.mashup.dataMgr.addSelectedRowsForWidgetHandleSelectionUpdateSubscription(binding, function (sourceId, selectedRows, selectedRowIndices) {\n                        // Only notify if the selection update comes from a different widget\n                        if (sourceId !== widget.jqElementId) {\n                            widget.handleSelectionUpdate(binding.PropertyMaps[0].TargetProperty, selectedRows, selectedRowIndices);\n                        }\n                    });\n                }\n            });\n        }\n\n    };\n\n    this.addNoBindingWarning = function() {\n        this.jqElement.find(\".configuration-warning\").remove();\n        var configurationWarningElement = '<div class=\"configuration-warning\">' + TW.Runtime.convertLocalizableString(\"[[mustBeBoundToData]]\", \"Must be bound to data.\") + '</div>';\n        this.jqElement.append(configurationWarningElement);\n    };\n    this.addNoMashupWarning = function() {\n        this.jqElement.find(\".configuration-warning\").remove();\n        var configurationWarningElement = '<div class=\"configuration-warning\">' + TW.Runtime.convertLocalizableString(\"[[MashupRequired]]\", \"Mashup or MashupNameField property required.\") + '</div>';\n        this.jqElement.append(configurationWarningElement);\n    };\n    this.addNoUIDFieldWarning = function() {\n        this.jqElement.find(\".configuration-warning\").remove();\n        var configurationWarningElement = '<div class=\"configuration-warning\">' + TW.Runtime.convertLocalizableString(\"[[UIDFieldRequired]]\", \"Configuration Error: Must have UIDField assigned.\") + '</div>';\n        this.jqElement.append(configurationWarningElement);\n    };\n};\n\n; }).apply(self); widget.jqElement.triggerHandler(\"Changed\")//# sourceURL=combined.js",
                          "FireOnFirstValue" : false,
                          "Height" : 28,
                          "Id" : "expression-8",
                          "Left" : 10,
                          "OutputBaseType" : "NUMBER",
                          "ResponsiveLayout" : false,
                          "ShowDataLoading" : true,
                          "Top" : 10,
                          "Type" : "expression",
                          "Visible" : true,
                          "Width" : 200,
                          "Z-index" : 10,
                          "__TypeDisplayName" : "Expression",
                          "editMode" : "edit",
                          "helperType" : "expression"
                        },
                        "Widgets" : [ ]
                      } ]
                    } ]
                  }, {
                    "Properties" : {
                      "AnimateExpandCollapse" : true,
                      "Area" : "UI",
                      "BGImageRepeat" : "no-repeat",
                      "BGImageSize" : "auto",
                      "DisplayName" : "Content",
                      "ExpandCollapseTabLocation" : "outside",
                      "Expanded" : true,
                      "Id" : "container-3",
                      "MinHeight" : 0,
                      "MinWidth" : 0,
                      "Overlay" : false,
                      "OverlayIsTransparent" : false,
                      "ResponsiveLayout" : true,
                      "ShowDataLoading" : true,
                      "ShowExpandCollapseTab" : false,
                      "Style" : "DefaultContainerStyle",
                      "TabCollapseStyle" : "DefaultTabCollapseStyle",
                      "TabExpandStyle" : "DefaultTabExpandStyle",
                      "TabHeight" : 36,
                      "TabLocation" : "center",
                      "TabOffset" : 0,
                      "TabWidth" : 36,
                      "Type" : "container",
                      "Visible" : true,
                      "Z-index" : 10,
                      "__TypeDisplayName" : "Container",
                      "userCannotRemove" : true
                    },
                    "Widgets" : [ {
                      "Properties" : {
                        "Area" : "UI",
                        "Columns" : 1,
                        "DisplayName" : "Content Layout",
                        "Footer" : false,
                        "FooterHeight" : 0,
                        "Header" : false,
                        "HeaderHeight" : 0,
                        "Id" : "layout-4",
                        "IncludeSpacingInFixedAreas" : false,
                        "IsPrintLayout" : false,
                        "LeftSidebar" : false,
                        "LeftSidebarWidth" : 0,
                        "Orientation" : "horizontal",
                        "PctColumn1" : 100,
                        "PctColumn2" : 50,
                        "PctColumn3" : 1,
                        "PctColumn4" : 1,
                        "PctColumn5" : 1,
                        "PctColumn6" : 1,
                        "PctColumn7" : 1,
                        "PctColumn8" : 1,
                        "PctRow1" : 50,
                        "PctRow2" : 50,
                        "PctRow3" : 0,
                        "PctRow4" : 0,
                        "PctRow5" : 0,
                        "PctRow6" : 0,
                        "PctRow7" : 0,
                        "PctRow8" : 0,
                        "PrintMarginLeftRight" : 0.5,
                        "PrintMarginTopBottom" : 0.5,
                        "PrintWidth" : 650,
                        "ResponsiveLayout" : true,
                        "RightSidebar" : false,
                        "RightSidebarWidth" : 0,
                        "Rows" : 0,
                        "ShowDataLoading" : true,
                        "Spacing" : 2,
                        "Type" : "layout",
                        "Visible" : true,
                        "Z-index" : 10,
                        "__TypeDisplayName" : "Layout"
                      },
                      "Widgets" : [ {
                        "Properties" : {
                          "AnimateExpandCollapse" : true,
                          "Area" : "UI",
                          "BGImageRepeat" : "no-repeat",
                          "BGImageSize" : "auto",
                          "DisplayName" : "Page Mashup Container",
                          "ExpandCollapseTabLocation" : "outside",
                          "Expanded" : true,
                          "Id" : "container-5",
                          "MinHeight" : 0,
                          "MinWidth" : 0,
                          "Overlay" : false,
                          "OverlayIsTransparent" : false,
                          "ResponsiveLayout" : true,
                          "ShowDataLoading" : true,
                          "ShowExpandCollapseTab" : false,
                          "Style" : "DefaultContainerStyle",
                          "TabCollapseStyle" : "DefaultTabCollapseStyle",
                          "TabExpandStyle" : "DefaultTabExpandStyle",
                          "TabHeight" : 36,
                          "TabLocation" : "center",
                          "TabOffset" : 0,
                          "TabWidth" : 36,
                          "Type" : "container",
                          "Visible" : true,
                          "Z-index" : 10,
                          "__TypeDisplayName" : "Container",
                          "userCannotRemove" : true
                        },
                        "Widgets" : [ {
                          "Properties" : {
                            "Area" : "UI",
                            "DisplayName" : "Page Mashup",
                            "Height" : 300,
                            "Id" : "pagemashupcontainer-6",
                            "Left" : 0,
                            "Name" : "",
                            "ResponsiveLayout" : true,
                            "ShowDataLoading" : true,
                            "Top" : 0,
                            "Type" : "pagemashupcontainer",
                            "Visible" : true,
                            "Width" : 400,
                            "Z-index" : 10,
                            "__TypeDisplayName" : "Page Mashup Container"
                          },
                          "Widgets" : [ ]
                        } ]
                      } ]
                    } ]
                  } ]
                }, {
                  "Properties" : {
                    "Area" : "UI",
                    "AutoEvaluate" : false,
                    "DataChangeType" : "ALWAYS",
                    "DisplayName" : "sandbox",
                    "Expression" : "window.parent.TW.evalInSandbox = function(inputs, exp) {\n    return (new window.parent.Function('inputs', 'exp', 'with (inputs) {return eval(exp);}'))(inputs, exp);\n}",
                    "FireOnFirstValue" : false,
                    "Height" : 28,
                    "Id" : "expression-11",
                    "Left" : 0,
                    "OutputBaseType" : "NUMBER",
                    "ShowDataLoading" : true,
                    "Top" : 0,
                    "Type" : "expression",
                    "Visible" : true,
                    "Width" : 200,
                    "Z-index" : 10,
                    "__TypeDisplayName" : "Expression",
                    "_currentParameterDefs" : [ ],
                    "editMode" : "edit",
                    "helperType" : "expression",
                    "parameters" : [ ],
                    "parametersToDelete" : [ ]
                  },
                  "Widgets" : [ ]
                } ]
              },
              "mashupType" : "targetmashup"
            }
            ]]>
            </mashupContent>
            <preview></preview>
        </Mashup>
    </Mashups>
</Entities>
